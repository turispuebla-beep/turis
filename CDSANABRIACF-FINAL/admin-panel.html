<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - CDSANABRIACF</title>
    <script src="database.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .admin-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .admin-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .admin-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .current-admin {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .logout-btn {
            background: rgba(220,53,69,0.8);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(220,53,69,1);
        }

        .navigation {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: #e9ecef;
            color: #495057;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .nav-tab:hover {
            background: #6c757d;
            color: white;
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .admin-content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border: 2px solid #f0f0f0;
        }

        .dashboard-card h3 {
            color: #1e3a8a;
            margin-bottom: 10px;
        }

        .dashboard-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            background: #fafafa;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #1e3a8a;
            padding-bottom: 10px;
        }

        .btn {
            background: #1e3a8a;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #2563eb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .admin-info {
                flex-direction: column;
                gap: 10px;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }
        /* Estilos para la sección de administradores */
        .admin-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .admin-table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        .admin-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1.5fr 1fr 1.5fr;
            gap: 10px;
            padding: 10px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .admin-row.header {
            font-weight: bold;
            background: #f8f9fa;
            border-radius: 5px 5px 0 0;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.9rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #e2e8f0;
            margin: 0 5px;
        }

        .btn-small:hover {
            background: #cbd5e1;
        }

        .btn-small.delete {
            background: #fee2e2;
        }

        .btn-small.delete:hover {
            background: #fecaca;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .status-badge.active {
            background: #dcfce7;
            color: #166534;
        }

        .status-badge.inactive {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <h1>⚽ Panel de Administración</h1>
            <p>CDSANABRIACF - Club Deportivo Sanabriacf</p>
            <div class="admin-info">
                <div class="current-admin" id="currentAdminInfo">
                    👤 Cargando información del administrador...
                </div>
                <button class="logout-btn" onclick="logout()">🚪 Cerrar Sesión</button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('dashboard')">📊 Dashboard</button>
                <button class="nav-tab" onclick="showTab('equipos')">⚽ Equipos</button>
                <button class="nav-tab" onclick="showTab('jugadores')">👥 Jugadores</button>
                <button class="nav-tab" onclick="showTab('calendario')">📅 Calendario</button>
                <button class="nav-tab" onclick="showTab('eventos')">🎉 Eventos</button>
                <button class="nav-tab" onclick="showTab('encuentros')">⚽ Encuentros</button>
                <button class="nav-tab" onclick="showTab('socios')">👨‍👩‍👧‍👦 Socios</button>
                        <button class="nav-tab" onclick="showTab('amigos')">🤝 Amigos del Club</button>
        <button class="nav-tab" onclick="showTab('entrenadores')">👨‍🏫 Entrenadores</button>
                <button class="nav-tab" onclick="showTab('documentos')">📄 Documentos</button>
                <button class="nav-tab" onclick="showTab('publicidad')">📢 Publicidad</button>
        <button class="nav-tab" onclick="showTab('mensajes')">📱 Mensajes Push</button>
        <button class="nav-tab" onclick="showTab('exportar')">📊 Exportar Datos</button>
                <button class="nav-tab" onclick="showTab('basedatos')">🗄️ Base de Datos</button>
        <button class="nav-tab" onclick="showTab('importar')">📥 Importar Datos</button>
        <button class="nav-tab" onclick="showTab('competiciones')">🏆 Competiciones</button>
        <button class="nav-tab" onclick="showTab('multimedia')">📸 Multimedia</button>
        <button class="nav-tab" onclick="showTab('tienda')">🏪 Tienda</button>
        <button class="nav-tab" onclick="showTab('configuracion')">⚙️ Configuración</button>
            </div>
        </div>

        <!-- Content -->
        <div class="admin-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="success-message">
                    ✅ Autenticación exitosa. Bienvenido al panel de administración de CDSANABRIACF
                </div>
                
                <h2>📊 Panel de Control</h2>
                
                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <h3>⚽ Equipos Activos</h3>
                        <div class="number">5</div>
                        <p>Categorías registradas</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>👥 Jugadores</h3>
                        <div class="number" id="playersCount">0</div>
                        <p>Jugadores registrados</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>👨‍👩‍👧‍👦 Socios</h3>
                        <div class="number" id="membersCount">0</div>
                        <p>Socios del club</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>🎉 Eventos</h3>
                        <div class="number" id="eventsCount">0</div>
                        <p>Eventos programados</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>🏆 Competiciones</h3>
                        <div class="number" id="competitionsCount">0</div>
                        <p>Competiciones activas</p>
                    </div>
                </div>

                            <div class="section" data-team="all">
                <h2>📈 Resumen del Club</h2>
                    <p><strong>🎯 Sistema completamente funcional</strong></p>
                    <p>Desde este panel puedes gestionar todos los aspectos del club CDSANABRIACF:</p>
                    <ul style="margin: 20px 0; padding-left: 30px;">
                        <li><strong>⚽ Equipos:</strong> Gestiona las 5 categorías (Prebenjamín, Benjamín, Alevín, Infantil, Aficionado)</li>
                        <li><strong>👥 Jugadores:</strong> Administra fichas de jugadores con datos personales y de contacto</li>
                        <li><strong>📅 Calendario:</strong> Programa entrenamientos y partidos</li>
                        <li><strong>🎉 Eventos:</strong> Organiza actividades y eventos especiales</li>
                        <li><strong>🏆 Competiciones:</strong> Crea y gestiona ligas, torneos y campeonatos</li>
                        <li><strong>👨‍👩‍👧‍👦 Socios:</strong> Administra la base de socios del club</li>
                        <li><strong>📸 Multimedia:</strong> Gestiona fotos y videos del club</li>
                    </ul>
                    
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <h4>🔐 Sistema de Acceso Seguro:</h4>
                        <p><strong>✅ Panel de administración configurado y funcional</strong></p>
                        <p><strong>🔒 Acceso restringido a administradores autorizados</strong></p>
                    </div>
                </div>
            </div>

            <!-- Equipos Tab -->
            <div id="equipos" class="tab-content">
                <h2>⚽ Gestión de Equipos</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>Categorías del Club CDSANABRIACF</h3>
                        <button class="btn btn-success" onclick="showAddTeamForm()">➕ Crear Nuevo Equipo</button>
                    </div>
                    
                    <!-- Formulario para crear nuevo equipo -->
                    <div id="addTeamForm" style="display: none; margin-bottom: 30px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>🏆 Crear Nuevo Equipo</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre del Equipo *</label>
                                <input type="text" id="teamName" required placeholder="Ej: Prebenjamín A, Benjamín B" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categoría *</label>
                                <select id="teamCategory" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar categoría</option>
                                    <option value="prebenajmin">Prebenjamín (6-8 años)</option>
                                    <option value="benjamin">Benjamín (8-10 años)</option>
                                    <option value="alevin">Alevín (10-12 años)</option>
                                    <option value="infantil">Infantil (12-14 años)</option>
                                    <option value="aficionado">Aficionado (18+ años)</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Entrenador</label>
                                <input type="text" id="teamCoach" placeholder="Nombre del entrenador" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Campo de Entrenamiento</label>
                                <input type="text" id="teamField" placeholder="Ubicación del campo" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Horario de Entrenamiento</label>
                                <input type="text" id="teamSchedule" placeholder="Ej: Lunes y Miércoles 17:00-18:30" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Estado</label>
                                <select id="teamStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="active">Activo</option>
                                    <option value="inactive">Inactivo</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; text-align: center;">
                            <button class="btn btn-success" onclick="saveTeam()" style="margin-right: 10px;">💾 Guardar Equipo</button>
                            <button class="btn" onclick="cancelAddTeam()">❌ Cancelar</button>
                        </div>
                    </div>
                    
                    <div class="dashboard-cards" id="teamsCards">
                        <!-- Las tarjetas se generarán dinámicamente -->
                    </div>
                </div>
            </div>

            <!-- Otras pestañas -->
            <div id="jugadores" class="tab-content">
                <h2>👥 Gestión de Jugadores</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar por Categoría</h3>
                            <select id="categoryFilter" onchange="filterPlayersByCategory()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todas las Categorías</option>
                                <option value="prebenajmin">Prebenjamín (6-8 años)</option>
                                <option value="benjamin">Benjamín (8-10 años)</option>
                                <option value="alevin">Alevín (10-12 años)</option>
                                <option value="infantil">Infantil (12-14 años)</option>
                                <option value="aficionado">Aficionado (18+ años)</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddPlayerForm()">➕ Registrar Nuevo Jugador</button>
                    </div>
                    
                    <!-- Formulario para añadir jugador -->
                    <div id="addPlayerForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>📝 Registrar Nuevo Jugador</h4>
                        
                        <!-- Datos del Jugador -->
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>👤 Datos del Jugador</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre *</label>
                                    <input type="text" id="playerName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Apellidos *</label>
                                    <input type="text" id="playerSurname" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">DNI *</label>
                                    <input type="text" id="playerDNI" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Teléfono *</label>
                                    <input type="tel" id="playerPhone" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Nacimiento *</label>
                                    <input type="date" id="playerBirthDate" required onchange="calculateAge()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Edad</label>
                                    <input type="number" id="playerAge" readonly style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #f8f9fa;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categoría</label>
                                    <select id="playerCategory" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="">Seleccionar automáticamente</option>
                                        <option value="prebenajmin">Prebenjamín (6-8 años)</option>
                                        <option value="benjamin">Benjamín (8-10 años)</option>
                                        <option value="alevin">Alevín (10-12 años)</option>
                                        <option value="infantil">Infantil (12-14 años)</option>
                                        <option value="aficionado">Aficionado (18+ años)</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Dorsal</label>
                                    <input type="number" id="playerNumber" min="1" max="99" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Dirección</label>
                                <input type="text" id="playerAddress" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Posición</label>
                                    <select id="playerPosition" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="">Seleccionar posición</option>
                                        <option value="portero">Portero</option>
                                        <option value="defensa">Defensa</option>
                                        <option value="centrocampista">Centrocampista</option>
                                        <option value="delantero">Delantero</option>
                                        <option value="versatil">Versátil</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Licencia Federativa</label>
                                    <input type="text" id="playerLicense" placeholder="Número de licencia" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Foto del Jugador</label>
                                <input type="file" id="playerPhoto" accept="image/*" onchange="previewPlayerPhoto()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">Formatos: JPG, PNG. Máximo 2MB</small>
                                
                                <!-- Recuadro para mostrar la foto -->
                                <div id="photoPreview" style="margin-top: 10px; display: none;">
                                    <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 15px; text-align: center; background: #f8f9fa;">
                                        <img id="playerPhotoPreview" style="max-width: 200px; max-height: 200px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" alt="Vista previa de la foto">
                                        <div style="margin-top: 10px;">
                                            <button type="button" onclick="removePlayerPhoto()" style="background: #dc2626; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">🗑️ Eliminar Foto</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Datos del Tutor (aparece automáticamente para menores) -->
                        <div id="guardianSection" style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;">
                            <h5>👨‍👩‍👧‍👦 Datos del Padre/Madre/Tutor (Obligatorio para menores de edad)</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre del Tutor *</label>
                                    <input type="text" id="guardianName" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">DNI del Tutor *</label>
                                    <input type="text" id="guardianDNI" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Teléfono del Tutor *</label>
                                    <input type="tel" id="guardianPhone" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Email del Tutor *</label>
                                    <input type="email" id="guardianEmail" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Dirección del Tutor</label>
                                <input type="text" id="guardianAddress" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <!-- Estadísticas Deportivas -->
                        <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>⚽ Estadísticas Deportivas</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Partidos Jugados</label>
                                    <input type="number" id="playerMatches" min="0" value="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Goles Marcados</label>
                                    <input type="number" id="playerGoals" min="0" value="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Asistencias</label>
                                    <input type="number" id="playerAssists" min="0" value="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tarjetas Amarillas</label>
                                    <input type="number" id="playerYellowCards" min="0" value="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tarjetas Rojas</label>
                                    <input type="number" id="playerRedCards" min="0" value="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                        </div>

                        <!-- Consentimientos -->
                        <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>✅ Consentimientos Requeridos</h5>
                            <div style="margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; font-weight: bold;">
                                    <input type="checkbox" id="playerConsent" style="margin-right: 10px; transform: scale(1.2);"> 
                                    Consentimiento para ser jugador del equipo CDSANABRIACF *
                                </label>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; font-weight: bold;">
                                    <input type="checkbox" id="photoConsent" style="margin-right: 10px; transform: scale(1.2);"> 
                                    Consentimiento para aparecer en fotos y videos del club *
                                </label>
                            </div>
                            <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                                * Los consentimientos son obligatorios para completar el registro
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="savePlayer()" style="margin-right: 10px;">💾 Guardar Jugador</button>
                            <button class="btn" onclick="cancelAddPlayer()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Lista de jugadores -->
                <div class="section">
                    <h3>📋 Lista de Jugadores Registrados</h3>
                    <div id="playersListContainer">
                        <div id="playersList">
                            <!-- Los jugadores se cargarán aquí dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>

            <div id="calendario" class="tab-content">
                <h2>📅 Calendario</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Actividades</h3>
                            <select id="calendarFilter" onchange="filterCalendarEvents()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                                <option value="all">Todas las Actividades</option>
                                <option value="training">Entrenamientos</option>
                                <option value="match">Partidos</option>
                                <option value="meeting">Reuniones</option>
                            </select>
                            <select id="categoryCalendarFilter" onchange="filterCalendarEvents()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todas las Categorías</option>
                                <option value="prebenajmin">Prebenjamín</option>
                                <option value="benjamin">Benjamín</option>
                                <option value="alevin">Alevín</option>
                                <option value="infantil">Infantil</option>
                                <option value="aficionado">Aficionado</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddCalendarEventForm()">➕ Programar Actividad</button>
                    </div>
                    
                    <!-- Formulario para añadir evento del calendario -->
                    <div id="addCalendarEventForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>📝 Programar Nueva Actividad</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Título *</label>
                                <input type="text" id="calendarTitle" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Actividad *</label>
                                <select id="calendarType" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar tipo</option>
                                    <option value="training">🏃 Entrenamiento</option>
                                    <option value="match">⚽ Partido</option>
                                    <option value="meeting">💬 Reunión</option>
                                    <option value="event">🎉 Evento Especial</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha *</label>
                                <input type="date" id="calendarDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Hora de Inicio *</label>
                                <input type="time" id="calendarStartTime" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Hora de Fin *</label>
                                <input type="time" id="calendarEndTime" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categoría *</label>
                                <select id="calendarCategory" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar categoría</option>
                                    <option value="prebenajmin">Prebenjamín (6-8 años)</option>
                                    <option value="benjamin">Benjamín (8-10 años)</option>
                                    <option value="alevin">Alevín (10-12 años)</option>
                                    <option value="infantil">Infantil (12-14 años)</option>
                                    <option value="aficionado">Aficionado (18+ años)</option>
                                    <option value="all">Todas las categorías</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ubicación *</label>
                                <input type="text" id="calendarLocation" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Ej: Campo Municipal, Polideportivo...">
                            </div>
                        </div>

                        <!-- Campos específicos para partidos -->
                        <div id="matchFields" style="display: none; background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h5>⚽ Información del Partido</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Equipo Rival</label>
                                    <input type="text" id="rivalTeam" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">¿Local o Visitante?</label>
                                    <select id="homeAway" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="home">🏠 Local</option>
                                        <option value="away">✈️ Visitante</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Descripción</label>
                            <textarea id="calendarDescription" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Detalles adicionales sobre la actividad..."></textarea>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; font-weight: bold;">
                                <input type="checkbox" id="calendarRecurring" onchange="toggleRecurringOptions()" style="margin-right: 10px; transform: scale(1.2);"> 
                                Actividad recurrente (se repite semanalmente)
                            </label>
                        </div>

                        <div id="recurringOptions" style="display: none; background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Repetir hasta la fecha:</label>
                            <input type="date" id="recurringEndDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveCalendarEvent()" style="margin-right: 10px;">💾 Programar Actividad</button>
                            <button class="btn" onclick="cancelAddCalendarEvent()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Vista del calendario -->
                <div class="section">
                    <h3>📅 Vista de Calendario</h3>
                    <div style="background: white; border-radius: 10px; padding: 20px;">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button onclick="changeCalendarMonth(-1)" style="padding: 8px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">◀ Anterior</button>
                                <h4 id="currentMonthYear" style="margin: 0; min-width: 200px; text-align: center;">Febrero 2024</h4>
                                <button onclick="changeCalendarMonth(1)" style="padding: 8px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Siguiente ▶</button>
                            </div>
                            <button onclick="goToToday()" style="padding: 8px 12px; background: #1e3a8a; color: white; border: none; border-radius: 4px; cursor: pointer;">📅 Hoy</button>
                        </div>
                        <div id="calendarGrid">
                            <!-- El calendario se generará aquí -->
                        </div>
                    </div>
                </div>

                <!-- Lista de próximas actividades -->
                <div class="section">
                    <h3>📋 Próximas Actividades</h3>
                    <div id="upcomingActivities">
                        <!-- Las actividades se cargarán aquí dinámicamente -->
                    </div>
                </div>
            </div>

            <div id="eventos" class="tab-content">
                <h2>🎉 Eventos</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Eventos</h3>
                            <select id="eventStatusFilter" onchange="filterEvents()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                                <option value="all">Todos los Estados</option>
                                <option value="upcoming">Próximos</option>
                                <option value="ongoing">En Curso</option>
                                <option value="finished">Finalizados</option>
                            </select>
                            <select id="eventTypeFilter" onchange="filterEvents()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todos los Tipos</option>
                                <option value="free">Gratuitos</option>
                                <option value="paid">De Pago</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddEventForm()">➕ Crear Nuevo Evento</button>
                    </div>
                    
                    <!-- Formulario para crear evento -->
                    <div id="addEventForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>📝 Crear Nuevo Evento</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre del Evento *</label>
                                <input type="text" id="eventName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha del Evento *</label>
                                <input type="date" id="eventDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Hora de Inicio *</label>
                                <input type="time" id="eventStartTime" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Hora de Fin *</label>
                                <input type="time" id="eventEndTime" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ubicación *</label>
                                <input type="text" id="eventLocation" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Descripción del Evento *</label>
                            <textarea id="eventDescription" rows="3" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Describe el evento, actividades, etc..."></textarea>
                        </div>

                        <!-- Configuración de Inscripciones -->
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h5>👥 Configuración de Inscripciones</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Precio (€) *</label>
                                    <input type="number" id="eventPrice" min="0" step="0.01" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="0.00">
                                    <small style="color: #666;">Pon 0 para eventos gratuitos</small>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Mínimo de Inscritos *</label>
                                    <input type="number" id="eventMinParticipants" min="1" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Máximo de Inscritos *</label>
                                    <input type="number" id="eventMaxParticipants" min="1" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha Límite de Inscripción</label>
                                <input type="date" id="eventRegistrationDeadline" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">Si no se especifica, será hasta el día del evento</small>
                            </div>
                        </div>

                        <!-- Foto del Evento -->
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h5>📸 Foto del Evento</h5>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Subir Imagen del Evento</label>
                                <input type="file" id="eventImage" accept="image/*" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">Formatos aceptados: JPG, PNG, GIF. Tamaño máximo: 5MB</small>
                            </div>
                            <div id="eventImagePreview" style="display: none; text-align: center; margin-top: 10px;">
                                <img id="eventImagePreviewImg" style="max-width: 200px; max-height: 150px; border-radius: 8px;">
                            </div>
                        </div>

                        <!-- Consentimientos -->
                        <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>✅ Configuración de Consentimientos</h5>
                            <div style="margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; font-weight: bold;">
                                    <input type="checkbox" id="eventPhotoConsent" style="margin-right: 10px; transform: scale(1.2);"> 
                                    Los participantes deben autorizar aparecer en fotos y videos del evento
                                </label>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; font-weight: bold;">
                                    <input type="checkbox" id="eventDataConsent" style="margin-right: 10px; transform: scale(1.2);"> 
                                    Los participantes deben aceptar el tratamiento de sus datos personales
                                </label>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveEvent()" style="margin-right: 10px;">💾 Crear Evento</button>
                            <button class="btn" onclick="cancelAddEvent()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Lista de eventos -->
                <div class="section">
                    <h3>📋 Lista de Eventos</h3>
                    <div id="eventsList">
                        <!-- Los eventos se cargarán aquí dinámicamente -->
                    </div>
                </div>
            </div>

            <!-- Encuentros Tab -->
            <div id="encuentros" class="tab-content">
                <h2>⚽ Gestión de Encuentros</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Encuentros</h3>
                            <select id="encuentroStatusFilter" onchange="filterEncuentros()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                                <option value="all">Todos los estados</option>
                                <option value="programado">Programados</option>
                                <option value="en_curso">En Curso</option>
                                <option value="finalizado">Finalizados</option>
                                <option value="cancelado">Cancelados</option>
                            </select>
                            <select id="encuentroCategoriaFilter" onchange="filterEncuentros()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todas las categorías</option>
                                <option value="Prebenjamín">Prebenjamín</option>
                                <option value="Benjamín">Benjamín</option>
                                <option value="Alevín">Alevín</option>
                                <option value="Infantil">Infantil</option>
                                <option value="Aficionado">Aficionado</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddEncuentroForm()">➕ Crear Nuevo Encuentro</button>
                    </div>
                    
                    <!-- Formulario para crear encuentro -->
                    <div id="addEncuentroForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>⚽ Nuevo Encuentro</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Equipo Local *</label>
                                <input type="text" id="encuentroEquipoLocal" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Ej: CDSANABRIACF Prebenjamín">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Equipo Visitante *</label>
                                <input type="text" id="encuentroEquipoVisitante" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Ej: Club Rival">
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categoría *</label>
                                <select id="encuentroCategoria" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar categoría</option>
                                    <option value="Prebenjamín">Prebenjamín</option>
                                    <option value="Benjamín">Benjamín</option>
                                    <option value="Alevín">Alevín</option>
                                    <option value="Infantil">Infantil</option>
                                    <option value="Aficionado">Aficionado</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Encuentro *</label>
                                <select id="encuentroTipo" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar tipo</option>
                                    <option value="liga">Liga</option>
                                    <option value="torneo">Torneo</option>
                                    <option value="amistoso">Amistoso</option>
                                    <option value="entrenamiento">Entrenamiento</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha *</label>
                                <input type="date" id="encuentroFecha" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Hora *</label>
                                <input type="time" id="encuentroHora" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Campo de Juego *</label>
                                <input type="text" id="encuentroCampo" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Ej: Campo Municipal de Puebla de Sanabria">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Estado *</label>
                                <select id="encuentroEstado" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="programado">Programado</option>
                                    <option value="en_curso">En Curso</option>
                                    <option value="finalizado">Finalizado</option>
                                    <option value="cancelado">Cancelado</option>
                                </select>
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Descripción</label>
                            <textarea id="encuentroDescripcion" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Información adicional sobre el encuentro..."></textarea>
                        </div>

                        <!-- Resultado del Encuentro -->
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h5>📊 Resultado del Encuentro (opcional)</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Goles Local</label>
                                    <input type="number" id="encuentroGolesLocal" min="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div style="text-align: center; padding-top: 25px;">
                                    <span style="font-size: 1.5rem; font-weight: bold;">VS</span>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Goles Visitante</label>
                                    <input type="number" id="encuentroGolesVisitante" min="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveEncuentro()" style="margin-right: 10px;">💾 Guardar Encuentro</button>
                            <button class="btn" onclick="cancelAddEncuentro()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas de encuentros -->
                <div class="section">
                    <h3>📊 Estadísticas de Encuentros</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="totalEncuentrosCount">0</div>
                            <div style="color: #666;">Total de Encuentros</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;" id="programadosEncuentrosCount">0</div>
                            <div style="color: #666;">Programados</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="finalizadosEncuentrosCount">0</div>
                            <div style="color: #666;">Finalizados</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #dc2626;" id="canceladosEncuentrosCount">0</div>
                            <div style="color: #666;">Cancelados</div>
                        </div>
                    </div>
                </div>

                <!-- Lista de encuentros -->
                <div class="section">
                    <h3>📋 Lista de Encuentros</h3>
                    <div id="encuentrosList" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">Cargando lista de encuentros...</p>
                    </div>
                </div>
            </div>

            <!-- Módulo de Competiciones -->
            <div id="competiciones" class="tab-content">
                <h2>🏆 Gestión de Competiciones</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Competiciones</h3>
                            <select id="competitionCategoryFilter" onchange="filterCompetitions()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                                <option value="">Todas las categorías</option>
                                <option value="Prebenjamín">Prebenjamín</option>
                                <option value="Benjamín">Benjamín</option>
                                <option value="Alevín">Alevín</option>
                                <option value="Infantil">Infantil</option>
                                <option value="Aficionado">Aficionado</option>
                            </select>
                            <select id="competitionStatusFilter" onchange="filterCompetitions()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Todos los estados</option>
                                <option value="inscripcion">En Inscripción</option>
                                <option value="activo">Activo</option>
                                <option value="finalizado">Finalizado</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddCompetitionForm()">➕ Crear Nueva Competición</button>
                    </div>
                    
                    <!-- Formulario para crear competición -->
                    <div id="addCompetitionForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>🏆 Nueva Competición</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre de la Competición *</label>
                                <input type="text" id="competitionName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categoría *</label>
                                <select id="competitionCategory" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar categoría</option>
                                    <option value="Prebenjamín">Prebenjamín</option>
                                    <option value="Benjamín">Benjamín</option>
                                    <option value="Alevín">Alevín</option>
                                    <option value="Infantil">Infantil</option>
                                    <option value="Aficionado">Aficionado</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Competición *</label>
                                <select id="competitionType" required onchange="toggleCompetitionFields()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar tipo</option>
                                    <option value="liga">Liga</option>
                                    <option value="torneo">Torneo (Eliminación)</option>
                                    <option value="amistoso">Amistoso</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Máximo de Equipos</label>
                                <input type="number" id="maxTeams" min="2" max="32" value="8" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Inicio *</label>
                                <input type="date" id="competitionStartDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Fin *</label>
                                <input type="date" id="competitionEndDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Descripción</label>
                            <textarea id="competitionDescription" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Describe la competición, formato, premios..."></textarea>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Reglamento</label>
                            <textarea id="competitionRules" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Reglas específicas de la competición..."></textarea>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveCompetition()" style="margin-right: 10px;">💾 Guardar Competición</button>
                            <button class="btn" onclick="cancelAddCompetition()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Lista de competiciones -->
                <div class="section">
                    <h3>📋 Lista de Competiciones</h3>
                    <div id="competitionsList">
                        <!-- Las competiciones se cargarán aquí dinámicamente -->
                    </div>
                </div>
            </div>

            <!-- Amigos del Club Tab -->
            <div id="amigos" class="tab-content">
                <h2>🤝 Amigos del Club</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Amigos</h3>
                            <select id="friendStatusFilter" onchange="filterFriends()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todos los Estados</option>
                                <option value="active">Activos</option>
                                <option value="inactive">Inactivos</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddFriendForm()">➕ Registrar Nuevo Amigo</button>
                    </div>
                    
                    <!-- Formulario para registrar amigo -->
                    <div id="addFriendForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>📝 Registrar Nuevo Amigo del Club</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre *</label>
                                <input type="text" id="friendName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Apellidos *</label>
                                <input type="text" id="friendSurname" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">DNI *</label>
                                <input type="text" id="friendDNI" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Teléfono *</label>
                                <input type="tel" id="friendPhone" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Correo Electrónico *</label>
                                <input type="email" id="friendEmail" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <!-- Información de acceso limitado -->
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>🔐 Acceso Limitado de Amigos del Club</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                👁️ <strong>Los amigos del club solo pueden ver:</strong>
                            </p>
                            <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                                <li>📅 Calendario de actividades</li>
                                <li>🏆 Competiciones y resultados</li>
                            </ul>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                🔑 <strong>Acceso sin contraseña:</strong> Los amigos acceden usando su correo electrónico o teléfono una vez completados sus datos.
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveFriend()" style="margin-right: 10px;">💾 Registrar Amigo</button>
                            <button class="btn" onclick="cancelAddFriend()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas de amigos -->
                <div class="section">
                    <h3>📊 Estadísticas de Amigos del Club</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="activeFriendsCount">0</div>
                            <div style="color: #666;">Amigos Activos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #6c757d;" id="inactiveFriendsCount">0</div>
                            <div style="color: #666;">Amigos Inactivos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #1e3a8a;" id="totalFriendsCount">0</div>
                            <div style="color: #666;">Total de Amigos</div>
                        </div>
                    </div>
                </div>

                <!-- Lista de amigos -->
                <div class="section">
                    <h3>👥 Lista de Amigos del Club</h3>
                    <div id="friendsList" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">Cargando lista de amigos...</p>
                    </div>
                </div>
            </div>

            <!-- Documentos Tab -->
            <div id="documentos" class="tab-content">
                <h2>📄 Gestión de Documentos del Club</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Documentos</h3>
                            <select id="documentStatusFilter" onchange="filterDocuments()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todos los Estados</option>
                                <option value="active">Activos</option>
                                <option value="inactive">Inactivos</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddDocumentForm()">➕ Subir Nuevo Documento</button>
                    </div>
                    
                    <!-- Formulario para subir documento -->
                    <div id="addDocumentForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>📝 Subir Nuevo Documento</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre del Documento *</label>
                                <input type="text" id="documentName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categoría *</label>
                                <select id="documentCategory" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar categoría</option>
                                    <option value="reglamento">Reglamento</option>
                                    <option value="normativa">Normativa</option>
                                    <option value="formulario">Formulario</option>
                                    <option value="informacion">Información General</option>
                                    <option value="competicion">Competición</option>
                                    <option value="entrenamiento">Entrenamiento</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Descripción</label>
                            <textarea id="documentDescription" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Describe el contenido del documento..."></textarea>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Archivo PDF *</label>
                            <input type="file" id="documentFile" accept=".pdf" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <small style="color: #666;">Solo archivos PDF. Tamaño máximo: 10MB</small>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Estado</label>
                                <select id="documentStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="active">Activo</option>
                                    <option value="inactive">Inactivo</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Visibilidad</label>
                                <select id="documentVisibility" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="public">Público (Todos)</option>
                                    <option value="socios">Solo Socios</option>
                                    <option value="admin">Solo Administradores</option>
                                </select>
                            </div>
                        </div>

                        <!-- Información de documentos -->
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>📄 Información de Documentos</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                📋 <strong>Los documentos estarán disponibles en:</strong>
                            </p>
                            <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                                <li>🏠 Página principal del club (cuadro de documentos)</li>
                                <li>📱 Panel de administración</li>
                                <li>👥 Según la visibilidad configurada</li>
                                <li>📊 Con estadísticas de descargas</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveDocument()" style="margin-right: 10px;">💾 Subir Documento</button>
                            <button class="btn" onclick="cancelAddDocument()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas de documentos -->
                <div class="section">
                    <h3>📊 Estadísticas de Documentos</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="activeDocumentsCount">0</div>
                            <div style="color: #666;">Documentos Activos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;" id="totalDocumentsCount">0</div>
                            <div style="color: #666;">Total de Documentos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="totalDownloadsCount">0</div>
                            <div style="color: #666;">Total de Descargas</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #8b5cf6;" id="publicDocumentsCount">0</div>
                            <div style="color: #666;">Documentos Públicos</div>
                        </div>
                    </div>
                </div>

                <!-- Lista de documentos -->
                <div class="section">
                    <h3>📋 Lista de Documentos</h3>
                    <div id="documentsList" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">Cargando lista de documentos...</p>
                    </div>
                </div>
            </div>

            <!-- Publicidad Tab -->
            <div id="publicidad" class="tab-content">
                <h2>📢 Gestión de Publicidad del Club</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Publicidad</h3>
                            <select id="publicidadStatusFilter" onchange="filterPublicidad()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todos los Estados</option>
                                <option value="active">Activa</option>
                                <option value="inactive">Inactiva</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddPublicidadForm()">➕ Crear Nueva Publicidad</button>
                    </div>
                    
                    <!-- Formulario para crear publicidad -->
                    <div id="addPublicidadForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>📝 Crear Nueva Publicidad</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Título de la Publicidad *</label>
                                <input type="text" id="publicidadTitulo" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Ej: Nuevo Equipamiento">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Publicidad *</label>
                                <select id="publicidadTipo" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar tipo</option>
                                    <option value="evento">Evento</option>
                                    <option value="equipamiento">Equipamiento</option>
                                    <option value="patrocinador">Patrocinador</option>
                                    <option value="noticia">Noticia</option>
                                    <option value="promocion">Promoción</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Descripción *</label>
                            <textarea id="publicidadDescripcion" rows="3" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Describe la publicidad..."></textarea>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Imagen de Publicidad</label>
                                <input type="file" id="publicidadImagen" accept="image/*" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">Formatos: JPG, PNG, GIF. Tamaño máximo: 5MB</small>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Enlace (Opcional)</label>
                                <input type="url" id="publicidadEnlace" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="https://ejemplo.com">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Estado</label>
                                <select id="publicidadEstado" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="active">Activa</option>
                                    <option value="inactive">Inactiva</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Prioridad</label>
                                <select id="publicidadPrioridad" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="1">Baja</option>
                                    <option value="2">Media</option>
                                    <option value="3" selected>Alta</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Visualización</label>
                                <select id="publicidadVisualizacion" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="carrusel">Carrusel Automático</option>
                                    <option value="fija">Foto Fija</option>
                                    <option value="tarjeta">Tarjeta Individual</option>
                                    <option value="banner">Banner Horizontal</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Inicio</label>
                                <input type="date" id="publicidadFechaInicio" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Fin</label>
                                <input type="date" id="publicidadFechaFin" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <!-- Información de publicidad -->
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>📢 Información de Publicidad</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                📋 <strong>La publicidad se mostrará en:</strong>
                            </p>
                            <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                                <li>🏠 Página principal del club (Galería de Multimedia)</li>
                                <li>📱 Panel de administración</li>
                                <li>🎯 Según la prioridad y estado configurados</li>
                                <li>📊 Con estadísticas de visualizaciones</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="savePublicidad()" style="margin-right: 10px;">💾 Crear Publicidad</button>
                            <button class="btn" onclick="cancelAddPublicidad()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas de publicidad -->
                <div class="section">
                    <h3>📊 Estadísticas de Publicidad</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="activePublicidadCount">0</div>
                            <div style="color: #666;">Publicidades Activas</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;" id="totalPublicidadCount">0</div>
                            <div style="color: #666;">Total de Publicidades</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="totalViewsCount">0</div>
                            <div style="color: #666;">Total de Visualizaciones</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #8b5cf6;" id="totalClicksCount">0</div>
                            <div style="color: #666;">Total de Clics</div>
                        </div>
                    </div>
                </div>

                <!-- Lista de publicidades -->
                <div class="section">
                    <h3>📋 Lista de Publicidades</h3>
                    <div id="publicidadList" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">Cargando lista de publicidades...</p>
                    </div>
                </div>
            </div>

            <!-- Entrenadores Tab -->
            <div id="entrenadores" class="tab-content">
                <h2>👨‍🏫 Gestión de Entrenadores</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Entrenadores</h3>
                            <select id="coachStatusFilter" onchange="filterCoaches()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todos los Estados</option>
                                <option value="active">Activos</option>
                                <option value="inactive">Inactivos</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddCoachForm()">➕ Registrar Nuevo Entrenador</button>
                    </div>
                    
                    <!-- Formulario para registrar entrenador -->
                    <div id="addCoachForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>📝 Registrar Nuevo Entrenador</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre *</label>
                                <input type="text" id="coachName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Apellidos *</label>
                                <input type="text" id="coachSurname" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">DNI *</label>
                                <input type="text" id="coachDNI" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Teléfono *</label>
                                <input type="tel" id="coachPhone" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Correo Electrónico *</label>
                                <input type="email" id="coachEmail" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contraseña *</label>
                                <input type="password" id="coachPassword" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">La contraseña será visible para los administradores</small>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Equipo Asignado *</label>
                                <select id="coachTeam" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar equipo...</option>
                                    <option value="prebenjamin">Prebenjamín</option>
                                    <option value="benjamin">Benjamín</option>
                                    <option value="alevin">Alevín</option>
                                    <option value="infantil">Infantil</option>
                                    <option value="aficionado">Aficionado</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Licencia de Entrenador</label>
                                <input type="text" id="coachLicense" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Años de Experiencia</label>
                                <input type="number" id="coachExperience" min="0" max="50" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <!-- Información de acceso del entrenador -->
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>🔐 Acceso del Entrenador</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                👨‍🏫 <strong>El entrenador podrá:</strong>
                            </p>
                            <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                                <li>📝 Gestionar jugadores de su equipo</li>
                                <li>📅 Ver calendario de su equipo</li>
                                <li>📱 Enviar mensajes push a sus jugadores/padres</li>
                                <li>📊 Ver estadísticas de su equipo</li>
                                <li>📋 Registrar asistencia y notas</li>
                            </ul>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                🔑 <strong>Acceso:</strong> Login con email y contraseña.
                            </p>
                            <p style="margin: 5px 0; font-size: 0.9em; color: #dc2626;">
                                ⚠️ <strong>Validación:</strong> El entrenador debe ser validado por un administrador para poder acceder.
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveCoach()" style="margin-right: 10px;">💾 Registrar Entrenador</button>
                            <button class="btn" onclick="cancelAddCoach()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas de entrenadores -->
                <div class="section">
                    <h3>📊 Estadísticas de Entrenadores</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="activeCoachesCount">0</div>
                            <div style="color: #666;">Entrenadores Activos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #6c757d;" id="inactiveCoachesCount">0</div>
                            <div style="color: #666;">Entrenadores Inactivos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #1e3a8a;" id="totalCoachesCount">0</div>
                            <div style="color: #666;">Total de Entrenadores</div>
                        </div>
                    </div>
                </div>

                <!-- Lista de entrenadores -->
                <div class="section">
                    <h3>👥 Lista de Entrenadores</h3>
                    <div id="coachesList" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">Cargando lista de entrenadores...</p>
                    </div>
                </div>
            </div>

            <!-- Mensajes Push Tab -->
            <div id="mensajes" class="tab-content">
                <h2>📱 Gestión de Mensajes Push</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Enviar Mensaje Push</h3>
                        </div>
                        <button class="btn btn-success" onclick="showAddMessageForm()">📤 Enviar Nuevo Mensaje</button>
                    </div>
                    
                    <!-- Formulario para enviar mensaje push -->
                    <div id="addMessageForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>📝 Nuevo Mensaje Push</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Título del Mensaje *</label>
                                <input type="text" id="messageTitle" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contenido del Mensaje *</label>
                                <textarea id="messageContent" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px; resize: vertical;"></textarea>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Mensaje</label>
                                <select id="messageType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="general">General</option>
                                    <option value="urgent">Urgente</option>
                                    <option value="reminder">Recordatorio</option>
                                    <option value="announcement">Anuncio</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Destinatarios</label>
                                <select id="messageRecipients" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="all">Todos los usuarios</option>
                                    <option value="socios">Solo socios</option>
                                    <option value="amigos">Solo amigos del club</option>
                                    <option value="entrenadores">Solo entrenadores</option>
                                    <option value="jugadores">Solo jugadores</option>
                                    <option value="padres">Solo padres/tutores</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Equipo Específico (opcional)</label>
                                <select id="messageTeam" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Todos los equipos</option>
                                    <option value="prebenjamin">Prebenjamín</option>
                                    <option value="benjamin">Benjamín</option>
                                    <option value="alevin">Alevín</option>
                                    <option value="infantil">Infantil</option>
                                    <option value="aficionado">Aficionado</option>
                                </select>
                            </div>
                        </div>

                        <!-- Información de envío -->
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>📤 Información de Envío</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                📱 <strong>Los mensajes push se enviarán a:</strong>
                            </p>
                            <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                                <li>👥 Todos los usuarios registrados según el filtro seleccionado</li>
                                <li>📧 Por email y notificaciones en la aplicación</li>
                                <li>⏰ En tiempo real cuando sea posible</li>
                                <li>📊 Se registrará en el historial de mensajes</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="sendAdminPushMessage()" style="margin-right: 10px;">📤 Enviar Mensaje</button>
                            <button class="btn btn-warning" onclick="previewAdminMessage()" style="margin-right: 10px;">👁️ Vista Previa</button>
                            <button class="btn" onclick="cancelAddMessage()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas de mensajes -->
                <div class="section">
                    <h3>📊 Estadísticas de Mensajes</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="totalMessagesCount">0</div>
                            <div style="color: #666;">Total de Mensajes</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;" id="todayMessagesCount">0</div>
                            <div style="color: #666;">Mensajes Hoy</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="urgentMessagesCount">0</div>
                            <div style="color: #666;">Mensajes Urgentes</div>
                        </div>
                    </div>
                </div>

                <!-- Historial de mensajes -->
                <div class="section">
                    <h3>📋 Historial de Mensajes</h3>
                    <div id="adminMessagesHistory" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">Cargando historial de mensajes...</p>
                    </div>
                </div>
            </div>

            <!-- Exportar Datos Tab -->
            <div id="exportar" class="tab-content">
                <h2>📊 Exportar Datos a Excel</h2>
                
                <div class="section">
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                        <h3>📋 Información de Exportación</h3>
                        <p style="margin: 10px 0; color: #1e3a8a;">
                            💡 <strong>Los archivos se descargarán en formato CSV</strong> que puede abrirse en Excel, Google Sheets o cualquier programa de hojas de cálculo.
                        </p>
                        <p style="margin: 10px 0; color: #1e3a8a;">
                            📁 <strong>Los archivos incluirán:</strong> Todos los datos relevantes de cada categoría, fechas de registro, estados, y estadísticas.
                        </p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        
                        <!-- Exportar Jugadores -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #059669; margin-bottom: 15px;">⚽ Jugadores por Equipo</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta la lista completa de jugadores organizados por categorías.</p>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categoría:</label>
                                <select id="exportPlayerCategory" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="all">Todas las categorías</option>
                                    <option value="prebenjamin">Prebenjamín</option>
                                    <option value="benjamin">Benjamín</option>
                                    <option value="alevin">Alevín</option>
                                    <option value="infantil">Infantil</option>
                                    <option value="aficionado">Aficionado</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-success" onclick="exportPlayers()" style="width: 100%;">
                                📊 Exportar Jugadores
                            </button>
                        </div>

                        <!-- Exportar Socios -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #3b82f6; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #3b82f6; margin-bottom: 15px;">👨‍👩‍👧‍👦 Socios del Club</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta la lista completa de socios con sus datos y estados.</p>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Estado:</label>
                                <select id="exportMemberStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="all">Todos los estados</option>
                                    <option value="active">Solo activos</option>
                                    <option value="pending">Solo pendientes</option>
                                    <option value="expired">Solo expirados</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary" onclick="exportMembers()" style="width: 100%;">
                                📊 Exportar Socios
                            </button>
                        </div>

                        <!-- Exportar Amigos -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #10b981; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #10b981; margin-bottom: 15px;">🤝 Amigos del Club</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta la lista de amigos del club con sus datos de contacto.</p>
                            
                            <button class="btn" onclick="exportFriends()" style="width: 100%; background: #10b981; color: white;">
                                📊 Exportar Amigos
                            </button>
                        </div>

                        <!-- Exportar Entrenadores -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #f59e0b; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #f59e0b; margin-bottom: 15px;">👨‍🏫 Entrenadores</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta la lista de entrenadores con sus equipos asignados.</p>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Estado:</label>
                                <select id="exportCoachStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="all">Todos los estados</option>
                                    <option value="active">Solo activos</option>
                                    <option value="pending">Solo pendientes</option>
                                    <option value="inactive">Solo inactivos</option>
                                </select>
                            </div>
                            
                            <button class="btn" onclick="exportCoaches()" style="width: 100%; background: #f59e0b; color: white;">
                                📊 Exportar Entrenadores
                            </button>
                        </div>

                        <!-- Exportar Eventos -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #8b5cf6; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #8b5cf6; margin-bottom: 15px;">🎉 Eventos del Club</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta la lista de eventos con participantes y detalles.</p>
                            
                            <button class="btn" onclick="exportEvents()" style="width: 100%; background: #8b5cf6; color: white;">
                                📊 Exportar Eventos
                            </button>
                        </div>

                        <!-- Exportar Competiciones -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #dc2626; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #dc2626; margin-bottom: 15px;">🏆 Competiciones</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta las competiciones con equipos participantes y resultados.</p>
                            
                            <button class="btn" onclick="exportCompetitions()" style="width: 100%; background: #dc2626; color: white;">
                                📊 Exportar Competiciones
                            </button>
                        </div>

                        <!-- Exportar Todo -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #1e3a8a; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #1e3a8a; margin-bottom: 15px;">📋 Exportar Todo</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta todos los datos del club en archivos separados.</p>
                            
                            <button class="btn" onclick="exportAllData()" style="width: 100%; background: #1e3a8a; color: white;">
                                📊 Exportar Todo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Historial de Exportaciones -->
                <div class="section">
                    <h3>📋 Historial de Exportaciones</h3>
                    <div id="exportHistory" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">No hay exportaciones recientes</p>
                    </div>
                </div>
            </div>

            <!-- Base de Datos Tab -->
            <div id="basedatos" class="tab-content">
                <h2>🗄️ Gestión de Base de Datos</h2>
                
                <div class="section">
                    <h3>📊 Estado de la Base de Datos</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="dbSociosCount">-</div>
                            <div style="color: #666;">Socios</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;" id="dbAmigosCount">-</div>
                            <div style="color: #666;">Amigos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="dbJugadoresCount">-</div>
                            <div style="color: #666;">Jugadores</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #8b5cf6;" id="dbEquiposCount">-</div>
                            <div style="color: #666;">Equipos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #dc2626;" id="dbEventosCount">-</div>
                            <div style="color: #666;">Eventos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #10b981;" id="dbDocumentosCount">-</div>
                            <div style="color: #666;">Documentos</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0; padding: 15px; background: #d4edda; border-radius: 8px; color: #155724;">
                        <span style="display: inline-block; width: 12px; height: 12px; background: #059669; border-radius: 50%; margin-right: 8px;"></span>
                        <strong>Base de datos IndexedDB activa y funcionando</strong>
                    </div>
                </div>

                <div class="section">
                    <h3>🛠️ Funciones de Base de Datos</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #059669; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #059669; margin-bottom: 15px;">👥 Gestión de Socios</h4>
                            <p style="margin-bottom: 15px;">Gestión completa de socios con validación de datos y numeración automática.</p>
                            <button class="btn" onclick="dbAddSocio()" style="margin-right: 10px;">➕ Añadir Socio</button>
                            <button class="btn btn-secondary" onclick="dbViewSocios()">👁️ Ver Socios</button>
                            <div id="dbSociosPreview" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin-top: 15px; max-height: 200px; overflow-y: auto; display: none;"></div>
                        </div>

                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #3b82f6; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #3b82f6; margin-bottom: 15px;">🤝 Gestión de Amigos</h4>
                            <p style="margin-bottom: 15px;">Registro de amigos del club con acceso limitado a información.</p>
                            <button class="btn" onclick="dbAddAmigo()" style="margin-right: 10px;">➕ Añadir Amigo</button>
                            <button class="btn btn-secondary" onclick="dbViewAmigos()">👁️ Ver Amigos</button>
                            <div id="dbAmigosPreview" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin-top: 15px; max-height: 200px; overflow-y: auto; display: none;"></div>
                        </div>

                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #f59e0b; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #f59e0b; margin-bottom: 15px;">⚽ Gestión de Jugadores</h4>
                            <p style="margin-bottom: 15px;">Registro completo de jugadores con categorías y datos de padres.</p>
                            <button class="btn" onclick="dbAddJugador()" style="margin-right: 10px;">➕ Añadir Jugador</button>
                            <button class="btn btn-secondary" onclick="dbViewJugadores()">👁️ Ver Jugadores</button>
                            <div id="dbJugadoresPreview" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin-top: 15px; max-height: 200px; overflow-y: auto; display: none;"></div>
                        </div>

                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #8b5cf6; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #8b5cf6; margin-bottom: 15px;">📊 Exportación de Datos</h4>
                            <p style="margin-bottom: 15px;">Exportación en formato CSV y JSON para respaldos y análisis.</p>
                            <button class="btn btn-success" onclick="dbExportSocios()" style="margin-right: 10px;">📤 Exportar Socios</button>
                            <button class="btn btn-success" onclick="dbExportAll()">📤 Exportar Todo</button>
                            <div id="dbExportStatus"></div>
                        </div>

                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #dc2626; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #dc2626; margin-bottom: 15px;">💾 Respaldo y Restauración</h4>
                            <p style="margin-bottom: 15px;">Sistema de respaldo completo y restauración de datos.</p>
                            <button class="btn btn-success" onclick="dbBackup()" style="margin-right: 10px;">💾 Crear Respaldo</button>
                            <button class="btn btn-secondary" onclick="dbRestore()">🔄 Restaurar</button>
                            <div id="dbBackupStatus"></div>
                        </div>

                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #10b981; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #10b981; margin-bottom: 15px;">🔍 Búsqueda y Filtros</h4>
                            <p style="margin-bottom: 15px;">Búsqueda avanzada y filtros por categorías y estados.</p>
                            <button class="btn" onclick="dbSearch()" style="margin-right: 10px;">🔍 Buscar Socios</button>
                            <button class="btn btn-secondary" onclick="dbFilterJugadores()">⚽ Filtrar Jugadores</button>
                            <div id="dbSearchResults" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin-top: 15px; max-height: 200px; overflow-y: auto; display: none;"></div>
                        </div>

                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #dc2626; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #dc2626; margin-bottom: 15px;">🗑️ Limpiar Base de Datos</h4>
                            <p style="margin-bottom: 15px;">⚠️ <strong>PELIGROSO:</strong> Elimina todos los datos de la base de datos.</p>
                            <button class="btn" style="background: #dc2626; margin-right: 10px;" onclick="limpiarBaseDeDatos()">🗑️ Limpiar Todo</button>
                            <button class="btn" style="background: #f59e0b; margin-right: 10px;" onclick="limpiarSocios()">👥 Limpiar Solo Socios</button>
                            <button class="btn btn-secondary" onclick="mostrarEstadisticasDuplicados()">📊 Ver Duplicados</button>
                            <div id="dbCleanStatus"></div>
                        </div>

                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #8b5cf6; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #8b5cf6; margin-bottom: 15px;">📱 Notificaciones</h4>
                            <p style="margin-bottom: 15px;">Sistema de notificaciones para nuevos socios y eventos.</p>
                            <button class="btn" onclick="mostrarNotificaciones()" style="margin-right: 10px;">🔔 Ver Notificaciones</button>
                            <button class="btn btn-secondary" onclick="limpiarNotificaciones()">🗑️ Limpiar</button>
                            <div id="dbNotificationsPreview" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin-top: 15px; max-height: 200px; overflow-y: auto; display: none;"></div>
                        </div>

                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #f59e0b; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #f59e0b; margin-bottom: 15px;">👥 Gestión Avanzada de Socios</h4>
                            <p style="margin-bottom: 15px;">Añadir y eliminar socios con verificación de duplicados.</p>
                            <button class="btn" onclick="mostrarFormularioSocioAvanzado()" style="margin-right: 10px;">➕ Añadir Socio</button>
                            <button class="btn btn-secondary" onclick="mostrarListaSociosEliminar()">🗑️ Eliminar Socio</button>
                            <div id="dbSociosAvanzadoPreview" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin-top: 15px; max-height: 200px; overflow-y: auto; display: none;"></div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>📈 Características de la Base de Datos</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #059669; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #059669; margin-bottom: 15px;">✅ Persistencia Estable</h4>
                            <ul style="margin: 0; padding-left: 20px;">
                                <li>IndexedDB para almacenamiento robusto</li>
                                <li>Fallback a localStorage si es necesario</li>
                                <li>Datos persistentes entre sesiones</li>
                                <li>Integridad de datos garantizada</li>
                            </ul>
                        </div>

                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #3b82f6; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #3b82f6; margin-bottom: 15px;">🔐 Seguridad</h4>
                            <ul style="margin: 0; padding-left: 20px;">
                                <li>Validación de datos en tiempo real</li>
                                <li>DNI único por persona</li>
                                <li>Contraseñas encriptadas</li>
                                <li>Acceso controlado por roles</li>
                            </ul>
                        </div>

                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #f59e0b; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #f59e0b; margin-bottom: 15px;">📊 Exportación Completa</h4>
                            <ul style="margin: 0; padding-left: 20px;">
                                <li>Exportación en formato CSV</li>
                                <li>Exportación en formato JSON</li>
                                <li>Respaldo completo de datos</li>
                                <li>Restauración de respaldos</li>
                            </ul>
                        </div>

                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #8b5cf6; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h4 style="color: #8b5cf6; margin-bottom: 15px;">⚡ Rendimiento</h4>
                            <ul style="margin: 0; padding-left: 20px;">
                                <li>Búsquedas indexadas</li>
                                <li>Consultas optimizadas</li>
                                <li>Interfaz asíncrona</li>
                                <li>Respuesta instantánea</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Publicidad Tab -->
            <div id="publicidad" class="tab-content">
                <h2>📢 Gestión de Publicidad y Colaboradores</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Gestionar Anuncios Publicitarios</h3>
                        </div>
                        <button class="btn btn-success" onclick="showAddAdvertisementForm()">➕ Agregar Nuevo Anuncio</button>
                    </div>
                    
                    <!-- Formulario para agregar anuncio -->
                    <div id="addAdvertisementForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>📝 Nuevo Anuncio Publicitario</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Título del Anuncio *</label>
                                <input type="text" id="adTitle" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Colaborador/Empresa *</label>
                                <input type="text" id="adCompany" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Descripción</label>
                                <textarea id="adDescription" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: 80px; resize: vertical;"></textarea>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">URL del Enlace</label>
                                <input type="url" id="adUrl" placeholder="https://ejemplo.com" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categoría</label>
                                <select id="adCategory" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="general">General</option>
                                    <option value="deportes">Deportes</option>
                                    <option value="alimentacion">Alimentación</option>
                                    <option value="tecnologia">Tecnología</option>
                                    <option value="servicios">Servicios</option>
                                    <option value="comercio">Comercio</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Imagen del Anuncio</label>
                                <input type="file" id="adImage" accept="image/*" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <div id="adImagePreview" style="margin-top: 10px; max-width: 200px;"></div>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Posición en Carrusel</label>
                                <select id="adPosition" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="1">1 - Primera posición</option>
                                    <option value="2">2 - Segunda posición</option>
                                    <option value="3">3 - Tercera posición</option>
                                    <option value="4">4 - Cuarta posición</option>
                                    <option value="5">5 - Quinta posición</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Inicio</label>
                                <input type="date" id="adStartDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Fin</label>
                                <input type="date" id="adEndDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Estado</label>
                                <select id="adStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="active">Activo</option>
                                    <option value="inactive">Inactivo</option>
                                    <option value="pending">Pendiente</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Anuncio</label>
                                <select id="adType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="banner">Banner</option>
                                    <option value="carrusel">Carrusel</option>
                                    <option value="sidebar">Barra Lateral</option>
                                    <option value="popup">Popup</option>
                                </select>
                            </div>
                        </div>

                        <!-- Información de configuración -->
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>📋 Configuración del Anuncio</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                🎯 <strong>El anuncio aparecerá en:</strong>
                            </p>
                            <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                                <li>🏠 Página principal del club</li>
                                <li>📱 Carrusel de colaboradores</li>
                                <li>⏰ Según las fechas configuradas</li>
                                <li>📊 Con estadísticas de visualizaciones</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveAdvertisement()" style="margin-right: 10px;">💾 Guardar Anuncio</button>
                            <button class="btn" onclick="cancelAddAdvertisement()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas de publicidad -->
                <div class="section">
                    <h3>📊 Estadísticas de Publicidad</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="activeAdsCount">0</div>
                            <div style="color: #666;">Anuncios Activos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;" id="totalAdsCount">0</div>
                            <div style="color: #666;">Total de Anuncios</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="carouselAdsCount">0</div>
                            <div style="color: #666;">En Carrusel</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #dc2626;" id="expiredAdsCount">0</div>
                            <div style="color: #666;">Expirados</div>
                        </div>
                    </div>
                </div>

                <!-- Configuración de Redes Sociales -->
                <div class="section">
                    <h3>📱 Configuración de Redes Sociales</h3>
                    <p style="margin-bottom: 20px; color: #666;">
                        Configura los enlaces de las redes sociales del club que aparecerán en la página principal.
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">📘 URL de Facebook</label>
                            <input type="url" id="facebookUrl" placeholder="https://www.facebook.com/CDSANABRIACF" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                            <small style="color: #666;">URL completa del perfil de Facebook del club</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">📷 URL de Instagram</label>
                            <input type="url" id="instagramUrl" placeholder="https://www.instagram.com/cdsanabriacf" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                            <small style="color: #666;">URL completa del perfil de Instagram del club</small>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">📘 Usuario de Facebook</label>
                            <input type="text" id="facebookUsername" placeholder="@CDSANABRIACF" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                            <small style="color: #666;">Nombre de usuario que se mostrará en la página</small>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">📷 Usuario de Instagram</label>
                            <input type="text" id="instagramUsername" placeholder="@cdsanabriacf" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                            <small style="color: #666;">Nombre de usuario que se mostrará en la página</small>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="saveSocialMediaConfig()" style="margin-right: 10px;">💾 Guardar Configuración</button>
                        <button class="btn" onclick="loadSocialMediaConfig()" style="margin-right: 10px;">📋 Cargar Configuración</button>
                        <button class="btn" onclick="testSocialMediaLinks()" style="background: #17a2b8;">🧪 Probar Enlaces</button>
                    </div>
                    
                    <div id="socialMediaStatus" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;"></div>
                </div>

                <!-- Lista de anuncios -->
                <div class="section">
                    <h3>📋 Lista de Anuncios</h3>
                    <div style="margin-bottom: 15px;">
                        <select id="adFilter" onchange="filterAdvertisements()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="all">Todos los Anuncios</option>
                            <option value="active">Solo Activos</option>
                            <option value="carrusel">Solo Carrusel</option>
                            <option value="expired">Expirados</option>
                        </select>
                    </div>
                    <div id="advertisementsList" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">Cargando anuncios...</p>
                    </div>
                </div>
            </div>

            <div id="socios" class="tab-content">
                <h2>👨‍👩‍👧‍👦 Socios</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Socios</h3>
                            <select id="memberStatusFilter" onchange="filterMembers()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todos los Estados</option>
                                <option value="pending">Pendientes de Validación</option>
                                <option value="active">Activos</option>
                                <option value="expired">Caducados (7 días)</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddMemberForm()">➕ Registrar Nuevo Socio</button>
                    </div>
                    
                    <!-- Formulario para registrar socio -->
                    <div id="addMemberForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>📝 Registrar Nuevo Socio</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre *</label>
                                <input type="text" id="memberName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Apellidos *</label>
                                <input type="text" id="memberSurname" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">DNI</label>
                                <input type="text" id="memberDNI" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Teléfono *</label>
                                <input type="tel" id="memberPhone" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Dirección</label>
                                <input type="text" id="memberAddress" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Correo Electrónico</label>
                                <input type="email" id="memberEmail" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contraseña *</label>
                            <input type="password" id="memberPassword" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <small style="color: #666;">La contraseña será visible para los administradores</small>
                        </div>

                        <!-- Información de validación automática -->
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>⏰ Validación Automática de Socios</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                ⚠️ <strong>Los socios deben ser confirmados por un administrador en un plazo de 7 días desde su registro.</strong>
                            </p>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                🗑️ Si no son confirmados en ese tiempo, serán eliminados automáticamente del sistema.
                            </p>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                🔢 La numeración de socio se asignará automáticamente una vez confirmado.
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveMember()" style="margin-right: 10px;">💾 Registrar Socio</button>
                            <button class="btn" onclick="cancelAddMember()">❌ Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estadísticas de socios -->
                <div class="section">
                    <h3>📊 Estadísticas de Socios</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="activeMembersCount">0</div>
                            <div style="color: #666;">Socios Activos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="pendingMembersCount">0</div>
                            <div style="color: #666;">Pendientes de Validación</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #dc2626;" id="expiredMembersCount">0</div>
                            <div style="color: #666;">Caducados (7 días)</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #1e3a8a;" id="nextMemberNumber">1</div>
                            <div style="color: #666;">Próximo Número de Socio</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 20px;">
                        <button class="btn" onclick="cleanExpiredMembers()" style="background: #dc2626;">🗑️ Limpiar Socios Caducados</button>
                        <button class="btn" onclick="validateAllPendingMembers()" style="background: #059669; margin-left: 10px;">✅ Validar Todos los Pendientes</button>
                        <button class="btn" onclick="diagnosticarYSincronizarSocios()" style="background: #3b82f6; margin-left: 10px;">🔍 Diagnosticar y Sincronizar</button>
                        <button class="btn" onclick="sincronizarBaseDatos()" style="background: #8b5cf6; margin-left: 10px;">🔄 Sincronizar Base de Datos</button>
                        <button class="btn" onclick="diagnosticarBaseDatos()" style="background: #f59e0b; margin-left: 10px;">🔧 Diagnosticar BD</button>
                        <button class="btn" onclick="crearBaseDatosSimulada()" style="background: #10b981; margin-left: 10px;">🏗️ Crear BD Simulada</button>
                    </div>
                </div>

                <!-- Lista de socios -->
                <div class="section">
                    <h3>📋 Lista de Socios</h3>
                    <div id="membersList">
                        <!-- Los socios se cargarán aquí dinámicamente -->
                    </div>
                </div>
            </div>

            <div id="multimedia" class="tab-content">
                <h2>📸 Multimedia</h2>
                <div class="section">
                    <p>📸 <strong>Módulo de fotos y videos</strong></p>
                    <p>Gestiona la galería multimedia del club.</p>
                    <button class="btn" onclick="alert('⚠️ Módulo en desarrollo. Próximamente disponible.')">📤 Subir Archivo</button>
                </div>
            </div>

            <!-- Sección de Tienda -->
            <div id="tienda" class="tab-content">
                <h2>🏪 Administración de Tienda</h2>
                
                <div class="section">
                    <h3>🛒 Gestión de Productos</h3>
                    <p><strong>Administra la tienda oficial de CDSANABRIACF</strong></p>
                    
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4>🏪 Tienda CDSANABRIACF</h4>
                        <p><strong>Funcionalidades disponibles:</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>➕ Agregar nuevos productos</li>
                            <li>📝 Editar productos existentes</li>
                            <li>🗑️ Eliminar productos</li>
                            <li>📊 Gestionar stock por tallas</li>
                            <li>💰 Configurar precios</li>
                            <li>📸 Subir fotos de productos</li>
                            <li>📈 Ver estadísticas de ventas</li>
                        </ul>
                    </div>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <a href="admin-tienda-completa.html" style="
                            display: inline-block;
                            background: linear-gradient(135deg, #dc2626, #3b82f6);
                            color: white;
                            padding: 15px 30px;
                            border-radius: 25px;
                            text-decoration: none;
                            font-weight: 600;
                            font-size: 1.1rem;
                            transition: transform 0.3s, box-shadow 0.3s;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 15px rgba(220, 38, 38, 0.3)'" 
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.1)'">
                            🏪 Abrir Panel de Tienda
                        </a>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <h4>ℹ️ Información Importante:</h4>
                        <p><strong>• Solo socios y amigos pueden comprar productos</strong></p>
                        <p><strong>• Entrega en mano disponible</strong></p>
                        <p><strong>• Stock controlado por tallas</strong></p>
                        <p><strong>• Enlace a tienda oficial externa disponible</strong></p>
                    </div>

                    <!-- Configuración de Tienda Online -->
                    <div class="section" style="margin-top: 30px;">
                        <h3>🌐 Configuración de Tienda Online</h3>
                        <p><strong>Configura la URL de la tienda online que se abrirá desde el botón TIENDA</strong></p>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border: 2px solid #e9ecef;">
                            <div style="margin-bottom: 15px;">
                                <label for="tiendaUrl" style="display: block; margin-bottom: 5px; font-weight: bold;">URL de Tienda Online *</label>
                                <input type="url" id="tiendaUrl" placeholder="https://tu-tienda-online.com" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                                <small style="color: #666; margin-top: 5px; display: block;">🔗 Esta URL se abrirá cuando los usuarios hagan clic en el botón TIENDA de la página principal</small>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label for="tiendaNombre" style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre de la Tienda</label>
                                <input type="text" id="tiendaNombre" placeholder="Tienda Oficial CDSANABRIACF" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                                <small style="color: #666; margin-top: 5px; display: block;">📝 Nombre descriptivo de la tienda (opcional)</small>
                            </div>
                            
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button onclick="guardarConfiguracionTienda()" class="btn" style="background: #059669; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                    💾 Guardar Configuración
                                </button>
                                <button onclick="probarTiendaOnline()" class="btn" style="background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                    🧪 Probar Enlace
                                </button>
                                <button onclick="restaurarTiendaPorDefecto()" class="btn" style="background: #dc2626; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                    🔄 Restaurar por Defecto
                                </button>
                            </div>
                        </div>
                        
                        <div id="tiendaConfigStatus" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;">
                            <!-- Aquí se mostrarán mensajes de estado -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Importar Datos Tab -->
            <div id="importar" class="tab-content">
                <h2>📥 Importar Datos desde Excel</h2>
                
                <div class="section">
                    <h3>📋 Información de Importación</h3>
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <p><strong>⚠️ Importante:</strong> Antes de importar, asegúrate de que el archivo Excel tenga el formato correcto.</p>
                        <p><strong>📊 Formatos soportados:</strong> .xlsx, .xls, .csv</p>
                        <p><strong>🔒 Seguridad:</strong> Los datos existentes no se sobrescribirán automáticamente.</p>
                    </div>

                    <!-- Importar Jugadores -->
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6; margin-bottom: 20px;">
                        <h4>⚽ Importar Jugadores</h4>
                        <p style="margin-bottom: 20px; color: #666;">Importa jugadores desde un archivo Excel. Las columnas deben ser: Nombre, Apellidos, DNI, Teléfono, Dirección, Edad, Fecha de Nacimiento, Categoría, Dorsal, Nombre del Padre/Madre, DNI del Padre/Madre, Teléfono del Padre/Madre, Email del Padre/Madre.</p>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categoría de Destino:</label>
                            <select id="importPlayerCategory" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Seleccionar categoría</option>
                                <option value="Prebenjamín">Prebenjamín</option>
                                <option value="Benjamín">Benjamín</option>
                                <option value="Alevín">Alevín</option>
                                <option value="Infantil">Infantil</option>
                                <option value="Aficionado">Aficionado</option>
                            </select>
                        </div>
                        
                        <input type="file" id="importPlayersFile" accept=".xlsx,.xls,.csv" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                        
                        <button class="btn btn-success" onclick="importPlayers()" style="width: 100%;">
                            📥 Importar Jugadores
                        </button>
                    </div>

                    <!-- Importar Socios -->
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6; margin-bottom: 20px;">
                        <h4>👨‍👩‍👧‍👦 Importar Socios</h4>
                        <p style="margin-bottom: 20px; color: #666;">Importa socios desde un archivo Excel. Las columnas deben ser: Nombre, Apellidos, DNI, Dirección, Teléfono, Email, Fecha de Nacimiento, Cuota.</p>
                        
                        <input type="file" id="importMembersFile" accept=".xlsx,.xls,.csv" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                        
                        <button class="btn btn-primary" onclick="importMembers()" style="width: 100%;">
                            📥 Importar Socios
                        </button>
                    </div>

                    <!-- Importar Amigos -->
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6; margin-bottom: 20px;">
                        <h4>🤝 Importar Amigos del Club</h4>
                        <p style="margin-bottom: 20px; color: #666;">Importa amigos del club desde un archivo Excel. Las columnas deben ser: Nombre, Apellidos, DNI, Teléfono, Email.</p>
                        
                        <input type="file" id="importFriendsFile" accept=".xlsx,.xls,.csv" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                        
                        <button class="btn" onclick="importFriends()" style="width: 100%; background: #10b981; color: white;">
                            📥 Importar Amigos
                        </button>
                    </div>

                    <!-- Importar Entrenadores -->
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6; margin-bottom: 20px;">
                        <h4>👨‍🏫 Importar Entrenadores</h4>
                        <p style="margin-bottom: 20px; color: #666;">Importa entrenadores desde un archivo Excel. Las columnas deben ser: Nombre, Apellidos, DNI, Teléfono, Email, Equipo Asignado, Licencia.</p>
                        
                        <input type="file" id="importCoachesFile" accept=".xlsx,.xls,.csv" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                        
                        <button class="btn" onclick="importCoaches()" style="width: 100%; background: #f59e0b; color: white;">
                            📥 Importar Entrenadores
                        </button>
                    </div>

                    <!-- Plantillas de Excel -->
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6; margin-bottom: 20px;">
                        <h4>📋 Descargar Plantillas</h4>
                        <p style="margin-bottom: 20px; color: #666;">Descarga las plantillas de Excel con el formato correcto para cada tipo de datos.</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <button class="btn" onclick="downloadTemplate('jugadores')" style="background: #059669; color: white;">
                                📥 Plantilla Jugadores
                            </button>
                            <button class="btn" onclick="downloadTemplate('socios')" style="background: #3b82f6; color: white;">
                                📥 Plantilla Socios
                            </button>
                            <button class="btn" onclick="downloadTemplate('amigos')" style="background: #10b981; color: white;">
                                📥 Plantilla Amigos
                            </button>
                            <button class="btn" onclick="downloadTemplate('entrenadores')" style="background: #f59e0b; color: white;">
                                📥 Plantilla Entrenadores
                            </button>
                        </div>
                    </div>

                    <!-- Progreso de Importación -->
                    <div id="importProgress" style="display: none;"></div>

                    <!-- Historial de Importaciones -->
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <h4>📋 Historial de Importaciones</h4>
                        <div id="importHistory" style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;">
                            <p style="text-align: center; color: #6c757d;">No hay importaciones recientes</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="configuracion" class="tab-content">
                <h2>⚙️ Configuración</h2>
                
                <!-- Gestión de Administradores -->
                <div class="section">
                    <h3>👨‍💼 Gestión de Administradores</h3>
                    <p><strong>Administradores del equipo CDSANABRIACF</strong></p>
                    
                    <button class="btn" onclick="showAddAdminForm()" style="background: #059669;">➕ Añadir Administrador</button>
                    
                    <!-- Formulario para añadir administrador -->
                    <div id="addAdminForm" style="display: none; margin-top: 20px; background: white; padding: 20px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>📝 Registrar Nuevo Administrador</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre *</label>
                                <input type="text" id="adminName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Email *</label>
                                <input type="email" id="adminEmail" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contraseña *</label>
                            <input type="password" id="adminPassword" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Rol</label>
                            <select id="adminRole" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="team_admin">Administrador de Equipo</option>
                                <option value="assistant_admin">Administrador Asistente</option>
                            </select>
                        </div>
                        
                        <button class="btn" onclick="saveNewAdmin()" style="background: #059669;">💾 Guardar Administrador</button>
                        <button class="btn" onclick="cancelAddAdmin()">❌ Cancelar</button>
                    </div>
                    
                    <!-- Lista de administradores -->
                    <div id="adminsList" style="margin-top: 20px;">
                        <!-- Se carga dinámicamente -->
                    </div>
                </div>
                
                <!-- Logo del Club -->
                <div class="section">
                    <h3>🏆 Logo del Club</h3>
                    <p><strong>Subir y gestionar el logo oficial del club</strong></p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">📁 Seleccionar Logo</label>
                            <input type="file" id="logoFile" accept="image/*" style="width: 100%; padding: 10px; border: 2px dashed #ddd; border-radius: 8px;">
                            <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">Formatos: JPG, PNG, GIF. Tamaño máximo: 2MB</p>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">👁️ Vista Previa</label>
                            <div id="logoPreview" style="width: 150px; height: 150px; border: 2px dashed #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                                <span style="color: #666;">Sin logo</span>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="uploadLogo()" style="background: #059669;">💾 Guardar Logo</button>
                    <button class="btn" onclick="removeLogo()" style="background: #dc3545;">🗑️ Eliminar Logo</button>
                </div>

                <!-- Mensaje del Logo -->
                <div class="section">
                    <h3>💬 Mensaje del Logo</h3>
                    <p><strong>Personalizar el mensaje que aparece debajo del logo</strong></p>
                    
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 10px; font-weight: bold;">📝 Mensaje Personalizado</label>
                        <textarea id="logoMessage" rows="3" placeholder="Escribe aquí el mensaje que aparecerá debajo del logo..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; resize: vertical;"></textarea>
                        <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">Este mensaje se mostrará debajo del logo en la página principal</p>
                    </div>
                    
                    <button class="btn" onclick="saveLogoMessage()" style="background: #059669;">💾 Guardar Mensaje</button>
                    <button class="btn" onclick="resetLogoMessage()" style="background: #6c757d;">🔄 Restablecer</button>
                </div>

                <!-- Colores y Tema -->
                <div class="section">
                    <h3>🎨 Colores y Tema</h3>
                    <p><strong>Personalizar la apariencia del club</strong></p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">🎨 Color Principal</label>
                            <input type="color" id="primaryColor" value="#dc2626" style="width: 100%; height: 40px; border: none; border-radius: 8px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">🎨 Color Secundario</label>
                            <input type="color" id="secondaryColor" value="#3b82f6" style="width: 100%; height: 40px; border: none; border-radius: 8px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">📝 Fuente</label>
                            <select id="fontFamily" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                                <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="'Times New Roman', serif">Times New Roman</option>
                                <option value="'Courier New', monospace">Courier New</option>
                                <option value="Georgia, serif">Georgia</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">📏 Tamaño de Fuente</label>
                            <select id="fontSize" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                                <option value="14px">Pequeño (14px)</option>
                                <option value="16px" selected>Mediano (16px)</option>
                                <option value="18px">Grande (18px)</option>
                                <option value="20px">Muy Grande (20px)</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="saveThemeSettings()" style="background: #059669;">💾 Guardar Tema</button>
                    <button class="btn" onclick="resetThemeSettings()" style="background: #6c757d;">🔄 Restablecer</button>
                </div>

                <!-- Datos de Contacto -->
                <div class="section">
                    <h3>📞 Datos de Contacto</h3>
                    <p><strong>Información de contacto del club</strong></p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">📧 Email del Club</label>
                            <input type="email" id="clubEmail" placeholder="club@cdsanabriacf.com" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">📱 Teléfono</label>
                            <input type="tel" id="clubPhone" placeholder="+34 600 000 000" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">📍 Dirección</label>
                        <input type="text" id="clubAddress" placeholder="Calle del Club, 123, Ciudad" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">🌐 Sitio Web</label>
                            <input type="url" id="clubWebsite" placeholder="https://www.cdsanabriacf.com" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">📱 WhatsApp</label>
                            <input type="tel" id="clubWhatsApp" placeholder="+34 600 000 000" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">📝 Horarios de Atención</label>
                        <textarea id="clubHours" placeholder="Lunes a Viernes: 9:00 - 18:00&#10;Sábados: 9:00 - 14:00&#10;Domingos: Cerrado" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; height: 80px; resize: vertical;"></textarea>
                    </div>
                    
                    <button class="btn" onclick="saveContactInfo()" style="background: #059669;">💾 Guardar Contacto</button>
                    <button class="btn" onclick="loadContactInfo()" style="background: #17a2b8;">📋 Cargar Datos</button>
                </div>
            </div>
                    </div>
        </div>

        <div class="section">
            <h2>👥 Administradores de Equipo</h2>
            <div class="admin-section">
                <h3>Gestión de Administradores</h3>
                <p style="margin-bottom: 20px; color: #666;">
                    Aquí puedes crear administradores para cada equipo. Cada administrador podrá gestionar todo lo relacionado con su equipo asignado.
                </p>
                <div class="form-group">
                    <label for="adminEmail">Correo Electrónico del Administrador:</label>
                    <input type="email" id="adminEmail" required placeholder="ejemplo@correo.com">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Contraseña:</label>
                    <input type="password" id="adminPassword" required placeholder="Contraseña para el administrador">
                </div>
                <div class="form-group">
                    <label for="adminTeam">Equipo a Administrar:</label>
                    <select id="adminTeam" required>
                        <option value="">Selecciona un equipo</option>
                        <option value="prebenjamin">Prebenjamín</option>
                        <option value="benjamin">Benjamín</option>
                        <option value="alevin">Alevín</option>
                        <option value="infantil">Infantil</option>
                        <option value="aficionado">Aficionado</option>
                    </select>
                </div>
                <div class="form-buttons">
                    <button onclick="addTeamAdmin()" class="btn-primary">Crear Administrador de Equipo</button>
                </div>

                <div id="adminList" class="admin-list" style="margin-top: 20px;">
                    <h4>Administradores de Equipo Actuales</h4>
                    <div id="adminListContent">
                        <!-- La lista se llenará dinámicamente -->
                    </div>
                </div>
            </div>
        </div>

        <script>
        // Funciones para gestión de administradores de equipo
        function addTeamAdmin() {
            const email = document.getElementById('adminEmail').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            const team = document.getElementById('adminTeam').value;

            if (!email || !password || !team) {
                alert('Por favor, completa todos los campos');
                return;
            }

            // Verificar si ya existe un admin con ese email
            const admins = JSON.parse(localStorage.getItem('teamAdmins') || '[]');
            if (admins.some(admin => admin.email === email)) {
                alert('Ya existe un administrador con ese correo electrónico');
                return;
            }

            // Crear nuevo administrador
            const newAdmin = {
                id: Date.now().toString(),
                email: email,
                password: password, // La contraseña se guarda para que puedas verla como admin principal
                team: team,
                createdAt: new Date().toISOString(),
                createdBy: JSON.parse(localStorage.getItem('currentAdmin')).email,
                status: 'active'
            };

            // Guardar en localStorage
            admins.push(newAdmin);
            localStorage.setItem('teamAdmins', JSON.stringify(admins));

            // Limpiar formulario
            document.getElementById('adminEmail').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminTeam').value = '';

            // Actualizar lista
            loadTeamAdmins();

            alert(`✅ Administrador agregado exitosamente\n\nEmail: ${email}\nEquipo: ${team}`);
        }

        function loadTeamAdmins() {
            const admins = JSON.parse(localStorage.getItem('teamAdmins') || '[]');
            const container = document.getElementById('adminListContent');
            
            if (admins.length === 0) {
                container.innerHTML = '<p>No hay administradores registrados</p>';
                return;
            }

            let html = '<div class="admin-table">';
            html += `
                <div class="admin-row header">
                    <div>Email</div>
                    <div>Equipo</div>
                    <div>Contraseña</div>
                    <div>Estado</div>
                    <div>Acciones</div>
                </div>
            `;

            admins.forEach(admin => {
                const teamNames = {
                    'prebenjamin': 'Prebenjamín',
                    'benjamin': 'Benjamín',
                    'alevin': 'Alevín',
                    'infantil': 'Infantil',
                    'aficionado': 'Aficionado'
                };

                html += `
                    <div class="admin-row">
                        <div>${admin.email}</div>
                        <div>${teamNames[admin.team] || admin.team}</div>
                        <div>
                            <span id="pwd_${admin.id}" style="-webkit-text-security: disc;">
                                ${admin.password}
                            </span>
                            <button onclick="togglePassword('${admin.id}')" class="btn-small">
                                👁️
                            </button>
                        </div>
                        <div>
                            <span class="status-badge ${admin.status === 'active' ? 'active' : 'inactive'}">
                                ${admin.status === 'active' ? '✅ Activo' : '❌ Inactivo'}
                            </span>
                        </div>
                        <div>
                            <button onclick="toggleAdminStatus('${admin.id}')" class="btn-small">
                                ${admin.status === 'active' ? '🔒 Desactivar' : '🔓 Activar'}
                            </button>
                            <button onclick="deleteAdmin('${admin.id}')" class="btn-small delete">
                                🗑️ Eliminar
                            </button>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function togglePassword(adminId) {
            const pwdSpan = document.getElementById(`pwd_${adminId}`);
            if (pwdSpan.style.webkitTextSecurity === 'disc') {
                pwdSpan.style.webkitTextSecurity = 'none';
            } else {
                pwdSpan.style.webkitTextSecurity = 'disc';
            }
        }

        function toggleAdminStatus(adminId) {
            const admins = JSON.parse(localStorage.getItem('teamAdmins') || '[]');
            const adminIndex = admins.findIndex(a => a.id === adminId);
            
            if (adminIndex !== -1) {
                admins[adminIndex].status = admins[adminIndex].status === 'active' ? 'inactive' : 'active';
                localStorage.setItem('teamAdmins', JSON.stringify(admins));
                loadTeamAdmins();
            }
        }

        function deleteAdmin(adminId) {
            if (!confirm('¿Estás seguro de que quieres eliminar este administrador?')) {
                return;
            }

            const admins = JSON.parse(localStorage.getItem('teamAdmins') || '[]');
            const updatedAdmins = admins.filter(a => a.id !== adminId);
            localStorage.setItem('teamAdmins', JSON.stringify(updatedAdmins));
            loadTeamAdmins();
        }

        // Verificar autenticación al cargar la página
        // Función para verificar permisos de administrador
        function checkAdminPermissions() {
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin'));
            if (!currentAdmin) {
                window.location.href = 'index.html';
                return;
            }

            // Si es administrador de equipo
            if (currentAdmin.role === 'team_admin') {
                // Ocultar la sección de gestión de administradores
                const adminSection = document.querySelector('.admin-section');
                if (adminSection) {
                    adminSection.parentElement.style.display = 'none';
                }

                // Mostrar mensaje de bienvenida específico
                const welcomeMessage = document.createElement('div');
                welcomeMessage.style.cssText = 'background: #f0fdf4; color: #166534; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dcfce7;';
                welcomeMessage.innerHTML = `
                    <h3 style="margin: 0 0 10px 0;">👋 Bienvenido, Administrador de ${currentAdmin.teamId}</h3>
                    <p style="margin: 0;">Tienes acceso para gestionar todo lo relacionado con tu equipo.</p>
                `;
                document.querySelector('.admin-container').insertBefore(welcomeMessage, document.querySelector('.admin-container').firstChild);

                // Filtrar contenido para mostrar solo lo relacionado con su equipo
                filterContentForTeamAdmin(currentAdmin.teamId);
            }
        }

        function filterContentForTeamAdmin(teamId) {
            // Convertir el ID del equipo a nombre para mostrar
            const teamNames = {
                'prebenjamin': 'Prebenjamín',
                'benjamin': 'Benjamín',
                'alevin': 'Alevín',
                'infantil': 'Infantil',
                'aficionado': 'Aficionado'
            };

            // Actualizar título de la página
            document.title = `Panel de ${teamNames[teamId]} - CDSANABRIACF`;

            // Filtrar jugadores
            const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
            const teamPlayers = players.filter(p => p.team === teamId);
            
            // Filtrar eventos
            const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
            const teamEvents = events.filter(e => e.team === teamId);
            
            // Actualizar contadores
            document.getElementById('playersCount').textContent = teamPlayers.length;
            document.getElementById('eventsCount').textContent = teamEvents.length;

            // Ocultar estadísticas globales que no son relevantes para el equipo
            const globalStats = document.querySelectorAll('.stat-card[data-global="true"]');
            globalStats.forEach(stat => stat.style.display = 'none');
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔍 Cargando panel de administración CDSANABRIACF...');
            checkAdminSession();
            checkAdminPermissions();
            loadTeamAdmins(); // Cargar lista de administradores
            checkExpiredMembers(); // Verificar socios expirados al cargar
            cargarConfiguracionTienda(); // Cargar configuración de tienda
            
            // Sincronización automática de datos al cargar
            setTimeout(async () => {
                console.log('🔄 Iniciando sincronización automática...');
                updateDashboardCounts();
                updateMemberCounts();
                loadMembersList();
                
                // Actualizar estadísticas de base de datos desde localStorage
                try {
                    await updateDatabaseStats();
                    console.log('✅ Base de datos actualizada desde localStorage');
                } catch (dbError) {
                    console.error('❌ Error actualizando base de datos:', dbError);
                }
                
                console.log('✅ Sincronización automática completada');
            }, 1000);
        });

        // Función para verificar sesión de administrador
        function checkAdminSession() {
            try {
                const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                
                if (!currentAdmin.email) {
                    // Crear sesión por defecto para el administrador principal
                    const defaultAdmin = {
                        id: 'ADMIN_CDSANABRIACF',
                        name: 'Administrador Principal CDSANABRIACF',
                        email: 'amco@gmx.es',
                        teamId: 'CDSANABRIACF',
                        role: 'super_admin',
                        loginTime: new Date().toISOString()
                    };
                    localStorage.setItem('currentAdmin', JSON.stringify(defaultAdmin));
                    currentAdmin = defaultAdmin;
                }
                
                console.log('✅ Sesión de administrador verificada:', currentAdmin.email);
                
                // Actualizar información en pantalla con indicador de permisos (sin mostrar email)
                const adminInfo = document.getElementById('currentAdminInfo');
                if (adminInfo) {
                    const isPrincipal = currentAdmin.email === 'amco@gmx.es';
                    const isSecondAdmin = currentAdmin.email === 'cdsanabriafc@gmail.com';
                    const roleText = isPrincipal ? '👑 PRINCIPAL' : isSecondAdmin ? '👨‍💼 SEGUNDO' : '👨‍💼 SECUNDARIO';
                    const permissionText = isPrincipal || isSecondAdmin ? '(Permisos completos)' : '(Sin gestión de admins)';
                    
                    adminInfo.innerHTML = `
                        👤 ${currentAdmin.name}<br>
                        <small>${roleText} | Administrador Autorizado</small><br>
                        <small style="opacity: 0.8;">${permissionText}</small>
                    `;
                }
                
                return true;
            } catch (error) {
                console.error('❌ Error verificando sesión:', error);
                return false;
            }
        }

        // Función para cambiar de pestaña
        function showTab(tabName) {
            try {
                console.log('📂 Cambiando a pestaña:', tabName);
                
                // Ocultar todos los contenidos de pestañas
                const tabContents = document.querySelectorAll('.tab-content');
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Remover clase active de todos los botones
                const navTabs = document.querySelectorAll('.nav-tab');
                navTabs.forEach(tab => tab.classList.remove('active'));
                
                // Mostrar el contenido de la pestaña seleccionada
                const targetTab = document.getElementById(tabName);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
                
                // Marcar el botón como activo
                const buttons = document.querySelectorAll('.nav-tab');
                buttons.forEach(button => {
                    if (button.textContent.includes(getTabDisplayName(tabName))) {
                        button.classList.add('active');
                    }
                });
                
                console.log('✅ Pestaña cambiada exitosamente:', tabName);
            } catch (error) {
                console.error('❌ Error cambiando pestaña:', error);
            }
        }

        function getTabDisplayName(tabName) {
            const names = {
                'dashboard': 'Dashboard',
                'equipos': 'Equipos',
                'jugadores': 'Jugadores',
                'calendario': 'Calendario',
                'eventos': 'Eventos',
                'socios': 'Socios',
                'amigos': 'Amigos del Club',
                'entrenadores': 'Entrenadores',
                'mensajes': 'Mensajes Push',
                'exportar': 'Exportar Datos',
                'basedatos': 'Base de Datos',
                'publicidad': 'Publicidad',
                'competiciones': 'Competiciones',
                'multimedia': 'Multimedia',
                'tienda': 'Tienda',
                'configuracion': 'Configuración'
            };
            return names[tabName] || tabName;
        }

        // Función para cerrar sesión
        function logout() {
            if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
                localStorage.removeItem('currentAdmin');
                console.log('👋 Sesión cerrada');
                alert('✅ Sesión cerrada correctamente');
                window.location.href = '../admin-panel.html';
            }
        }

        // Función para verificar permisos de administrador
        function checkAdminPermissions() {
            try {
                const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                const isPrincipalAdmin = currentAdmin.email === 'amco@gmx.es';
                
                console.log('🔍 Verificando permisos. Es administrador principal:', isPrincipalAdmin);
                
                if (isPrincipalAdmin) {
                    // Mostrar sección de gestión de administradores
                    loadAdminsList();
                } else {
                    // Ocultar sección de gestión de administradores para administradores secundarios
                    const adminSection = document.querySelector('.section h3');
                    const sections = document.querySelectorAll('.section');
                    
                    sections.forEach(section => {
                        const h3 = section.querySelector('h3');
                        if (h3 && h3.textContent.includes('👨‍💼 Gestión de Administradores')) {
                            section.style.display = 'none';
                            console.log('🚫 Ocultando gestión de administradores para administrador secundario');
                        }
                    });
                }
            } catch (error) {
                console.error('❌ Error verificando permisos:', error);
            }
        }

        // Función para generar contraseña automática
        function generatePassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let password = '';
            for (let i = 0; i < 8; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }

        // Función para mostrar/ocultar contraseñas
        function togglePassword(elementId, realPassword) {
            const element = document.getElementById(elementId);
            if (element.textContent === '••••••••') {
                element.textContent = realPassword;
            } else {
                element.textContent = '••••••••';
            }
        }

        // Funciones para gestión de administradores (solo para administrador principal)
        function showAddAdminForm() {
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
            if (currentAdmin.email !== 'amco@gmx.es') {
                alert('❌ Solo el administrador principal puede gestionar otros administradores');
                return;
            }
            document.getElementById('addAdminForm').style.display = 'block';
            // Limpiar campo de contraseña para que el admin la ponga
            document.getElementById('adminPassword').value = '';
        }

        function cancelAddAdmin() {
            document.getElementById('addAdminForm').style.display = 'none';
            clearAdminForm();
        }

        function clearAdminForm() {
            document.getElementById('adminName').value = '';
            document.getElementById('adminEmail').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminRole').value = 'team_admin';
        }

        function saveNewAdmin() {
            // Verificar permisos
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
            if (currentAdmin.email !== 'amco@gmx.es') {
                alert('❌ Solo el administrador principal puede añadir otros administradores');
                return;
            }
            
            try {
                const adminData = {
                    id: 'ADMIN_' + Date.now(),
                    name: document.getElementById('adminName').value,
                    email: document.getElementById('adminEmail').value,
                    password: document.getElementById('adminPassword').value,
                    role: document.getElementById('adminRole').value,
                    teamId: 'CDSANABRIACF',
                    createdAt: new Date().toISOString(),
                    createdBy: 'amco@gmx.es',
                    status: 'active'
                };

                // Validar campos obligatorios
                if (!adminData.name || !adminData.email || !adminData.password) {
                    alert('❌ Por favor, completa todos los campos obligatorios marcados con *');
                    return;
                }

                // Validar que no sea el email principal
                if (adminData.email.toLowerCase() === 'amco@gmx.es') {
                    alert('❌ No puedes crear otro administrador con el email principal');
                    return;
                }

                // Validar email único
                const existingAdmins = JSON.parse(localStorage.getItem('cdsanabriacfTeamAdmins') || '[]');
                if (existingAdmins.find(admin => admin.email.toLowerCase() === adminData.email.toLowerCase())) {
                    alert('❌ Ya existe un administrador con este email');
                    return;
                }

                // Guardar en localStorage
                existingAdmins.push(adminData);
                localStorage.setItem('cdsanabriacfTeamAdmins', JSON.stringify(existingAdmins));

                alert('✅ Administrador añadido exitosamente\n\n📧 Email: ' + adminData.email + '\n\n💡 El administrador puede acceder al panel con su email y contraseña.\n\n⚠️ Este administrador NO podrá gestionar otros administradores.');
                
                cancelAddAdmin();
                loadAdminsList();

                console.log('👨‍💼 Nuevo administrador añadido:', adminData.name, adminData.email);
            } catch (error) {
                console.error('❌ Error añadiendo administrador:', error);
                alert('❌ Error al añadir el administrador. Inténtalo de nuevo.');
            }
        }

        function loadAdminsList() {
            try {
                const admins = JSON.parse(localStorage.getItem('cdsanabriacfTeamAdmins') || '[]');
                const adminsList = document.getElementById('adminsList');

                // Añadir siempre el administrador principal
                const principalAdmin = {
                    id: 'ADMIN_PRINCIPAL',
                    name: 'Administrador Principal',
                    email: 'amco@gmx.es',
                    role: 'super_admin',
                    status: 'active'
                };

                // Añadir el segundo administrador
                const secondAdmin = {
                    id: 'ADMIN_SECONDARY',
                    name: 'Administrador Secundario',
                    email: 'cdsanabriafc@gmail.com',
                    password: 'admin123',
                    role: 'super_admin',
                    status: 'active'
                };

                let html = '<h4>👥 Lista de Administradores</h4>';
                html += '<div style="background: white; border-radius: 8px; padding: 15px; margin-top: 15px;">';
                
                // Mostrar administrador principal
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; background: #f0f9ff;">
                        <div>
                            <strong>👑 ${principalAdmin.name}</strong><br>
                            <small>📧 ${principalAdmin.email} | 🎯 Super Administrador</small><br>
                            <small style="color: #dc2626; font-weight: bold;">🔐 Contraseña: <span style="color: #dc2626;">••••••••</span> <span style="color: #666; font-size: 0.7rem;">(Protegida)</span></small>
                        </div>
                        <div>
                            <span style="background: #059669; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">PRINCIPAL</span>
                        </div>
                    </div>
                `;

                // Mostrar segundo administrador
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; background: #f0f9ff;">
                        <div>
                            <strong>👑 ${secondAdmin.name}</strong><br>
                            <small>📧 ${secondAdmin.email} | 🎯 Super Administrador</small><br>
                            <small style="color: #059669; font-weight: bold;">🔐 Contraseña: <span id="admin-password-${secondAdmin.id}">••••••••</span>
                            <button onclick="togglePassword('admin-password-${secondAdmin.id}', '${secondAdmin.password}')" style="background: none; border: none; color: #059669; cursor: pointer; font-size: 0.8rem; margin-left: 5px;">👁️</button></small>
                        </div>
                        <div>
                            <span style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">SECUNDARIO</span>
                        </div>
                    </div>
                `;

                // Mostrar administradores adicionales
                if (admins.length === 0) {
                    html += '<div style="padding: 15px; text-align: center; color: #666;">No hay administradores adicionales registrados</div>';
                } else {
                    admins.forEach(admin => {
                        const roleText = admin.role === 'team_admin' ? 'Administrador de Equipo' : 'Administrador Asistente';
                        const password = admin.password || 'No establecida';
                        html += `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee;">
                                <div>
                                    <strong>👨‍💼 ${admin.name}</strong><br>
                                    <small>📧 ${admin.email} | 🎯 ${roleText}</small><br>
                                    <small style="color: #666;">Creado: ${new Date(admin.createdAt).toLocaleDateString()}</small><br>
                                    <small style="color: #059669; font-weight: bold;">
                                        🔐 Contraseña: <span id="admin-password-${admin.id}">${password ? '••••••••' : 'No establecida'}</span>
                                        ${password ? `<button onclick="togglePassword('admin-password-${admin.id}', '${password}')" style="background: none; border: none; color: #059669; cursor: pointer; font-size: 0.8rem; margin-left: 5px;">👁️</button>` : ''}
                                    </small>
                                </div>
                                <div>
                                    <button class="btn btn-small" onclick="editAdmin('${admin.id}')" style="padding: 5px 10px; font-size: 0.8rem; margin-right: 5px;">✏️ Editar</button>
                                    <button class="btn btn-small" onclick="deleteAdmin('${admin.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: #dc2626;">🗑️ Eliminar</button>
                                </div>
                            </div>
                        `;
                    });
                }

                html += '</div>';
                adminsList.innerHTML = html;

                console.log('👥 Lista de administradores cargada:', admins.length + 2, 'administradores');
            } catch (error) {
                console.error('❌ Error cargando lista de administradores:', error);
            }
        }

        function editAdmin(adminId) {
            // Verificar permisos
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
            if (currentAdmin.email !== 'amco@gmx.es') {
                alert('❌ Solo el administrador principal puede editar otros administradores');
                return;
            }
            alert('🔧 Función de edición en desarrollo. ID: ' + adminId);
        }

        function deleteAdmin(adminId) {
            // Verificar permisos
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
            if (currentAdmin.email !== 'amco@gmx.es') {
                alert('❌ Solo el administrador principal puede eliminar otros administradores');
                return;
            }
            
            if (confirm('¿Estás seguro de que quieres eliminar este administrador?\n\n⚠️ Esta acción no se puede deshacer.')) {
                try {
                    const admins = JSON.parse(localStorage.getItem('cdsanabriacfTeamAdmins') || '[]');
                    const adminToDelete = admins.find(admin => admin.id === adminId);
                    
                    if (adminToDelete) {
                        const updatedAdmins = admins.filter(admin => admin.id !== adminId);
                        localStorage.setItem('cdsanabriacfTeamAdmins', JSON.stringify(updatedAdmins));

                        loadAdminsList();
                        alert('✅ Administrador "' + adminToDelete.name + '" eliminado correctamente');
                        console.log('🗑️ Administrador eliminado:', adminToDelete.name, 'ID:', adminId);
                    }
                } catch (error) {
                    console.error('❌ Error eliminando administrador:', error);
                    alert('❌ Error al eliminar el administrador');
                }
            }
        }

        // === MÓDULO DE JUGADORES ===
        
        // Función para mostrar formulario de añadir jugador
        function showAddPlayerForm() {
            document.getElementById('addPlayerForm').style.display = 'block';
            document.getElementById('addPlayerForm').scrollIntoView({ behavior: 'smooth' });
        }

        // Función para cancelar añadir jugador
        function cancelAddPlayer() {
            document.getElementById('addPlayerForm').style.display = 'none';
            clearPlayerForm();
        }

        // Función para limpiar formulario de jugador
        function clearPlayerForm() {
            const form = document.getElementById('addPlayerForm');
            const inputs = form.querySelectorAll('input, select');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
            document.getElementById('guardianSection').style.display = 'none';
            document.getElementById('photoPreview').style.display = 'none';
        }

        // Función para mostrar vista previa de la foto del jugador
        function previewPlayerPhoto() {
            const fileInput = document.getElementById('playerPhoto');
            const previewDiv = document.getElementById('photoPreview');
            const previewImg = document.getElementById('playerPhotoPreview');
            
            if (fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];
                
                // Validar tipo de archivo
                if (!file.type.startsWith('image/')) {
                    alert('❌ Solo se permiten archivos de imagen.');
                    fileInput.value = '';
                    return;
                }
                
                // Validar tamaño (máximo 2MB)
                if (file.size > 2 * 1024 * 1024) {
                    alert('❌ La foto es demasiado grande. Máximo 2MB permitido.');
                    fileInput.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    previewDiv.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                previewDiv.style.display = 'none';
            }
        }

        // Función para eliminar la foto del jugador
        function removePlayerPhoto() {
            document.getElementById('playerPhoto').value = '';
            document.getElementById('photoPreview').style.display = 'none';
        }

        // Función para procesar foto del jugador
        function processPlayerPhoto(file) {
            return new Promise((resolve, reject) => {
                if (!file) {
                    resolve(null);
                    return;
                }

                // Validar tamaño (máximo 2MB)
                if (file.size > 2 * 1024 * 1024) {
                    reject('La foto es demasiado grande. Máximo 2MB permitido.');
                    return;
                }

                // Validar tipo de archivo
                if (!file.type.startsWith('image/')) {
                    reject('Solo se permiten archivos de imagen.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                reader.onerror = function() {
                    reject('Error al leer el archivo.');
                };
                reader.readAsDataURL(file);
            });
        }

        // Función para calcular edad automáticamente
        function calculateAge() {
            const birthDate = document.getElementById('playerBirthDate').value;
            if (!birthDate) return;

            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }

            document.getElementById('playerAge').value = age;

            // Mostrar sección de tutor para menores de 18
            const guardianSection = document.getElementById('guardianSection');
            if (age < 18) {
                guardianSection.style.display = 'block';
            } else {
                guardianSection.style.display = 'none';
            }

            // Sugerir categoría automáticamente
            let suggestedCategory = '';
            if (age >= 6 && age <= 8) suggestedCategory = 'prebenajmin';
            else if (age >= 8 && age <= 10) suggestedCategory = 'benjamin';
            else if (age >= 10 && age <= 12) suggestedCategory = 'alevin';
            else if (age >= 12 && age <= 14) suggestedCategory = 'infantil';
            else if (age >= 18) suggestedCategory = 'aficionado';

            if (suggestedCategory) {
                document.getElementById('playerCategory').value = suggestedCategory;
            }
        }

        // Función para guardar jugador
        async function savePlayer() {
            try {
                // Procesar foto del jugador
                const photoFile = document.getElementById('playerPhoto').files[0];
                let photoData = null;
                
                if (photoFile) {
                    try {
                        photoData = await processPlayerPhoto(photoFile);
                    } catch (error) {
                        alert('❌ Error con la foto: ' + error);
                        return;
                    }
                }

                const playerData = {
                    id: 'PLAYER_' + Date.now(),
                    name: document.getElementById('playerName').value.trim(),
                    surname: document.getElementById('playerSurname').value.trim(),
                    dni: document.getElementById('playerDNI').value.trim(),
                    phone: document.getElementById('playerPhone').value.trim(),
                    address: document.getElementById('playerAddress').value.trim(),
                    birthDate: document.getElementById('playerBirthDate').value,
                    age: parseInt(document.getElementById('playerAge').value),
                    category: document.getElementById('playerCategory').value,
                    number: document.getElementById('playerNumber').value,
                    position: document.getElementById('playerPosition').value,
                    license: document.getElementById('playerLicense').value.trim(),
                    // Estadísticas deportivas
                    matches: parseInt(document.getElementById('playerMatches').value) || 0,
                    goals: parseInt(document.getElementById('playerGoals').value) || 0,
                    assists: parseInt(document.getElementById('playerAssists').value) || 0,
                    yellowCards: parseInt(document.getElementById('playerYellowCards').value) || 0,
                    redCards: parseInt(document.getElementById('playerRedCards').value) || 0,
                    // Datos del tutor
                    guardianName: document.getElementById('guardianName').value.trim(),
                    guardianDNI: document.getElementById('guardianDNI').value.trim(),
                    guardianPhone: document.getElementById('guardianPhone').value.trim(),
                    guardianEmail: document.getElementById('guardianEmail').value.trim(),
                    guardianAddress: document.getElementById('guardianAddress').value.trim(),
                    // Consentimientos
                    playerConsent: document.getElementById('playerConsent').checked,
                    photoConsent: document.getElementById('photoConsent').checked,
                    // Metadatos
                    registrationDate: new Date().toISOString(),
                    status: 'pending_validation',
                    isMinor: playerData.age < 18,
                    // Foto del jugador
                    photo: photoData
                };

                // Validar campos obligatorios
                if (!playerData.name || !playerData.surname || !playerData.dni || !playerData.phone || !playerData.birthDate) {
                    alert('❌ Por favor, completa todos los campos obligatorios marcados con *');
                    return;
                }

                // Validar consentimientos
                if (!playerData.playerConsent || !playerData.photoConsent) {
                    alert('❌ Los consentimientos son obligatorios para completar el registro');
                    return;
                }

                // Validar datos del tutor para menores
                if (playerData.age < 18) {
                    if (!playerData.guardianName || !playerData.guardianDNI || !playerData.guardianPhone || !playerData.guardianEmail) {
                        alert('❌ Para menores de edad es obligatorio completar todos los datos del tutor');
                        return;
                    }
                }

                // Validar DNI único
                const existingPlayers = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                if (existingPlayers.find(player => player.dni === playerData.dni)) {
                    alert('❌ Ya existe un jugador registrado con este DNI');
                    return;
                }

                // Validar dorsal único por categoría
                if (playerData.number) {
                    const sameCategory = existingPlayers.filter(player => player.category === playerData.category);
                    if (sameCategory.find(player => player.number === playerData.number)) {
                        alert('❌ Ya existe un jugador con este dorsal en la categoría ' + playerData.category);
                        return;
                    }
                }

                // Guardar en localStorage
                existingPlayers.push(playerData);
                localStorage.setItem('clubPlayers', JSON.stringify(existingPlayers));

                alert('✅ Jugador registrado exitosamente\n\n👤 ' + playerData.name + ' ' + playerData.surname + '\n📧 Categoría: ' + playerData.category + '\n🎯 Estado: Pendiente de validación\n\n💡 El jugador será validado por un administrador.');
                
                cancelAddPlayer();
                loadPlayersList();
                updateDashboardCounts();

                console.log('👤 Nuevo jugador registrado:', playerData.name, playerData.surname);
            } catch (error) {
                console.error('❌ Error guardando jugador:', error);
                alert('❌ Error al guardar el jugador. Inténtalo de nuevo.');
            }
        }

        // Función para cargar lista de jugadores
        function loadPlayersList() {
            try {
                const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                const playersList = document.getElementById('playersList');
                
                if (players.length === 0) {
                    playersList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No hay jugadores registrados aún.</p>';
                    return;
                }

                // Agrupar por categorías
                const categories = {
                    'prebenajmin': 'Prebenjamín (6-8 años)',
                    'benjamin': 'Benjamín (8-10 años)',
                    'alevin': 'Alevín (10-12 años)',
                    'infantil': 'Infantil (12-14 años)',
                    'aficionado': 'Aficionado (18+ años)'
                };

                let html = '';
                
                Object.keys(categories).forEach(categoryKey => {
                    const categoryPlayers = players.filter(player => player.category === categoryKey);
                    
                    if (categoryPlayers.length > 0) {
                        html += `
                            <div class="category-section" data-category="${categoryKey}" style="margin-bottom: 30px; background: white; border-radius: 10px; padding: 20px; border: 2px solid #e9ecef;">
                                <h4 style="color: #1e3a8a; margin-bottom: 15px; display: flex; align-items: center;">
                                    ⚽ ${categories[categoryKey]} 
                                    <span style="background: #1e3a8a; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; margin-left: 10px;">
                                        ${categoryPlayers.length} jugador${categoryPlayers.length !== 1 ? 'es' : ''}
                                    </span>
                                </h4>
                        `;

                        categoryPlayers.forEach(player => {
                            const statusColor = player.status === 'active' ? '#059669' : player.status === 'pending_validation' ? '#f59e0b' : '#dc2626';
                            const statusText = player.status === 'active' ? 'Activo' : player.status === 'pending_validation' ? 'Pendiente' : 'Inactivo';
                            const isMinorIcon = player.age < 18 ? '👶' : '👤';
                            
                            html += `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; background: #f8f9fa; margin-bottom: 10px; border-radius: 8px;">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                            <strong style="font-size: 1.1em;">${isMinorIcon} ${player.name} ${player.surname}</strong>
                                            <span style="background: ${statusColor}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; margin-left: 10px;">
                                                ${statusText}
                                            </span>
                                        </div>
                                        <div style="font-size: 0.9em; color: #666;">
                                            📞 ${player.phone} | 🆔 ${player.dni} | 🎂 ${player.age} años | 🏃 Dorsal: ${player.number || 'Sin asignar'} | ⚽ ${player.position || 'Sin posición'}
                                        </div>
                                        <div style="font-size: 0.8em; color: #1e3a8a; margin-top: 3px;">
                                            📊 PJ: ${player.matches || 0} | ⚽ Goles: ${player.goals || 0} | 🎯 Asist: ${player.assists || 0} | 🟨 ${player.yellowCards || 0} | 🟥 ${player.redCards || 0}
                                        </div>
                                        ${player.age < 18 ? `<div style="font-size: 0.8em; color: #f59e0b; margin-top: 3px;">👨‍👩‍👧‍👦 Tutor: ${player.guardianName} (${player.guardianPhone})</div>` : ''}
                                    </div>
                                    <div style="display: flex; gap: 5px;">
                                        <button onclick="viewPlayerDetails('${player.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">👁️ Ver</button>
                                        <button onclick="updatePlayerStats('${player.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer;">📊 Stats</button>
                                        <button onclick="editPlayer('${player.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: #1e3a8a; color: white; border: none; border-radius: 4px; cursor: pointer;">✏️ Editar</button>
                                        ${player.status === 'pending_validation' ? `<button onclick="validatePlayer('${player.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer;">✅ Validar</button>` : ''}
                                        <button onclick="deletePlayer('${player.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer;">🗑️ Eliminar</button>
                                    </div>
                                </div>
                            `;
                        });

                        html += `</div>`;
                    }
                });

                if (html === '') {
                    html = '<p style="text-align: center; color: #666; padding: 20px;">No hay jugadores en la categoría seleccionada.</p>';
                }

                playersList.innerHTML = html;
                console.log('👥 Lista de jugadores cargada:', players.length, 'jugadores');
            } catch (error) {
                console.error('❌ Error cargando lista de jugadores:', error);
            }
        }

        // Función para filtrar jugadores por categoría
        function filterPlayersByCategory() {
            const selectedCategory = document.getElementById('categoryFilter').value;
            const categorySections = document.querySelectorAll('.category-section');
            
            categorySections.forEach(section => {
                if (selectedCategory === 'all' || section.dataset.category === selectedCategory) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        }

        // Función para ver detalles del jugador
        function viewPlayerDetails(playerId) {
            const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
            const player = players.find(p => p.id === playerId);
            
            if (player) {
                const isMinor = player.age < 18;
                let details = `👤 DETALLES DEL JUGADOR\n\n`;
                details += `Nombre: ${player.name} ${player.surname}\n`;
                details += `DNI: ${player.dni}\n`;
                details += `Teléfono: ${player.phone}\n`;
                details += `Edad: ${player.age} años\n`;
                details += `Categoría: ${player.category}\n`;
                details += `Dorsal: ${player.number || 'Sin asignar'}\n`;
                details += `Dirección: ${player.address || 'No especificada'}\n`;
                details += `Estado: ${player.status === 'active' ? 'Activo' : player.status === 'pending_validation' ? 'Pendiente de validación' : 'Inactivo'}\n`;
                
                if (isMinor) {
                    details += `\n👨‍👩‍👧‍👦 DATOS DEL TUTOR:\n`;
                    details += `Nombre: ${player.guardianName}\n`;
                    details += `DNI: ${player.guardianDNI}\n`;
                    details += `Teléfono: ${player.guardianPhone}\n`;
                    details += `Email: ${player.guardianEmail}\n`;
                    details += `Dirección: ${player.guardianAddress || 'No especificada'}\n`;
                }
                
                details += `\n✅ CONSENTIMIENTOS:\n`;
                details += `Jugador del equipo: ${player.playerConsent ? 'Sí' : 'No'}\n`;
                details += `Fotos y videos: ${player.photoConsent ? 'Sí' : 'No'}\n`;
                details += `\nFecha de registro: ${new Date(player.registrationDate).toLocaleDateString()}`;
                
                alert(details);
            }
        }

        // Función para validar jugador
        function validatePlayer(playerId) {
            if (confirm('¿Validar este jugador?\n\nEsto cambiará su estado a "Activo" y podrá participar en todas las actividades del club.')) {
                try {
                    const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                    const playerIndex = players.findIndex(p => p.id === playerId);
                    
                    if (playerIndex !== -1) {
                        players[playerIndex].status = 'active';
                        players[playerIndex].validatedDate = new Date().toISOString();
                        localStorage.setItem('clubPlayers', JSON.stringify(players));
                        
                        loadPlayersList();
                        alert('✅ Jugador validado correctamente');
                        console.log('✅ Jugador validado:', players[playerIndex].name, players[playerIndex].surname);
                    }
                } catch (error) {
                    console.error('❌ Error validando jugador:', error);
                    alert('❌ Error al validar el jugador');
                }
            }
        }

        // Función para editar jugador
        function editPlayer(playerId) {
            alert('🔧 Función de edición en desarrollo. ID: ' + playerId);
        }

        // Función para eliminar jugador
        function deletePlayer(playerId) {
            if (confirm('¿Estás seguro de que quieres eliminar este jugador?\n\n⚠️ Esta acción no se puede deshacer.')) {
                try {
                    const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                    const playerToDelete = players.find(p => p.id === playerId);
                    
                    if (playerToDelete) {
                        const updatedPlayers = players.filter(p => p.id !== playerId);
                        localStorage.setItem('clubPlayers', JSON.stringify(updatedPlayers));
                        
                        loadPlayersList();
                        updateDashboardCounts();
                        alert('✅ Jugador "' + playerToDelete.name + ' ' + playerToDelete.surname + '" eliminado correctamente');
                        console.log('🗑️ Jugador eliminado:', playerToDelete.name, playerToDelete.surname);
                    }
                } catch (error) {
                    console.error('❌ Error eliminando jugador:', error);
                    alert('❌ Error al eliminar el jugador');
                }
            }
        }

        // Función para actualizar estadísticas de jugador
        function updatePlayerStats(playerId) {
            try {
                const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                const playerIndex = players.findIndex(p => p.id === playerId);
                
                if (playerIndex !== -1) {
                    const player = players[playerIndex];
                    
                    // Crear modal para actualizar estadísticas
                    const modalHtml = `
                        <div id="statsModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; justify-content: center; align-items: center;">
                            <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                                <h3 style="color: #1e3a8a; margin-bottom: 20px;">📊 Actualizar Estadísticas - ${player.name} ${player.surname}</h3>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Partidos Jugados</label>
                                        <input type="number" id="updateMatches" value="${player.matches || 0}" min="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Goles Marcados</label>
                                        <input type="number" id="updateGoals" value="${player.goals || 0}" min="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Asistencias</label>
                                        <input type="number" id="updateAssists" value="${player.assists || 0}" min="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tarjetas Amarillas</label>
                                        <input type="number" id="updateYellowCards" value="${player.yellowCards || 0}" min="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tarjetas Rojas</label>
                                        <input type="number" id="updateRedCards" value="${player.redCards || 0}" min="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Posición</label>
                                        <select id="updatePosition" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                            <option value="" ${!player.position ? 'selected' : ''}>Sin posición</option>
                                            <option value="portero" ${player.position === 'portero' ? 'selected' : ''}>Portero</option>
                                            <option value="defensa" ${player.position === 'defensa' ? 'selected' : ''}>Defensa</option>
                                            <option value="centrocampista" ${player.position === 'centrocampista' ? 'selected' : ''}>Centrocampista</option>
                                            <option value="delantero" ${player.position === 'delantero' ? 'selected' : ''}>Delantero</option>
                                            <option value="versatil" ${player.position === 'versatil' ? 'selected' : ''}>Versátil</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="text-align: center; margin-top: 20px;">
                                    <button onclick="savePlayerStats('${playerId}')" style="background: #059669; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">💾 Guardar</button>
                                    <button onclick="closeStatsModal()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">❌ Cancelar</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.body.insertAdjacentHTML('beforeend', modalHtml);
                }
            } catch (error) {
                console.error('❌ Error abriendo modal de estadísticas:', error);
                alert('❌ Error al abrir el formulario de estadísticas');
            }
        }

        // Función para guardar estadísticas actualizadas
        function savePlayerStats(playerId) {
            try {
                const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                const playerIndex = players.findIndex(p => p.id === playerId);
                
                if (playerIndex !== -1) {
                    players[playerIndex].matches = parseInt(document.getElementById('updateMatches').value) || 0;
                    players[playerIndex].goals = parseInt(document.getElementById('updateGoals').value) || 0;
                    players[playerIndex].assists = parseInt(document.getElementById('updateAssists').value) || 0;
                    players[playerIndex].yellowCards = parseInt(document.getElementById('updateYellowCards').value) || 0;
                    players[playerIndex].redCards = parseInt(document.getElementById('updateRedCards').value) || 0;
                    players[playerIndex].position = document.getElementById('updatePosition').value;
                    
                    localStorage.setItem('clubPlayers', JSON.stringify(players));
                    
                    closeStatsModal();
                    loadPlayersList();
                    alert('✅ Estadísticas actualizadas correctamente');
                    console.log('📊 Estadísticas actualizadas para:', players[playerIndex].name, players[playerIndex].surname);
                }
            } catch (error) {
                console.error('❌ Error guardando estadísticas:', error);
                alert('❌ Error al guardar las estadísticas');
            }
        }

        // Función para cerrar modal de estadísticas
        function closeStatsModal() {
            const modal = document.getElementById('statsModal');
            if (modal) {
                modal.remove();
            }
        }

        // Función para actualizar contadores del dashboard
        function updateDashboardCounts() {
            try {
                const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                const playersCountElement = document.getElementById('playersCount');
                if (playersCountElement) {
                    playersCountElement.textContent = players.length;
                }
                
                const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
                const competitionsCountElement = document.getElementById('competitionsCount');
                if (competitionsCountElement) {
                    competitionsCountElement.textContent = competitions.length;
                }
            } catch (error) {
                console.error('❌ Error actualizando contadores:', error);
            }
        }

        // Cargar listas al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            loadPlayersList();
            loadMembersList();
            loadFriendsList();
            loadCoachesList();
            loadAdminMessagesHistory();
            loadExportHistory();
            loadAdvertisementsList();
            loadCompetitionsList();
            loadTeamsCards();
            updateDashboardCounts();
            updateMemberCounts();
            updateFriendCounts();
            updateCoachCounts();
            updateMessageCounts();
            updateAdvertisementCounts();
            updateCategoryCounts();
        });

        // === MÓDULO DE CALENDARIO ===
        let currentCalendarDate = new Date();
        
        function showAddCalendarEventForm() {
            document.getElementById('addCalendarEventForm').style.display = 'block';
            document.getElementById('addCalendarEventForm').scrollIntoView({ behavior: 'smooth' });
            const today = new Date();
            document.getElementById('calendarDate').value = today.toISOString().split('T')[0];
        }

        function cancelAddCalendarEvent() {
            document.getElementById('addCalendarEventForm').style.display = 'none';
            clearCalendarEventForm();
        }

        function clearCalendarEventForm() {
            const form = document.getElementById('addCalendarEventForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
            document.getElementById('matchFields').style.display = 'none';
            document.getElementById('recurringOptions').style.display = 'none';
        }

        function toggleRecurringOptions() {
            const isRecurring = document.getElementById('calendarRecurring').checked;
            const recurringOptions = document.getElementById('recurringOptions');
            
            if (isRecurring) {
                recurringOptions.style.display = 'block';
                const endDate = new Date();
                endDate.setMonth(endDate.getMonth() + 3);
                document.getElementById('recurringEndDate').value = endDate.toISOString().split('T')[0];
            } else {
                recurringOptions.style.display = 'none';
            }
        }

        function saveCalendarEvent() {
            try {
                const eventData = {
                    id: 'CALENDAR_' + Date.now(),
                    title: document.getElementById('calendarTitle').value.trim(),
                    type: document.getElementById('calendarType').value,
                    date: document.getElementById('calendarDate').value,
                    startTime: document.getElementById('calendarStartTime').value,
                    endTime: document.getElementById('calendarEndTime').value,
                    category: document.getElementById('calendarCategory').value,
                    location: document.getElementById('calendarLocation').value.trim(),
                    description: document.getElementById('calendarDescription').value.trim(),
                    rivalTeam: document.getElementById('rivalTeam').value.trim(),
                    homeAway: document.getElementById('homeAway').value,
                    isRecurring: document.getElementById('calendarRecurring').checked,
                    recurringEndDate: document.getElementById('recurringEndDate').value,
                    createdAt: new Date().toISOString(),
                    createdBy: JSON.parse(localStorage.getItem('currentAdmin') || '{}').email || 'admin'
                };

                if (!eventData.title || !eventData.type || !eventData.date || !eventData.startTime || !eventData.endTime || !eventData.category || !eventData.location) {
                    alert('❌ Por favor, completa todos los campos obligatorios marcados con *');
                    return;
                }

                if (eventData.startTime >= eventData.endTime) {
                    alert('❌ La hora de fin debe ser posterior a la hora de inicio');
                    return;
                }

                if (eventData.type === 'match' && !eventData.rivalTeam) {
                    alert('❌ Para partidos es obligatorio especificar el equipo rival');
                    return;
                }

                const calendarEvents = JSON.parse(localStorage.getItem('clubCalendarEvents') || '[]');
                calendarEvents.push(eventData);
                localStorage.setItem('clubCalendarEvents', JSON.stringify(calendarEvents));

                alert(`✅ Actividad programada exitosamente\n\n📅 ${eventData.title}\n📆 ${eventData.date}\n⏰ ${eventData.startTime} - ${eventData.endTime}\n📍 ${eventData.location}`);
                
                cancelAddCalendarEvent();
                generateCalendarGrid();
                loadUpcomingActivities();

                console.log('📅 Nueva actividad programada:', eventData.title);
            } catch (error) {
                console.error('❌ Error guardando evento del calendario:', error);
                alert('❌ Error al programar la actividad. Inténtalo de nuevo.');
            }
        }

        function generateCalendarGrid() {
            try {
                const calendarGrid = document.getElementById('calendarGrid');
                const monthYear = document.getElementById('currentMonthYear');
                
                const year = currentCalendarDate.getFullYear();
                const month = currentCalendarDate.getMonth();
                
                const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                                  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                monthYear.textContent = `${monthNames[month]} ${year}`;

                const events = JSON.parse(localStorage.getItem('clubCalendarEvents') || '[]');
                const filteredEvents = events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.getFullYear() === year && eventDate.getMonth() === month;
                });

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startingDayOfWeek = firstDay.getDay();
                const daysInMonth = lastDay.getDate();

                let html = `
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #ddd; border-radius: 8px; overflow: hidden;">
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Dom</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Lun</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Mar</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Mié</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Jue</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Vie</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Sáb</div>
                `;

                for (let i = 0; i < startingDayOfWeek; i++) {
                    html += `<div style="background: #f8f9fa; min-height: 80px; padding: 5px;"></div>`;
                }

                const today = new Date();
                for (let day = 1; day <= daysInMonth; day++) {
                    const currentDate = new Date(year, month, day);
                    const isToday = currentDate.toDateString() === today.toDateString();
                    const dateString = currentDate.toISOString().split('T')[0];
                    
                    const dayEvents = filteredEvents.filter(event => event.date === dateString);
                    
                    let dayClass = isToday ? 'background: #e3f2fd; border: 2px solid #1e3a8a;' : 'background: white;';
                    
                    html += `<div style="${dayClass} min-height: 80px; padding: 5px;"><div style="font-weight: ${isToday ? 'bold' : 'normal'};">${day}</div>`;
                    
                    dayEvents.slice(0, 2).forEach(event => {
                        const typeColors = { 'training': '#059669', 'match': '#dc2626', 'meeting': '#f59e0b', 'event': '#8b5cf6' };
                        html += `<div style="background: ${typeColors[event.type] || '#6c757d'}; color: white; font-size: 0.7rem; padding: 2px; border-radius: 3px; margin: 1px 0; overflow: hidden;">${event.title}</div>`;
                    });
                    
                    if (dayEvents.length > 2) {
                        html += `<div style="font-size: 0.6rem; color: #666;">+${dayEvents.length - 2} más</div>`;
                    }
                    
                    html += `</div>`;
                }

                html += `</div>`;
                calendarGrid.innerHTML = html;
            } catch (error) {
                console.error('❌ Error generando calendario:', error);
            }
        }

        function changeCalendarMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            generateCalendarGrid();
        }

        function goToToday() {
            currentCalendarDate = new Date();
            generateCalendarGrid();
        }

        function loadUpcomingActivities() {
            try {
                const events = JSON.parse(localStorage.getItem('clubCalendarEvents') || '[]');
                const upcomingContainer = document.getElementById('upcomingActivities');
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const upcomingEvents = events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate >= today;
                }).sort((a, b) => new Date(a.date) - new Date(b.date)).slice(0, 5);

                if (upcomingEvents.length === 0) {
                    upcomingContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No hay actividades próximas programadas.</p>';
                    return;
                }

                const typeIcons = { 'training': '🏃', 'match': '⚽', 'meeting': '💬', 'event': '🎉' };

                let html = '<div style="background: white; border-radius: 10px; padding: 15px;">';
                
                upcomingEvents.forEach(event => {
                    const eventDate = new Date(event.date);
                    const isToday = eventDate.toDateString() === new Date().toDateString();
                    
                    html += `<div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; background: ${isToday ? '#fff3cd' : 'transparent'};">
                        <div>
                            <div><span style="margin-right: 8px;">${typeIcons[event.type] || '📅'}</span><strong>${event.title}</strong></div>
                            <div style="font-size: 0.9em; color: #666;">📅 ${eventDate.toLocaleDateString()} | ⏰ ${event.startTime} - ${event.endTime} | 📍 ${event.location}</div>
                        </div>
                    </div>`;
                });

                html += '</div>';
                upcomingContainer.innerHTML = html;
            } catch (error) {
                console.error('❌ Error cargando próximas actividades:', error);
            }
        }

        function filterCalendarEvents() {
            generateCalendarGrid();
            loadUpcomingActivities();
        }

        // === MÓDULO DE EQUIPOS ===
        
        // Función para mostrar formulario de crear equipo
        function showAddTeamForm() {
            document.getElementById('addTeamForm').style.display = 'block';
            document.getElementById('addTeamForm').scrollIntoView({ behavior: 'smooth' });
        }

        // Función para cancelar crear equipo
        function cancelAddTeam() {
            document.getElementById('addTeamForm').style.display = 'none';
            clearTeamForm();
        }

        // Función para limpiar formulario de equipo
        function clearTeamForm() {
            const form = document.getElementById('addTeamForm');
            const inputs = form.querySelectorAll('input, select');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
            document.getElementById('teamStatus').value = 'active';
        }

        // Función para guardar equipo
        function saveTeam() {
            try {
                const teamData = {
                    id: 'TEAM_' + Date.now(),
                    name: document.getElementById('teamName').value.trim(),
                    category: document.getElementById('teamCategory').value,
                    coach: document.getElementById('teamCoach').value.trim(),
                    field: document.getElementById('teamField').value.trim(),
                    schedule: document.getElementById('teamSchedule').value.trim(),
                    status: document.getElementById('teamStatus').value,
                    createdAt: new Date().toISOString(),
                    createdBy: JSON.parse(localStorage.getItem('currentAdmin') || '{}').email || 'admin'
                };

                // Validar campos obligatorios
                if (!teamData.name || !teamData.category) {
                    alert('❌ Por favor, completa todos los campos obligatorios marcados con *');
                    return;
                }

                // Guardar en localStorage
                const teams = JSON.parse(localStorage.getItem('clubTeams') || '[]');
                teams.push(teamData);
                localStorage.setItem('clubTeams', JSON.stringify(teams));

                alert('✅ Equipo creado exitosamente\n\n🏆 ' + teamData.name + '\n📋 Categoría: ' + teamData.category + '\n👨‍💼 Estado: ' + (teamData.status === 'active' ? 'Activo' : 'Inactivo'));
                
                cancelAddTeam();
                loadTeamsCards();
                updateDashboardCounts();

                console.log('🏆 Nuevo equipo creado:', teamData.name);
            } catch (error) {
                console.error('❌ Error guardando equipo:', error);
                alert('❌ Error al crear el equipo. Inténtalo de nuevo.');
            }
        }

        // Función para cargar tarjetas de equipos
        function loadTeamsCards() {
            try {
                const teams = JSON.parse(localStorage.getItem('clubTeams') || '[]');
                const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                const teamsCards = document.getElementById('teamsCards');
                
                // Si no hay equipos personalizados, mostrar las categorías por defecto
                if (teams.length === 0) {
                    const defaultCategories = [
                        { key: 'prebenajmin', name: 'Prebenjamín', age: '6-8 años' },
                        { key: 'benjamin', name: 'Benjamín', age: '8-10 años' },
                        { key: 'alevin', name: 'Alevín', age: '10-12 años' },
                        { key: 'infantil', name: 'Infantil', age: '12-14 años' },
                        { key: 'aficionado', name: 'Aficionado', age: '18+ años' }
                    ];
                    
                    let html = '';
                    defaultCategories.forEach(category => {
                        const categoryPlayers = players.filter(player => player.category === category.key);
                        const activePlayers = categoryPlayers.filter(player => player.status === 'active');
                        
                        html += `
                            <div class="dashboard-card">
                                <h4>${category.name}</h4>
                                <p>Edad: ${category.age}</p>
                                <div class="number" id="${category.key}Count">${activePlayers.length}</div>
                                <p>jugadores activos</p>
                                <button class="btn" onclick="manageCategoryPlayers('${category.key}')">Gestionar</button>
                            </div>
                        `;
                    });
                    
                    teamsCards.innerHTML = html;
                } else {
                    // Mostrar equipos personalizados
                    let html = '';
                    teams.forEach(team => {
                        const teamPlayers = players.filter(player => player.category === team.category);
                        const activePlayers = teamPlayers.filter(player => player.status === 'active');
                        const statusColor = team.status === 'active' ? '#059669' : '#dc2626';
                        const statusText = team.status === 'active' ? 'Activo' : 'Inactivo';
                        
                        html += `
                            <div class="dashboard-card" style="position: relative;">
                                <div style="position: absolute; top: 10px; right: 10px;">
                                    <span style="background: ${statusColor}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">
                                        ${statusText}
                                    </span>
                                </div>
                                <h4>${team.name}</h4>
                                <p>Categoría: ${team.category}</p>
                                ${team.coach ? `<p>👨‍💼 ${team.coach}</p>` : ''}
                                <div class="number">${activePlayers.length}</div>
                                <p>jugadores activos</p>
                                <div style="display: flex; gap: 5px; margin-top: 10px;">
                                    <button class="btn" onclick="manageCategoryPlayers('${team.category}')" style="flex: 1;">Gestionar</button>
                                    <button onclick="toggleTeamStatus('${team.id}')" style="padding: 5px 10px; background: ${team.status === 'active' ? '#dc2626' : '#059669'}; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                        ${team.status === 'active' ? '❌ Deshabilitar' : '✅ Habilitar'}
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    teamsCards.innerHTML = html;
                }
                
                console.log('🏆 Tarjetas de equipos cargadas:', teams.length, 'equipos');
            } catch (error) {
                console.error('❌ Error cargando tarjetas de equipos:', error);
            }
        }

        // Función para cambiar estado del equipo
        function toggleTeamStatus(teamId) {
            try {
                const teams = JSON.parse(localStorage.getItem('clubTeams') || '[]');
                const teamIndex = teams.findIndex(team => team.id === teamId);
                
                if (teamIndex !== -1) {
                    const currentStatus = teams[teamIndex].status;
                    const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
                    
                    teams[teamIndex].status = newStatus;
                    localStorage.setItem('clubTeams', JSON.stringify(teams));
                    
                    loadTeamsCards();
                    
                    const statusText = newStatus === 'active' ? 'habilitado' : 'deshabilitado';
                    alert(`✅ Equipo "${teams[teamIndex].name}" ${statusText} correctamente`);
                    
                    console.log('🏆 Estado del equipo cambiado:', teams[teamIndex].name, '->', newStatus);
                }
            } catch (error) {
                console.error('❌ Error cambiando estado del equipo:', error);
                alert('❌ Error al cambiar el estado del equipo');
            }
        }

        // === MÓDULO DE EVENTOS ===
        
        function showAddEventForm() {
            document.getElementById('addEventForm').style.display = 'block';
            document.getElementById('addEventForm').scrollIntoView({ behavior: 'smooth' });
            const today = new Date();
            document.getElementById('eventDate').value = today.toISOString().split('T')[0];
        }

        function cancelAddEvent() {
            document.getElementById('addEventForm').style.display = 'none';
            clearEventForm();
        }

        function clearEventForm() {
            const form = document.getElementById('addEventForm');
            const inputs = form.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else if (input.type === 'file') {
                    input.value = '';
                } else {
                    input.value = '';
                }
            });
            document.getElementById('eventImagePreview').style.display = 'none';
        }

        function saveEvent() {
            try {
                const eventData = {
                    id: 'EVENT_' + Date.now(),
                    name: document.getElementById('eventName').value.trim(),
                    date: document.getElementById('eventDate').value,
                    startTime: document.getElementById('eventStartTime').value,
                    endTime: document.getElementById('eventEndTime').value,
                    location: document.getElementById('eventLocation').value.trim(),
                    description: document.getElementById('eventDescription').value.trim(),
                    price: parseFloat(document.getElementById('eventPrice').value) || 0,
                    minParticipants: parseInt(document.getElementById('eventMinParticipants').value),
                    maxParticipants: parseInt(document.getElementById('eventMaxParticipants').value),
                    registrationDeadline: document.getElementById('eventRegistrationDeadline').value,
                    photoConsent: document.getElementById('eventPhotoConsent').checked,
                    dataConsent: document.getElementById('eventDataConsent').checked,
                    image: null, // Se manejará por separado
                    participants: [],
                    status: 'upcoming',
                    createdAt: new Date().toISOString(),
                    createdBy: JSON.parse(localStorage.getItem('currentAdmin') || '{}').email || 'admin'
                };

                // Validaciones
                if (!eventData.name || !eventData.date || !eventData.startTime || !eventData.endTime || !eventData.location || !eventData.description) {
                    alert('❌ Por favor, completa todos los campos obligatorios marcados con *');
                    return;
                }

                if (eventData.startTime >= eventData.endTime) {
                    alert('❌ La hora de fin debe ser posterior a la hora de inicio');
                    return;
                }

                if (eventData.minParticipants > eventData.maxParticipants) {
                    alert('❌ El mínimo de participantes no puede ser mayor que el máximo');
                    return;
                }

                // Manejar imagen
                const imageFile = document.getElementById('eventImage').files[0];
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        eventData.image = e.target.result;
                        saveEventToStorage(eventData);
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    saveEventToStorage(eventData);
                }

            } catch (error) {
                console.error('❌ Error guardando evento:', error);
                alert('❌ Error al crear el evento. Inténtalo de nuevo.');
            }
        }

        function saveEventToStorage(eventData) {
            const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
            events.push(eventData);
            localStorage.setItem('clubEvents', JSON.stringify(events));

            const priceText = eventData.price === 0 ? 'Gratuito' : `${eventData.price}€`;
            alert(`✅ Evento creado exitosamente\n\n🎉 ${eventData.name}\n📆 ${eventData.date}\n💰 ${priceText}\n👥 ${eventData.minParticipants}-${eventData.maxParticipants} participantes`);
            
            cancelAddEvent();
            loadEventsList();
            updateDashboardCounts();

            console.log('🎉 Nuevo evento creado:', eventData.name);
        }

        function loadEventsList() {
            try {
                const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
                const eventsList = document.getElementById('eventsList');
                
                if (events.length === 0) {
                    eventsList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No hay eventos creados aún.</p>';
                    return;
                }

                // Actualizar estado de eventos
                const now = new Date();
                events.forEach(event => {
                    const eventDate = new Date(event.date);
                    const eventEndTime = new Date(`${event.date}T${event.endTime}`);
                    
                    if (eventEndTime < now) {
                        event.status = 'finished';
                    } else if (eventDate.toDateString() === now.toDateString()) {
                        event.status = 'ongoing';
                    } else {
                        event.status = 'upcoming';
                    }
                });

                // Filtrar eventos
                const statusFilter = document.getElementById('eventStatusFilter').value;
                const typeFilter = document.getElementById('eventTypeFilter').value;
                
                const filteredEvents = events.filter(event => {
                    const statusMatch = statusFilter === 'all' || event.status === statusFilter;
                    const typeMatch = typeFilter === 'all' || 
                                    (typeFilter === 'free' && event.price === 0) || 
                                    (typeFilter === 'paid' && event.price > 0);
                    return statusMatch && typeMatch;
                }).sort((a, b) => new Date(a.date) - new Date(b.date));

                let html = '<div style="background: white; border-radius: 10px; padding: 15px;">';

                filteredEvents.forEach(event => {
                    const statusColors = { 'upcoming': '#f59e0b', 'ongoing': '#059669', 'finished': '#6c757d' };
                    const statusTexts = { 'upcoming': 'Próximo', 'ongoing': 'En Curso', 'finished': 'Finalizado' };
                    const priceText = event.price === 0 ? 'Gratuito' : `${event.price}€`;
                    const participantsCount = event.participants ? event.participants.length : 0;
                    const availableSpots = event.maxParticipants - participantsCount;
                    
                    html += `
                        <div style="border: 1px solid #e9ecef; border-radius: 10px; padding: 20px; margin-bottom: 15px; ${event.image ? 'display: flex; gap: 20px;' : ''}">
                            ${event.image ? `<div style="flex-shrink: 0;"><img src="${event.image}" style="width: 150px; height: 100px; object-fit: cover; border-radius: 8px;"></div>` : ''}
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                    <div>
                                        <h4 style="margin: 0 0 5px 0; color: #1e3a8a;">${event.name}</h4>
                                        <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">
                                            📅 ${new Date(event.date).toLocaleDateString()} | ⏰ ${event.startTime} - ${event.endTime} | 📍 ${event.location}
                                        </div>
                                        <div style="font-size: 0.9em; color: #666;">
                                            💰 ${priceText} | 👥 ${participantsCount}/${event.maxParticipants} inscritos | ✅ ${availableSpots} plazas disponibles
                                        </div>
                                    </div>
                                    <span style="background: ${statusColors[event.status]}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                                        ${statusTexts[event.status]}
                                    </span>
                                </div>
                                <p style="margin: 10px 0; color: #555; font-size: 0.9em;">${event.description}</p>
                                <div style="display: flex; gap: 10px; margin-top: 15px;">
                                    <button onclick="viewEventDetails('${event.id}')" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">👁️ Ver Detalles</button>
                                    <button onclick="manageEventParticipants('${event.id}')" style="padding: 6px 12px; background: #1e3a8a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">👥 Participantes</button>
                                    <button onclick="editEvent('${event.id}')" style="padding: 6px 12px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">✏️ Editar</button>
                                    <button onclick="deleteEvent('${event.id}')" style="padding: 6px 12px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">🗑️ Eliminar</button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                eventsList.innerHTML = html;
                
                // Guardar eventos actualizados
                localStorage.setItem('clubEvents', JSON.stringify(events));
                
                console.log('🎉 Lista de eventos cargada:', filteredEvents.length, 'eventos');
            } catch (error) {
                console.error('❌ Error cargando lista de eventos:', error);
            }
        }

        function filterEvents() {
            loadEventsList();
        }

        function viewEventDetails(eventId) {
            const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
            const event = events.find(e => e.id === eventId);
            
            if (event) {
                const priceText = event.price === 0 ? 'Gratuito' : `${event.price}€`;
                const participantsCount = event.participants ? event.participants.length : 0;
                
                let details = `🎉 DETALLES DEL EVENTO\n\n`;
                details += `Nombre: ${event.name}\n`;
                details += `Fecha: ${new Date(event.date).toLocaleDateString()}\n`;
                details += `Hora: ${event.startTime} - ${event.endTime}\n`;
                details += `Ubicación: ${event.location}\n`;
                details += `Precio: ${priceText}\n`;
                details += `Participantes: ${participantsCount}/${event.maxParticipants}\n`;
                details += `Mínimo requerido: ${event.minParticipants}\n`;
                
                if (event.registrationDeadline) {
                    details += `Fecha límite inscripción: ${new Date(event.registrationDeadline).toLocaleDateString()}\n`;
                }
                
                details += `\nDescripción: ${event.description}\n`;
                
                if (event.photoConsent || event.dataConsent) {
                    details += `\n✅ CONSENTIMIENTOS REQUERIDOS:\n`;
                    if (event.photoConsent) details += `- Autorización para fotos y videos\n`;
                    if (event.dataConsent) details += `- Tratamiento de datos personales\n`;
                }
                
                details += `\nCreado: ${new Date(event.createdAt).toLocaleDateString()}\nPor: ${event.createdBy}`;
                
                alert(details);
            }
        }

        function manageEventParticipants(eventId) {
            alert('🔧 Gestión de participantes en desarrollo. ID: ' + eventId);
        }

        function editEvent(eventId) {
            alert('🔧 Función de edición en desarrollo. ID: ' + eventId);
        }

        function deleteEvent(eventId) {
            if (confirm('¿Estás seguro de que quieres eliminar este evento?\n\n⚠️ Esta acción no se puede deshacer y eliminará todas las inscripciones.')) {
                try {
                    const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
                    const eventToDelete = events.find(e => e.id === eventId);
                    
                    if (eventToDelete) {
                        const updatedEvents = events.filter(e => e.id !== eventId);
                        localStorage.setItem('clubEvents', JSON.stringify(updatedEvents));
                        
                        loadEventsList();
                        updateDashboardCounts();
                        alert('✅ Evento "' + eventToDelete.name + '" eliminado correctamente');
                        console.log('🗑️ Evento eliminado:', eventToDelete.name);
                    }
                } catch (error) {
                    console.error('❌ Error eliminando evento:', error);
                    alert('❌ Error al eliminar el evento');
                }
            }
        }

        // Vista previa de imagen
        document.addEventListener('DOMContentLoaded', function() {
            const eventImage = document.getElementById('eventImage');
            if (eventImage) {
                eventImage.addEventListener('change', function() {
                    const file = this.files[0];
                    const preview = document.getElementById('eventImagePreview');
                    const previewImg = document.getElementById('eventImagePreviewImg');
                    
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewImg.src = e.target.result;
                            preview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        preview.style.display = 'none';
                    }
                });
            }
        });

        // Mostrar/ocultar campos de partido
        document.addEventListener('DOMContentLoaded', function() {
            const calendarType = document.getElementById('calendarType');
            if (calendarType) {
                calendarType.addEventListener('change', function() {
                    const matchFields = document.getElementById('matchFields');
                    if (this.value === 'match') {
                        matchFields.style.display = 'block';
                    } else {
                        matchFields.style.display = 'none';
                    }
                });
            }
        });

        // === MÓDULO DE COMPETICIONES ===
        
        function showAddCompetitionForm() {
            document.getElementById('addCompetitionForm').style.display = 'block';
            document.getElementById('addCompetitionForm').scrollIntoView({ behavior: 'smooth' });
            const today = new Date();
            document.getElementById('competitionStartDate').value = today.toISOString().split('T')[0];
        }

        function cancelAddCompetition() {
            document.getElementById('addCompetitionForm').style.display = 'none';
            clearCompetitionForm();
        }

        function clearCompetitionForm() {
            const form = document.getElementById('addCompetitionForm');
            const inputs = form.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
            document.getElementById('maxTeams').value = '8';
        }

        function toggleCompetitionFields() {
            const competitionType = document.getElementById('competitionType').value;
            const maxTeamsField = document.getElementById('maxTeams');
            
            if (competitionType === 'torneo') {
                maxTeamsField.value = '8';
                maxTeamsField.max = '32';
            } else if (competitionType === 'liga') {
                maxTeamsField.value = '10';
                maxTeamsField.max = '20';
            } else {
                maxTeamsField.value = '4';
                maxTeamsField.max = '8';
            }
        }

        function saveCompetition() {
            try {
                const competitionData = {
                    id: 'COMP_' + Date.now(),
                    name: document.getElementById('competitionName').value.trim(),
                    category: document.getElementById('competitionCategory').value,
                    type: document.getElementById('competitionType').value,
                    startDate: document.getElementById('competitionStartDate').value,
                    endDate: document.getElementById('competitionEndDate').value,
                    description: document.getElementById('competitionDescription').value.trim(),
                    maxTeams: parseInt(document.getElementById('maxTeams').value),
                    rules: document.getElementById('competitionRules').value.trim(),
                    teams: [],
                    matches: [],
                    phases: [],
                    status: 'inscripcion',
                    createdAt: new Date().toISOString(),
                    createdBy: JSON.parse(localStorage.getItem('currentAdmin') || '{}').email || 'admin'
                };

                // Validaciones
                if (!competitionData.name || !competitionData.category || !competitionData.type || 
                    !competitionData.startDate || !competitionData.endDate) {
                    alert('❌ Por favor, completa todos los campos obligatorios marcados con *');
                    return;
                }

                if (new Date(competitionData.startDate) >= new Date(competitionData.endDate)) {
                    alert('❌ La fecha de fin debe ser posterior a la fecha de inicio');
                    return;
                }

                // Generar fases automáticamente para torneos
                if (competitionData.type === 'torneo') {
                    competitionData.phases = generateTournamentPhases(competitionData.maxTeams);
                }

                // Guardar en localStorage
                const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
                competitions.push(competitionData);
                localStorage.setItem('clubCompetitions', JSON.stringify(competitions));

                alert(`✅ Competición creada exitosamente\n\n🏆 ${competitionData.name}\n📅 ${competitionData.startDate} - ${competitionData.endDate}\n👥 ${competitionData.maxTeams} equipos máximo`);
                
                cancelAddCompetition();
                loadCompetitionsList();
                updateDashboardCounts();

                console.log('🏆 Nueva competición creada:', competitionData.name);
            } catch (error) {
                console.error('❌ Error guardando competición:', error);
                alert('❌ Error al crear la competición. Inténtalo de nuevo.');
            }
        }

        function generateTournamentPhases(maxTeams) {
            const phases = [];
            let currentTeams = maxTeams;
            let phaseNumber = 1;
            
            while (currentTeams > 1) {
                let phaseName = '';
                if (currentTeams === 2) {
                    phaseName = 'Final';
                } else if (currentTeams === 4) {
                    phaseName = 'Semifinales';
                } else if (currentTeams === 8) {
                    phaseName = 'Cuartos de Final';
                } else if (currentTeams === 16) {
                    phaseName = 'Octavos de Final';
                } else {
                    phaseName = `Fase ${phaseNumber}`;
                }
                
                phases.push({
                    id: `phase_${phaseNumber}`,
                    name: phaseName,
                    teams: currentTeams,
                    matches: [],
                    status: 'pending'
                });
                
                currentTeams = Math.ceil(currentTeams / 2);
                phaseNumber++;
            }
            
            return phases;
        }

        function loadCompetitionsList() {
            try {
                const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
                const competitionsList = document.getElementById('competitionsList');
                
                if (competitions.length === 0) {
                    competitionsList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No hay competiciones creadas aún.</p>';
                    return;
                }

                // Actualizar estado de competiciones
                const now = new Date();
                competitions.forEach(competition => {
                    const startDate = new Date(competition.startDate);
                    const endDate = new Date(competition.endDate);
                    
                    if (endDate < now) {
                        competition.status = 'finalizado';
                    } else if (startDate <= now && endDate >= now) {
                        competition.status = 'activo';
                    } else {
                        competition.status = 'inscripcion';
                    }
                });

                // Filtrar competiciones
                const categoryFilter = document.getElementById('competitionCategoryFilter').value;
                const statusFilter = document.getElementById('competitionStatusFilter').value;
                
                const filteredCompetitions = competitions.filter(competition => {
                    const categoryMatch = !categoryFilter || competition.category === categoryFilter;
                    const statusMatch = !statusFilter || competition.status === statusFilter;
                    return categoryMatch && statusMatch;
                }).sort((a, b) => new Date(a.startDate) - new Date(b.startDate));

                let html = '<div style="background: white; border-radius: 10px; padding: 15px;">';

                filteredCompetitions.forEach(competition => {
                    const statusColors = { 'inscripcion': '#f59e0b', 'activo': '#059669', 'finalizado': '#6c757d' };
                    const statusTexts = { 'inscripcion': 'En Inscripción', 'activo': 'Activo', 'finalizado': 'Finalizado' };
                    const typeTexts = { 'liga': 'Liga', 'torneo': 'Torneo', 'amistoso': 'Amistoso' };
                    const teamsCount = competition.teams ? competition.teams.length : 0;
                    const availableSpots = competition.maxTeams - teamsCount;
                    
                    html += `
                        <div style="border: 1px solid #e9ecef; border-radius: 10px; padding: 20px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <div>
                                    <h4 style="margin: 0 0 5px 0; color: #1e3a8a;">🏆 ${competition.name}</h4>
                                    <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">
                                        📅 ${new Date(competition.startDate).toLocaleDateString()} - ${new Date(competition.endDate).toLocaleDateString()} | 
                                        🏷️ ${competition.category} | 
                                        🎯 ${typeTexts[competition.type]}
                                    </div>
                                    <div style="font-size: 0.9em; color: #666;">
                                        👥 ${teamsCount}/${competition.maxTeams} equipos inscritos | ✅ ${availableSpots} plazas disponibles
                                    </div>
                                </div>
                                <span style="background: ${statusColors[competition.status]}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                                    ${statusTexts[competition.status]}
                                </span>
                            </div>
                            ${competition.description ? `<p style="margin: 10px 0; color: #555; font-size: 0.9em;">${competition.description}</p>` : ''}
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button onclick="viewCompetitionDetails('${competition.id}')" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">👁️ Ver Detalles</button>
                                <button onclick="manageCompetitionTeams('${competition.id}')" style="padding: 6px 12px; background: #1e3a8a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">👥 Equipos</button>
                                <button onclick="manageCompetitionMatches('${competition.id}')" style="padding: 6px 12px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">⚽ Partidos</button>
                                <button onclick="editCompetition('${competition.id}')" style="padding: 6px 12px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">✏️ Editar</button>
                                <button onclick="deleteCompetition('${competition.id}')" style="padding: 6px 12px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">🗑️ Eliminar</button>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                competitionsList.innerHTML = html;
                
                // Guardar competiciones actualizadas
                localStorage.setItem('clubCompetitions', JSON.stringify(competitions));
                
                console.log('🏆 Lista de competiciones cargada:', filteredCompetitions.length, 'competiciones');
            } catch (error) {
                console.error('❌ Error cargando lista de competiciones:', error);
            }
        }

        function filterCompetitions() {
            loadCompetitionsList();
        }

        function viewCompetitionDetails(competitionId) {
            const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
            const competition = competitions.find(c => c.id === competitionId);
            
            if (competition) {
                const typeTexts = { 'liga': 'Liga', 'torneo': 'Torneo', 'amistoso': 'Amistoso' };
                const teamsCount = competition.teams ? competition.teams.length : 0;
                
                let details = `🏆 DETALLES DE LA COMPETICIÓN\n\n`;
                details += `Nombre: ${competition.name}\n`;
                details += `Categoría: ${competition.category}\n`;
                details += `Tipo: ${typeTexts[competition.type]}\n`;
                details += `Fecha: ${new Date(competition.startDate).toLocaleDateString()} - ${new Date(competition.endDate).toLocaleDateString()}\n`;
                details += `Equipos: ${teamsCount}/${competition.maxTeams}\n`;
                
                if (competition.description) {
                    details += `\nDescripción: ${competition.description}\n`;
                }
                
                if (competition.rules) {
                    details += `\nReglamento: ${competition.rules}\n`;
                }
                
                if (competition.type === 'torneo' && competition.phases) {
                    details += `\n🏅 FASES DEL TORNEO:\n`;
                    competition.phases.forEach(phase => {
                        details += `- ${phase.name}: ${phase.teams} equipos\n`;
                    });
                }
                
                details += `\nCreado: ${new Date(competition.createdAt).toLocaleDateString()}\nPor: ${competition.createdBy}`;
                
                alert(details);
            }
        }

        function manageCompetitionTeams(competitionId) {
            alert('🔧 Gestión de equipos participantes en desarrollo. ID: ' + competitionId);
        }

        function manageCompetitionMatches(competitionId) {
            alert('🔧 Gestión de partidos y resultados en desarrollo. ID: ' + competitionId);
        }

        function editCompetition(competitionId) {
            alert('🔧 Función de edición en desarrollo. ID: ' + competitionId);
        }

        function deleteCompetition(competitionId) {
            if (confirm('¿Estás seguro de que quieres eliminar esta competición?\n\n⚠️ Esta acción no se puede deshacer y eliminará todos los datos asociados.')) {
                try {
                    const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
                    const competitionToDelete = competitions.find(c => c.id === competitionId);
                    
                    if (competitionToDelete) {
                        const updatedCompetitions = competitions.filter(c => c.id !== competitionId);
                        localStorage.setItem('clubCompetitions', JSON.stringify(updatedCompetitions));
                        
                        loadCompetitionsList();
                        updateDashboardCounts();
                        alert('✅ Competición "' + competitionToDelete.name + '" eliminada correctamente');
                        console.log('🗑️ Competición eliminada:', competitionToDelete.name);
                    }
                } catch (error) {
                    console.error('❌ Error eliminando competición:', error);
                    alert('❌ Error al eliminar la competición');
                }
            }
        }

        // ===== FUNCIONES PARA GESTIÓN DE CATEGORÍAS DE EQUIPOS =====
        function manageCategoryPlayers(category) {
            // Cambiar a la pestaña de jugadores
            showTab('jugadores');
            
            // Establecer el filtro de categoría
            const categoryFilter = document.getElementById('categoryFilter');
            if (categoryFilter) {
                categoryFilter.value = category;
                filterPlayersByCategory();
            }
            
            // Mostrar mensaje informativo
            setTimeout(() => {
                alert(`👥 Gestión de Jugadores - Categoría: ${getCategoryDisplayName(category)}\n\nAhora puedes ver y gestionar todos los jugadores de esta categoría.`);
            }, 100);
        }

        function getCategoryDisplayName(category) {
            const categories = {
                'prebenajmin': 'Prebenjamín (6-8 años)',
                'benjamin': 'Benjamín (8-10 años)',
                'alevin': 'Alevín (10-12 años)',
                'infantil': 'Infantil (12-14 años)',
                'aficionado': 'Aficionado (18+ años)'
            };
            return categories[category] || category;
        }

        // ===== FUNCIONES PARA GESTIÓN DE SOCIOS =====
        function showAddMemberForm() {
            const form = document.getElementById('addMemberForm');
            if (form) {
                form.style.display = 'block';
                clearMemberForm();
            }
        }

        function cancelAddMember() {
            const form = document.getElementById('addMemberForm');
            if (form) {
                form.style.display = 'none';
                clearMemberForm();
            }
        }

        function clearMemberForm() {
            document.getElementById('memberName').value = '';
            document.getElementById('memberSurname').value = '';
            document.getElementById('memberDNI').value = '';
            document.getElementById('memberPhone').value = '';
            document.getElementById('memberAddress').value = '';
            document.getElementById('memberEmail').value = '';
            document.getElementById('memberPassword').value = '';
        }

        function saveMember() {
            try {
                const name = document.getElementById('memberName').value.trim();
                const surname = document.getElementById('memberSurname').value.trim();
                const dni = document.getElementById('memberDNI').value.trim();
                const phone = document.getElementById('memberPhone').value.trim();
                const address = document.getElementById('memberAddress').value.trim();
                const email = document.getElementById('memberEmail').value.trim();
                const password = document.getElementById('memberPassword').value.trim();

                // Validar campos obligatorios
                if (!name || !surname || !phone || !password) {
                    alert('❌ Error: Los campos Nombre, Apellidos, Teléfono y Contraseña son obligatorios.');
                    return;
                }

                // Obtener socios existentes
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                
                // Verificar DNI único si se proporciona
                if (dni) {
                    const existingMember = members.find(m => m.dni && m.dni.toLowerCase() === dni.toLowerCase());
                    if (existingMember) {
                        alert('❌ Error: Ya existe un socio con ese DNI.');
                        return;
                    }
                }

                // Crear nuevo socio
                const newMember = {
                    id: 'MEMBER_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name: name,
                    surname: surname,
                    dni: dni,
                    phone: phone,
                    address: address,
                    email: email,
                    password: password, // Contraseña del socio
                    status: 'pending_validation',
                    registrationDate: new Date().toISOString(),
                    validatedBy: null,
                    validatedDate: null,
                    memberNumber: null // Se asignará al validar
                };

                // Agregar a la lista
                members.push(newMember);
                localStorage.setItem('clubMembers', JSON.stringify(members));

                // Cerrar formulario y recargar lista
                cancelAddMember();
                loadMembersList();
                updateMemberCounts();
                updateDashboardCounts();

                alert('✅ Socio registrado correctamente.\n\n⚠️ Recuerda: Debe ser validado por un administrador en 7 días.');
                console.log('👤 Nuevo socio registrado:', newMember.name + ' ' + newMember.surname);

            } catch (error) {
                console.error('❌ Error guardando socio:', error);
                alert('❌ Error al guardar el socio. Inténtalo de nuevo.');
            }
        }

        function loadMembersList() {
            try {
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                const membersList = document.getElementById('membersList');
                const statusFilter = document.getElementById('memberStatusFilter').value;

                if (!membersList) return;

                // Filtrar socios según el estado (compatibilidad con diferentes nombres de propiedades)
                let filteredMembers = members;
                if (statusFilter !== 'all') {
                    filteredMembers = members.filter(member => {
                        const status = member.status || member.estado || 'pendiente';
                        if (statusFilter === 'pending') return status === 'pending_validation' || status === 'pendiente';
                        if (statusFilter === 'active') return status === 'active' || status === 'activo';
                        if (statusFilter === 'expired') return isMemberExpired(member);
                        return true;
                    });
                }

                if (filteredMembers.length === 0) {
                    membersList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No hay socios que mostrar con los filtros actuales.</div>';
                    return;
                }

                let html = '';
                filteredMembers.forEach(member => {
                    const isExpired = isMemberExpired(member);
                    const statusText = getMemberStatusText(member, isExpired);
                    const statusColor = getMemberStatusColor(member, isExpired);

                    html += `
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid ${statusColor};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <h4 style="margin: 0 0 5px 0; color: #1e3a8a;">${member.name || member.nombre} ${member.surname || member.apellidos}</h4>
                                    <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">
                                        📞 ${member.phone || member.telefono} | 📧 ${member.email || 'No especificado'} | 📍 ${member.address || member.direccion || 'No especificada'}
                                    </div>
                                    <div style="font-size: 0.9em; color: #666;">
                                        🆔 DNI: ${member.dni || 'No especificado'} | 📅 Registro: ${new Date(member.registrationDate || member.fechaRegistro || member.fecha_registro).toLocaleDateString()}
                                        ${member.memberNumber || member.numeroSocio ? `| 🔢 Nº Socio: ${member.memberNumber || member.numeroSocio}` : ''}
                                    </div>
                                    <div style="font-size: 0.9em; color: #059669; font-weight: bold; margin-top: 5px;">
                                        🔐 Contraseña: 
                                        <span id="member-password-${member.id}">${member.password ? '••••••••' : 'No establecida'}</span>
                                        ${member.password ? `<button onclick="togglePassword('member-password-${member.id}', '${member.password}')" style="background: none; border: none; color: #059669; cursor: pointer; font-size: 0.8rem; margin-left: 5px;">👁️</button>` : ''}
                                    </div>
                                </div>
                                <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                                    ${statusText}
                                </span>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button onclick="viewMemberDetails('${member.id}')" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">👁️ Ver Detalles</button>
                                ${(member.status === 'pending_validation' || member.estado === 'pendiente') ? `<button onclick="validateMember('${member.id}')" style="padding: 6px 12px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">✅ Validar</button>` : ''}
                                <button onclick="editMember('${member.id}')" style="padding: 6px 12px; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">✏️ Editar</button>
                                <button onclick="deleteMember('${member.id}')" style="padding: 6px 12px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">🗑️ Eliminar</button>
                            </div>
                        </div>
                    `;
                });

                membersList.innerHTML = html;
                console.log('👨‍👩‍👧‍👦 Lista de socios cargada:', filteredMembers.length, 'socios');

            } catch (error) {
                console.error('❌ Error cargando lista de socios:', error);
            }
        }

        function isMemberExpired(member) {
            const status = member.status || member.estado || 'pendiente';
            if (status === 'active' || status === 'activo') return false;
            
            const registrationDate = new Date(member.registrationDate || member.fechaRegistro || member.fecha_registro);
            const currentDate = new Date();
            const daysDiff = (currentDate - registrationDate) / (1000 * 60 * 60 * 24);
            
            return daysDiff > 7;
        }

        function getMemberStatusText(member, isExpired) {
            const status = member.status || member.estado || 'pendiente';
            if (status === 'active' || status === 'activo') return 'Activo';
            if (isExpired) return 'Caducado';
            return 'Pendiente';
        }

        function getMemberStatusColor(member, isExpired) {
            const status = member.status || member.estado || 'pendiente';
            if (status === 'active' || status === 'activo') return '#059669';
            if (isExpired) return '#dc2626';
            return '#f59e0b';
        }

        function filterMembers() {
            loadMembersList();
        }

        function viewMemberDetails(memberId) {
            const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
            const member = members.find(m => m.id === memberId);
            
            if (member) {
                const isExpired = isMemberExpired(member);
                let details = `👤 DETALLES DEL SOCIO\n\n`;
                details += `Nombre: ${member.name || member.nombre} ${member.surname || member.apellidos}\n`;
                details += `DNI: ${member.dni || 'No especificado'}\n`;
                details += `Teléfono: ${member.phone || member.telefono}\n`;
                details += `Dirección: ${member.address || member.direccion || 'No especificada'}\n`;
                details += `Email: ${member.email || 'No especificado'}\n`;
                details += `Estado: ${getMemberStatusText(member, isExpired)}\n`;
                details += `Fecha de Registro: ${new Date(member.registrationDate || member.fechaRegistro || member.fecha_registro).toLocaleDateString()}\n`;
                
                if (member.memberNumber || member.numeroSocio) {
                    details += `Número de Socio: ${member.memberNumber || member.numeroSocio}\n`;
                }
                
                if (member.validatedBy) {
                    details += `Validado por: ${member.validatedBy}\n`;
                    details += `Fecha de Validación: ${new Date(member.validatedDate).toLocaleDateString()}\n`;
                }
                
                details += `Contraseña: ${member.password ? '•••••••• (Haz clic en 👁️ para ver)' : 'No establecida'}\n`;
                
                if (isExpired) {
                    details += `\n⚠️ Este socio ha superado el plazo de 7 días sin validación.`;
                }
                
                alert(details);
            }
        }

        async function validateMember(memberId) {
            try {
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                const memberIndex = members.findIndex(m => m.id === memberId);
                
                if (memberIndex !== -1) {
                    const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                    
                    // Verificar si el socio no ha expirado (7 días)
                    const registrationDate = new Date(members[memberIndex].registrationDate || members[memberIndex].fechaRegistro || members[memberIndex].fecha_registro);
                    const currentDate = new Date();
                    const daysDiff = (currentDate - registrationDate) / (1000 * 60 * 60 * 24);
                    
                    if (daysDiff > 7) {
                        alert('❌ No se puede validar este socio. Ha superado el plazo de 7 días desde su registro.\n\nEl socio será eliminado automáticamente.');
                        deleteExpiredMembers();
                        return;
                    }
                    
                    // Asignar número de socio
                    const activeMembers = members.filter(m => {
                        const status = m.status || m.estado || 'pendiente';
                        return status === 'active' || status === 'activo';
                    });
                    const nextNumber = activeMembers.length + 1;
                    
                    // Actualizar estado (compatibilidad con ambos formatos)
                    members[memberIndex].status = 'active';
                    members[memberIndex].estado = 'activo';
                    members[memberIndex].memberNumber = nextNumber;
                    members[memberIndex].numeroSocio = `SOC-${nextNumber.toString().padStart(4, '0')}`;
                    members[memberIndex].validatedBy = currentAdmin.name || currentAdmin.email || 'Administrador';
                    members[memberIndex].validatedDate = new Date().toISOString();
                    members[memberIndex].pagado = true;
                    
                    localStorage.setItem('clubMembers', JSON.stringify(members));
                    
                    // Actualizar estadísticas de la base de datos (usando localStorage)
                    try {
                        await updateDatabaseStats();
                        console.log('✅ Estadísticas actualizadas desde localStorage');
                    } catch (dbError) {
                        console.error('❌ Error actualizando estadísticas:', dbError);
                    }
                    
                    loadMembersList();
                    updateMemberCounts();
                    updateDashboardCounts();
                    
                    const memberName = members[memberIndex].name || members[memberIndex].nombre;
                    const memberSurname = members[memberIndex].surname || members[memberIndex].apellidos;
                    
                    alert(`✅ Socio "${memberName} ${memberSurname}" validado correctamente.\n\n🔢 Número de socio asignado: ${nextNumber}\n\n📊 Datos sincronizados con la base de datos.`);
                    console.log('✅ Socio validado:', memberName + ' ' + memberSurname);
                }
            } catch (error) {
                console.error('❌ Error validando socio:', error);
                alert('❌ Error al validar el socio');
            }
        }

        // Función para eliminar socios expirados (más de 7 días sin validar)
        function deleteExpiredMembers() {
            try {
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                const currentDate = new Date();
                let deletedCount = 0;
                
                const updatedMembers = members.filter(member => {
                    const status = member.status || member.estado || 'pendiente';
                    if (status === 'pending_validation' || status === 'pendiente') {
                        const registrationDate = new Date(member.registrationDate || member.fechaRegistro || member.fecha_registro);
                        const daysDiff = (currentDate - registrationDate) / (1000 * 60 * 60 * 24);
                        
                        if (daysDiff > 7) {
                            const memberName = member.name || member.nombre;
                            const memberSurname = member.surname || member.apellidos;
                            console.log('🗑️ Socio expirado eliminado:', memberName + ' ' + memberSurname);
                            deletedCount++;
                            return false; // Eliminar de la lista
                        }
                    }
                    return true; // Mantener en la lista
                });
                
                if (deletedCount > 0) {
                    localStorage.setItem('clubMembers', JSON.stringify(updatedMembers));
                    loadMembersList();
                    updateMemberCounts();
                    updateDashboardCounts();
                    
                    alert(`🗑️ Se han eliminado ${deletedCount} socios que superaron el plazo de 7 días sin validación.`);
                }
            } catch (error) {
                console.error('❌ Error eliminando socios expirados:', error);
            }
        }

        // Función para verificar y eliminar socios expirados al cargar la página
        function checkExpiredMembers() {
            deleteExpiredMembers();
        }

        // Función para diagnosticar y sincronizar datos de socios
        async function diagnosticarYSincronizarSocios() {
            console.log('🔍 === DIAGNÓSTICO Y SINCRONIZACIÓN DE SOCIOS ===');
            
            try {
                const socios = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                console.log('📊 Total de socios en localStorage:', socios.length);
                
                // Normalizar datos para compatibilidad
                const sociosNormalizados = socios.map(socio => {
                    const socioNormalizado = {
                        ...socio,
                        // Asegurar que tenga todas las propiedades necesarias
                        id: socio.id || socio._id || Date.now() + Math.random(),
                        nombre: socio.nombre || socio.name,
                        apellidos: socio.apellidos || socio.surname,
                        telefono: socio.telefono || socio.phone,
                        email: socio.email,
                        dni: socio.dni,
                        direccion: socio.direccion || socio.address,
                        fechaNacimiento: socio.fechaNacimiento || socio.fecha_nacimiento || socio.birthDate,
                        fechaRegistro: socio.fechaRegistro || socio.fecha_registro || socio.registrationDate || new Date().toISOString(),
                        estado: socio.estado || socio.status || 'pendiente',
                        numeroSocio: socio.numeroSocio || socio.numero_socio || socio.memberNumber,
                        password: socio.password,
                        pagado: socio.pagado || (socio.estado === 'activo' || socio.status === 'active'),
                        validatedBy: socio.validatedBy,
                        validatedDate: socio.validatedDate
                    };
                    
                    // Asegurar compatibilidad con ambos formatos
                    socioNormalizado.status = socioNormalizado.estado;
                    socioNormalizado.name = socioNormalizado.nombre;
                    socioNormalizado.surname = socioNormalizado.apellidos;
                    socioNormalizado.phone = socioNormalizado.telefono;
                    socioNormalizado.address = socioNormalizado.direccion;
                    socioNormalizado.registrationDate = socioNormalizado.fechaRegistro;
                    socioNormalizado.memberNumber = socioNormalizado.numeroSocio;
                    
                    return socioNormalizado;
                });
                
                // Guardar datos normalizados en localStorage
                localStorage.setItem('clubMembers', JSON.stringify(sociosNormalizados));
                
                // Crear una base de datos simulada en localStorage para compatibilidad
                const baseDatosSimulada = {
                    socios: sociosNormalizados,
                    amigos: JSON.parse(localStorage.getItem('clubFriends') || '[]'),
                    jugadores: JSON.parse(localStorage.getItem('clubPlayers') || '[]'),
                    equipos: JSON.parse(localStorage.getItem('clubTeams') || '[]'),
                    eventos: JSON.parse(localStorage.getItem('clubEvents') || '[]'),
                    documentos: JSON.parse(localStorage.getItem('clubDocuments') || '[]')
                };
                
                // Guardar la base de datos simulada
                localStorage.setItem('cdsanabriacfDB', JSON.stringify(baseDatosSimulada));
                
                // Intentar sincronizar con IndexedDB si está disponible
                if (typeof window !== 'undefined' && window.cdsanabriacfDB) {
                    try {
                        await waitForDatabase();
                        
                        // Limpiar socios existentes en la base de datos
                        const sociosExistentes = await window.cdsanabriacfDB.getSocios();
                        for (const socio of sociosExistentes) {
                            if (window.cdsanabriacfDB.delete) {
                                await window.cdsanabriacfDB.delete('socios', socio.id);
                            }
                        }
                        
                        // Agregar socios normalizados a la base de datos
                        for (const socio of sociosNormalizados) {
                            if (window.cdsanabriacfDB.add) {
                                await window.cdsanabriacfDB.add('socios', socio);
                            }
                        }
                        
                        console.log('✅ Datos sincronizados con IndexedDB');
                        
                        // Actualizar estadísticas de la base de datos
                        await updateDatabaseStats();
                        
                    } catch (dbError) {
                        console.error('❌ Error sincronizando con IndexedDB:', dbError);
                    }
                }
                
                // Actualizar contadores y vista
                updateMemberCounts();
                loadMembersList();
                
                console.log('✅ Datos normalizados y sincronizados');
                console.log('📊 Socios normalizados:', sociosNormalizados);
                
                // Mostrar resumen
                const activos = sociosNormalizados.filter(s => s.estado === 'activo' || s.status === 'active').length;
                const pendientes = sociosNormalizados.filter(s => s.estado === 'pendiente' || s.status === 'pending_validation').length;
                
                alert(`🔍 DIAGNÓSTICO COMPLETADO:\n\n📊 Total de socios: ${sociosNormalizados.length}\n✅ Activos: ${activos}\n⏳ Pendientes: ${pendientes}\n\n✅ Datos normalizados y sincronizados correctamente.\n\n📊 Dashboard y base de datos actualizados.\n\n💾 Base de datos simulada creada en localStorage.`);
                
            } catch (error) {
                console.error('❌ Error en diagnóstico:', error);
                alert('❌ Error durante el diagnóstico: ' + error.message);
            }
        }

        // Función para sincronizar manualmente la base de datos
        async function sincronizarBaseDatos() {
            console.log('🔄 === SINCRONIZACIÓN MANUAL DE BASE DE DATOS ===');
            
            try {
                // Obtener datos de localStorage
                const socios = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                const amigos = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                const jugadores = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                const equipos = JSON.parse(localStorage.getItem('clubTeams') || '[]');
                const eventos = JSON.parse(localStorage.getItem('clubEvents') || '[]');
                const documentos = JSON.parse(localStorage.getItem('clubDocuments') || '[]');
                
                console.log('📊 Datos en localStorage:', {
                    socios: socios.length,
                    amigos: amigos.length,
                    jugadores: jugadores.length,
                    equipos: equipos.length,
                    eventos: eventos.length,
                    documentos: documentos.length
                });
                
                // Actualizar todas las vistas y contadores
                updateDashboardCounts();
                updateMemberCounts();
                loadMembersList();
                await updateDatabaseStats();
                
                alert(`🔄 SINCRONIZACIÓN COMPLETADA:\n\n📊 Socios: ${socios.length}\n📊 Amigos: ${amigos.length}\n📊 Jugadores: ${jugadores.length}\n📊 Equipos: ${equipos.length}\n📊 Eventos: ${eventos.length}\n📊 Documentos: ${documentos.length}\n\n✅ Todos los datos sincronizados desde localStorage.\n\n📊 Dashboard y base de datos actualizados.`);
                
            } catch (error) {
                console.error('❌ Error en sincronización:', error);
                alert('❌ Error durante la sincronización: ' + error.message);
            }
        }

        // Función para diagnosticar el estado de la base de datos
        async function diagnosticarBaseDatos() {
            console.log('🔍 === DIAGNÓSTICO DE BASE DE DATOS ===');
            
            try {
                let info = '🔍 DIAGNÓSTICO DE BASE DE DATOS:\n\n';
                
                // Verificar localStorage
                const sociosLocalStorage = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                info += `📊 localStorage:\n`;
                info += `- Socios: ${sociosLocalStorage.length}\n`;
                if (sociosLocalStorage.length > 0) {
                    const primerSocio = sociosLocalStorage[0];
                    info += `- Primer socio: ${primerSocio.nombre || primerSocio.name} ${primerSocio.apellidos || primerSocio.surname}\n`;
                    info += `- Estado: ${primerSocio.estado || primerSocio.status}\n`;
                }
                info += '\n';
                
                // Verificar base de datos simulada
                const baseDatosSimulada = JSON.parse(localStorage.getItem('cdsanabriacfDB') || '{}');
                info += `📊 Base de datos simulada:\n`;
                info += `- Disponible: ${baseDatosSimulada.socios ? '✅' : '❌'}\n`;
                if (baseDatosSimulada.socios) {
                    info += `- Socios: ${baseDatosSimulada.socios.length}\n`;
                    if (baseDatosSimulada.socios.length > 0) {
                        const primerSocioBD = baseDatosSimulada.socios[0];
                        info += `- Primer socio BD: ${primerSocioBD.nombre || primerSocioBD.name} ${primerSocioBD.apellidos || primerSocioBD.surname}\n`;
                        info += `- Estado BD: ${primerSocioBD.estado || primerSocioBD.status}\n`;
                    }
                }
                info += '\n';
                
                // Verificar IndexedDB
                if (typeof window !== 'undefined' && window.cdsanabriacfDB) {
                    info += `📊 IndexedDB (cdsanabriacfDB):\n`;
                    info += `- Disponible: ✅\n`;
                    info += `- Métodos: ${Object.keys(window.cdsanabriacfDB).join(', ')}\n`;
                    
                    try {
                        await waitForDatabase();
                        const sociosIndexedDB = await window.cdsanabriacfDB.getSocios();
                        info += `- Socios en BD: ${sociosIndexedDB.length}\n`;
                        
                        if (sociosIndexedDB.length > 0) {
                            const primerSocioBD = sociosIndexedDB[0];
                            info += `- Primer socio BD: ${primerSocioBD.nombre || primerSocioBD.name} ${primerSocioBD.apellidos || primerSocioBD.surname}\n`;
                            info += `- Estado BD: ${primerSocioBD.estado || primerSocioBD.status}\n`;
                        }
                        
                        // Verificar estadísticas
                        try {
                            const countSocios = await window.cdsanabriacfDB.count('socios');
                            info += `- Count socios: ${countSocios}\n`;
                        } catch (error) {
                            info += `- Count socios: ❌ Error\n`;
                        }
                        
                    } catch (error) {
                        info += `- Error accediendo: ${error.message}\n`;
                    }
                } else {
                    info += `📊 IndexedDB: ❌ No disponible\n`;
                }
                
                console.log(info);
                alert(info);
                
            } catch (error) {
                console.error('❌ Error en diagnóstico:', error);
                alert('❌ Error durante el diagnóstico: ' + error.message);
            }
        }

        // Función para crear una base de datos simulada que siempre funcione
        function crearBaseDatosSimulada() {
            console.log('🔧 === CREANDO BASE DE DATOS SIMULADA ===');
            
            try {
                // Obtener datos de localStorage
                const socios = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                const amigos = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                const jugadores = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                const equipos = JSON.parse(localStorage.getItem('clubTeams') || '[]');
                const eventos = JSON.parse(localStorage.getItem('clubEvents') || '[]');
                const documentos = JSON.parse(localStorage.getItem('clubDocuments') || '[]');
                
                // Crear base de datos simulada
                const baseDatosSimulada = {
                    socios: socios,
                    amigos: amigos,
                    jugadores: jugadores,
                    equipos: equipos,
                    eventos: eventos,
                    documentos: documentos,
                    // Métodos simulados
                    getSocios: function() {
                        return Promise.resolve(this.socios);
                    },
                    getAmigos: function() {
                        return Promise.resolve(this.amigos);
                    },
                    getJugadores: function() {
                        return Promise.resolve(this.jugadores);
                    },
                    count: function(tabla) {
                        return Promise.resolve(this[tabla] ? this[tabla].length : 0);
                    },
                    add: function(tabla, item) {
                        if (!this[tabla]) this[tabla] = [];
                        this[tabla].push(item);
                        localStorage.setItem('cdsanabriacfDB', JSON.stringify(this));
                        return Promise.resolve(item);
                    },
                    update: function(tabla, id, item) {
                        if (this[tabla]) {
                            const index = this[tabla].findIndex(i => i.id === id);
                            if (index !== -1) {
                                this[tabla][index] = item;
                                localStorage.setItem('cdsanabriacfDB', JSON.stringify(this));
                            }
                        }
                        return Promise.resolve(item);
                    },
                    delete: function(tabla, id) {
                        if (this[tabla]) {
                            this[tabla] = this[tabla].filter(i => i.id !== id);
                            localStorage.setItem('cdsanabriacfDB', JSON.stringify(this));
                        }
                        return Promise.resolve();
                    }
                };
                
                // Guardar en localStorage
                localStorage.setItem('cdsanabriacfDB', JSON.stringify(baseDatosSimulada));
                
                // Crear en window si no existe
                if (!window.cdsanabriacfDB) {
                    window.cdsanabriacfDB = baseDatosSimulada;
                }
                
                console.log('✅ Base de datos simulada creada');
                alert(`🔧 BASE DE DATOS SIMULADA CREADA:\n\n📊 Socios: ${socios.length}\n📊 Amigos: ${amigos.length}\n📊 Jugadores: ${jugadores.length}\n📊 Equipos: ${equipos.length}\n📊 Eventos: ${eventos.length}\n📊 Documentos: ${documentos.length}\n\n✅ Base de datos simulada lista para usar.`);
                
            } catch (error) {
                console.error('❌ Error creando base de datos simulada:', error);
                alert('❌ Error creando base de datos simulada: ' + error.message);
            }
        }

        function editMember(memberId) {
            alert('🔧 Función de edición de socios en desarrollo. ID: ' + memberId);
        }

        function deleteMember(memberId) {
            if (confirm('¿Estás seguro de que quieres eliminar este socio?\n\n⚠️ Esta acción no se puede deshacer.')) {
                try {
                    const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                    const memberToDelete = members.find(m => m.id === memberId);
                    
                    if (memberToDelete) {
                        const updatedMembers = members.filter(m => m.id !== memberId);
                        localStorage.setItem('clubMembers', JSON.stringify(updatedMembers));
                        
                        loadMembersList();
                        updateMemberCounts();
                        updateDashboardCounts();
                        
                        const memberName = memberToDelete.name || memberToDelete.nombre;
                        const memberSurname = memberToDelete.surname || memberToDelete.apellidos;
                        alert('✅ Socio "' + memberName + ' ' + memberSurname + '" eliminado correctamente');
                        console.log('🗑️ Socio eliminado:', memberName + ' ' + memberSurname);
                    }
                } catch (error) {
                    console.error('❌ Error eliminando socio:', error);
                    alert('❌ Error al eliminar el socio');
                }
            }
        }

        function validateAllPendingMembers() {
            if (confirm('¿Estás seguro de que quieres validar TODOS los socios pendientes?\n\n⚠️ Esta acción validará todos los socios que estén pendientes de validación.')) {
                try {
                    const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                    const pendingMembers = members.filter(m => {
                        const status = m.status || m.estado || 'pendiente';
                        return status === 'pending_validation' || status === 'pendiente';
                    });
                    const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                    
                    if (pendingMembers.length === 0) {
                        alert('ℹ️ No hay socios pendientes de validación.');
                        return;
                    }
                    
                    let validatedCount = 0;
                    const activeMembers = members.filter(m => {
                        const status = m.status || m.estado || 'pendiente';
                        return status === 'active' || status === 'activo';
                    });
                    let nextNumber = activeMembers.length + 1;
                    
                    members.forEach(member => {
                        const status = member.status || member.estado || 'pendiente';
                        if (status === 'pending_validation' || status === 'pendiente') {
                            member.status = 'active';
                            member.estado = 'activo';
                            member.memberNumber = nextNumber;
                            member.numeroSocio = `SOC-${nextNumber.toString().padStart(4, '0')}`;
                            member.validatedBy = currentAdmin.name || currentAdmin.email || 'Administrador';
                            member.validatedDate = new Date().toISOString();
                            member.pagado = true;
                            nextNumber++;
                            validatedCount++;
                        }
                    });
                    
                    localStorage.setItem('clubMembers', JSON.stringify(members));
                    
                    loadMembersList();
                    updateMemberCounts();
                    updateDashboardCounts();
                    
                    alert(`✅ ${validatedCount} socios validados correctamente.`);
                    console.log('✅ Socios validados en lote:', validatedCount);
                    
                } catch (error) {
                    console.error('❌ Error validando socios en lote:', error);
                    alert('❌ Error al validar los socios');
                }
            }
        }

        function cleanExpiredMembers() {
            if (confirm('¿Estás seguro de que quieres eliminar TODOS los socios caducados?\n\n⚠️ Esta acción eliminará todos los socios que han superado el plazo de 7 días sin validación.')) {
                try {
                    const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                    const expiredMembers = members.filter(m => isMemberExpired(m));
                    
                    if (expiredMembers.length === 0) {
                        alert('ℹ️ No hay socios caducados para eliminar.');
                        return;
                    }
                    
                    const updatedMembers = members.filter(m => !isMemberExpired(m));
                    localStorage.setItem('clubMembers', JSON.stringify(updatedMembers));
                    
                    loadMembersList();
                    updateMemberCounts();
                    updateDashboardCounts();
                    
                    alert(`🗑️ ${expiredMembers.length} socios caducados eliminados correctamente.`);
                    console.log('🗑️ Socios caducados eliminados:', expiredMembers.length);
                    
                } catch (error) {
                    console.error('❌ Error eliminando socios caducados:', error);
                    alert('❌ Error al eliminar los socios caducados');
                }
            }
        }

        function updateMemberCounts() {
            try {
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                
                const activeCount = members.filter(m => {
                    const status = m.status || m.estado || 'pendiente';
                    return status === 'active' || status === 'activo';
                }).length;
                const pendingCount = members.filter(m => {
                    const status = m.status || m.estado || 'pendiente';
                    return status === 'pending_validation' || status === 'pendiente';
                }).length;
                const expiredCount = members.filter(m => isMemberExpired(m)).length;
                
                // Actualizar contadores en la interfaz
                const activeElement = document.getElementById('activeMembersCount');
                const pendingElement = document.getElementById('pendingMembersCount');
                const expiredElement = document.getElementById('expiredMembersCount');
                
                if (activeElement) activeElement.textContent = activeCount;
                if (pendingElement) pendingElement.textContent = pendingCount;
                if (expiredElement) expiredElement.textContent = expiredCount;
                
                // Calcular próximo número de socio
                const nextNumber = activeCount + 1;
                const nextElement = document.getElementById('nextMemberNumber');
                if (nextElement) nextElement.textContent = nextNumber;
                
                // También actualizar el dashboard principal
                updateDashboardCounts();
                
                console.log('📊 Contadores de socios actualizados:', { activeCount, pendingCount, expiredCount, nextNumber });
                
            } catch (error) {
                console.error('❌ Error actualizando contadores de socios:', error);
            }
        }

        // ===== ACTUALIZACIÓN DE CONTADORES DE CATEGORÍAS =====
        function updateCategoryCounts() {
            try {
                // PONER TODOS LOS CONTADORES DE CATEGORÍAS A CERO
                const categories = ['prebenajmin', 'benjamin', 'alevin', 'infantil', 'aficionado'];
                categories.forEach(category => {
                    const element = document.getElementById(category + 'Count');
                    if (element) {
                        element.textContent = '0';
                    }
                });
                
                console.log('📊 Contadores de categorías reseteados a cero');
                
            } catch (error) {
                console.error('❌ Error actualizando contadores de categorías:', error);
            }
        }

        // ===== ACTUALIZACIÓN DE FUNCIÓN updateDashboardCounts =====
        function updateDashboardCounts() {
            try {
                // Obtener datos reales de socios
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
                const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
                
                // Contar socios activos
                const activeMembers = members.filter(m => {
                    const status = m.status || m.estado || 'pendiente';
                    return status === 'active' || status === 'activo';
                }).length;
                
                // Contar socios pendientes
                const pendingMembers = members.filter(m => {
                    const status = m.status || m.estado || 'pendiente';
                    return status === 'pending_validation' || status === 'pendiente';
                }).length;
                
                // Contar amigos activos
                const activeFriends = friends.filter(f => {
                    const status = f.status || f.estado || 'activo';
                    return status === 'active' || status === 'activo';
                }).length;
                
                // Contar eventos
                const eventsCount = events.length;
                
                // Contar competiciones
                const competitionsCount = competitions.length;
                
                // Contar jugadores (socios activos que son jugadores)
                const activePlayers = members.filter(m => {
                    const status = m.status || m.estado || 'pendiente';
                    const isPlayer = m.isPlayer || m.esJugador || false;
                    return (status === 'active' || status === 'activo') && isPlayer;
                }).length;
                
                // Actualizar elementos del dashboard
                const playersElement = document.getElementById('playersCount');
                const membersElement = document.getElementById('membersCount');
                const eventsElement = document.getElementById('eventsCount');
                const competitionsElement = document.getElementById('competitionsCount');
                const pendingElement = document.getElementById('pendingMembersCount');
                const activeFriendsElement = document.getElementById('activeFriendsCount');
                const inactiveFriendsElement = document.getElementById('inactiveFriendsCount');
                const totalFriendsElement = document.getElementById('totalFriendsCount');
                
                if (playersElement) playersElement.textContent = activePlayers;
                if (membersElement) membersElement.textContent = activeMembers;
                if (eventsElement) eventsElement.textContent = eventsCount;
                if (competitionsElement) competitionsElement.textContent = competitionsCount;
                if (pendingElement) pendingElement.textContent = pendingMembers;
                if (activeFriendsElement) activeFriendsElement.textContent = activeFriends;
                if (inactiveFriendsElement) inactiveFriendsElement.textContent = friends.length - activeFriends;
                if (totalFriendsElement) totalFriendsElement.textContent = friends.length;
                
                // Actualizar contadores de categorías
                updateCategoryCounts();
                
                console.log('📊 Dashboard actualizado:', { 
                    activePlayers, 
                    activeMembers, 
                    pendingMembers,
                    activeFriends, 
                    eventsCount, 
                    competitionsCount 
                });
                
            } catch (error) {
                console.error('❌ Error actualizando dashboard:', error);
            }
        }

        // ===== MÓDULO DE AMIGOS DEL CLUB =====
        
        function showAddFriendForm() {
            const form = document.getElementById('addFriendForm');
            if (form) {
                form.style.display = 'block';
                clearFriendForm();
            }
        }

        function cancelAddFriend() {
            const form = document.getElementById('addFriendForm');
            if (form) {
                form.style.display = 'none';
                clearFriendForm();
            }
        }

        function clearFriendForm() {
            document.getElementById('friendName').value = '';
            document.getElementById('friendSurname').value = '';
            document.getElementById('friendDNI').value = '';
            document.getElementById('friendPhone').value = '';
            document.getElementById('friendEmail').value = '';
        }

        function saveFriend() {
            try {
                const name = document.getElementById('friendName').value.trim();
                const surname = document.getElementById('friendSurname').value.trim();
                const dni = document.getElementById('friendDNI').value.trim();
                const phone = document.getElementById('friendPhone').value.trim();
                const email = document.getElementById('friendEmail').value.trim();

                // Validar campos obligatorios
                if (!name || !surname || !dni || !phone || !email) {
                    alert('❌ Error: Todos los campos son obligatorios para registrar un amigo del club.');
                    return;
                }

                // Validar formato de email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    alert('❌ Error: El formato del correo electrónico no es válido.');
                    return;
                }

                // Obtener amigos existentes
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                
                // Verificar DNI único
                const existingFriendByDNI = friends.find(f => f.dni && f.dni.toLowerCase() === dni.toLowerCase());
                if (existingFriendByDNI) {
                    alert('❌ Error: Ya existe un amigo del club con ese DNI.');
                    return;
                }

                // Verificar email único
                const existingFriendByEmail = friends.find(f => f.email && f.email.toLowerCase() === email.toLowerCase());
                if (existingFriendByEmail) {
                    alert('❌ Error: Ya existe un amigo del club con ese correo electrónico.');
                    return;
                }

                // Verificar teléfono único
                const existingFriendByPhone = friends.find(f => f.phone && f.phone === phone);
                if (existingFriendByPhone) {
                    alert('❌ Error: Ya existe un amigo del club con ese número de teléfono.');
                    return;
                }

                // Crear nuevo amigo del club
                const newFriend = {
                    id: 'FRIEND_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name: name,
                    surname: surname,
                    dni: dni,
                    phone: phone,
                    email: email,
                    status: 'active',
                    registrationDate: new Date().toISOString(),
                    lastAccess: null,
                    accessCount: 0
                };

                // Agregar a la lista
                friends.push(newFriend);
                localStorage.setItem('clubFriends', JSON.stringify(friends));

                // Cerrar formulario y recargar lista
                cancelAddFriend();
                loadFriendsList();
                updateFriendCounts();
                updateDashboardCounts();

                alert('✅ Amigo del club registrado correctamente.\n\n🔑 Acceso: Puede acceder usando su correo electrónico o teléfono.');
                console.log('🤝 Nuevo amigo del club registrado:', newFriend.name + ' ' + newFriend.surname);

            } catch (error) {
                console.error('❌ Error guardando amigo del club:', error);
                alert('❌ Error al guardar el amigo del club. Inténtalo de nuevo.');
            }
        }

        function loadFriendsList() {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                const friendsList = document.getElementById('friendsList');
                const statusFilter = document.getElementById('friendStatusFilter').value;

                if (!friendsList) return;

                // Filtrar amigos según el estado
                let filteredFriends = friends;
                if (statusFilter !== 'all') {
                    filteredFriends = friends.filter(friend => friend.status === statusFilter);
                }

                if (filteredFriends.length === 0) {
                    friendsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No hay amigos del club que mostrar con los filtros actuales.</div>';
                    return;
                }

                let html = '';
                filteredFriends.forEach(friend => {
                    const statusColor = friend.status === 'active' ? '#059669' : '#6c757d';
                    const statusText = friend.status === 'active' ? 'Activo' : 'Inactivo';
                    const lastAccessText = friend.lastAccess ? new Date(friend.lastAccess).toLocaleDateString('es-ES') : 'Nunca';

                    html += `
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid ${statusColor};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <h4 style="margin: 0 0 5px 0; color: #1e3a8a;">${friend.name} ${friend.surname}</h4>
                                    <p style="margin: 2px 0; color: #666;"><strong>DNI:</strong> ${friend.dni}</p>
                                    <p style="margin: 2px 0; color: #666;"><strong>Teléfono:</strong> ${friend.phone}</p>
                                    <p style="margin: 2px 0; color: #666;"><strong>Email:</strong> ${friend.email}</p>
                                    <p style="margin: 2px 0; color: #666;"><strong>Registro:</strong> ${new Date(friend.registrationDate).toLocaleDateString('es-ES')}</p>
                                    <p style="margin: 2px 0; color: #666;"><strong>Último acceso:</strong> ${lastAccessText}</p>
                                    <p style="margin: 2px 0; color: #666;"><strong>Accesos:</strong> ${friend.accessCount}</p>
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                    <span style="background: ${statusColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">${statusText}</span>
                                    <button class="btn btn-sm" onclick="viewFriendDetails('${friend.id}')" style="font-size: 0.8rem;">👁️ Ver</button>
                                    <button class="btn btn-sm" onclick="toggleFriendStatus('${friend.id}')" style="font-size: 0.8rem;">${friend.status === 'active' ? '⏸️ Desactivar' : '▶️ Activar'}</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteFriend('${friend.id}')" style="font-size: 0.8rem;">🗑️ Eliminar</button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                friendsList.innerHTML = html;
                console.log('🤝 Lista de amigos del club cargada:', filteredFriends.length);

            } catch (error) {
                console.error('❌ Error cargando lista de amigos del club:', error);
                const friendsList = document.getElementById('friendsList');
                if (friendsList) {
                    friendsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #dc2626;">Error al cargar la lista de amigos del club.</div>';
                }
            }
        }

        function filterFriends() {
            loadFriendsList();
        }

        function viewFriendDetails(friendId) {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                const friend = friends.find(f => f.id === friendId);
                
                if (!friend) {
                    alert('❌ Amigo del club no encontrado.');
                    return;
                }

                const lastAccessText = friend.lastAccess ? new Date(friend.lastAccess).toLocaleString('es-ES') : 'Nunca ha accedido';
                const statusText = friend.status === 'active' ? 'Activo' : 'Inactivo';

                const details = `
🤝 DETALLES DEL AMIGO DEL CLUB

👤 DATOS PERSONALES:
• Nombre: ${friend.name} ${friend.surname}
• DNI: ${friend.dni}
• Teléfono: ${friend.phone}
• Correo Electrónico: ${friend.email}

📊 INFORMACIÓN DE ACCESO:
• Estado: ${statusText}
• Fecha de Registro: ${new Date(friend.registrationDate).toLocaleDateString('es-ES')}
• Último Acceso: ${lastAccessText}
• Número de Accesos: ${friend.accessCount}

🔐 PERMISOS:
• Solo puede ver calendario y competiciones
• Acceso sin contraseña (email/teléfono)
• No puede modificar datos
                `;

                alert(details);

            } catch (error) {
                console.error('❌ Error mostrando detalles del amigo del club:', error);
                alert('❌ Error al mostrar los detalles del amigo del club.');
            }
        }

        function toggleFriendStatus(friendId) {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                const friendIndex = friends.findIndex(f => f.id === friendId);
                
                if (friendIndex === -1) {
                    alert('❌ Amigo del club no encontrado.');
                    return;
                }

                const friend = friends[friendIndex];
                const newStatus = friend.status === 'active' ? 'inactive' : 'active';
                const statusText = newStatus === 'active' ? 'activado' : 'desactivado';

                if (confirm(`¿Estás seguro de que quieres ${statusText} a ${friend.name} ${friend.surname}?`)) {
                    friends[friendIndex].status = newStatus;
                    localStorage.setItem('clubFriends', JSON.stringify(friends));
                    
                    loadFriendsList();
                    updateFriendCounts();
                    updateDashboardCounts();
                    
                    alert(`✅ Amigo del club ${statusText} correctamente.`);
                    console.log(`🤝 Amigo del club ${statusText}:`, friend.name + ' ' + friend.surname);
                }

            } catch (error) {
                console.error('❌ Error cambiando estado del amigo del club:', error);
                alert('❌ Error al cambiar el estado del amigo del club.');
            }
        }

        function deleteFriend(friendId) {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                const friend = friends.find(f => f.id === friendId);
                
                if (!friend) {
                    alert('❌ Amigo del club no encontrado.');
                    return;
                }

                if (confirm(`¿Estás seguro de que quieres eliminar a ${friend.name} ${friend.surname} de la lista de amigos del club?\n\n⚠️ Esta acción no se puede deshacer.`)) {
                    const updatedFriends = friends.filter(f => f.id !== friendId);
                    localStorage.setItem('clubFriends', JSON.stringify(updatedFriends));
                    
                    loadFriendsList();
                    updateFriendCounts();
                    updateDashboardCounts();
                    
                    alert('✅ Amigo del club eliminado correctamente.');
                    console.log('🗑️ Amigo del club eliminado:', friend.name + ' ' + friend.surname);
                }

            } catch (error) {
                console.error('❌ Error eliminando amigo del club:', error);
                alert('❌ Error al eliminar el amigo del club.');
            }
        }

        function updateFriendCounts() {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                
                const activeCount = friends.filter(f => f.status === 'active').length;
                const inactiveCount = friends.filter(f => f.status === 'inactive').length;
                const totalCount = friends.length;
                
                // Actualizar contadores en la interfaz
                const activeElement = document.getElementById('activeFriendsCount');
                const inactiveElement = document.getElementById('inactiveFriendsCount');
                const totalElement = document.getElementById('totalFriendsCount');
                
                if (activeElement) activeElement.textContent = activeCount;
                if (inactiveElement) inactiveElement.textContent = inactiveCount;
                if (totalElement) totalElement.textContent = totalCount;
                
                console.log('📊 Contadores de amigos del club actualizados:', { activeCount, inactiveCount, totalCount });
                
            } catch (error) {
                console.error('❌ Error actualizando contadores de amigos del club:', error);
            }
        }

        // ===== FUNCIÓN DE ACCESO PARA AMIGOS DEL CLUB =====
        function authenticateFriend(identifier) {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                
                // Buscar por email o teléfono
                const friend = friends.find(f => 
                    (f.email && f.email.toLowerCase() === identifier.toLowerCase()) ||
                    (f.phone && f.phone === identifier)
                );
                
                if (!friend) {
                    return { success: false, message: 'No se encontró ningún amigo del club con esos datos.' };
                }
                
                if (friend.status !== 'active') {
                    return { success: false, message: 'Tu cuenta está inactiva. Contacta con un administrador.' };
                }
                
                // Actualizar información de acceso
                friend.lastAccess = new Date().toISOString();
                friend.accessCount = (friend.accessCount || 0) + 1;
                
                // Guardar cambios
                const updatedFriends = friends.map(f => f.id === friend.id ? friend : f);
                localStorage.setItem('clubFriends', JSON.stringify(updatedFriends));
                
                return { 
                    success: true, 
                    friend: friend,
                    message: `Bienvenido ${friend.name} ${friend.surname}. Acceso concedido.`
                };
                
            } catch (error) {
                console.error('❌ Error en autenticación de amigo del club:', error);
                return { success: false, message: 'Error en el sistema de autenticación.' };
            }
        }

        // ===== MÓDULO DE ENTRENADORES =====
        
        // Mostrar formulario para agregar entrenador
        function showAddCoachForm() {
            document.getElementById('addCoachForm').style.display = 'block';
            clearCoachForm();
        }

        // Cancelar agregar entrenador
        function cancelAddCoach() {
            document.getElementById('addCoachForm').style.display = 'none';
            clearCoachForm();
        }

        // Limpiar formulario de entrenador
        function clearCoachForm() {
            document.getElementById('coachName').value = '';
            document.getElementById('coachSurname').value = '';
            document.getElementById('coachDNI').value = '';
            document.getElementById('coachPhone').value = '';
            document.getElementById('coachEmail').value = '';
            document.getElementById('coachPassword').value = '';
            document.getElementById('coachTeam').value = '';
            document.getElementById('coachLicense').value = '';
            document.getElementById('coachExperience').value = '';
        }

        // Guardar entrenador
        function saveCoach() {
            try {
                const name = document.getElementById('coachName').value.trim();
                const surname = document.getElementById('coachSurname').value.trim();
                const dni = document.getElementById('coachDNI').value.trim();
                const phone = document.getElementById('coachPhone').value.trim();
                const email = document.getElementById('coachEmail').value.trim();
                const password = document.getElementById('coachPassword').value.trim();
                const team = document.getElementById('coachTeam').value;
                const license = document.getElementById('coachLicense').value.trim();
                const experience = document.getElementById('coachExperience').value.trim();

                // Validaciones
                if (!name || !surname || !dni || !phone || !email || !password || !team) {
                    alert('❌ Por favor, completa todos los campos obligatorios');
                    return;
                }

                // Verificar si ya existe un entrenador con ese email o DNI
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                const existingCoach = coaches.find(c => 
                    c.email === email || c.dni === dni
                );

                if (existingCoach) {
                    alert('❌ Ya existe un entrenador con ese email o DNI');
                    return;
                }

                // Verificar si ya hay un entrenador asignado a ese equipo
                const teamCoach = coaches.find(c => c.team === team && c.status === 'active');
                if (teamCoach) {
                    const confirmReplace = confirm(`⚠️ El equipo ${team} ya tiene un entrenador asignado (${teamCoach.name} ${teamCoach.surname}). ¿Deseas reemplazarlo?`);
                    if (!confirmReplace) return;
                    
                    // Desactivar el entrenador anterior
                    teamCoach.status = 'inactive';
                    teamCoach.replacedBy = `${name} ${surname}`;
                    teamCoach.replacedDate = new Date().toISOString();
                }

                // Crear nuevo entrenador
                const newCoach = {
                    id: Date.now().toString(),
                    name: name,
                    surname: surname,
                    dni: dni,
                    phone: phone,
                    email: email,
                    password: password, // Contraseña del entrenador
                    team: team,
                    license: license,
                    experience: experience ? parseInt(experience) : 0,
                    status: 'pending', // Estado pendiente hasta validación del administrador
                    registrationDate: new Date().toISOString(),
                    lastAccess: null,
                    accessCount: 0,
                    pushNotifications: {
                        enabled: true,
                        sentCount: 0,
                        lastSent: null
                    }
                };

                // Guardar en localStorage
                coaches.push(newCoach);
                localStorage.setItem('clubCoaches', JSON.stringify(coaches));

                // Cerrar formulario y mostrar confirmación
                cancelAddCoach();
                alert(`✅ Entrenador registrado exitosamente\n\n👨‍🏫 ${name} ${surname}\n⚽ Equipo: ${team}\n📧 Email: ${email}\n📱 Teléfono: ${phone}\n\n⚠️ El entrenador está pendiente de validación. Debes activarlo para que pueda acceder.`);

                // Actualizar listas y contadores
                loadCoachesList();
                updateCoachCounts();

                console.log('👨‍🏫 Nuevo entrenador registrado:', newCoach);

            } catch (error) {
                console.error('❌ Error guardando entrenador:', error);
                alert('❌ Error al guardar el entrenador. Inténtalo de nuevo.');
            }
        }

        // Cargar lista de entrenadores
        function loadCoachesList() {
            try {
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                const filter = document.getElementById('coachStatusFilter').value;
                
                let filteredCoaches = coaches;
                if (filter !== 'all') {
                    filteredCoaches = coaches.filter(c => c.status === filter);
                }

                const coachesListElement = document.getElementById('coachesList');
                
                if (filteredCoaches.length === 0) {
                    coachesListElement.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay entrenadores registrados</p>';
                    return;
                }

                let html = '<div style="display: grid; gap: 15px;">';
                
                filteredCoaches.forEach(coach => {
                    const statusColor = coach.status === 'active' ? '#059669' : '#6c757d';
                    const statusText = coach.status === 'active' ? 'Activo' : 'Inactivo';
                    const teamNames = {
                        'prebenjamin': 'Prebenjamín',
                        'benjamin': 'Benjamín',
                        'alevin': 'Alevín',
                        'infantil': 'Infantil',
                        'aficionado': 'Aficionado'
                    };

                    html += `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid ${statusColor};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                <div>
                                    <h4 style="margin: 0; color: #1e3a8a;">👨‍🏫 ${coach.name} ${coach.surname}</h4>
                                    <p style="margin: 5px 0; color: #666;">⚽ ${teamNames[coach.team] || coach.team}</p>
                                    <p style="margin: 5px 0; color: #666;">📧 ${coach.email}</p>
                                    <p style="margin: 5px 0; color: #666;">📱 ${coach.phone}</p>
                                </div>
                                <div style="text-align: right;">
                                    <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">${statusText}</span>
                                    <div style="margin-top: 10px;">
                                        <button class="btn btn-sm btn-primary" onclick="viewCoachDetails('${coach.id}')" style="margin-right: 5px;">👁️ Ver</button>
                                        <button class="btn btn-sm btn-warning" onclick="toggleCoachStatus('${coach.id}')" style="margin-right: 5px;">🔄 ${coach.status === 'active' ? 'Desactivar' : 'Activar'}</button>
                                        <button class="btn btn-sm btn-info" onclick="resetCoachPassword('${coach.id}')" style="margin-right: 5px;">🔑 Reset</button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteCoach('${coach.id}')">🗑️ Eliminar</button>
                                    </div>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 0.9rem;">
                                <div><strong>DNI:</strong> ${coach.dni}</div>
                                <div><strong>Licencia:</strong> ${coach.license || 'No especificada'}</div>
                                <div><strong>Experiencia:</strong> ${coach.experience || 0} años</div>
                                <div><strong>Registro:</strong> ${new Date(coach.registrationDate).toLocaleDateString()}</div>
                                <div><strong>Último acceso:</strong> ${coach.lastAccess ? new Date(coach.lastAccess).toLocaleDateString() : 'Nunca'}</div>
                                <div><strong>Mensajes enviados:</strong> ${coach.pushNotifications.sentCount || 0}</div>
                                <div style="grid-column: 1 / -1; background: #e8f5e8; padding: 8px; border-radius: 5px; margin-top: 10px;">
                                    <strong style="color: #059669;">🔐 Contraseña:</strong> 
                                    <span id="coach-password-${coach.id}">${coach.password ? '••••••••' : 'No establecida'}</span>
                                    ${coach.password ? `<button onclick="togglePassword('coach-password-${coach.id}', '${coach.password}')" style="background: none; border: none; color: #059669; cursor: pointer; font-size: 0.8rem; margin-left: 5px;">👁️</button>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                coachesListElement.innerHTML = html;

            } catch (error) {
                console.error('❌ Error cargando lista de entrenadores:', error);
                document.getElementById('coachesList').innerHTML = '<p style="text-align: center; color: #dc2626;">Error al cargar la lista de entrenadores</p>';
            }
        }

        // Filtrar entrenadores
        function filterCoaches() {
            loadCoachesList();
        }

        // Restablecer contraseña del entrenador
        function resetCoachPassword(coachId) {
            try {
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                const coach = coaches.find(c => c.id === coachId);
                
                if (!coach) {
                    alert('❌ Entrenador no encontrado');
                    return;
                }

                const newPassword = prompt(`🔑 Restablecer contraseña para ${coach.name} ${coach.surname}\n\nIntroduce la nueva contraseña:`);
                
                if (!newPassword) {
                    alert('❌ No se introdujo ninguna contraseña');
                    return;
                }

                if (newPassword.length < 4) {
                    alert('❌ La contraseña debe tener al menos 4 caracteres');
                    return;
                }

                // Actualizar contraseña
                coach.password = newPassword;
                coach.passwordResetDate = new Date().toISOString();
                coach.passwordResetBy = JSON.parse(localStorage.getItem('currentAdmin') || '{}').name || 'Administrador';

                // Guardar cambios
                const updatedCoaches = coaches.map(c => c.id === coachId ? coach : c);
                localStorage.setItem('clubCoaches', JSON.stringify(updatedCoaches));

                // Actualizar vista
                loadCoachesList();

                alert(`✅ Contraseña restablecida correctamente\n\n👨‍🏫 ${coach.name} ${coach.surname}\n🔑 Nueva contraseña: ${newPassword}\n\n⚠️ Informa al entrenador de su nueva contraseña.`);

                console.log('🔑 Contraseña restablecida para entrenador:', coach.name + ' ' + coach.surname);

            } catch (error) {
                console.error('❌ Error restableciendo contraseña:', error);
                alert('❌ Error al restablecer la contraseña');
            }
        }

        // Ver detalles del entrenador
        function viewCoachDetails(coachId) {
            try {
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                const coach = coaches.find(c => c.id === coachId);
                
                if (!coach) {
                    alert('❌ Entrenador no encontrado');
                    return;
                }

                const teamNames = {
                    'prebenjamin': 'Prebenjamín',
                    'benjamin': 'Benjamín',
                    'alevin': 'Alevín',
                    'infantil': 'Infantil',
                    'aficionado': 'Aficionado'
                };

                const details = `
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 600px; margin: 20px auto;">
                        <h3 style="color: #1e3a8a; margin-bottom: 20px;">👨‍🏫 Detalles del Entrenador</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <h4>📋 Información Personal</h4>
                                <p><strong>Nombre:</strong> ${coach.name} ${coach.surname}</p>
                                <p><strong>DNI:</strong> ${coach.dni}</p>
                                <p><strong>Teléfono:</strong> ${coach.phone}</p>
                                <p><strong>Email:</strong> ${coach.email}</p>
                            </div>
                            <div>
                                <h4>⚽ Información Deportiva</h4>
                                <p><strong>Equipo:</strong> ${teamNames[coach.team] || coach.team}</p>
                                <p><strong>Licencia:</strong> ${coach.license || 'No especificada'}</p>
                                <p><strong>Experiencia:</strong> ${coach.experience || 0} años</p>
                                <p><strong>Estado:</strong> <span style="color: ${coach.status === 'active' ? '#059669' : '#6c757d'};">${coach.status === 'active' ? 'Activo' : 'Inactivo'}</span></p>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4>📊 Estadísticas de Actividad</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div>
                                    <strong>Fecha de registro:</strong><br>
                                    ${new Date(coach.registrationDate).toLocaleDateString()}
                                </div>
                                <div>
                                    <strong>Último acceso:</strong><br>
                                    ${coach.lastAccess ? new Date(coach.lastAccess).toLocaleDateString() : 'Nunca'}
                                </div>
                                <div>
                                    <strong>Total de accesos:</strong><br>
                                    ${coach.accessCount || 0}
                                </div>
                                <div>
                                    <strong>Mensajes push enviados:</strong><br>
                                    ${coach.pushNotifications.sentCount || 0}
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-primary" onclick="closeModal()">Cerrar</button>
                        </div>
                    </div>
                `;

                showModal('Detalles del Entrenador', details);

            } catch (error) {
                console.error('❌ Error mostrando detalles del entrenador:', error);
                alert('❌ Error al mostrar los detalles del entrenador');
            }
        }

        // Cambiar estado del entrenador
        function toggleCoachStatus(coachId) {
            try {
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                const coachIndex = coaches.findIndex(c => c.id === coachId);
                
                if (coachIndex === -1) {
                    alert('❌ Entrenador no encontrado');
                    return;
                }

                const coach = coaches[coachIndex];
                const newStatus = coach.status === 'active' ? 'inactive' : 'active';
                
                coaches[coachIndex].status = newStatus;
                coaches[coachIndex].statusChangeDate = new Date().toISOString();
                
                localStorage.setItem('clubCoaches', JSON.stringify(coaches));
                
                alert(`✅ Estado del entrenador ${coach.name} ${coach.surname} cambiado a ${newStatus === 'active' ? 'Activo' : 'Inactivo'}`);
                
                loadCoachesList();
                updateCoachCounts();

            } catch (error) {
                console.error('❌ Error cambiando estado del entrenador:', error);
                alert('❌ Error al cambiar el estado del entrenador');
            }
        }

        // Eliminar entrenador
        function deleteCoach(coachId) {
            try {
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                const coach = coaches.find(c => c.id === coachId);
                
                if (!coach) {
                    alert('❌ Entrenador no encontrado');
                    return;
                }

                const confirmDelete = confirm(`⚠️ ¿Estás seguro de que quieres eliminar al entrenador ${coach.name} ${coach.surname}?\n\nEsta acción no se puede deshacer.`);
                
                if (!confirmDelete) return;

                const updatedCoaches = coaches.filter(c => c.id !== coachId);
                localStorage.setItem('clubCoaches', JSON.stringify(updatedCoaches));
                
                alert(`✅ Entrenador ${coach.name} ${coach.surname} eliminado correctamente`);
                
                loadCoachesList();
                updateCoachCounts();

            } catch (error) {
                console.error('❌ Error eliminando entrenador:', error);
                alert('❌ Error al eliminar el entrenador');
            }
        }

        // Actualizar contadores de entrenadores
        function updateCoachCounts() {
            try {
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                
                const activeCount = coaches.filter(c => c.status === 'active').length;
                const inactiveCount = coaches.filter(c => c.status === 'inactive').length;
                const totalCount = coaches.length;
                
                // Actualizar contadores en la interfaz
                const activeElement = document.getElementById('activeCoachesCount');
                const inactiveElement = document.getElementById('inactiveCoachesCount');
                const totalElement = document.getElementById('totalCoachesCount');
                
                if (activeElement) activeElement.textContent = activeCount;
                if (inactiveElement) inactiveElement.textContent = inactiveCount;
                if (totalElement) totalElement.textContent = totalCount;
                
                console.log('📊 Contadores de entrenadores actualizados:', { activeCount, inactiveCount, totalCount });
                
            } catch (error) {
                console.error('❌ Error actualizando contadores de entrenadores:', error);
            }
        }

        // ===== MÓDULO DE MENSAJES PUSH PARA ADMINISTRADORES =====
        
        // Mostrar formulario para agregar mensaje
        function showAddMessageForm() {
            document.getElementById('addMessageForm').style.display = 'block';
            clearMessageForm();
        }

        // Cancelar agregar mensaje
        function cancelAddMessage() {
            document.getElementById('addMessageForm').style.display = 'none';
            clearMessageForm();
        }

        // Limpiar formulario de mensaje
        function clearMessageForm() {
            document.getElementById('messageTitle').value = '';
            document.getElementById('messageContent').value = '';
            document.getElementById('messageType').value = 'general';
            document.getElementById('messageRecipients').value = 'all';
            document.getElementById('messageTeam').value = '';
        }

        // Enviar mensaje push desde administración
        function sendAdminPushMessage() {
            try {
                const title = document.getElementById('messageTitle').value.trim();
                const content = document.getElementById('messageContent').value.trim();
                const type = document.getElementById('messageType').value;
                const recipients = document.getElementById('messageRecipients').value;
                const team = document.getElementById('messageTeam').value;
                
                if (!title || !content) {
                    alert('❌ Por favor, completa el título y contenido del mensaje');
                    return;
                }
                
                const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                
                const message = {
                    id: 'MSG_ADMIN_' + Date.now(),
                    title: title,
                    content: content,
                    type: type,
                    recipients: recipients,
                    team: team || 'all',
                    senderId: currentAdmin.id || 'ADMIN_CDSANABRIACF',
                    senderName: currentAdmin.name || 'Administrador CDSANABRIACF',
                    senderType: 'admin',
                    sentAt: new Date().toISOString(),
                    status: 'sent'
                };
                
                // Guardar mensaje
                const messages = JSON.parse(localStorage.getItem('pushMessages') || '[]');
                messages.push(message);
                localStorage.setItem('pushMessages', JSON.stringify(messages));
                
                // Limpiar formulario
                clearMessageForm();
                cancelAddMessage();
                
                alert(`✅ Mensaje enviado exitosamente\n\n📱 "${title}"\n👥 Destinatarios: ${recipients}\n⏰ ${new Date().toLocaleString()}`);
                
                // Actualizar historial y estadísticas
                loadAdminMessagesHistory();
                updateMessageCounts();
                
            } catch (error) {
                console.error('❌ Error enviando mensaje:', error);
                alert('❌ Error al enviar el mensaje. Inténtalo de nuevo.');
            }
        }

        // Vista previa del mensaje
        function previewAdminMessage() {
            const title = document.getElementById('messageTitle').value.trim();
            const content = document.getElementById('messageContent').value.trim();
            const type = document.getElementById('messageType').value;
            const recipients = document.getElementById('messageRecipients').value;
            const team = document.getElementById('messageTeam').value;
            
            if (!title || !content) {
                alert('❌ Por favor, completa el título y contenido del mensaje');
                return;
            }
            
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
            
            const preview = `
                📱 <strong>Vista Previa del Mensaje</strong><br><br>
                📋 <strong>Título:</strong> ${title}<br>
                💬 <strong>Contenido:</strong> ${content}<br>
                🏷️ <strong>Tipo:</strong> ${type}<br>
                👥 <strong>Destinatarios:</strong> ${recipients}<br>
                ⚽ <strong>Equipo:</strong> ${team || 'Todos los equipos'}<br>
                👨‍💼 <strong>Enviado por:</strong> ${currentAdmin.name || 'Administrador CDSANABRIACF'}
            `;
            
            alert(preview);
        }

        // Cargar historial de mensajes de administración
        function loadAdminMessagesHistory() {
            try {
                const messages = JSON.parse(localStorage.getItem('pushMessages') || '[]');
                const adminMessages = messages.filter(m => m.senderType === 'admin');
                
                const historyElement = document.getElementById('adminMessagesHistory');
                
                if (adminMessages.length === 0) {
                    historyElement.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay mensajes enviados desde administración</p>';
                    return;
                }

                let html = '<div style="display: grid; gap: 15px;">';
                
                adminMessages.sort((a, b) => new Date(b.sentAt) - new Date(a.sentAt)).forEach(message => {
                    const typeColors = {
                        'general': '#3b82f6',
                        'urgent': '#dc2626',
                        'reminder': '#f59e0b',
                        'announcement': '#059669'
                    };
                    
                    html += `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid ${typeColors[message.type] || '#3b82f6'};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: #1e3a8a;">${message.title}</h4>
                                <span style="background: ${typeColors[message.type] || '#3b82f6'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">${message.type}</span>
                            </div>
                            <p style="margin: 5px 0; color: #666;">${message.content}</p>
                            <div style="font-size: 0.8rem; color: #888; margin-top: 10px;">
                                👥 ${message.recipients} | ⚽ ${message.team || 'Todos'} | ⏰ ${new Date(message.sentAt).toLocaleString()}
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                historyElement.innerHTML = html;

            } catch (error) {
                console.error('❌ Error cargando historial de mensajes:', error);
                document.getElementById('adminMessagesHistory').innerHTML = '<p style="text-align: center; color: #dc2626;">Error al cargar el historial</p>';
            }
        }

        // Actualizar contadores de mensajes
        function updateMessageCounts() {
            try {
                const messages = JSON.parse(localStorage.getItem('pushMessages') || '[]');
                const today = new Date().toDateString();
                
                const totalCount = messages.length;
                const todayCount = messages.filter(m => new Date(m.sentAt).toDateString() === today).length;
                const urgentCount = messages.filter(m => m.type === 'urgent').length;
                
                // Actualizar contadores en la interfaz
                const totalElement = document.getElementById('totalMessagesCount');
                const todayElement = document.getElementById('todayMessagesCount');
                const urgentElement = document.getElementById('urgentMessagesCount');
                
                if (totalElement) totalElement.textContent = totalCount;
                if (todayElement) todayElement.textContent = todayCount;
                if (urgentElement) urgentElement.textContent = urgentCount;
                
                console.log('📊 Contadores de mensajes actualizados:', { totalCount, todayCount, urgentCount });
                
            } catch (error) {
                console.error('❌ Error actualizando contadores de mensajes:', error);
            }
        }

        // ===== MÓDULO DE EXPORTACIÓN A EXCEL =====
        
        // Función para convertir datos a CSV
        function convertToCSV(data, headers) {
            try {
                // Crear encabezados
                const csvHeaders = headers.map(h => `"${h}"`).join(',');
                
                // Crear filas de datos
                const csvRows = data.map(row => {
                    return headers.map(header => {
                        const value = row[header] || '';
                        // Escapar comillas y envolver en comillas si contiene comas
                        return `"${String(value).replace(/"/g, '""')}"`;
                    }).join(',');
                });
                
                // Combinar encabezados y datos
                return [csvHeaders, ...csvRows].join('\n');
            } catch (error) {
                console.error('❌ Error convirtiendo a CSV:', error);
                return '';
            }
        }

        // Función para descargar archivo CSV
        function downloadCSV(csvContent, filename) {
            try {
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', filename);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                
                // Registrar en historial
                addToExportHistory(filename);
                
                console.log('✅ Archivo descargado:', filename);
            } catch (error) {
                console.error('❌ Error descargando archivo:', error);
                alert('❌ Error al descargar el archivo. Inténtalo de nuevo.');
            }
        }

        // Agregar al historial de exportaciones
        function addToExportHistory(filename) {
            try {
                const history = JSON.parse(localStorage.getItem('exportHistory') || '[]');
                const exportRecord = {
                    id: Date.now(),
                    filename: filename,
                    date: new Date().toISOString(),
                    admin: JSON.parse(localStorage.getItem('currentAdmin') || '{}').name || 'Administrador'
                };
                
                history.unshift(exportRecord);
                
                // Mantener solo los últimos 20 registros
                if (history.length > 20) {
                    history.splice(20);
                }
                
                localStorage.setItem('exportHistory', JSON.stringify(history));
                loadExportHistory();
                
            } catch (error) {
                console.error('❌ Error guardando historial:', error);
            }
        }

        // Cargar historial de exportaciones
        function loadExportHistory() {
            try {
                const history = JSON.parse(localStorage.getItem('exportHistory') || '[]');
                const historyElement = document.getElementById('exportHistory');
                
                if (history.length === 0) {
                    historyElement.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay exportaciones recientes</p>';
                    return;
                }

                let html = '<div style="display: grid; gap: 10px;">';
                
                history.forEach(record => {
                    html += `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #059669;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: #1e3a8a;">📄 ${record.filename}</strong>
                                    <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                                        👤 ${record.admin} | ⏰ ${new Date(record.date).toLocaleString()}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                historyElement.innerHTML = html;

            } catch (error) {
                console.error('❌ Error cargando historial:', error);
                document.getElementById('exportHistory').innerHTML = '<p style="text-align: center; color: #dc2626;">Error al cargar el historial</p>';
            }
        }

        // Exportar jugadores usando la nueva base de datos
        async function exportPlayers() {
            try {
                const category = document.getElementById('exportPlayerCategory').value;
                
                // Obtener jugadores de la base de datos
                let jugadores = await window.cdsanabriacfDB.getJugadores();
                
                // Filtrar por categoría si es necesario
                if (category !== 'all') {
                    jugadores = jugadores.filter(j => j.categoria === category);
                }
                
                if (jugadores.length === 0) {
                    alert('❌ No hay jugadores para exportar con los filtros seleccionados');
                    return;
                }
                
                // Exportar usando la función de la base de datos
                const success = await exportarDatosEspecificos('jugadores');
                
                if (success) {
                    alert(`✅ Exportación completada\n\n📊 ${jugadores.length} jugadores exportados\n📁 Archivo: CDSANABRIACF_Jugadores_${new Date().toISOString().split('T')[0]}.csv`);
                }
                
            } catch (error) {
                console.error('❌ Error exportando jugadores:', error);
                alert('❌ Error al exportar jugadores. Inténtalo de nuevo.');
            }
        }

        // Exportar socios usando la nueva base de datos
        async function exportMembers() {
            try {
                const status = document.getElementById('exportMemberStatus').value;
                
                // Obtener socios de la base de datos
                let socios = await window.cdsanabriacfDB.getSocios();
                
                // Filtrar por estado si es necesario
                if (status !== 'all') {
                    socios = socios.filter(s => s.estado === status);
                }
                
                if (socios.length === 0) {
                    alert('❌ No hay socios para exportar con los filtros seleccionados');
                    return;
                }
                
                // Exportar usando la función de la base de datos
                const success = await exportarDatosEspecificos('socios');
                
                if (success) {
                    alert(`✅ Exportación completada\n\n📊 ${socios.length} socios exportados\n📁 Archivo: CDSANABRIACF_Socios_${new Date().toISOString().split('T')[0]}.csv`);
                }
                
            } catch (error) {
                console.error('❌ Error exportando socios:', error);
                alert('❌ Error al exportar socios. Inténtalo de nuevo.');
            }
        }

        // Exportar amigos usando la nueva base de datos
        async function exportFriends() {
            try {
                const amigos = await window.cdsanabriacfDB.getAmigos();
                
                if (amigos.length === 0) {
                    alert('❌ No hay amigos del club para exportar');
                    return;
                }
                
                // Exportar usando la función de la base de datos
                const success = await exportarDatosEspecificos('amigos');
                
                if (success) {
                    alert(`✅ Exportación completada\n\n📊 ${amigos.length} amigos exportados\n📁 Archivo: CDSANABRIACF_Amigos_${new Date().toISOString().split('T')[0]}.csv`);
                }
                
            } catch (error) {
                console.error('❌ Error exportando amigos:', error);
                alert('❌ Error al exportar amigos. Inténtalo de nuevo.');
            }
        }

        // Exportar entrenadores usando la nueva base de datos
        async function exportCoaches() {
            try {
                const status = document.getElementById('exportCoachStatus').value;
                
                // Obtener entrenadores de la base de datos
                let entrenadores = await window.cdsanabriacfDB.getEntrenadores();
                
                // Filtrar por estado si es necesario
                if (status !== 'all') {
                    entrenadores = entrenadores.filter(e => e.estado === status);
                }
                
                if (entrenadores.length === 0) {
                    alert('❌ No hay entrenadores para exportar con los filtros seleccionados');
                    return;
                }
                
                // Exportar usando la función de la base de datos
                const success = await exportarDatosEspecificos('entrenadores');
                
                if (success) {
                    alert(`✅ Exportación completada\n\n📊 ${entrenadores.length} entrenadores exportados\n📁 Archivo: CDSANABRIACF_Entrenadores_${new Date().toISOString().split('T')[0]}.csv`);
                }
                
            } catch (error) {
                console.error('❌ Error exportando entrenadores:', error);
                alert('❌ Error al exportar entrenadores. Inténtalo de nuevo.');
            }
        }

        // Exportar eventos usando la nueva base de datos
        async function exportEvents() {
            try {
                const eventos = await window.cdsanabriacfDB.getEventos();
                
                if (eventos.length === 0) {
                    alert('❌ No hay eventos para exportar');
                    return;
                }
                
                // Exportar usando la función de la base de datos
                const success = await exportarDatosEspecificos('eventos');
                
                if (success) {
                    alert(`✅ Exportación completada\n\n📊 ${eventos.length} eventos exportados\n📁 Archivo: CDSANABRIACF_Eventos_${new Date().toISOString().split('T')[0]}.csv`);
                }
                
            } catch (error) {
                console.error('❌ Error exportando eventos:', error);
                alert('❌ Error al exportar eventos. Inténtalo de nuevo.');
            }
        }

        // Exportar competiciones
        function exportCompetitions() {
            try {
                const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
                
                if (competitions.length === 0) {
                    alert('❌ No hay competiciones para exportar');
                    return;
                }
                
                const headers = [
                    'ID', 'Nombre', 'Categoría', 'Fecha de Inicio', 'Fecha de Fin',
                    'Equipos Participantes', 'Fases', 'Estado', 'Fecha de Creación'
                ];
                
                const csvData = competitions.map(comp => ({
                    'ID': comp.id,
                    'Nombre': comp.name,
                    'Categoría': comp.category,
                    'Fecha de Inicio': comp.startDate,
                    'Fecha de Fin': comp.endDate,
                    'Equipos Participantes': comp.teams ? comp.teams.length : 0,
                    'Fases': comp.phases ? comp.phases.length : 0,
                    'Estado': comp.status || 'activa',
                    'Fecha de Creación': comp.createdAt ? new Date(comp.createdAt).toLocaleDateString() : ''
                }));
                
                const csvContent = convertToCSV(csvData, headers);
                const filename = `competiciones_${new Date().toISOString().split('T')[0]}.csv`;
                
                downloadCSV(csvContent, filename);
                alert(`✅ Exportación completada\n\n📊 ${competitions.length} competiciones exportadas\n📁 Archivo: ${filename}`);
                
            } catch (error) {
                console.error('❌ Error exportando competiciones:', error);
                alert('❌ Error al exportar competiciones. Inténtalo de nuevo.');
            }
        }

        // Exportar todos los datos
        function exportAllData() {
            try {
                if (confirm('📊 ¿Estás seguro de que quieres exportar todos los datos del club?\n\nEsto generará múltiples archivos CSV con toda la información.')) {
                    // Exportar cada categoría
                    exportPlayers();
                    setTimeout(() => exportMembers(), 500);
                    setTimeout(() => exportFriends(), 1000);
                    setTimeout(() => exportCoaches(), 1500);
                    setTimeout(() => exportEvents(), 2000);
                    setTimeout(() => exportCompetitions(), 2500);
                    
                    alert('✅ Exportación masiva iniciada\n\n📁 Se descargarán 6 archivos CSV con todos los datos del club.');
                }
            } catch (error) {
                console.error('❌ Error en exportación masiva:', error);
                alert('❌ Error en la exportación masiva. Inténtalo de nuevo.');
            }
        }

        // ===== MÓDULO DE PUBLICIDAD =====
        
        // Mostrar formulario para agregar anuncio
        function showAddAdvertisementForm() {
            document.getElementById('addAdvertisementForm').style.display = 'block';
            clearAdvertisementForm();
            setupImagePreview();
        }

        // Cancelar agregar anuncio
        function cancelAddAdvertisement() {
            document.getElementById('addAdvertisementForm').style.display = 'none';
            clearAdvertisementForm();
        }

        // Limpiar formulario de anuncio
        function clearAdvertisementForm() {
            document.getElementById('adTitle').value = '';
            document.getElementById('adCompany').value = '';
            document.getElementById('adDescription').value = '';
            document.getElementById('adUrl').value = '';
            document.getElementById('adCategory').value = 'general';
            document.getElementById('adImage').value = '';
            document.getElementById('adPosition').value = '1';
            document.getElementById('adStartDate').value = '';
            document.getElementById('adEndDate').value = '';
            document.getElementById('adStatus').value = 'active';
            document.getElementById('adType').value = 'carrusel';
            document.getElementById('adImagePreview').innerHTML = '';
        }

        // Configurar vista previa de imagen
        function setupImagePreview() {
            const imageInput = document.getElementById('adImage');
            const preview = document.getElementById('adImagePreview');
            
            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) { // 5MB
                        alert('❌ La imagen es demasiado grande. Máximo 5MB.');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; height: auto; border-radius: 8px; border: 2px solid #ddd;">`;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // Guardar anuncio
        function saveAdvertisement() {
            try {
                const title = document.getElementById('adTitle').value.trim();
                const company = document.getElementById('adCompany').value.trim();
                const description = document.getElementById('adDescription').value.trim();
                const url = document.getElementById('adUrl').value.trim();
                const category = document.getElementById('adCategory').value;
                const position = parseInt(document.getElementById('adPosition').value);
                const startDate = document.getElementById('adStartDate').value;
                const endDate = document.getElementById('adEndDate').value;
                const status = document.getElementById('adStatus').value;
                const type = document.getElementById('adType').value;
                
                if (!title || !company) {
                    alert('❌ Por favor, completa el título y la empresa colaboradora');
                    return;
                }
                
                // Procesar imagen
                const imageInput = document.getElementById('adImage');
                let imageData = null;
                
                if (imageInput.files[0]) {
                    const file = imageInput.files[0];
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imageData = e.target.result;
                            createAdvertisement(title, company, description, url, category, position, startDate, endDate, status, type, imageData);
                        };
                        reader.readAsDataURL(file);
                    });
                } else {
                    createAdvertisement(title, company, description, url, category, position, startDate, endDate, status, type, imageData);
                }
                
            } catch (error) {
                console.error('❌ Error guardando anuncio:', error);
                alert('❌ Error al guardar el anuncio. Inténtalo de nuevo.');
            }
        }

        // Crear anuncio
        function createAdvertisement(title, company, description, url, category, position, startDate, endDate, status, type, imageData) {
            try {
                const newAd = {
                    id: 'AD_' + Date.now(),
                    title: title,
                    company: company,
                    description: description,
                    url: url,
                    category: category,
                    position: position,
                    startDate: startDate,
                    endDate: endDate,
                    status: status,
                    type: type,
                    image: imageData,
                    createdAt: new Date().toISOString(),
                    views: 0,
                    clicks: 0
                };
                
                // Guardar anuncio
                const advertisements = JSON.parse(localStorage.getItem('clubAdvertisements') || '[]');
                advertisements.push(newAd);
                localStorage.setItem('clubAdvertisements', JSON.stringify(advertisements));
                
                // Cerrar formulario y mostrar confirmación
                cancelAddAdvertisement();
                alert(`✅ Anuncio guardado exitosamente\n\n📢 "${title}"\n🏢 ${company}\n📅 ${status === 'active' ? 'Activo' : 'Inactivo'}`);
                
                // Actualizar listas y contadores
                loadAdvertisementsList();
                updateAdvertisementCounts();
                
            } catch (error) {
                console.error('❌ Error creando anuncio:', error);
                alert('❌ Error al crear el anuncio. Inténtalo de nuevo.');
            }
        }

        // Cargar lista de anuncios
        function loadAdvertisementsList() {
            try {
                const advertisements = JSON.parse(localStorage.getItem('clubAdvertisements') || '[]');
                const filter = document.getElementById('adFilter').value;
                
                let filteredAds = advertisements;
                if (filter === 'active') {
                    filteredAds = advertisements.filter(ad => ad.status === 'active');
                } else if (filter === 'carrusel') {
                    filteredAds = advertisements.filter(ad => ad.type === 'carrusel' && ad.status === 'active');
                } else if (filter === 'expired') {
                    const today = new Date().toISOString().split('T')[0];
                    filteredAds = advertisements.filter(ad => ad.endDate && ad.endDate < today);
                }
                
                const listElement = document.getElementById('advertisementsList');
                
                if (filteredAds.length === 0) {
                    listElement.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay anuncios para mostrar</p>';
                    return;
                }

                let html = '<div style="display: grid; gap: 15px;">';
                
                filteredAds.sort((a, b) => a.position - b.position).forEach(ad => {
                    const statusColors = {
                        'active': '#059669',
                        'inactive': '#6c757d',
                        'pending': '#f59e0b'
                    };
                    
                    const typeColors = {
                        'banner': '#3b82f6',
                        'carrusel': '#8b5cf6',
                        'sidebar': '#10b981',
                        'popup': '#dc2626'
                    };
                    
                    const isExpired = ad.endDate && new Date(ad.endDate) < new Date();
                    
                    html += `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid ${statusColors[ad.status]};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <div style="flex: 1;">
                                    <h4 style="margin: 0; color: #1e3a8a;">📢 ${ad.title}</h4>
                                    <p style="margin: 5px 0; color: #666; font-weight: bold;">🏢 ${ad.company}</p>
                                    ${ad.description ? `<p style="margin: 5px 0; color: #666;">${ad.description}</p>` : ''}
                                </div>
                                <div style="text-align: right; margin-left: 15px;">
                                    <span style="background: ${statusColors[ad.status]}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">${ad.status}</span>
                                    <br>
                                    <span style="background: ${typeColors[ad.type]}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; margin-top: 5px; display: inline-block;">${ad.type}</span>
                                </div>
                            </div>
                            
                            ${ad.image ? `<div style="margin: 10px 0;"><img src="${ad.image}" style="max-width: 200px; max-height: 100px; object-fit: cover; border-radius: 8px;"></div>` : ''}
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; font-size: 0.9rem;">
                                <div><strong>📊 Posición:</strong> ${ad.position}</div>
                                <div><strong>🏷️ Categoría:</strong> ${ad.category}</div>
                                <div><strong>👁️ Vistas:</strong> ${ad.views}</div>
                                <div><strong>🖱️ Clicks:</strong> ${ad.clicks}</div>
                                ${ad.startDate ? `<div><strong>📅 Inicio:</strong> ${ad.startDate}</div>` : ''}
                                ${ad.endDate ? `<div><strong>📅 Fin:</strong> ${ad.endDate}</div>` : ''}
                            </div>
                            
                            ${isExpired ? '<div style="background: #dc2626; color: white; padding: 5px; border-radius: 5px; margin-top: 10px; text-align: center;">⚠️ ANUNCIO EXPIRADO</div>' : ''}
                            
                            <div style="margin-top: 15px;">
                                <button class="btn btn-sm" onclick="editAdvertisement('${ad.id}')" style="background: #3b82f6; color: white; margin-right: 5px;">✏️ Editar</button>
                                <button class="btn btn-sm" onclick="toggleAdvertisementStatus('${ad.id}')" style="background: ${ad.status === 'active' ? '#f59e0b' : '#059669'}; color: white; margin-right: 5px;">${ad.status === 'active' ? '⏸️ Pausar' : '▶️ Activar'}</button>
                                <button class="btn btn-sm" onclick="deleteAdvertisement('${ad.id}')" style="background: #dc2626; color: white;">🗑️ Eliminar</button>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                listElement.innerHTML = html;

            } catch (error) {
                console.error('❌ Error cargando anuncios:', error);
                document.getElementById('advertisementsList').innerHTML = '<p style="text-align: center; color: #dc2626;">Error al cargar los anuncios</p>';
            }
        }

        // Filtrar anuncios
        function filterAdvertisements() {
            loadAdvertisementsList();
        }

        // Cambiar estado del anuncio
        function toggleAdvertisementStatus(adId) {
            try {
                const advertisements = JSON.parse(localStorage.getItem('clubAdvertisements') || '[]');
                const adIndex = advertisements.findIndex(ad => ad.id === adId);
                
                if (adIndex !== -1) {
                    const currentStatus = advertisements[adIndex].status;
                    advertisements[adIndex].status = currentStatus === 'active' ? 'inactive' : 'active';
                    
                    localStorage.setItem('clubAdvertisements', JSON.stringify(advertisements));
                    
                    alert(`✅ Anuncio ${advertisements[adIndex].status === 'active' ? 'activado' : 'desactivado'} exitosamente`);
                    
                    loadAdvertisementsList();
                    updateAdvertisementCounts();
                }
            } catch (error) {
                console.error('❌ Error cambiando estado:', error);
                alert('❌ Error al cambiar el estado del anuncio');
            }
        }

        // Eliminar anuncio
        function deleteAdvertisement(adId) {
            try {
                if (confirm('❌ ¿Estás seguro de que quieres eliminar este anuncio?\n\nEsta acción no se puede deshacer.')) {
                    const advertisements = JSON.parse(localStorage.getItem('clubAdvertisements') || '[]');
                    const filteredAds = advertisements.filter(ad => ad.id !== adId);
                    
                    localStorage.setItem('clubAdvertisements', JSON.stringify(filteredAds));
                    
                    alert('✅ Anuncio eliminado exitosamente');
                    
                    loadAdvertisementsList();
                    updateAdvertisementCounts();
                }
            } catch (error) {
                console.error('❌ Error eliminando anuncio:', error);
                alert('❌ Error al eliminar el anuncio');
            }
        }

        // Editar anuncio (función básica)
        function editAdvertisement(adId) {
            alert('🔄 Función de edición en desarrollo. Por favor, elimina y crea un nuevo anuncio.');
        }

        // Actualizar contadores de anuncios
        function updateAdvertisementCounts() {
            try {
                const advertisements = JSON.parse(localStorage.getItem('clubAdvertisements') || '[]');
                const today = new Date().toISOString().split('T')[0];
                
                const activeCount = advertisements.filter(ad => ad.status === 'active').length;
                const totalCount = advertisements.length;
                const carouselCount = advertisements.filter(ad => ad.type === 'carrusel' && ad.status === 'active').length;
                const expiredCount = advertisements.filter(ad => ad.endDate && ad.endDate < today).length;
                
                // Actualizar contadores en la interfaz
                const activeElement = document.getElementById('activeAdsCount');
                const totalElement = document.getElementById('totalAdsCount');
                const carouselElement = document.getElementById('carouselAdsCount');
                const expiredElement = document.getElementById('expiredAdsCount');
                
                if (activeElement) activeElement.textContent = activeCount;
                if (totalElement) totalElement.textContent = totalCount;
                if (carouselElement) carouselElement.textContent = carouselCount;
                if (expiredElement) expiredElement.textContent = expiredCount;
                
                console.log('📊 Contadores de anuncios actualizados:', { activeCount, totalCount, carouselCount, expiredCount });
                
            } catch (error) {
                console.error('❌ Error actualizando contadores de anuncios:', error);
            }
        }

        // ===== MÓDULO DE CONFIGURACIÓN DE REDES SOCIALES =====
        
        // Función para guardar configuración de redes sociales
        function saveSocialMediaConfig() {
            try {
                const facebookUrl = document.getElementById('facebookUrl').value.trim();
                const instagramUrl = document.getElementById('instagramUrl').value.trim();
                const facebookUsername = document.getElementById('facebookUsername').value.trim();
                const instagramUsername = document.getElementById('instagramUsername').value.trim();
                
                // Validar URLs si están proporcionadas
                if (facebookUrl && !isValidUrl(facebookUrl)) {
                    alert('❌ La URL de Facebook no es válida');
                    return;
                }
                
                if (instagramUrl && !isValidUrl(instagramUrl)) {
                    alert('❌ La URL de Instagram no es válida');
                    return;
                }
                
                // Guardar en localStorage
                const teamSettings = JSON.parse(localStorage.getItem('teamSettings') || '{}');
                teamSettings.facebookUrl = facebookUrl;
                teamSettings.instagramUrl = instagramUrl;
                teamSettings.facebookUsername = facebookUsername;
                teamSettings.instagramUsername = instagramUsername;
                
                localStorage.setItem('teamSettings', JSON.stringify(teamSettings));
                
                showSocialMediaStatus('✅ Configuración de redes sociales guardada correctamente', 'success');
                console.log('📱 Configuración de redes sociales guardada:', teamSettings);
                
            } catch (error) {
                console.error('❌ Error guardando configuración de redes sociales:', error);
                showSocialMediaStatus('❌ Error al guardar la configuración', 'error');
            }
        }

        // Función para cargar configuración de redes sociales
        function loadSocialMediaConfig() {
            try {
                const teamSettings = JSON.parse(localStorage.getItem('teamSettings') || '{}');
                
                document.getElementById('facebookUrl').value = teamSettings.facebookUrl || '';
                document.getElementById('instagramUrl').value = teamSettings.instagramUrl || '';
                document.getElementById('facebookUsername').value = teamSettings.facebookUsername || '';
                document.getElementById('instagramUsername').value = teamSettings.instagramUsername || '';
                
                showSocialMediaStatus('📋 Configuración de redes sociales cargada', 'info');
                console.log('📱 Configuración de redes sociales cargada:', teamSettings);
                
            } catch (error) {
                console.error('❌ Error cargando configuración de redes sociales:', error);
                showSocialMediaStatus('❌ Error al cargar la configuración', 'error');
            }
        }

        // Función para probar enlaces de redes sociales
        function testSocialMediaLinks() {
            try {
                const teamSettings = JSON.parse(localStorage.getItem('teamSettings') || '{}');
                const facebookUrl = teamSettings.facebookUrl;
                const instagramUrl = teamSettings.instagramUrl;
                
                let message = '🧪 Prueba de enlaces de redes sociales:\n\n';
                
                if (facebookUrl) {
                    message += `📘 Facebook: ${facebookUrl}\n`;
                } else {
                    message += `📘 Facebook: No configurado\n`;
                }
                
                if (instagramUrl) {
                    message += `📷 Instagram: ${instagramUrl}\n`;
                } else {
                    message += `📷 Instagram: No configurado\n`;
                }
                
                message += '\n💡 Los enlaces se abrirán en nuevas pestañas para su verificación.';
                
                if (confirm(message)) {
                    if (facebookUrl) {
                        window.open(facebookUrl, '_blank');
                    }
                    if (instagramUrl) {
                        window.open(instagramUrl, '_blank');
                    }
                }
                
            } catch (error) {
                console.error('❌ Error probando enlaces de redes sociales:', error);
                alert('❌ Error al probar los enlaces');
            }
        }

        // Función para mostrar estado de redes sociales
        function showSocialMediaStatus(message, type) {
            const statusDiv = document.getElementById('socialMediaStatus');
            const colors = {
                'success': '#d4edda',
                'error': '#f8d7da',
                'info': '#d1ecf1'
            };
            
            statusDiv.style.display = 'block';
            statusDiv.style.backgroundColor = colors[type] || colors.info;
            statusDiv.style.color = type === 'error' ? '#721c24' : '#155724';
            statusDiv.style.border = `1px solid ${type === 'error' ? '#f5c6cb' : '#c3e6cb'}`;
            statusDiv.textContent = message;
            
            // Ocultar después de 3 segundos
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        // Función auxiliar para validar URLs
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // ===== MÓDULO DE CONFIGURACIÓN - LOGO DEL CLUB =====
        
        // Cargar logo al seleccionar archivo
        document.addEventListener('DOMContentLoaded', function() {
            const logoFile = document.getElementById('logoFile');
            if (logoFile) {
                logoFile.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        if (file.size > 2 * 1024 * 1024) { // 2MB
                            alert('❌ El archivo es demasiado grande. Máximo 2MB.');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const preview = document.getElementById('logoPreview');
                            preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // Cargar logo existente al cargar la página
            loadExistingLogo();
            loadLogoMessage();
            loadThemeSettings();
            loadContactInfo();
            loadSocialMediaConfig();
        });

        function uploadLogo() {
            try {
                const fileInput = document.getElementById('logoFile');
                const file = fileInput.files[0];
                
                if (!file) {
                    alert('❌ Por favor, selecciona un archivo de imagen.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const logoData = {
                        id: 'LOGO_CDSANABRIACF',
                        dataUrl: e.target.result,
                        fileName: file.name,
                        fileSize: file.size,
                        uploadDate: new Date().toISOString(),
                        teamId: 'CDSANABRIACF'
                    };
                    
                    localStorage.setItem('clubLogo', JSON.stringify(logoData));
                    
                    alert('✅ Logo del club guardado correctamente.');
                    console.log('🏆 Logo del club guardado:', file.name);
                };
                reader.readAsDataURL(file);
                
            } catch (error) {
                console.error('❌ Error guardando logo:', error);
                alert('❌ Error al guardar el logo del club.');
            }
        }

        function removeLogo() {
            try {
                if (confirm('¿Estás seguro de que quieres eliminar el logo del club?')) {
                    localStorage.removeItem('clubLogo');
                    
                    const preview = document.getElementById('logoPreview');
                    preview.innerHTML = '<span style="color: #666;">Sin logo</span>';
                    
                    const fileInput = document.getElementById('logoFile');
                    fileInput.value = '';
                    
                    alert('✅ Logo del club eliminado correctamente.');
                    console.log('🗑️ Logo del club eliminado');
                }
            } catch (error) {
                console.error('❌ Error eliminando logo:', error);
                alert('❌ Error al eliminar el logo del club.');
            }
        }

        function loadExistingLogo() {
            try {
                const logoData = JSON.parse(localStorage.getItem('clubLogo') || 'null');
                const preview = document.getElementById('logoPreview');
                
                if (logoData && logoData.dataUrl) {
                    // Si hay un logo personalizado guardado, mostrarlo
                    preview.innerHTML = `<img src="${logoData.dataUrl}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                    console.log('✅ Logo personalizado cargado en configuración');
                } else {
                    // Si no hay logo personalizado, mostrar el escudo por defecto
                    preview.innerHTML = `<img src="escudo-sanabria.jpeg" style="max-width: 100%; max-height: 100%; object-fit: contain;" alt="Escudo CDSANABRIACF">`;
                    console.log('✅ Escudo por defecto cargado en configuración');
                }
            } catch (error) {
                console.error('❌ Error cargando logo existente:', error);
                // En caso de error, mostrar el escudo por defecto
                const preview = document.getElementById('logoPreview');
                preview.innerHTML = `<img src="escudo-sanabria.jpeg" style="max-width: 100%; max-height: 100%; object-fit: contain;" alt="Escudo CDSANABRIACF">`;
            }
        }

        // ===== MÓDULO DE CONFIGURACIÓN - MENSAJE DEL LOGO =====
        
        function saveLogoMessage() {
            try {
                const messageText = document.getElementById('logoMessage').value.trim();
                
                if (!messageText) {
                    alert('❌ Por favor, escribe un mensaje.');
                    return;
                }
                
                // Guardar en la configuración del equipo
                const teamSettings = JSON.parse(localStorage.getItem('cdsanabriacfSettings') || '{}');
                teamSettings.logoMessage = messageText;
                localStorage.setItem('cdsanabriacfSettings', JSON.stringify(teamSettings));
                
                alert('✅ Mensaje del logo guardado correctamente.\n\n🔄 El mensaje se aplicará automáticamente en la página principal.');
                console.log('💬 Mensaje del logo guardado:', messageText);
                
            } catch (error) {
                console.error('❌ Error guardando mensaje del logo:', error);
                alert('❌ Error al guardar el mensaje del logo.');
            }
        }

        function resetLogoMessage() {
            try {
                if (confirm('¿Estás seguro de que quieres restablecer el mensaje del logo al valor por defecto?')) {
                    const defaultMessage = '¡Bienvenidos al Club Deportivo Sanabriacf! ⚽';
                    
                    document.getElementById('logoMessage').value = defaultMessage;
                    
                    // Guardar en la configuración del equipo
                    const teamSettings = JSON.parse(localStorage.getItem('cdsanabriacfSettings') || '{}');
                    teamSettings.logoMessage = defaultMessage;
                    localStorage.setItem('cdsanabriacfSettings', JSON.stringify(teamSettings));
                    
                    console.log('🔄 Mensaje del logo restablecido:', defaultMessage);
                }
            } catch (error) {
                console.error('❌ Error restableciendo mensaje del logo:', error);
                alert('❌ Error al restablecer el mensaje del logo.');
            }
        }

        function loadLogoMessage() {
            try {
                const teamSettings = JSON.parse(localStorage.getItem('cdsanabriacfSettings') || '{}');
                const messageText = teamSettings.logoMessage || '¡Bienvenidos al Club Deportivo Sanabriacf! ⚽';
                
                document.getElementById('logoMessage').value = messageText;
                console.log('💬 Mensaje del logo cargado:', messageText);
                
            } catch (error) {
                console.error('❌ Error cargando mensaje del logo:', error);
            }
        }

        // ===== MÓDULO DE CONFIGURACIÓN - COLORES Y TEMA =====
        
        function saveThemeSettings() {
            try {
                const themeSettings = {
                    primaryColor: document.getElementById('primaryColor').value,
                    secondaryColor: document.getElementById('secondaryColor').value,
                    fontFamily: document.getElementById('fontFamily').value,
                    fontSize: document.getElementById('fontSize').value,
                    teamId: 'CDSANABRIACF',
                    lastModified: new Date().toISOString()
                };
                
                localStorage.setItem('clubThemeSettings', JSON.stringify(themeSettings));
                
                // Aplicar cambios inmediatamente en el panel de administración
                applyThemeSettings(themeSettings);
                
                // Notificar a la página principal si está abierta
                notifyMainPageOfThemeChange(themeSettings);
                
                alert('✅ Configuración de tema guardada y aplicada correctamente.\n\n🔄 Los cambios se aplicarán automáticamente a la página principal.');
                console.log('🎨 Configuración de tema guardada:', themeSettings);
                
            } catch (error) {
                console.error('❌ Error guardando configuración de tema:', error);
                alert('❌ Error al guardar la configuración de tema.');
            }
        }

        // Función para notificar a la página principal del cambio de tema
        function notifyMainPageOfThemeChange(themeSettings) {
            try {
                // Buscar la ventana de la página principal
                const mainPageWindow = window.opener || window.parent;
                
                if (mainPageWindow && mainPageWindow !== window) {
                    // Enviar mensaje a la página principal
                    mainPageWindow.postMessage({
                        type: 'THEME_CHANGED',
                        themeSettings: themeSettings
                    }, '*');
                    
                    console.log('📢 Notificación enviada a la página principal sobre cambio de tema');
                }
            } catch (error) {
                console.error('❌ Error notificando cambio de tema:', error);
            }
        }

        function resetThemeSettings() {
            try {
                if (confirm('¿Estás seguro de que quieres restablecer la configuración de tema a los valores por defecto?')) {
                    // Valores por defecto
                    document.getElementById('primaryColor').value = '#dc2626';
                    document.getElementById('secondaryColor').value = '#3b82f6';
                    document.getElementById('fontFamily').value = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
                    document.getElementById('fontSize').value = '16px';
                    
                    // Guardar y aplicar
                    saveThemeSettings();
                    
                    alert('✅ Configuración de tema restablecida a valores por defecto.');
                }
            } catch (error) {
                console.error('❌ Error restableciendo tema:', error);
                alert('❌ Error al restablecer la configuración de tema.');
            }
        }

        function loadThemeSettings() {
            try {
                const themeSettings = JSON.parse(localStorage.getItem('clubThemeSettings') || 'null');
                if (themeSettings) {
                    document.getElementById('primaryColor').value = themeSettings.primaryColor || '#dc2626';
                    document.getElementById('secondaryColor').value = themeSettings.secondaryColor || '#3b82f6';
                    document.getElementById('fontFamily').value = themeSettings.fontFamily || "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
                    document.getElementById('fontSize').value = themeSettings.fontSize || '16px';
                    
                    // Aplicar configuración
                    applyThemeSettings(themeSettings);
                } else {
                    // Valores por defecto si no hay configuración
                    document.getElementById('primaryColor').value = '#dc2626';
                    document.getElementById('secondaryColor').value = '#3b82f6';
                    document.getElementById('fontFamily').value = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
                    document.getElementById('fontSize').value = '16px';
                    
                    console.log('ℹ️ No hay configuración de tema guardada, usando valores por defecto');
                }
            } catch (error) {
                console.error('❌ Error cargando configuración de tema:', error);
            }
        }

        function applyThemeSettings(settings) {
            try {
                // Aplicar colores al CSS
                const root = document.documentElement;
                root.style.setProperty('--primary-color', settings.primaryColor);
                root.style.setProperty('--secondary-color', settings.secondaryColor);
                
                // Aplicar fuente
                document.body.style.fontFamily = settings.fontFamily;
                document.body.style.fontSize = settings.fontSize;
                
                // Actualizar gradientes y elementos específicos
                const adminHeader = document.querySelector('.admin-header');
                if (adminHeader) {
                    adminHeader.style.background = `linear-gradient(135deg, ${settings.primaryColor} 0%, ${settings.secondaryColor} 100%)`;
                }
                
                const navTabs = document.querySelectorAll('.nav-tab.active');
                navTabs.forEach(tab => {
                    tab.style.background = settings.primaryColor;
                });
                
            } catch (error) {
                console.error('❌ Error aplicando configuración de tema:', error);
            }
        }

        // ===== MÓDULO DE CONFIGURACIÓN - DATOS DE CONTACTO =====
        
        function saveContactInfo() {
            try {
                const contactInfo = {
                    email: document.getElementById('clubEmail').value.trim(),
                    phone: document.getElementById('clubPhone').value.trim(),
                    address: document.getElementById('clubAddress').value.trim(),
                    website: document.getElementById('clubWebsite').value.trim(),
                    whatsapp: document.getElementById('clubWhatsApp').value.trim(),
                    hours: document.getElementById('clubHours').value.trim(),
                    teamId: 'CDSANABRIACF',
                    lastModified: new Date().toISOString()
                };
                
                localStorage.setItem('clubContactInfo', JSON.stringify(contactInfo));
                
                alert('✅ Información de contacto guardada correctamente.');
                console.log('📞 Información de contacto guardada:', contactInfo);
                
            } catch (error) {
                console.error('❌ Error guardando información de contacto:', error);
                alert('❌ Error al guardar la información de contacto.');
            }
        }

        function loadContactInfo() {
            try {
                const contactInfo = JSON.parse(localStorage.getItem('clubContactInfo') || 'null');
                if (contactInfo) {
                    document.getElementById('clubEmail').value = contactInfo.email || '';
                    document.getElementById('clubPhone').value = contactInfo.phone || '';
                    document.getElementById('clubAddress').value = contactInfo.address || '';
                    document.getElementById('clubWebsite').value = contactInfo.website || '';
                    document.getElementById('clubWhatsApp').value = contactInfo.whatsapp || '';
                    document.getElementById('clubHours').value = contactInfo.hours || '';
                    
                    alert('✅ Información de contacto cargada correctamente.');
                } else {
                    alert('ℹ️ No hay información de contacto guardada.');
                }
            } catch (error) {
                console.error('❌ Error cargando información de contacto:', error);
                alert('❌ Error al cargar la información de contacto.');
            }
        }

        // ===== MÓDULO DE CONFIGURACIÓN DE TIENDA ONLINE =====
        
        function guardarConfiguracionTienda() {
            try {
                const tiendaUrl = document.getElementById('tiendaUrl').value.trim();
                const tiendaNombre = document.getElementById('tiendaNombre').value.trim();
                
                if (!tiendaUrl) {
                    mostrarMensajeTienda('❌ Por favor, introduce una URL válida para la tienda online.', 'error');
                    return;
                }
                
                // Validar que sea una URL válida
                try {
                    new URL(tiendaUrl);
                } catch (e) {
                    mostrarMensajeTienda('❌ Por favor, introduce una URL válida (debe incluir http:// o https://).', 'error');
                    return;
                }
                
                // Guardar configuración en teamSettings
                const teamSettings = JSON.parse(localStorage.getItem('teamSettings') || '{}');
                teamSettings.tiendaUrl = tiendaUrl;
                teamSettings.tiendaNombre = tiendaNombre;
                teamSettings.lastModified = new Date().toISOString();
                
                localStorage.setItem('teamSettings', JSON.stringify(teamSettings));
                
                mostrarMensajeTienda('✅ Configuración de tienda guardada correctamente.\n\n🔗 URL: ' + tiendaUrl, 'success');
                console.log('🏪 Configuración de tienda guardada:', { tiendaUrl, tiendaNombre });
                
            } catch (error) {
                console.error('❌ Error guardando configuración de tienda:', error);
                mostrarMensajeTienda('❌ Error al guardar la configuración de tienda.', 'error');
            }
        }
        
        function probarTiendaOnline() {
            try {
                const tiendaUrl = document.getElementById('tiendaUrl').value.trim();
                
                if (!tiendaUrl) {
                    mostrarMensajeTienda('❌ Por favor, introduce una URL válida para probar.', 'error');
                    return;
                }
                
                // Validar URL
                try {
                    new URL(tiendaUrl);
                } catch (e) {
                    mostrarMensajeTienda('❌ URL inválida. Debe incluir http:// o https://.', 'error');
                    return;
                }
                
                // Abrir en nueva pestaña
                window.open(tiendaUrl, '_blank');
                mostrarMensajeTienda('🧪 Abriendo tienda online en nueva pestaña para pruebas...', 'info');
                
            } catch (error) {
                console.error('❌ Error probando tienda online:', error);
                mostrarMensajeTienda('❌ Error al probar la tienda online.', 'error');
            }
        }
        
        function restaurarTiendaPorDefecto() {
            try {
                if (confirm('¿Estás seguro de que quieres restaurar la URL de tienda por defecto?\n\nEsto eliminará la configuración personalizada.')) {
                    const teamSettings = JSON.parse(localStorage.getItem('teamSettings') || '{}');
                    delete teamSettings.tiendaUrl;
                    delete teamSettings.tiendaNombre;
                    
                    localStorage.setItem('teamSettings', JSON.stringify(teamSettings));
                    
                    // Limpiar campos
                    document.getElementById('tiendaUrl').value = '';
                    document.getElementById('tiendaNombre').value = '';
                    
                    mostrarMensajeTienda('🔄 Configuración restaurada por defecto.\n\nEl botón TIENDA ahora abrirá la tienda oficial del club.', 'success');
                    console.log('🔄 Configuración de tienda restaurada por defecto');
                }
            } catch (error) {
                console.error('❌ Error restaurando configuración por defecto:', error);
                mostrarMensajeTienda('❌ Error al restaurar la configuración por defecto.', 'error');
            }
        }
        
        function mostrarMensajeTienda(mensaje, tipo) {
            const statusDiv = document.getElementById('tiendaConfigStatus');
            statusDiv.textContent = mensaje;
            statusDiv.style.display = 'block';
            
            // Aplicar estilos según el tipo
            statusDiv.className = '';
            switch (tipo) {
                case 'success':
                    statusDiv.style.background = '#d4edda';
                    statusDiv.style.color = '#155724';
                    statusDiv.style.border = '1px solid #c3e6cb';
                    break;
                case 'error':
                    statusDiv.style.background = '#f8d7da';
                    statusDiv.style.color = '#721c24';
                    statusDiv.style.border = '1px solid #f5c6cb';
                    break;
                case 'info':
                    statusDiv.style.background = '#d1ecf1';
                    statusDiv.style.color = '#0c5460';
                    statusDiv.style.border = '1px solid #bee5eb';
                    break;
            }
            
            // Ocultar mensaje después de 5 segundos
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
        
        function cargarConfiguracionTienda() {
            try {
                const teamSettings = JSON.parse(localStorage.getItem('teamSettings') || '{}');
                
                if (teamSettings.tiendaUrl) {
                    document.getElementById('tiendaUrl').value = teamSettings.tiendaUrl;
                    document.getElementById('tiendaNombre').value = teamSettings.tiendaNombre || '';
                    console.log('🏪 Configuración de tienda cargada:', teamSettings.tiendaUrl);
                } else {
                    console.log('ℹ️ No hay configuración de tienda personalizada');
                }
            } catch (error) {
                console.error('❌ Error cargando configuración de tienda:', error);
            }
        }

        // Exportar todos los datos usando la nueva base de datos
        async function exportAllData() {
            try {
                if (confirm('📊 ¿Estás seguro de que quieres exportar todos los datos del club?\n\nEsto generará un archivo JSON con toda la información de la base de datos.')) {
                    
                    // Mostrar indicador de carga
                    const exportButton = document.querySelector('button[onclick="exportAllData()"]');
                    const originalText = exportButton.innerHTML;
                    exportButton.innerHTML = '⏳ Exportando...';
                    exportButton.disabled = true;
                    
                    // Exportar usando la función de la base de datos
                    const success = await exportarDatosEspecificos('todo');
                    
                    if (success) {
                        alert(`✅ Exportación completa exitosa\n\n📊 Todos los datos del club han sido exportados\n📁 Archivo: CDSANABRIACF_RespaldoCompleto_${new Date().toISOString().split('T')[0]}.json\n\n💾 Este archivo contiene toda la información de la base de datos.`);
                    }
                    
                    // Restaurar botón
                    exportButton.innerHTML = originalText;
                    exportButton.disabled = false;
                }
                
            } catch (error) {
                console.error('❌ Error exportando todos los datos:', error);
                alert('❌ Error al exportar todos los datos. Inténtalo de nuevo.');
                
                // Restaurar botón en caso de error
                const exportButton = document.querySelector('button[onclick="exportAllData()"]');
                exportButton.innerHTML = '📊 Exportar Todo';
                exportButton.disabled = false;
            }
        }

        // === FUNCIONES DE BASE DE DATOS ===
        
        // Esperar a que la base de datos esté lista
        async function waitForDatabase() {
            return new Promise((resolve) => {
                const checkDB = () => {
                    if (window.cdsanabriacfDB && window.cdsanabriacfDB.db) {
                        resolve();
                    } else {
                        setTimeout(checkDB, 100);
                    }
                };
                checkDB();
            });
        }

        // Actualizar estadísticas de la base de datos
        async function updateDatabaseStats() {
            try {
                // Usar localStorage directamente en lugar de IndexedDB
                const socios = JSON.parse(localStorage.getItem('clubMembers') || '[]').length;
                const amigos = JSON.parse(localStorage.getItem('clubFriends') || '[]').length;
                const jugadores = JSON.parse(localStorage.getItem('clubPlayers') || '[]').length;
                const equipos = JSON.parse(localStorage.getItem('clubTeams') || '[]').length;
                const eventos = JSON.parse(localStorage.getItem('clubEvents') || '[]').length;
                const documentos = JSON.parse(localStorage.getItem('clubDocuments') || '[]').length;

                // Actualizar elementos si existen
                const dbSociosElement = document.getElementById('dbSociosCount');
                const dbAmigosElement = document.getElementById('dbAmigosCount');
                const dbJugadoresElement = document.getElementById('dbJugadoresCount');
                const dbEquiposElement = document.getElementById('dbEquiposCount');
                const dbEventosElement = document.getElementById('dbEventosCount');
                const dbDocumentosElement = document.getElementById('dbDocumentosCount');

                if (dbSociosElement) dbSociosElement.textContent = socios;
                if (dbAmigosElement) dbAmigosElement.textContent = amigos;
                if (dbJugadoresElement) dbJugadoresElement.textContent = jugadores;
                if (dbEquiposElement) dbEquiposElement.textContent = equipos;
                if (dbEventosElement) dbEventosElement.textContent = eventos;
                if (dbDocumentosElement) dbDocumentosElement.textContent = documentos;

                console.log('✅ Estadísticas de base de datos actualizadas desde localStorage:', { socios, amigos, jugadores, equipos, eventos, documentos });
            } catch (error) {
                console.error('Error actualizando estadísticas de BD:', error);
            }
        }

        // Funciones de gestión de socios
        async function dbAddSocio() {
            try {
                const socio = {
                    nombre: 'Nuevo',
                    apellidos: 'Socio',
                    dni: 'SOCIO' + Date.now(),
                    direccion: 'Dirección del socio',
                    telefono: '123456789',
                    email: 'socio@cdsanabriacf.com',
                    fechaRegistro: new Date().toISOString(),
                    estado: 'activo',
                    numeroSocio: await window.cdsanabriacfDB.generarNumeroSocio()
                };

                await window.cdsanabriacfDB.add('socios', socio);
                await updateDatabaseStats();
                showDbSuccess('Socio añadido correctamente');
            } catch (error) {
                showDbError('Error añadiendo socio: ' + error.message);
            }
        }

        async function dbViewSocios() {
            try {
                const socios = await window.cdsanabriacfDB.getSocios();
                const preview = document.getElementById('dbSociosPreview');
                preview.innerHTML = `<pre>${JSON.stringify(socios.slice(0, 3), null, 2)}</pre>`;
                preview.style.display = 'block';
            } catch (error) {
                showDbError('Error mostrando socios: ' + error.message);
            }
        }

        // Funciones de gestión de amigos
        async function dbAddAmigo() {
            try {
                const amigo = {
                    nombre: 'Nuevo',
                    apellidos: 'Amigo',
                    dni: 'AMIGO' + Date.now(),
                    telefono: '987654321',
                    email: 'amigo@cdsanabriacf.com',
                    fechaRegistro: new Date().toISOString()
                };

                await window.cdsanabriacfDB.add('amigos', amigo);
                await updateDatabaseStats();
                showDbSuccess('Amigo añadido correctamente');
            } catch (error) {
                showDbError('Error añadiendo amigo: ' + error.message);
            }
        }

        async function dbViewAmigos() {
            try {
                const amigos = await window.cdsanabriacfDB.getAmigos();
                const preview = document.getElementById('dbAmigosPreview');
                preview.innerHTML = `<pre>${JSON.stringify(amigos.slice(0, 3), null, 2)}</pre>`;
                preview.style.display = 'block';
            } catch (error) {
                showDbError('Error mostrando amigos: ' + error.message);
            }
        }

        // Funciones de gestión de jugadores
        async function dbAddJugador() {
            try {
                const jugador = {
                    nombre: 'Nuevo',
                    apellidos: 'Jugador',
                    dni: 'JUG' + Date.now(),
                    telefono: '555666777',
                    direccion: 'Dirección del jugador',
                    fechaNacimiento: '2010-01-01',
                    edad: 14,
                    categoria: 'infantil',
                    dorsal: Math.floor(Math.random() * 99) + 1,
                    estado: 'activo',
                    fechaRegistro: new Date().toISOString(),
                    consentimientoFotos: true
                };

                await window.cdsanabriacfDB.add('jugadores', jugador);
                await updateDatabaseStats();
                showDbSuccess('Jugador añadido correctamente');
            } catch (error) {
                showDbError('Error añadiendo jugador: ' + error.message);
            }
        }

        async function dbViewJugadores() {
            try {
                const jugadores = await window.cdsanabriacfDB.getJugadores();
                const preview = document.getElementById('dbJugadoresPreview');
                preview.innerHTML = `<pre>${JSON.stringify(jugadores.slice(0, 3), null, 2)}</pre>`;
                preview.style.display = 'block';
            } catch (error) {
                showDbError('Error mostrando jugadores: ' + error.message);
            }
        }

        // Funciones de exportación
        async function dbExportSocios() {
            try {
                const success = await exportarDatosEspecificos('socios');
                if (success) {
                    showDbSuccess('Socios exportados correctamente');
                }
            } catch (error) {
                showDbError('Error exportando socios: ' + error.message);
            }
        }

        async function dbExportAll() {
            try {
                const success = await exportarDatosEspecificos('todo');
                if (success) {
                    showDbSuccess('Todos los datos exportados correctamente');
                }
            } catch (error) {
                showDbError('Error exportando datos: ' + error.message);
            }
        }

        // Funciones de respaldo
        async function dbBackup() {
            try {
                const respaldo = await window.cdsanabriacfDB.crearRespaldo();
                const status = document.getElementById('dbBackupStatus');
                status.innerHTML = `<div style="background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; margin: 10px 0;">✅ Respaldo creado: ${respaldo.metadata.totalRegistros} registros</div>`;
            } catch (error) {
                showDbError('Error creando respaldo: ' + error.message);
            }
        }

        async function dbRestore() {
            try {
                if (confirm('¿Estás seguro de que quieres restaurar los datos?\n\n⚠️ Esta acción sobrescribirá los datos actuales.')) {
                    showDbSuccess('Restauración completada');
                }
            } catch (error) {
                showDbError('Error en restauración: ' + error.message);
            }
        }

        // Funciones de búsqueda
        async function dbSearch() {
            try {
                const socios = await window.cdsanabriacfDB.getSocios();
                const resultados = socios.filter(s => s.nombre.includes('Nuevo'));
                const results = document.getElementById('dbSearchResults');
                results.innerHTML = `<pre>${JSON.stringify(resultados, null, 2)}</pre>`;
                results.style.display = 'block';
            } catch (error) {
                showDbError('Error en búsqueda: ' + error.message);
            }
        }

        async function dbFilterJugadores() {
            try {
                const jugadores = await window.cdsanabriacfDB.getJugadores();
                const infantiles = jugadores.filter(j => j.categoria === 'infantil');
                const results = document.getElementById('dbSearchResults');
                results.innerHTML = `<pre>Jugadores Infantiles: ${JSON.stringify(infantiles, null, 2)}</pre>`;
                results.style.display = 'block';
            } catch (error) {
                showDbError('Error filtrando jugadores: ' + error.message);
            }
        }

        // Funciones de utilidad para mensajes
        function showDbSuccess(message) {
            const status = document.getElementById('dbExportStatus');
            status.innerHTML = `<div style="background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; margin: 10px 0;">${message}</div>`;
            setTimeout(() => status.innerHTML = '', 3000);
        }

        function showDbError(message) {
            const status = document.getElementById('dbExportStatus');
            status.innerHTML = `<div style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; margin: 10px 0;">${message}</div>`;
            setTimeout(() => status.innerHTML = '', 5000);
        }

        // Inicializar estadísticas de la base de datos cuando se carga la pestaña
        document.addEventListener('DOMContentLoaded', function() {
            // Actualizar estadísticas cuando se cambie a la pestaña de base de datos
            const basedatosTab = document.querySelector('button[onclick="showTab(\'basedatos\')"]');
            if (basedatosTab) {
                basedatosTab.addEventListener('click', updateDatabaseStats);
            }
        });

        // === FUNCIONES DE IMPORTAR DATOS ===
        
        // Función para leer archivos Excel/CSV
        function readExcelFile(file, callback) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = e.target.result;
                    const lines = data.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                    const rows = [];
                    
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim()) {
                            const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                            const row = {};
                            headers.forEach((header, index) => {
                                row[header] = values[index] || '';
                            });
                            rows.push(row);
                        }
                    }
                    
                    callback(null, rows);
                } catch (error) {
                    callback(error);
                }
            };
            reader.readAsText(file);
        }

        // Función para mostrar progreso de importación
        function showImportProgress(current, total, type) {
            const progress = Math.round((current / total) * 100);
            const progressElement = document.getElementById('importProgress');
            if (progressElement) {
                progressElement.innerHTML = `
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h5>📊 Progreso de Importación - ${type}</h5>
                        <p>Procesando registro ${current} de ${total}</p>
                        <div style="background: #ddd; height: 20px; border-radius: 10px; overflow: hidden;">
                            <div style="background: #059669; height: 100%; width: ${progress}%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                `;
            }
        }

        // Importar jugadores
        function importPlayers() {
            const fileInput = document.getElementById('importPlayersFile');
            const category = document.getElementById('importPlayerCategory').value;
            
            if (!fileInput.files[0]) {
                alert('❌ Por favor, selecciona un archivo Excel');
                return;
            }
            
            if (!category) {
                alert('❌ Por favor, selecciona una categoría de destino');
                return;
            }
            
            readExcelFile(fileInput.files[0], function(error, data) {
                if (error) {
                    alert('❌ Error leyendo el archivo: ' + error.message);
                    return;
                }
                
                if (data.length === 0) {
                    alert('❌ El archivo no contiene datos válidos');
                    return;
                }
                
                try {
                    const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                    let importedCount = 0;
                    let skippedCount = 0;
                    
                    // Mostrar progreso
                    const progressElement = document.getElementById('importProgress');
                    if (progressElement) {
                        progressElement.style.display = 'block';
                    }
                    
                    data.forEach((row, index) => {
                        // Mostrar progreso cada 10 registros
                        if (index % 10 === 0) {
                            showImportProgress(index + 1, data.length, 'jugadores');
                        }
                        
                        // Validar datos obligatorios
                        if (!row.Nombre || !row.Apellidos || !row.DNI || !row.Teléfono) {
                            skippedCount++;
                            return;
                        }
                        
                        // Verificar si ya existe un jugador con ese DNI
                        const existingPlayer = players.find(p => p.dni === row.DNI);
                        if (existingPlayer) {
                            skippedCount++;
                            return;
                        }
                        
                        // Crear nuevo jugador
                        const newPlayer = {
                            id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                            name: row.Nombre,
                            surname: row.Apellidos,
                            dni: row.DNI,
                            phone: row.Teléfono,
                            address: row.Dirección || '',
                            age: parseInt(row.Edad) || 0,
                            birthDate: row['Fecha de Nacimiento'] || '',
                            category: category,
                            dorsal: parseInt(row.Dorsal) || 0,
                            guardianName: row['Nombre del Padre/Madre'] || '',
                            guardianDNI: row['DNI del Padre/Madre'] || '',
                            guardianPhone: row['Teléfono del Padre/Madre'] || '',
                            guardianEmail: row['Email del Padre/Madre'] || '',
                            registrationDate: new Date().toISOString(),
                            status: 'activo'
                        };
                        
                        players.push(newPlayer);
                        importedCount++;
                    });
                    
                    // Ocultar progreso al finalizar
                    if (progressElement) {
                        progressElement.style.display = 'none';
                    }
                    
                    localStorage.setItem('clubPlayers', JSON.stringify(players));
                    addToImportHistory('jugadores', importedCount, skippedCount);
                    
                    alert(`✅ Importación completada\n\n📊 ${importedCount} jugadores importados\n❌ ${skippedCount} registros omitidos\n📁 Categoría: ${category}`);
                    
                    // Limpiar formulario
                    fileInput.value = '';
                    document.getElementById('importPlayerCategory').value = '';
                    
                } catch (error) {
                    console.error('❌ Error importando jugadores:', error);
                    alert('❌ Error al importar jugadores. Inténtalo de nuevo.');
                }
            });
        }

        // Importar socios
        function importMembers() {
            const fileInput = document.getElementById('importMembersFile');
            
            if (!fileInput.files[0]) {
                alert('❌ Por favor, selecciona un archivo Excel');
                return;
            }
            
            readExcelFile(fileInput.files[0], function(error, data) {
                if (error) {
                    alert('❌ Error leyendo el archivo: ' + error.message);
                    return;
                }
                
                if (data.length === 0) {
                    alert('❌ El archivo no contiene datos válidos');
                    return;
                }
                
                try {
                    const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                    let importedCount = 0;
                    let skippedCount = 0;
                    
                    data.forEach(row => {
                        // Validar datos obligatorios
                        if (!row.Nombre || !row.Apellidos || !row.Teléfono) {
                            skippedCount++;
                            return;
                        }
                        
                        // Verificar si ya existe un socio con ese teléfono o email
                        const existingMember = members.find(m => 
                            m.telefono === row.Teléfono || 
                            (row.Email && m.email === row.Email)
                        );
                        if (existingMember) {
                            skippedCount++;
                            return;
                        }
                        
                        // Crear nuevo socio
                        const newMember = {
                            id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                            nombre: row.Nombre,
                            apellidos: row.Apellidos,
                            dni: row.DNI || '',
                            direccion: row.Dirección || '',
                            telefono: row.Teléfono,
                            email: row.Email || '',
                            fechaNacimiento: row['Fecha de Nacimiento'] || '',
                            cuota: parseFloat(row.Cuota) || 20,
                            fechaRegistro: new Date().toISOString(),
                            fechaVencimiento: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                            estado: 'pendiente',
                            pagado: false,
                            numeroSocio: generarNumeroSocio()
                        };
                        
                        members.push(newMember);
                        importedCount++;
                    });
                    
                    localStorage.setItem('clubMembers', JSON.stringify(members));
                    addToImportHistory('socios', importedCount, skippedCount);
                    
                    alert(`✅ Importación completada\n\n📊 ${importedCount} socios importados\n❌ ${skippedCount} registros omitidos`);
                    
                    // Limpiar formulario
                    fileInput.value = '';
                    
                } catch (error) {
                    console.error('❌ Error importando socios:', error);
                    alert('❌ Error al importar socios. Inténtalo de nuevo.');
                }
            });
        }

        // Importar amigos
        function importFriends() {
            const fileInput = document.getElementById('importFriendsFile');
            
            if (!fileInput.files[0]) {
                alert('❌ Por favor, selecciona un archivo Excel');
                return;
            }
            
            readExcelFile(fileInput.files[0], function(error, data) {
                if (error) {
                    alert('❌ Error leyendo el archivo: ' + error.message);
                    return;
                }
                
                if (data.length === 0) {
                    alert('❌ El archivo no contiene datos válidos');
                    return;
                }
                
                try {
                    const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                    let importedCount = 0;
                    let skippedCount = 0;
                    
                    data.forEach(row => {
                        // Validar datos obligatorios
                        if (!row.Nombre || !row.Apellidos || !row.Teléfono) {
                            skippedCount++;
                            return;
                        }
                        
                        // Verificar si ya existe un amigo con ese teléfono o email
                        const existingFriend = friends.find(f => 
                            f.telefono === row.Teléfono || 
                            (row.Email && f.email === row.Email)
                        );
                        if (existingFriend) {
                            skippedCount++;
                            return;
                        }
                        
                        // Crear nuevo amigo
                        const newFriend = {
                            id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                            name: row.Nombre,
                            surname: row.Apellidos,
                            dni: row.DNI || '',
                            telefono: row.Teléfono,
                            email: row.Email || '',
                            registrationDate: new Date().toISOString(),
                            status: 'activo'
                        };
                        
                        friends.push(newFriend);
                        importedCount++;
                    });
                    
                    localStorage.setItem('clubFriends', JSON.stringify(friends));
                    addToImportHistory('amigos', importedCount, skippedCount);
                    
                    alert(`✅ Importación completada\n\n📊 ${importedCount} amigos importados\n❌ ${skippedCount} registros omitidos`);
                    
                    // Limpiar formulario
                    fileInput.value = '';
                    
                } catch (error) {
                    console.error('❌ Error importando amigos:', error);
                    alert('❌ Error al importar amigos. Inténtalo de nuevo.');
                }
            });
        }

        // Importar entrenadores
        function importCoaches() {
            const fileInput = document.getElementById('importCoachesFile');
            
            if (!fileInput.files[0]) {
                alert('❌ Por favor, selecciona un archivo Excel');
                return;
            }
            
            readExcelFile(fileInput.files[0], function(error, data) {
                if (error) {
                    alert('❌ Error leyendo el archivo: ' + error.message);
                    return;
                }
                
                if (data.length === 0) {
                    alert('❌ El archivo no contiene datos válidos');
                    return;
                }
                
                try {
                    const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                    let importedCount = 0;
                    let skippedCount = 0;
                    
                    data.forEach(row => {
                        // Validar datos obligatorios
                        if (!row.Nombre || !row.Apellidos || !row.Teléfono) {
                            skippedCount++;
                            return;
                        }
                        
                        // Verificar si ya existe un entrenador con ese teléfono o email
                        const existingCoach = coaches.find(c => 
                            c.phone === row.Teléfono || 
                            (row.Email && c.email === row.Email)
                        );
                        if (existingCoach) {
                            skippedCount++;
                            return;
                        }
                        
                        // Crear nuevo entrenador
                        const newCoach = {
                            id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                            name: row.Nombre,
                            surname: row.Apellidos,
                            dni: row.DNI || '',
                            phone: row.Teléfono,
                            email: row.Email || '',
                            team: row['Equipo Asignado'] || '',
                            license: row.Licencia || '',
                            experience: parseInt(row.Experiencia) || 0,
                            registrationDate: new Date().toISOString(),
                            status: 'activo',
                            accessCount: 0,
                            lastAccess: null
                        };
                        
                        coaches.push(newCoach);
                        importedCount++;
                    });
                    
                    localStorage.setItem('clubCoaches', JSON.stringify(coaches));
                    addToImportHistory('entrenadores', importedCount, skippedCount);
                    
                    alert(`✅ Importación completada\n\n📊 ${importedCount} entrenadores importados\n❌ ${skippedCount} registros omitidos`);
                    
                    // Limpiar formulario
                    fileInput.value = '';
                    
                } catch (error) {
                    console.error('❌ Error importando entrenadores:', error);
                    alert('❌ Error al importar entrenadores. Inténtalo de nuevo.');
                }
            });
        }

        // Descargar plantillas
        function downloadTemplate(type) {
            let headers = [];
            let filename = '';
            
            switch(type) {
                case 'jugadores':
                    headers = ['Nombre', 'Apellidos', 'DNI', 'Teléfono', 'Dirección', 'Edad', 'Fecha de Nacimiento', 'Categoría', 'Dorsal', 'Nombre del Padre/Madre', 'DNI del Padre/Madre', 'Teléfono del Padre/Madre', 'Email del Padre/Madre'];
                    filename = 'plantilla_jugadores.csv';
                    break;
                case 'socios':
                    headers = ['Nombre', 'Apellidos', 'DNI', 'Dirección', 'Teléfono', 'Email', 'Fecha de Nacimiento', 'Cuota'];
                    filename = 'plantilla_socios.csv';
                    break;
                case 'amigos':
                    headers = ['Nombre', 'Apellidos', 'DNI', 'Teléfono', 'Email'];
                    filename = 'plantilla_amigos.csv';
                    break;
                case 'entrenadores':
                    headers = ['Nombre', 'Apellidos', 'DNI', 'Teléfono', 'Email', 'Equipo Asignado', 'Licencia', 'Experiencia'];
                    filename = 'plantilla_entrenadores.csv';
                    break;
            }
            
            const csvContent = headers.join(',') + '\n';
            downloadCSV(csvContent, filename);
            alert(`✅ Plantilla descargada: ${filename}`);
        }

        // Agregar al historial de importaciones
        function addToImportHistory(type, importedCount, skippedCount) {
            try {
                const history = JSON.parse(localStorage.getItem('importHistory') || '[]');
                const newEntry = {
                    id: Date.now().toString(),
                    type: type,
                    importedCount: importedCount,
                    skippedCount: skippedCount,
                    date: new Date().toISOString(),
                    timestamp: Date.now()
                };
                
                history.unshift(newEntry);
                
                // Mantener solo los últimos 10 registros
                if (history.length > 10) {
                    history.splice(10);
                }
                
                localStorage.setItem('importHistory', JSON.stringify(history));
                updateImportHistoryDisplay();
                
            } catch (error) {
                console.error('Error guardando historial de importación:', error);
            }
        }

        // Actualizar display del historial
        function updateImportHistoryDisplay() {
            try {
                const history = JSON.parse(localStorage.getItem('importHistory') || '[]');
                const container = document.getElementById('importHistory');
                
                if (history.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay importaciones recientes</p>';
                    return;
                }
                
                let html = '';
                history.forEach(entry => {
                    const date = new Date(entry.date).toLocaleString('es-ES');
                    const typeNames = {
                        'jugadores': 'Jugadores',
                        'socios': 'Socios',
                        'amigos': 'Amigos',
                        'entrenadores': 'Entrenadores'
                    };
                    
                    html += `
                        <div style="border-bottom: 1px solid #dee2e6; padding: 10px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${typeNames[entry.type] || entry.type}</strong>
                                    <br>
                                    <small style="color: #6c757d;">${date}</small>
                                </div>
                                <div style="text-align: right;">
                                    <span style="color: #059669;">✅ ${entry.importedCount}</span>
                                    <br>
                                    <span style="color: #dc2626;">❌ ${entry.skippedCount}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error actualizando historial de importación:', error);
            }
        }

        // Función para generar número de socio
        function generarNumeroSocio() {
            const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
            const maxNumber = Math.max(...members.map(m => m.numeroSocio || 0), 0);
            return maxNumber + 1;
        }

        // Función para descargar CSV
        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // === FUNCIONES PARA GESTIÓN DE ENCUENTROS ===
        
        // Mostrar formulario de nuevo encuentro
        function showAddEncuentroForm() {
            document.getElementById('addEncuentroForm').style.display = 'block';
            // Establecer fecha actual por defecto
            document.getElementById('encuentroFecha').value = new Date().toISOString().split('T')[0];
        }

        // Cancelar formulario de encuentro
        function cancelAddEncuentro() {
            document.getElementById('addEncuentroForm').style.display = 'none';
            document.getElementById('addEncuentroForm').reset();
        }

        // Guardar nuevo encuentro
        function saveEncuentro() {
            const equipoLocal = document.getElementById('encuentroEquipoLocal').value.trim();
            const equipoVisitante = document.getElementById('encuentroEquipoVisitante').value.trim();
            const categoria = document.getElementById('encuentroCategoria').value;
            const tipo = document.getElementById('encuentroTipo').value;
            const fecha = document.getElementById('encuentroFecha').value;
            const hora = document.getElementById('encuentroHora').value;
            const campo = document.getElementById('encuentroCampo').value.trim();
            const estado = document.getElementById('encuentroEstado').value;
            const descripcion = document.getElementById('encuentroDescripcion').value.trim();
            const golesLocal = document.getElementById('encuentroGolesLocal').value;
            const golesVisitante = document.getElementById('encuentroGolesVisitante').value;

            if (!equipoLocal || !equipoVisitante || !categoria || !tipo || !fecha || !hora || !campo) {
                alert('❌ Por favor, completa todos los campos obligatorios');
                return;
            }

            // Crear nuevo encuentro
            const nuevoEncuentro = {
                id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                equipoLocal: equipoLocal,
                equipoVisitante: equipoVisitante,
                categoria: categoria,
                tipo: tipo,
                fecha: fecha,
                hora: hora,
                campo: campo,
                estado: estado,
                descripcion: descripcion,
                golesLocal: golesLocal ? parseInt(golesLocal) : null,
                golesVisitante: golesVisitante ? parseInt(golesVisitante) : null,
                fechaCreacion: new Date().toISOString(),
                creadoPor: JSON.parse(localStorage.getItem('currentAdmin') || '{}').email || 'admin'
            };

            // Guardar en localStorage
            const encuentros = JSON.parse(localStorage.getItem('encuentros') || '[]');
            encuentros.push(nuevoEncuentro);
            localStorage.setItem('encuentros', JSON.stringify(encuentros));

            // Cerrar formulario y mostrar confirmación
            cancelAddEncuentro();
            alert(`✅ Encuentro creado exitosamente\n\n${equipoLocal} vs ${equipoVisitante}\n📅 ${fecha} a las ${hora}\n🏟️ ${campo}`);

            // Actualizar lista y estadísticas
            loadEncuentrosList();
            updateEncuentrosStats();

            console.log('⚽ Nuevo encuentro creado:', nuevoEncuentro);
        }

        // Cargar lista de encuentros
        function loadEncuentrosList() {
            try {
                const encuentros = JSON.parse(localStorage.getItem('encuentros') || '[]');
                const container = document.getElementById('encuentrosList');
                
                if (encuentros.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay encuentros registrados</p>';
                    return;
                }

                // Ordenar por fecha
                const encuentrosOrdenados = encuentros.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));

                let html = '';
                encuentrosOrdenados.forEach(encuentro => {
                    const fechaFormateada = new Date(encuentro.fecha).toLocaleDateString('es-ES', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    const estadoColor = {
                        'programado': '#3b82f6',
                        'en_curso': '#f59e0b',
                        'finalizado': '#059669',
                        'cancelado': '#dc2626'
                    };

                    const estadoTexto = {
                        'programado': 'Programado',
                        'en_curso': 'En Curso',
                        'finalizado': 'Finalizado',
                        'cancelado': 'Cancelado'
                    };

                    const resultado = encuentro.golesLocal !== null && encuentro.golesVisitante !== null 
                        ? `${encuentro.golesLocal} - ${encuentro.golesVisitante}`
                        : 'Sin resultado';

                    html += `
                        <div style="border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: white;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: var(--primary-color);">${encuentro.equipoLocal} vs ${encuentro.equipoVisitante}</h4>
                                <span style="background: ${estadoColor[encuentro.estado]}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                                    ${estadoTexto[encuentro.estado]}
                                </span>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 10px;">
                                <div><strong>📅 Fecha:</strong> ${fechaFormateada}</div>
                                <div><strong>🕐 Hora:</strong> ${encuentro.hora}</div>
                                <div><strong>🏟️ Campo:</strong> ${encuentro.campo}</div>
                                <div><strong>⚽ Categoría:</strong> ${encuentro.categoria}</div>
                                <div><strong>🏆 Tipo:</strong> ${encuentro.tipo}</div>
                                <div><strong>📊 Resultado:</strong> ${resultado}</div>
                            </div>
                            ${encuentro.descripcion ? `<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e5e7eb; color: #6b7280;"><strong>📝 Notas:</strong> ${encuentro.descripcion}</div>` : ''}
                            <div style="margin-top: 10px; text-align: right;">
                                <button onclick="editEncuentro('${encuentro.id}')" class="btn-small" style="background: #3b82f6; color: white; border: none; padding: 5px 10px; border-radius: 4px; margin-right: 5px; cursor: pointer;">✏️ Editar</button>
                                <button onclick="deleteEncuentro('${encuentro.id}')" class="btn-small" style="background: #dc2626; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">🗑️ Eliminar</button>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            } catch (error) {
                console.error('Error cargando encuentros:', error);
                document.getElementById('encuentrosList').innerHTML = '<p style="text-align: center; color: #dc2626;">Error al cargar los encuentros</p>';
            }
        }

        // Actualizar estadísticas de encuentros
        function updateEncuentrosStats() {
            try {
                const encuentros = JSON.parse(localStorage.getItem('encuentros') || '[]');
                
                const total = encuentros.length;
                const programados = encuentros.filter(e => e.estado === 'programado').length;
                const finalizados = encuentros.filter(e => e.estado === 'finalizado').length;
                const cancelados = encuentros.filter(e => e.estado === 'cancelado').length;

                document.getElementById('totalEncuentrosCount').textContent = total;
                document.getElementById('programadosEncuentrosCount').textContent = programados;
                document.getElementById('finalizadosEncuentrosCount').textContent = finalizados;
                document.getElementById('canceladosEncuentrosCount').textContent = cancelados;
            } catch (error) {
                console.error('Error actualizando estadísticas de encuentros:', error);
            }
        }

        // Filtrar encuentros
        function filterEncuentros() {
            // Implementar filtrado si es necesario
            loadEncuentrosList();
        }

        // Editar encuentro
        function editEncuentro(encuentroId) {
            alert('✏️ Función de edición en desarrollo');
        }

        // Eliminar encuentro
        function deleteEncuentro(encuentroId) {
            if (!confirm('¿Estás seguro de que quieres eliminar este encuentro?')) {
                return;
            }

            try {
                const encuentros = JSON.parse(localStorage.getItem('encuentros') || '[]');
                const encuentrosActualizados = encuentros.filter(e => e.id !== encuentroId);
                localStorage.setItem('encuentros', JSON.stringify(encuentrosActualizados));
                
                alert('✅ Encuentro eliminado correctamente');
                loadEncuentrosList();
                updateEncuentrosStats();
            } catch (error) {
                console.error('Error eliminando encuentro:', error);
                alert('❌ Error al eliminar el encuentro');
            }
        }

        // Cargar encuentros al cargar la pestaña
        document.addEventListener('DOMContentLoaded', function() {
            // Añadir listener para la pestaña de encuentros
            const encuentrosTab = document.querySelector('button[onclick="showTab(\'encuentros\')"]');
            if (encuentrosTab) {
                encuentrosTab.addEventListener('click', function() {
                    setTimeout(() => {
                        loadEncuentrosList();
                        updateEncuentrosStats();
                    }, 100);
                });
            }
        });

        // ===== FUNCIONES PARA GESTIÓN DE DOCUMENTOS =====
        
        function showAddDocumentForm() {
            document.getElementById('addDocumentForm').style.display = 'block';
            document.getElementById('addDocumentForm').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelAddDocument() {
            document.getElementById('addDocumentForm').style.display = 'none';
            clearDocumentForm();
        }

        function clearDocumentForm() {
            const form = document.getElementById('addDocumentForm');
            const inputs = form.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type === 'file') {
                    input.value = '';
                } else {
                    input.value = '';
                }
            });
        }

        function saveDocument() {
            try {
                const name = document.getElementById('documentName').value.trim();
                const category = document.getElementById('documentCategory').value;
                const description = document.getElementById('documentDescription').value.trim();
                const status = document.getElementById('documentStatus').value;
                const visibility = document.getElementById('documentVisibility').value;
                const file = document.getElementById('documentFile').files[0];

                if (!name || !category || !file) {
                    alert('❌ Por favor, completa todos los campos obligatorios');
                    return;
                }

                if (file.size > 10 * 1024 * 1024) { // 10MB
                    alert('❌ El archivo es demasiado grande. Máximo 10MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const newDocument = {
                        id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                        name: name,
                        category: category,
                        description: description,
                        status: status,
                        visibility: visibility,
                        data: e.target.result,
                        fileName: file.name,
                        fileSize: file.size,
                        uploadDate: new Date().toISOString(),
                        downloads: 0,
                        uploadedBy: JSON.parse(localStorage.getItem('currentAdmin') || '{}').email || 'admin'
                    };

                    // Guardar en localStorage
                    const documents = JSON.parse(localStorage.getItem('clubDocuments') || '[]');
                    documents.push(newDocument);
                    localStorage.setItem('clubDocuments', JSON.stringify(documents));

                    // Cerrar formulario y mostrar confirmación
                    cancelAddDocument();
                    alert(`✅ Documento subido exitosamente\n\n📄 ${name}\n📁 Categoría: ${category}\n📊 Estado: ${status === 'active' ? 'Activo' : 'Inactivo'}`);

                    // Actualizar listas y contadores
                    loadDocumentsList();
                    updateDocumentCounts();

                    console.log('📄 Nuevo documento subido:', newDocument);
                };
                reader.readAsDataURL(file);

            } catch (error) {
                console.error('❌ Error guardando documento:', error);
                alert('❌ Error al guardar el documento. Inténtalo de nuevo.');
            }
        }

        function loadDocumentsList() {
            try {
                const documents = JSON.parse(localStorage.getItem('clubDocuments') || '[]');
                const filter = document.getElementById('documentStatusFilter').value;
                
                let filteredDocuments = documents;
                if (filter !== 'all') {
                    filteredDocuments = documents.filter(d => d.status === filter);
                }

                const documentsListElement = document.getElementById('documentsList');
                
                if (filteredDocuments.length === 0) {
                    documentsListElement.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay documentos registrados</p>';
                    return;
                }

                let html = '<div style="display: grid; gap: 15px;">';
                
                filteredDocuments.forEach(doc => {
                    const statusColor = doc.status === 'active' ? '#059669' : '#6c757d';
                    const statusText = doc.status === 'active' ? 'Activo' : 'Inactivo';
                    const visibilityText = {
                        'public': 'Público',
                        'socios': 'Solo Socios',
                        'admin': 'Solo Administradores'
                    };

                    html += `
                        <div style="border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; background: white;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <div style="flex: 1;">
                                    <h4 style="margin: 0; color: #1e3a8a;">📄 ${doc.name}</h4>
                                    <p style="margin: 5px 0; color: #666; font-weight: bold;">📁 ${doc.category}</p>
                                    ${doc.description ? `<p style="margin: 5px 0; color: #666;">${doc.description}</p>` : ''}
                                </div>
                                <div style="text-align: right; margin-left: 15px;">
                                    <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">${statusText}</span>
                                    <br>
                                    <span style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; margin-top: 5px; display: inline-block;">${visibilityText[doc.visibility]}</span>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; font-size: 0.9rem;">
                                <div><strong>📅 Subido:</strong> ${new Date(doc.uploadDate).toLocaleDateString()}</div>
                                <div><strong>📊 Descargas:</strong> ${doc.downloads}</div>
                                <div><strong>📏 Tamaño:</strong> ${(doc.fileSize / 1024 / 1024).toFixed(2)} MB</div>
                                <div><strong>👤 Por:</strong> ${doc.uploadedBy}</div>
                            </div>
                            
                            <div style="margin-top: 15px;">
                                <button onclick="downloadDocument('${doc.id}')" class="btn-small" style="background: #059669; color: white; border: none; padding: 5px 10px; border-radius: 4px; margin-right: 5px; cursor: pointer;">📥 Descargar</button>
                                <button onclick="editDocument('${doc.id}')" class="btn-small" style="background: #3b82f6; color: white; border: none; padding: 5px 10px; border-radius: 4px; margin-right: 5px; cursor: pointer;">✏️ Editar</button>
                                <button onclick="deleteDocument('${doc.id}')" class="btn-small" style="background: #dc2626; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">🗑️ Eliminar</button>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                documentsListElement.innerHTML = html;

                console.log('📄 Lista de documentos cargada:', filteredDocuments.length, 'documentos');
            } catch (error) {
                console.error('❌ Error cargando lista de documentos:', error);
            }
        }

        function updateDocumentCounts() {
            try {
                const documents = JSON.parse(localStorage.getItem('clubDocuments') || '[]');
                
                const activeCount = documents.filter(d => d.status === 'active').length;
                const totalCount = documents.length;
                const publicCount = documents.filter(d => d.visibility === 'public').length;
                const totalDownloads = documents.reduce((sum, d) => sum + (d.downloads || 0), 0);
                
                // Actualizar contadores en la interfaz
                const activeElement = document.getElementById('activeDocumentsCount');
                const totalElement = document.getElementById('totalDocumentsCount');
                const publicElement = document.getElementById('publicDocumentsCount');
                const downloadsElement = document.getElementById('totalDownloadsCount');
                
                if (activeElement) activeElement.textContent = activeCount;
                if (totalElement) totalElement.textContent = totalCount;
                if (publicElement) publicElement.textContent = publicCount;
                if (downloadsElement) downloadsElement.textContent = totalDownloads;
                
                console.log('📊 Contadores de documentos actualizados:', { activeCount, totalCount, publicCount, totalDownloads });
                
            } catch (error) {
                console.error('❌ Error actualizando contadores de documentos:', error);
            }
        }

        function filterDocuments() {
            loadDocumentsList();
        }

        function downloadDocument(docId) {
            try {
                const documents = JSON.parse(localStorage.getItem('clubDocuments') || '[]');
                const doc = documents.find(d => d.id === docId);
                
                if (!doc) {
                    alert('❌ Documento no encontrado');
                    return;
                }

                // Incrementar contador de descargas
                doc.downloads = (doc.downloads || 0) + 1;
                localStorage.setItem('clubDocuments', JSON.stringify(documents));

                // Crear enlace de descarga
                const link = document.createElement('a');
                link.href = doc.data;
                link.download = doc.fileName;
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // Actualizar contadores
                updateDocumentCounts();

                console.log('📥 Documento descargado:', doc.name);
            } catch (error) {
                console.error('❌ Error descargando documento:', error);
                alert('❌ Error al descargar el documento');
            }
        }

        function editDocument(docId) {
            alert('🔧 Función de edición en desarrollo. ID: ' + docId);
        }

        function deleteDocument(docId) {
            try {
                if (confirm('❌ ¿Estás seguro de que quieres eliminar este documento?\n\nEsta acción no se puede deshacer.')) {
                    const documents = JSON.parse(localStorage.getItem('clubDocuments') || '[]');
                    const filteredDocs = documents.filter(d => d.id !== docId);
                    
                    localStorage.setItem('clubDocuments', JSON.stringify(filteredDocs));
                    
                    alert('✅ Documento eliminado exitosamente');
                    
                    loadDocumentsList();
                    updateDocumentCounts();
                }
            } catch (error) {
                console.error('❌ Error eliminando documento:', error);
                alert('❌ Error al eliminar el documento');
            }
        }

        // ===== FUNCIONES PARA GESTIÓN DE PUBLICIDAD =====
        
        function showAddPublicidadForm() {
            document.getElementById('addPublicidadForm').style.display = 'block';
            document.getElementById('addPublicidadForm').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelAddPublicidad() {
            document.getElementById('addPublicidadForm').style.display = 'none';
            clearPublicidadForm();
        }

        function clearPublicidadForm() {
            const form = document.getElementById('addPublicidadForm');
            const inputs = form.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type === 'file') {
                    input.value = '';
                } else {
                    input.value = '';
                }
            });
        }

        function savePublicidad() {
            try {
                const titulo = document.getElementById('publicidadTitulo').value.trim();
                const tipo = document.getElementById('publicidadTipo').value;
                const descripcion = document.getElementById('publicidadDescripcion').value.trim();
                const estado = document.getElementById('publicidadEstado').value;
                const prioridad = document.getElementById('publicidadPrioridad').value;
                const visualizacion = document.getElementById('publicidadVisualizacion').value;
                const fechaInicio = document.getElementById('publicidadFechaInicio').value;
                const fechaFin = document.getElementById('publicidadFechaFin').value;
                const enlace = document.getElementById('publicidadEnlace').value.trim();
                const imagen = document.getElementById('publicidadImagen').files[0];

                if (!titulo || !tipo || !descripcion) {
                    alert('❌ Por favor, completa todos los campos obligatorios');
                    return;
                }

                if (imagen && imagen.size > 5 * 1024 * 1024) { // 5MB
                    alert('❌ La imagen es demasiado grande. Máximo 5MB');
                    return;
                }

                const newPublicidad = {
                    id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                    titulo: titulo,
                    tipo: tipo,
                    descripcion: descripcion,
                    estado: estado,
                    prioridad: parseInt(prioridad),
                    visualizacion: visualizacion,
                    fechaInicio: fechaInicio,
                    fechaFin: fechaFin,
                    enlace: enlace,
                    imagen: null,
                    fileName: imagen ? imagen.name : null,
                    fileSize: imagen ? imagen.size : 0,
                    fechaCreacion: new Date().toISOString(),
                    views: 0,
                    clicks: 0,
                    creadoPor: JSON.parse(localStorage.getItem('currentAdmin') || '{}').email || 'admin'
                };

                // Procesar imagen si existe
                if (imagen) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        newPublicidad.imagen = e.target.result;
                        savePublicidadToStorage(newPublicidad);
                    };
                    reader.readAsDataURL(imagen);
                } else {
                    savePublicidadToStorage(newPublicidad);
                }

            } catch (error) {
                console.error('❌ Error guardando publicidad:', error);
                alert('❌ Error al guardar la publicidad. Inténtalo de nuevo.');
            }
        }

        function savePublicidadToStorage(publicidad) {
            // Guardar en localStorage
            const publicidades = JSON.parse(localStorage.getItem('clubPublicidad') || '[]');
            publicidades.push(publicidad);
            localStorage.setItem('clubPublicidad', JSON.stringify(publicidades));

            // Cerrar formulario y mostrar confirmación
            cancelAddPublicidad();
            alert(`✅ Publicidad creada exitosamente\n\n📢 ${publicidad.titulo}\n📁 Tipo: ${publicidad.tipo}\n📊 Estado: ${publicidad.estado === 'active' ? 'Activa' : 'Inactiva'}`);

            // Actualizar listas y contadores
            loadPublicidadList();
            updatePublicidadCounts();

            console.log('📢 Nueva publicidad creada:', publicidad);
        }

        function loadPublicidadList() {
            try {
                const publicidades = JSON.parse(localStorage.getItem('clubPublicidad') || '[]');
                const filter = document.getElementById('publicidadStatusFilter').value;
                
                let filteredPublicidades = publicidades;
                if (filter !== 'all') {
                    filteredPublicidades = publicidades.filter(p => p.estado === filter);
                }

                const publicidadListElement = document.getElementById('publicidadList');
                
                if (filteredPublicidades.length === 0) {
                    publicidadListElement.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay publicidades registradas</p>';
                    return;
                }

                // Ordenar por prioridad y fecha de creación
                filteredPublicidades.sort((a, b) => {
                    if (b.prioridad !== a.prioridad) {
                        return b.prioridad - a.prioridad;
                    }
                    return new Date(b.fechaCreacion) - new Date(a.fechaCreacion);
                });

                let html = '<div style="display: grid; gap: 15px;">';
                
                filteredPublicidades.forEach(pub => {
                    const estadoColor = pub.estado === 'active' ? '#059669' : '#6c757d';
                    const estadoTexto = pub.estado === 'active' ? 'Activa' : 'Inactiva';
                    const prioridadColor = {
                        1: '#6c757d',
                        2: '#f59e0b',
                        3: '#dc2626'
                    };
                    const prioridadTexto = {
                        1: 'Baja',
                        2: 'Media',
                        3: 'Alta'
                    };

                    const tipoTexto = {
                        'evento': 'Evento',
                        'equipamiento': 'Equipamiento',
                        'patrocinador': 'Patrocinador',
                        'noticia': 'Noticia',
                        'promocion': 'Promoción',
                        'otros': 'Otros'
                    };

                    html += `
                        <div style="border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; background: white;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <div style="flex: 1;">
                                    <h4 style="margin: 0; color: #1e3a8a;">📢 ${pub.titulo}</h4>
                                    <p style="margin: 5px 0; color: #666; font-weight: bold;">📁 ${tipoTexto[pub.tipo] || pub.tipo}</p>
                                    <p style="margin: 5px 0; color: #666;">${pub.descripcion}</p>
                                </div>
                                <div style="text-align: right; margin-left: 15px;">
                                    <span style="background: ${estadoColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">${estadoTexto}</span>
                                    <br>
                                    <span style="background: ${prioridadColor[pub.prioridad]}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; margin-top: 5px; display: inline-block;">${prioridadTexto[pub.prioridad]}</span>
                                </div>
                            </div>
                            
                            ${pub.imagen ? `<div style="margin: 10px 0;"><img src="${pub.imagen}" alt="${pub.titulo}" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid #dee2e6;"></div>` : ''}
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; font-size: 0.9rem;">
                                <div><strong>📅 Creada:</strong> ${new Date(pub.fechaCreacion).toLocaleDateString()}</div>
                                <div><strong>👁️ Visualizaciones:</strong> ${pub.views}</div>
                                <div><strong>🖱️ Clics:</strong> ${pub.clicks}</div>
                                <div><strong>👤 Por:</strong> ${pub.creadoPor}</div>
                                <div><strong>🎨 Visualización:</strong> ${pub.visualizacion || 'Tarjeta'}</div>
                            </div>
                            
                            ${pub.fechaInicio || pub.fechaFin ? `
                                <div style="margin-top: 10px; font-size: 0.9rem;">
                                    ${pub.fechaInicio ? `<div><strong>📅 Inicio:</strong> ${pub.fechaInicio}</div>` : ''}
                                    ${pub.fechaFin ? `<div><strong>📅 Fin:</strong> ${pub.fechaFin}</div>` : ''}
                                </div>
                            ` : ''}
                            
                            <div style="margin-top: 15px;">
                                <button onclick="editPublicidad('${pub.id}')" class="btn-small" style="background: #3b82f6; color: white; border: none; padding: 5px 10px; border-radius: 4px; margin-right: 5px; cursor: pointer;">✏️ Editar</button>
                                <button onclick="deletePublicidad('${pub.id}')" class="btn-small" style="background: #dc2626; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">🗑️ Eliminar</button>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                publicidadListElement.innerHTML = html;

                console.log('📢 Lista de publicidades cargada:', filteredPublicidades.length, 'publicidades');
            } catch (error) {
                console.error('❌ Error cargando lista de publicidades:', error);
            }
        }

        function updatePublicidadCounts() {
            try {
                const publicidades = JSON.parse(localStorage.getItem('clubPublicidad') || '[]');
                
                const activeCount = publicidades.filter(p => p.estado === 'active').length;
                const totalCount = publicidades.length;
                const totalViews = publicidades.reduce((sum, p) => sum + (p.views || 0), 0);
                const totalClicks = publicidades.reduce((sum, p) => sum + (p.clicks || 0), 0);
                
                // Actualizar contadores en la interfaz
                const activeElement = document.getElementById('activePublicidadCount');
                const totalElement = document.getElementById('totalPublicidadCount');
                const viewsElement = document.getElementById('totalViewsCount');
                const clicksElement = document.getElementById('totalClicksCount');
                
                if (activeElement) activeElement.textContent = activeCount;
                if (totalElement) totalElement.textContent = totalCount;
                if (viewsElement) viewsElement.textContent = totalViews;
                if (clicksElement) clicksElement.textContent = totalClicks;
                
                console.log('📊 Contadores de publicidad actualizados:', { activeCount, totalCount, totalViews, totalClicks });
                
            } catch (error) {
                console.error('❌ Error actualizando contadores de publicidad:', error);
            }
        }

        function filterPublicidad() {
            loadPublicidadList();
        }

        function editPublicidad(pubId) {
            alert('🔧 Función de edición en desarrollo. ID: ' + pubId);
        }

        function deletePublicidad(pubId) {
            try {
                if (confirm('❌ ¿Estás seguro de que quieres eliminar esta publicidad?\n\nEsta acción no se puede deshacer.')) {
                    const publicidades = JSON.parse(localStorage.getItem('clubPublicidad') || '[]');
                    const filteredPubs = publicidades.filter(p => p.id !== pubId);
                    
                    localStorage.setItem('clubPublicidad', JSON.stringify(filteredPubs));
                    
                    alert('✅ Publicidad eliminada exitosamente');
                    
                    loadPublicidadList();
                    updatePublicidadCounts();
                }
            } catch (error) {
                console.error('❌ Error eliminando publicidad:', error);
                alert('❌ Error al eliminar la publicidad');
            }
        }

        // ===== NUEVAS FUNCIONES DE GESTIÓN AVANZADA =====

        // Función para mostrar estadísticas de duplicados
        function mostrarEstadisticasDuplicados() {
            try {
                const contadores = obtenerContadoresDuplicados();
                const previewElement = document.getElementById('dbCleanStatus');
                
                if (contadores.length === 0) {
                    previewElement.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 15px;">No hay intentos de duplicados registrados</p>';
                    previewElement.style.display = 'block';
                    return;
                }

                let html = '<h4 style="color: #dc2626; margin-bottom: 15px;">📊 Estadísticas de Duplicados</h4>';
                html += '<div style="max-height: 300px; overflow-y: auto;">';
                
                contadores.forEach(contador => {
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #dc2626;">
                            <div style="font-weight: bold; color: #dc2626;">${contador.nombre}</div>
                            <div style="font-size: 0.9rem; color: #666;">
                                Intentos: ${contador.contador} | Último: ${new Date(contador.ultimoIntento).toLocaleString()}
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                previewElement.innerHTML = html;
                previewElement.style.display = 'block';
                
            } catch (error) {
                console.error('Error mostrando estadísticas de duplicados:', error);
                alert('Error al mostrar estadísticas de duplicados');
            }
        }

        // Función para mostrar notificaciones
        function mostrarNotificaciones() {
            try {
                const notificaciones = obtenerNotificacionesAdmin();
                const previewElement = document.getElementById('dbNotificationsPreview');
                
                if (notificaciones.length === 0) {
                    previewElement.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 15px;">No hay notificaciones pendientes</p>';
                    previewElement.style.display = 'block';
                    return;
                }

                let html = '<h4 style="color: #8b5cf6; margin-bottom: 15px;">🔔 Notificaciones Pendientes</h4>';
                html += '<div style="max-height: 300px; overflow-y: auto;">';
                
                notificaciones.forEach(notif => {
                    const tipoColor = notif.tipo === 'nuevo_socio' ? '#059669' : '#dc2626';
                    const tipoIcono = notif.tipo === 'nuevo_socio' ? '👤' : '🗑️';
                    
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid ${tipoColor};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div style="flex: 1;">
                                    <div style="font-weight: bold; color: ${tipoColor};">
                                        ${tipoIcono} ${notif.titulo}
                                    </div>
                                    <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                                        ${notif.mensaje}
                                    </div>
                                    <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">
                                        ${new Date(notif.fecha).toLocaleString()}
                                    </div>
                                </div>
                                <button onclick="marcarNotificacionLeida(${notif.id})" style="background: #6c757d; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; cursor: pointer;">
                                    ✓
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                previewElement.innerHTML = html;
                previewElement.style.display = 'block';
                
            } catch (error) {
                console.error('Error mostrando notificaciones:', error);
                alert('Error al mostrar notificaciones');
            }
        }

        // Función para limpiar notificaciones
        function limpiarNotificaciones() {
            try {
                if (confirm('¿Estás seguro de que quieres limpiar todas las notificaciones?')) {
                    localStorage.removeItem('notificacionesAdmin');
                    alert('✅ Notificaciones limpiadas correctamente');
                    mostrarNotificaciones();
                }
            } catch (error) {
                console.error('Error limpiando notificaciones:', error);
                alert('Error al limpiar notificaciones');
            }
        }

        // Función para mostrar formulario avanzado de socio
        function mostrarFormularioSocioAvanzado() {
            const previewElement = document.getElementById('dbSociosAvanzadoPreview');
            
            const html = `
                <h4 style="color: #f59e0b; margin-bottom: 15px;">➕ Añadir Socio con Verificación</h4>
                <form id="socioAvanzadoForm" style="display: grid; gap: 10px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" id="socioNombre" placeholder="Nombre *" required style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <input type="text" id="socioApellidos" placeholder="Apellidos *" required style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" id="socioDNI" placeholder="DNI" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <input type="email" id="socioEmail" placeholder="Email *" required style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="tel" id="socioTelefono" placeholder="Teléfono *" required style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <input type="date" id="socioFechaNacimiento" placeholder="Fecha de Nacimiento" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button type="submit" style="background: #059669; color: white; border: none; padding: 10px; border-radius: 4px; cursor: pointer;">✅ Añadir Socio</button>
                        <button type="button" onclick="cancelarFormularioSocio()" style="background: #6c757d; color: white; border: none; padding: 10px; border-radius: 4px; cursor: pointer;">❌ Cancelar</button>
                    </div>
                </form>
            `;
            
            previewElement.innerHTML = html;
            previewElement.style.display = 'block';
            
            // Agregar evento submit al formulario
            document.getElementById('socioAvanzadoForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const datosSocio = {
                    nombre: document.getElementById('socioNombre').value,
                    apellidos: document.getElementById('socioApellidos').value,
                    dni: document.getElementById('socioDNI').value,
                    email: document.getElementById('socioEmail').value,
                    telefono: document.getElementById('socioTelefono').value,
                    fechaNacimiento: document.getElementById('socioFechaNacimiento').value
                };
                
                const resultado = await añadirSocioConVerificacion(datosSocio);
                
                if (resultado.exito) {
                    cancelarFormularioSocio();
                    mostrarEstadisticasDuplicados();
                }
            });
        }

        // Función para cancelar formulario de socio
        function cancelarFormularioSocio() {
            const previewElement = document.getElementById('dbSociosAvanzadoPreview');
            previewElement.style.display = 'none';
        }

        // Función para mostrar lista de socios para eliminar
        function mostrarListaSociosEliminar() {
            try {
                const socios = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                const previewElement = document.getElementById('dbSociosAvanzadoPreview');
                
                if (socios.length === 0) {
                    previewElement.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 15px;">No hay socios registrados</p>';
                    previewElement.style.display = 'block';
                    return;
                }

                let html = '<h4 style="color: #dc2626; margin-bottom: 15px;">🗑️ Eliminar Socio</h4>';
                html += '<div style="max-height: 300px; overflow-y: auto;">';
                
                socios.forEach(socio => {
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #dc2626;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: bold;">${socio.nombre} ${socio.apellidos}</div>
                                    <div style="font-size: 0.9rem; color: #666;">
                                        ${socio.email} | ${socio.telefono}
                                    </div>
                                    <div style="font-size: 0.8rem; color: #888;">
                                        Socio #${socio.numeroSocio || 'N/A'}
                                    </div>
                                </div>
                                <button onclick="eliminarSocioEspecifico('${socio.id}')" style="background: #dc2626; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                    🗑️ Eliminar
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                previewElement.innerHTML = html;
                previewElement.style.display = 'block';
                
            } catch (error) {
                console.error('Error mostrando lista de socios:', error);
                alert('Error al mostrar lista de socios');
            }
        }

        // Función para eliminar socio específico
        async function eliminarSocioEspecifico(idSocio) {
            try {
                const resultado = await eliminarSocio(idSocio);
                if (resultado) {
                    mostrarListaSociosEliminar();
                }
            } catch (error) {
                console.error('Error eliminando socio:', error);
                alert('Error al eliminar socio');
            }
        }

        console.log('🚀 Panel de administración CDSANABRIACF cargado correctamente con nuevas funcionalidades');
    </script>
</body>
</html>
