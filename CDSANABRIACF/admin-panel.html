<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - CDSANABRIACF</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .admin-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .admin-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .admin-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .current-admin {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .logout-btn {
            background: rgba(220,53,69,0.8);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(220,53,69,1);
        }

        .navigation {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: #e9ecef;
            color: #495057;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .nav-tab:hover {
            background: #6c757d;
            color: white;
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .admin-content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border: 2px solid #f0f0f0;
        }

        .dashboard-card h3 {
            color: #1e3a8a;
            margin-bottom: 10px;
        }

        .dashboard-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            background: #fafafa;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #1e3a8a;
            padding-bottom: 10px;
        }

        .btn {
            background: #1e3a8a;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #2563eb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .admin-info {
                flex-direction: column;
                gap: 10px;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }
        /* Estilos para la secci√≥n de administradores */
        .admin-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .admin-table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        .admin-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1.5fr 1fr 1.5fr;
            gap: 10px;
            padding: 10px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .admin-row.header {
            font-weight: bold;
            background: #f8f9fa;
            border-radius: 5px 5px 0 0;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.9rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #e2e8f0;
            margin: 0 5px;
        }

        .btn-small:hover {
            background: #cbd5e1;
        }

        .btn-small.delete {
            background: #fee2e2;
        }

        .btn-small.delete:hover {
            background: #fecaca;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .status-badge.active {
            background: #dcfce7;
            color: #166534;
        }

        .status-badge.inactive {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <h1>‚öΩ Panel de Administraci√≥n</h1>
            <p>CDSANABRIACF - Club Deportivo Sanabriacf</p>
            <div class="admin-info">
                <div class="current-admin" id="currentAdminInfo">
                    üë§ Cargando informaci√≥n del administrador...
                </div>
                <button class="logout-btn" onclick="logout()">üö™ Cerrar Sesi√≥n</button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
                <button class="nav-tab" onclick="showTab('equipos')">‚öΩ Equipos</button>
                <button class="nav-tab" onclick="showTab('jugadores')">üë• Jugadores</button>
                <button class="nav-tab" onclick="showTab('calendario')">üìÖ Calendario</button>
                <button class="nav-tab" onclick="showTab('eventos')">üéâ Eventos</button>
                <button class="nav-tab" onclick="showTab('socios')">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Socios</button>
                        <button class="nav-tab" onclick="showTab('amigos')">ü§ù Amigos del Club</button>
        <button class="nav-tab" onclick="showTab('entrenadores')">üë®‚Äçüè´ Entrenadores</button>
        <button class="nav-tab" onclick="showTab('mensajes')">üì± Mensajes Push</button>
        <button class="nav-tab" onclick="showTab('exportar')">üìä Exportar Datos</button>
        <button class="nav-tab" onclick="showTab('publicidad')">üì¢ Publicidad</button>
        <button class="nav-tab" onclick="showTab('competiciones')">üèÜ Competiciones</button>
        <button class="nav-tab" onclick="showTab('multimedia')">üì∏ Multimedia</button>
        <button class="nav-tab" onclick="showTab('tienda')">üè™ Tienda</button>
        <button class="nav-tab" onclick="showTab('configuracion')">‚öôÔ∏è Configuraci√≥n</button>
            </div>
        </div>

        <!-- Content -->
        <div class="admin-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="success-message">
                    ‚úÖ Autenticaci√≥n exitosa. Bienvenido al panel de administraci√≥n de CDSANABRIACF
                </div>
                
                <h2>üìä Panel de Control</h2>
                
                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <h3>‚öΩ Equipos Activos</h3>
                        <div class="number">5</div>
                        <p>Categor√≠as registradas</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>üë• Jugadores</h3>
                        <div class="number" id="playersCount">0</div>
                        <p>Jugadores registrados</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Socios</h3>
                        <div class="number" id="membersCount">0</div>
                        <p>Socios del club</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>üéâ Eventos</h3>
                        <div class="number" id="eventsCount">0</div>
                        <p>Eventos programados</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>üèÜ Competiciones</h3>
                        <div class="number" id="competitionsCount">0</div>
                        <p>Competiciones activas</p>
                    </div>
                </div>

                            <div class="section" data-team="all">
                <h2>üìà Resumen del Club</h2>
                    <p><strong>üéØ Sistema completamente funcional</strong></p>
                    <p>Desde este panel puedes gestionar todos los aspectos del club CDSANABRIACF:</p>
                    <ul style="margin: 20px 0; padding-left: 30px;">
                        <li><strong>‚öΩ Equipos:</strong> Gestiona las 5 categor√≠as (Prebenjam√≠n, Benjam√≠n, Alev√≠n, Infantil, Aficionado)</li>
                        <li><strong>üë• Jugadores:</strong> Administra fichas de jugadores con datos personales y de contacto</li>
                        <li><strong>üìÖ Calendario:</strong> Programa entrenamientos y partidos</li>
                        <li><strong>üéâ Eventos:</strong> Organiza actividades y eventos especiales</li>
                        <li><strong>üèÜ Competiciones:</strong> Crea y gestiona ligas, torneos y campeonatos</li>
                        <li><strong>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Socios:</strong> Administra la base de socios del club</li>
                        <li><strong>üì∏ Multimedia:</strong> Gestiona fotos y videos del club</li>
                    </ul>
                    
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <h4>üîê Sistema de Acceso Seguro:</h4>
                        <p><strong>‚úÖ Panel de administraci√≥n configurado y funcional</strong></p>
                        <p><strong>üîí Acceso restringido a administradores autorizados</strong></p>
                    </div>
                </div>
            </div>

            <!-- Equipos Tab -->
            <div id="equipos" class="tab-content">
                <h2>‚öΩ Gesti√≥n de Equipos</h2>
                
                <div class="section">
                    <h3>Categor√≠as del Club CDSANABRIACF</h3>
                    <div class="dashboard-cards">
                        <div class="dashboard-card">
                            <h4>Prebenjam√≠n</h4>
                            <p>Edad: 6-8 a√±os</p>
                            <div class="number" id="prebenajminCount">0</div>
                            <p>jugadores</p>
                            <button class="btn" onclick="manageCategoryPlayers('prebenajmin')">Gestionar</button>
                        </div>
                        <div class="dashboard-card">
                            <h4>Benjam√≠n</h4>
                            <p>Edad: 8-10 a√±os</p>
                            <div class="number" id="benjaminCount">0</div>
                            <p>jugadores</p>
                            <button class="btn" onclick="manageCategoryPlayers('benjamin')">Gestionar</button>
                        </div>
                        <div class="dashboard-card">
                            <h4>Alev√≠n</h4>
                            <p>Edad: 10-12 a√±os</p>
                            <div class="number" id="alevinCount">0</div>
                            <p>jugadores</p>
                            <button class="btn" onclick="manageCategoryPlayers('alevin')">Gestionar</button>
                        </div>
                        <div class="dashboard-card">
                            <h4>Infantil</h4>
                            <p>Edad: 12-14 a√±os</p>
                            <div class="number" id="infantilCount">0</div>
                            <p>jugadores</p>
                            <button class="btn" onclick="manageCategoryPlayers('infantil')">Gestionar</button>
                        </div>
                        <div class="dashboard-card">
                            <h4>Aficionado</h4>
                            <p>Edad: 18+ a√±os</p>
                            <div class="number" id="aficionadoCount">0</div>
                            <p>jugadores</p>
                            <button class="btn" onclick="manageCategoryPlayers('aficionado')">Gestionar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Otras pesta√±as -->
            <div id="jugadores" class="tab-content">
                <h2>üë• Gesti√≥n de Jugadores</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar por Categor√≠a</h3>
                            <select id="categoryFilter" onchange="filterPlayersByCategory()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todas las Categor√≠as</option>
                                <option value="prebenajmin">Prebenjam√≠n (6-8 a√±os)</option>
                                <option value="benjamin">Benjam√≠n (8-10 a√±os)</option>
                                <option value="alevin">Alev√≠n (10-12 a√±os)</option>
                                <option value="infantil">Infantil (12-14 a√±os)</option>
                                <option value="aficionado">Aficionado (18+ a√±os)</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddPlayerForm()">‚ûï Registrar Nuevo Jugador</button>
                    </div>
                    
                    <!-- Formulario para a√±adir jugador -->
                    <div id="addPlayerForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>üìù Registrar Nuevo Jugador</h4>
                        
                        <!-- Datos del Jugador -->
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>üë§ Datos del Jugador</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre *</label>
                                    <input type="text" id="playerName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Apellidos *</label>
                                    <input type="text" id="playerSurname" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">DNI *</label>
                                    <input type="text" id="playerDNI" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tel√©fono *</label>
                                    <input type="tel" id="playerPhone" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Nacimiento *</label>
                                    <input type="date" id="playerBirthDate" required onchange="calculateAge()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Edad</label>
                                    <input type="number" id="playerAge" readonly style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #f8f9fa;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categor√≠a</label>
                                    <select id="playerCategory" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="">Seleccionar autom√°ticamente</option>
                                        <option value="prebenajmin">Prebenjam√≠n (6-8 a√±os)</option>
                                        <option value="benjamin">Benjam√≠n (8-10 a√±os)</option>
                                        <option value="alevin">Alev√≠n (10-12 a√±os)</option>
                                        <option value="infantil">Infantil (12-14 a√±os)</option>
                                        <option value="aficionado">Aficionado (18+ a√±os)</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Dorsal</label>
                                    <input type="number" id="playerNumber" min="1" max="99" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Direcci√≥n</label>
                                <input type="text" id="playerAddress" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <!-- Datos del Tutor (aparece autom√°ticamente para menores) -->
                        <div id="guardianSection" style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;">
                            <h5>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Datos del Padre/Madre/Tutor (Obligatorio para menores de edad)</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre del Tutor *</label>
                                    <input type="text" id="guardianName" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">DNI del Tutor *</label>
                                    <input type="text" id="guardianDNI" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tel√©fono del Tutor *</label>
                                    <input type="tel" id="guardianPhone" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Email del Tutor *</label>
                                    <input type="email" id="guardianEmail" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Direcci√≥n del Tutor</label>
                                <input type="text" id="guardianAddress" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <!-- Consentimientos -->
                        <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>‚úÖ Consentimientos Requeridos</h5>
                            <div style="margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; font-weight: bold;">
                                    <input type="checkbox" id="playerConsent" style="margin-right: 10px; transform: scale(1.2);"> 
                                    Consentimiento para ser jugador del equipo CDSANABRIACF *
                                </label>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; font-weight: bold;">
                                    <input type="checkbox" id="photoConsent" style="margin-right: 10px; transform: scale(1.2);"> 
                                    Consentimiento para aparecer en fotos y videos del club *
                                </label>
                            </div>
                            <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                                * Los consentimientos son obligatorios para completar el registro
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="savePlayer()" style="margin-right: 10px;">üíæ Guardar Jugador</button>
                            <button class="btn" onclick="cancelAddPlayer()">‚ùå Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Lista de jugadores -->
                <div class="section">
                    <h3>üìã Lista de Jugadores Registrados</h3>
                    <div id="playersListContainer">
                        <div id="playersList">
                            <!-- Los jugadores se cargar√°n aqu√≠ din√°micamente -->
                        </div>
                    </div>
                </div>
            </div>

            <div id="calendario" class="tab-content">
                <h2>üìÖ Calendario</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Actividades</h3>
                            <select id="calendarFilter" onchange="filterCalendarEvents()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                                <option value="all">Todas las Actividades</option>
                                <option value="training">Entrenamientos</option>
                                <option value="match">Partidos</option>
                                <option value="meeting">Reuniones</option>
                            </select>
                            <select id="categoryCalendarFilter" onchange="filterCalendarEvents()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todas las Categor√≠as</option>
                                <option value="prebenajmin">Prebenjam√≠n</option>
                                <option value="benjamin">Benjam√≠n</option>
                                <option value="alevin">Alev√≠n</option>
                                <option value="infantil">Infantil</option>
                                <option value="aficionado">Aficionado</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddCalendarEventForm()">‚ûï Programar Actividad</button>
                    </div>
                    
                    <!-- Formulario para a√±adir evento del calendario -->
                    <div id="addCalendarEventForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>üìù Programar Nueva Actividad</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">T√≠tulo *</label>
                                <input type="text" id="calendarTitle" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Actividad *</label>
                                <select id="calendarType" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar tipo</option>
                                    <option value="training">üèÉ Entrenamiento</option>
                                    <option value="match">‚öΩ Partido</option>
                                    <option value="meeting">üí¨ Reuni√≥n</option>
                                    <option value="event">üéâ Evento Especial</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha *</label>
                                <input type="date" id="calendarDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Hora de Inicio *</label>
                                <input type="time" id="calendarStartTime" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Hora de Fin *</label>
                                <input type="time" id="calendarEndTime" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categor√≠a *</label>
                                <select id="calendarCategory" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar categor√≠a</option>
                                    <option value="prebenajmin">Prebenjam√≠n (6-8 a√±os)</option>
                                    <option value="benjamin">Benjam√≠n (8-10 a√±os)</option>
                                    <option value="alevin">Alev√≠n (10-12 a√±os)</option>
                                    <option value="infantil">Infantil (12-14 a√±os)</option>
                                    <option value="aficionado">Aficionado (18+ a√±os)</option>
                                    <option value="all">Todas las categor√≠as</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ubicaci√≥n *</label>
                                <input type="text" id="calendarLocation" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Ej: Campo Municipal, Polideportivo...">
                            </div>
                        </div>

                        <!-- Campos espec√≠ficos para partidos -->
                        <div id="matchFields" style="display: none; background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h5>‚öΩ Informaci√≥n del Partido</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Equipo Rival</label>
                                    <input type="text" id="rivalTeam" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">¬øLocal o Visitante?</label>
                                    <select id="homeAway" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="home">üè† Local</option>
                                        <option value="away">‚úàÔ∏è Visitante</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Descripci√≥n</label>
                            <textarea id="calendarDescription" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Detalles adicionales sobre la actividad..."></textarea>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; font-weight: bold;">
                                <input type="checkbox" id="calendarRecurring" onchange="toggleRecurringOptions()" style="margin-right: 10px; transform: scale(1.2);"> 
                                Actividad recurrente (se repite semanalmente)
                            </label>
                        </div>

                        <div id="recurringOptions" style="display: none; background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Repetir hasta la fecha:</label>
                            <input type="date" id="recurringEndDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveCalendarEvent()" style="margin-right: 10px;">üíæ Programar Actividad</button>
                            <button class="btn" onclick="cancelAddCalendarEvent()">‚ùå Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Vista del calendario -->
                <div class="section">
                    <h3>üìÖ Vista de Calendario</h3>
                    <div style="background: white; border-radius: 10px; padding: 20px;">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button onclick="changeCalendarMonth(-1)" style="padding: 8px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">‚óÄ Anterior</button>
                                <h4 id="currentMonthYear" style="margin: 0; min-width: 200px; text-align: center;">Febrero 2024</h4>
                                <button onclick="changeCalendarMonth(1)" style="padding: 8px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Siguiente ‚ñ∂</button>
                            </div>
                            <button onclick="goToToday()" style="padding: 8px 12px; background: #1e3a8a; color: white; border: none; border-radius: 4px; cursor: pointer;">üìÖ Hoy</button>
                        </div>
                        <div id="calendarGrid">
                            <!-- El calendario se generar√° aqu√≠ -->
                        </div>
                    </div>
                </div>

                <!-- Lista de pr√≥ximas actividades -->
                <div class="section">
                    <h3>üìã Pr√≥ximas Actividades</h3>
                    <div id="upcomingActivities">
                        <!-- Las actividades se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                </div>
            </div>

            <div id="eventos" class="tab-content">
                <h2>üéâ Eventos</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Eventos</h3>
                            <select id="eventStatusFilter" onchange="filterEvents()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                                <option value="all">Todos los Estados</option>
                                <option value="upcoming">Pr√≥ximos</option>
                                <option value="ongoing">En Curso</option>
                                <option value="finished">Finalizados</option>
                            </select>
                            <select id="eventTypeFilter" onchange="filterEvents()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todos los Tipos</option>
                                <option value="free">Gratuitos</option>
                                <option value="paid">De Pago</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddEventForm()">‚ûï Crear Nuevo Evento</button>
                    </div>
                    
                    <!-- Formulario para crear evento -->
                    <div id="addEventForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>üìù Crear Nuevo Evento</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre del Evento *</label>
                                <input type="text" id="eventName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha del Evento *</label>
                                <input type="date" id="eventDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Hora de Inicio *</label>
                                <input type="time" id="eventStartTime" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Hora de Fin *</label>
                                <input type="time" id="eventEndTime" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ubicaci√≥n *</label>
                                <input type="text" id="eventLocation" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Descripci√≥n del Evento *</label>
                            <textarea id="eventDescription" rows="3" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Describe el evento, actividades, etc..."></textarea>
                        </div>

                        <!-- Configuraci√≥n de Inscripciones -->
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h5>üë• Configuraci√≥n de Inscripciones</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Precio (‚Ç¨) *</label>
                                    <input type="number" id="eventPrice" min="0" step="0.01" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="0.00">
                                    <small style="color: #666;">Pon 0 para eventos gratuitos</small>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">M√≠nimo de Inscritos *</label>
                                    <input type="number" id="eventMinParticipants" min="1" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">M√°ximo de Inscritos *</label>
                                    <input type="number" id="eventMaxParticipants" min="1" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha L√≠mite de Inscripci√≥n</label>
                                <input type="date" id="eventRegistrationDeadline" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">Si no se especifica, ser√° hasta el d√≠a del evento</small>
                            </div>
                        </div>

                        <!-- Foto del Evento -->
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h5>üì∏ Foto del Evento</h5>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Subir Imagen del Evento</label>
                                <input type="file" id="eventImage" accept="image/*" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">Formatos aceptados: JPG, PNG, GIF. Tama√±o m√°ximo: 5MB</small>
                            </div>
                            <div id="eventImagePreview" style="display: none; text-align: center; margin-top: 10px;">
                                <img id="eventImagePreviewImg" style="max-width: 200px; max-height: 150px; border-radius: 8px;">
                            </div>
                        </div>

                        <!-- Consentimientos -->
                        <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>‚úÖ Configuraci√≥n de Consentimientos</h5>
                            <div style="margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; font-weight: bold;">
                                    <input type="checkbox" id="eventPhotoConsent" style="margin-right: 10px; transform: scale(1.2);"> 
                                    Los participantes deben autorizar aparecer en fotos y videos del evento
                                </label>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; font-weight: bold;">
                                    <input type="checkbox" id="eventDataConsent" style="margin-right: 10px; transform: scale(1.2);"> 
                                    Los participantes deben aceptar el tratamiento de sus datos personales
                                </label>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveEvent()" style="margin-right: 10px;">üíæ Crear Evento</button>
                            <button class="btn" onclick="cancelAddEvent()">‚ùå Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Lista de eventos -->
                <div class="section">
                    <h3>üìã Lista de Eventos</h3>
                    <div id="eventsList">
                        <!-- Los eventos se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                </div>
            </div>

            <!-- M√≥dulo de Competiciones -->
            <div id="competiciones" class="tab-content">
                <h2>üèÜ Gesti√≥n de Competiciones</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Competiciones</h3>
                            <select id="competitionCategoryFilter" onchange="filterCompetitions()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                                <option value="">Todas las categor√≠as</option>
                                <option value="Prebenjam√≠n">Prebenjam√≠n</option>
                                <option value="Benjam√≠n">Benjam√≠n</option>
                                <option value="Alev√≠n">Alev√≠n</option>
                                <option value="Infantil">Infantil</option>
                                <option value="Aficionado">Aficionado</option>
                            </select>
                            <select id="competitionStatusFilter" onchange="filterCompetitions()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Todos los estados</option>
                                <option value="inscripcion">En Inscripci√≥n</option>
                                <option value="activo">Activo</option>
                                <option value="finalizado">Finalizado</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddCompetitionForm()">‚ûï Crear Nueva Competici√≥n</button>
                    </div>
                    
                    <!-- Formulario para crear competici√≥n -->
                    <div id="addCompetitionForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>üèÜ Nueva Competici√≥n</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre de la Competici√≥n *</label>
                                <input type="text" id="competitionName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categor√≠a *</label>
                                <select id="competitionCategory" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar categor√≠a</option>
                                    <option value="Prebenjam√≠n">Prebenjam√≠n</option>
                                    <option value="Benjam√≠n">Benjam√≠n</option>
                                    <option value="Alev√≠n">Alev√≠n</option>
                                    <option value="Infantil">Infantil</option>
                                    <option value="Aficionado">Aficionado</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Competici√≥n *</label>
                                <select id="competitionType" required onchange="toggleCompetitionFields()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar tipo</option>
                                    <option value="liga">Liga</option>
                                    <option value="torneo">Torneo (Eliminaci√≥n)</option>
                                    <option value="amistoso">Amistoso</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">M√°ximo de Equipos</label>
                                <input type="number" id="maxTeams" min="2" max="32" value="8" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Inicio *</label>
                                <input type="date" id="competitionStartDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Fin *</label>
                                <input type="date" id="competitionEndDate" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Descripci√≥n</label>
                            <textarea id="competitionDescription" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Describe la competici√≥n, formato, premios..."></textarea>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Reglamento</label>
                            <textarea id="competitionRules" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Reglas espec√≠ficas de la competici√≥n..."></textarea>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveCompetition()" style="margin-right: 10px;">üíæ Guardar Competici√≥n</button>
                            <button class="btn" onclick="cancelAddCompetition()">‚ùå Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Lista de competiciones -->
                <div class="section">
                    <h3>üìã Lista de Competiciones</h3>
                    <div id="competitionsList">
                        <!-- Las competiciones se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                </div>
            </div>

            <!-- Amigos del Club Tab -->
            <div id="amigos" class="tab-content">
                <h2>ü§ù Amigos del Club</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Amigos</h3>
                            <select id="friendStatusFilter" onchange="filterFriends()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todos los Estados</option>
                                <option value="active">Activos</option>
                                <option value="inactive">Inactivos</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddFriendForm()">‚ûï Registrar Nuevo Amigo</button>
                    </div>
                    
                    <!-- Formulario para registrar amigo -->
                    <div id="addFriendForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>üìù Registrar Nuevo Amigo del Club</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre *</label>
                                <input type="text" id="friendName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Apellidos *</label>
                                <input type="text" id="friendSurname" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">DNI *</label>
                                <input type="text" id="friendDNI" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tel√©fono *</label>
                                <input type="tel" id="friendPhone" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Correo Electr√≥nico *</label>
                                <input type="email" id="friendEmail" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <!-- Informaci√≥n de acceso limitado -->
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>üîê Acceso Limitado de Amigos del Club</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                üëÅÔ∏è <strong>Los amigos del club solo pueden ver:</strong>
                            </p>
                            <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                                <li>üìÖ Calendario de actividades</li>
                                <li>üèÜ Competiciones y resultados</li>
                            </ul>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                üîë <strong>Acceso sin contrase√±a:</strong> Los amigos acceden usando su correo electr√≥nico o tel√©fono una vez completados sus datos.
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveFriend()" style="margin-right: 10px;">üíæ Registrar Amigo</button>
                            <button class="btn" onclick="cancelAddFriend()">‚ùå Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estad√≠sticas de amigos -->
                <div class="section">
                    <h3>üìä Estad√≠sticas de Amigos del Club</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="activeFriendsCount">0</div>
                            <div style="color: #666;">Amigos Activos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #6c757d;" id="inactiveFriendsCount">0</div>
                            <div style="color: #666;">Amigos Inactivos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #1e3a8a;" id="totalFriendsCount">0</div>
                            <div style="color: #666;">Total de Amigos</div>
                        </div>
                    </div>
                </div>

                <!-- Lista de amigos -->
                <div class="section">
                    <h3>üë• Lista de Amigos del Club</h3>
                    <div id="friendsList" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">Cargando lista de amigos...</p>
                    </div>
                </div>
            </div>

            <!-- Entrenadores Tab -->
            <div id="entrenadores" class="tab-content">
                <h2>üë®‚Äçüè´ Gesti√≥n de Entrenadores</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Entrenadores</h3>
                            <select id="coachStatusFilter" onchange="filterCoaches()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todos los Estados</option>
                                <option value="active">Activos</option>
                                <option value="inactive">Inactivos</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddCoachForm()">‚ûï Registrar Nuevo Entrenador</button>
                    </div>
                    
                    <!-- Formulario para registrar entrenador -->
                    <div id="addCoachForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>üìù Registrar Nuevo Entrenador</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre *</label>
                                <input type="text" id="coachName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Apellidos *</label>
                                <input type="text" id="coachSurname" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">DNI *</label>
                                <input type="text" id="coachDNI" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tel√©fono *</label>
                                <input type="tel" id="coachPhone" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Correo Electr√≥nico *</label>
                                <input type="email" id="coachEmail" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contrase√±a *</label>
                                <input type="password" id="coachPassword" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">La contrase√±a ser√° visible para los administradores</small>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Equipo Asignado *</label>
                                <select id="coachTeam" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Seleccionar equipo...</option>
                                    <option value="prebenjamin">Prebenjam√≠n</option>
                                    <option value="benjamin">Benjam√≠n</option>
                                    <option value="alevin">Alev√≠n</option>
                                    <option value="infantil">Infantil</option>
                                    <option value="aficionado">Aficionado</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Licencia de Entrenador</label>
                                <input type="text" id="coachLicense" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">A√±os de Experiencia</label>
                                <input type="number" id="coachExperience" min="0" max="50" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <!-- Informaci√≥n de acceso del entrenador -->
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>üîê Acceso del Entrenador</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                üë®‚Äçüè´ <strong>El entrenador podr√°:</strong>
                            </p>
                            <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                                <li>üìù Gestionar jugadores de su equipo</li>
                                <li>üìÖ Ver calendario de su equipo</li>
                                <li>üì± Enviar mensajes push a sus jugadores/padres</li>
                                <li>üìä Ver estad√≠sticas de su equipo</li>
                                <li>üìã Registrar asistencia y notas</li>
                            </ul>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                üîë <strong>Acceso:</strong> Login con email o tel√©fono (sin contrase√±a).
                            </p>
                            <p style="margin: 5px 0; font-size: 0.9em; color: #dc2626;">
                                ‚ö†Ô∏è <strong>Validaci√≥n:</strong> El entrenador debe ser validado por un administrador para poder acceder.
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveCoach()" style="margin-right: 10px;">üíæ Registrar Entrenador</button>
                            <button class="btn" onclick="cancelAddCoach()">‚ùå Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estad√≠sticas de entrenadores -->
                <div class="section">
                    <h3>üìä Estad√≠sticas de Entrenadores</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="activeCoachesCount">0</div>
                            <div style="color: #666;">Entrenadores Activos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #6c757d;" id="inactiveCoachesCount">0</div>
                            <div style="color: #666;">Entrenadores Inactivos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #1e3a8a;" id="totalCoachesCount">0</div>
                            <div style="color: #666;">Total de Entrenadores</div>
                        </div>
                    </div>
                </div>

                <!-- Lista de entrenadores -->
                <div class="section">
                    <h3>üë• Lista de Entrenadores</h3>
                    <div id="coachesList" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">Cargando lista de entrenadores...</p>
                    </div>
                </div>
            </div>

            <!-- Mensajes Push Tab -->
            <div id="mensajes" class="tab-content">
                <h2>üì± Gesti√≥n de Mensajes Push</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Enviar Mensaje Push</h3>
                        </div>
                        <button class="btn btn-success" onclick="showAddMessageForm()">üì§ Enviar Nuevo Mensaje</button>
                    </div>
                    
                    <!-- Formulario para enviar mensaje push -->
                    <div id="addMessageForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>üìù Nuevo Mensaje Push</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">T√≠tulo del Mensaje *</label>
                                <input type="text" id="messageTitle" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contenido del Mensaje *</label>
                                <textarea id="messageContent" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px; resize: vertical;"></textarea>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Mensaje</label>
                                <select id="messageType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="general">General</option>
                                    <option value="urgent">Urgente</option>
                                    <option value="reminder">Recordatorio</option>
                                    <option value="announcement">Anuncio</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Destinatarios</label>
                                <select id="messageRecipients" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="all">Todos los usuarios</option>
                                    <option value="socios">Solo socios</option>
                                    <option value="amigos">Solo amigos del club</option>
                                    <option value="entrenadores">Solo entrenadores</option>
                                    <option value="jugadores">Solo jugadores</option>
                                    <option value="padres">Solo padres/tutores</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Equipo Espec√≠fico (opcional)</label>
                                <select id="messageTeam" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Todos los equipos</option>
                                    <option value="prebenjamin">Prebenjam√≠n</option>
                                    <option value="benjamin">Benjam√≠n</option>
                                    <option value="alevin">Alev√≠n</option>
                                    <option value="infantil">Infantil</option>
                                    <option value="aficionado">Aficionado</option>
                                </select>
                            </div>
                        </div>

                        <!-- Informaci√≥n de env√≠o -->
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>üì§ Informaci√≥n de Env√≠o</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                üì± <strong>Los mensajes push se enviar√°n a:</strong>
                            </p>
                            <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                                <li>üë• Todos los usuarios registrados seg√∫n el filtro seleccionado</li>
                                <li>üìß Por email y notificaciones en la aplicaci√≥n</li>
                                <li>‚è∞ En tiempo real cuando sea posible</li>
                                <li>üìä Se registrar√° en el historial de mensajes</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="sendAdminPushMessage()" style="margin-right: 10px;">üì§ Enviar Mensaje</button>
                            <button class="btn btn-warning" onclick="previewAdminMessage()" style="margin-right: 10px;">üëÅÔ∏è Vista Previa</button>
                            <button class="btn" onclick="cancelAddMessage()">‚ùå Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estad√≠sticas de mensajes -->
                <div class="section">
                    <h3>üìä Estad√≠sticas de Mensajes</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="totalMessagesCount">0</div>
                            <div style="color: #666;">Total de Mensajes</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;" id="todayMessagesCount">0</div>
                            <div style="color: #666;">Mensajes Hoy</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="urgentMessagesCount">0</div>
                            <div style="color: #666;">Mensajes Urgentes</div>
                        </div>
                    </div>
                </div>

                <!-- Historial de mensajes -->
                <div class="section">
                    <h3>üìã Historial de Mensajes</h3>
                    <div id="adminMessagesHistory" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">Cargando historial de mensajes...</p>
                    </div>
                </div>
            </div>

            <!-- Exportar Datos Tab -->
            <div id="exportar" class="tab-content">
                <h2>üìä Exportar Datos a Excel</h2>
                
                <div class="section">
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                        <h3>üìã Informaci√≥n de Exportaci√≥n</h3>
                        <p style="margin: 10px 0; color: #1e3a8a;">
                            üí° <strong>Los archivos se descargar√°n en formato CSV</strong> que puede abrirse en Excel, Google Sheets o cualquier programa de hojas de c√°lculo.
                        </p>
                        <p style="margin: 10px 0; color: #1e3a8a;">
                            üìÅ <strong>Los archivos incluir√°n:</strong> Todos los datos relevantes de cada categor√≠a, fechas de registro, estados, y estad√≠sticas.
                        </p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        
                        <!-- Exportar Jugadores -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #059669; margin-bottom: 15px;">‚öΩ Jugadores por Equipo</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta la lista completa de jugadores organizados por categor√≠as.</p>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categor√≠a:</label>
                                <select id="exportPlayerCategory" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="all">Todas las categor√≠as</option>
                                    <option value="prebenjamin">Prebenjam√≠n</option>
                                    <option value="benjamin">Benjam√≠n</option>
                                    <option value="alevin">Alev√≠n</option>
                                    <option value="infantil">Infantil</option>
                                    <option value="aficionado">Aficionado</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-success" onclick="exportPlayers()" style="width: 100%;">
                                üìä Exportar Jugadores
                            </button>
                        </div>

                        <!-- Exportar Socios -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #3b82f6; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #3b82f6; margin-bottom: 15px;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Socios del Club</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta la lista completa de socios con sus datos y estados.</p>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Estado:</label>
                                <select id="exportMemberStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="all">Todos los estados</option>
                                    <option value="active">Solo activos</option>
                                    <option value="pending">Solo pendientes</option>
                                    <option value="expired">Solo expirados</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary" onclick="exportMembers()" style="width: 100%;">
                                üìä Exportar Socios
                            </button>
                        </div>

                        <!-- Exportar Amigos -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #10b981; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #10b981; margin-bottom: 15px;">ü§ù Amigos del Club</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta la lista de amigos del club con sus datos de contacto.</p>
                            
                            <button class="btn" onclick="exportFriends()" style="width: 100%; background: #10b981; color: white;">
                                üìä Exportar Amigos
                            </button>
                        </div>

                        <!-- Exportar Entrenadores -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #f59e0b; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #f59e0b; margin-bottom: 15px;">üë®‚Äçüè´ Entrenadores</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta la lista de entrenadores con sus equipos asignados.</p>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Estado:</label>
                                <select id="exportCoachStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="all">Todos los estados</option>
                                    <option value="active">Solo activos</option>
                                    <option value="pending">Solo pendientes</option>
                                    <option value="inactive">Solo inactivos</option>
                                </select>
                            </div>
                            
                            <button class="btn" onclick="exportCoaches()" style="width: 100%; background: #f59e0b; color: white;">
                                üìä Exportar Entrenadores
                            </button>
                        </div>

                        <!-- Exportar Eventos -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #8b5cf6; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #8b5cf6; margin-bottom: 15px;">üéâ Eventos del Club</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta la lista de eventos con participantes y detalles.</p>
                            
                            <button class="btn" onclick="exportEvents()" style="width: 100%; background: #8b5cf6; color: white;">
                                üìä Exportar Eventos
                            </button>
                        </div>

                        <!-- Exportar Competiciones -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #dc2626; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #dc2626; margin-bottom: 15px;">üèÜ Competiciones</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta las competiciones con equipos participantes y resultados.</p>
                            
                            <button class="btn" onclick="exportCompetitions()" style="width: 100%; background: #dc2626; color: white;">
                                üìä Exportar Competiciones
                            </button>
                        </div>

                        <!-- Exportar Todo -->
                        <div style="background: white; padding: 25px; border-radius: 10px; border: 2px solid #1e3a8a; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="color: #1e3a8a; margin-bottom: 15px;">üìã Exportar Todo</h3>
                            <p style="margin-bottom: 20px; color: #666;">Exporta todos los datos del club en archivos separados.</p>
                            
                            <button class="btn" onclick="exportAllData()" style="width: 100%; background: #1e3a8a; color: white;">
                                üìä Exportar Todo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Historial de Exportaciones -->
                <div class="section">
                    <h3>üìã Historial de Exportaciones</h3>
                    <div id="exportHistory" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">No hay exportaciones recientes</p>
                    </div>
                </div>
            </div>

            <!-- Publicidad Tab -->
            <div id="publicidad" class="tab-content">
                <h2>üì¢ Gesti√≥n de Publicidad y Colaboradores</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Gestionar Anuncios Publicitarios</h3>
                        </div>
                        <button class="btn btn-success" onclick="showAddAdvertisementForm()">‚ûï Agregar Nuevo Anuncio</button>
                    </div>
                    
                    <!-- Formulario para agregar anuncio -->
                    <div id="addAdvertisementForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>üìù Nuevo Anuncio Publicitario</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">T√≠tulo del Anuncio *</label>
                                <input type="text" id="adTitle" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Colaborador/Empresa *</label>
                                <input type="text" id="adCompany" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Descripci√≥n</label>
                                <textarea id="adDescription" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: 80px; resize: vertical;"></textarea>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">URL del Enlace</label>
                                <input type="url" id="adUrl" placeholder="https://ejemplo.com" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Categor√≠a</label>
                                <select id="adCategory" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="general">General</option>
                                    <option value="deportes">Deportes</option>
                                    <option value="alimentacion">Alimentaci√≥n</option>
                                    <option value="tecnologia">Tecnolog√≠a</option>
                                    <option value="servicios">Servicios</option>
                                    <option value="comercio">Comercio</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Imagen del Anuncio</label>
                                <input type="file" id="adImage" accept="image/*" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <div id="adImagePreview" style="margin-top: 10px; max-width: 200px;"></div>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Posici√≥n en Carrusel</label>
                                <select id="adPosition" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="1">1 - Primera posici√≥n</option>
                                    <option value="2">2 - Segunda posici√≥n</option>
                                    <option value="3">3 - Tercera posici√≥n</option>
                                    <option value="4">4 - Cuarta posici√≥n</option>
                                    <option value="5">5 - Quinta posici√≥n</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Inicio</label>
                                <input type="date" id="adStartDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Fecha de Fin</label>
                                <input type="date" id="adEndDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Estado</label>
                                <select id="adStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="active">Activo</option>
                                    <option value="inactive">Inactivo</option>
                                    <option value="pending">Pendiente</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Anuncio</label>
                                <select id="adType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="banner">Banner</option>
                                    <option value="carrusel">Carrusel</option>
                                    <option value="sidebar">Barra Lateral</option>
                                    <option value="popup">Popup</option>
                                </select>
                            </div>
                        </div>

                        <!-- Informaci√≥n de configuraci√≥n -->
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>üìã Configuraci√≥n del Anuncio</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                üéØ <strong>El anuncio aparecer√° en:</strong>
                            </p>
                            <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                                <li>üè† P√°gina principal del club</li>
                                <li>üì± Carrusel de colaboradores</li>
                                <li>‚è∞ Seg√∫n las fechas configuradas</li>
                                <li>üìä Con estad√≠sticas de visualizaciones</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveAdvertisement()" style="margin-right: 10px;">üíæ Guardar Anuncio</button>
                            <button class="btn" onclick="cancelAddAdvertisement()">‚ùå Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estad√≠sticas de publicidad -->
                <div class="section">
                    <h3>üìä Estad√≠sticas de Publicidad</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="activeAdsCount">0</div>
                            <div style="color: #666;">Anuncios Activos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;" id="totalAdsCount">0</div>
                            <div style="color: #666;">Total de Anuncios</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="carouselAdsCount">0</div>
                            <div style="color: #666;">En Carrusel</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #dc2626;" id="expiredAdsCount">0</div>
                            <div style="color: #666;">Expirados</div>
                        </div>
                    </div>
                </div>

                <!-- Lista de anuncios -->
                <div class="section">
                    <h3>üìã Lista de Anuncios</h3>
                    <div style="margin-bottom: 15px;">
                        <select id="adFilter" onchange="filterAdvertisements()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="all">Todos los Anuncios</option>
                            <option value="active">Solo Activos</option>
                            <option value="carrusel">Solo Carrusel</option>
                            <option value="expired">Expirados</option>
                        </select>
                    </div>
                    <div id="advertisementsList" style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <p style="text-align: center; color: #6c757d;">Cargando anuncios...</p>
                    </div>
                </div>
            </div>

            <div id="socios" class="tab-content">
                <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Socios</h2>
                
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3>Filtrar Socios</h3>
                            <select id="memberStatusFilter" onchange="filterMembers()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="all">Todos los Estados</option>
                                <option value="pending">Pendientes de Validaci√≥n</option>
                                <option value="active">Activos</option>
                                <option value="expired">Caducados (7 d√≠as)</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="showAddMemberForm()">‚ûï Registrar Nuevo Socio</button>
                    </div>
                    
                    <!-- Formulario para registrar socio -->
                    <div id="addMemberForm" style="display: none; margin-top: 20px; background: white; padding: 25px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>üìù Registrar Nuevo Socio</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre *</label>
                                <input type="text" id="memberName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Apellidos *</label>
                                <input type="text" id="memberSurname" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">DNI</label>
                                <input type="text" id="memberDNI" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tel√©fono *</label>
                                <input type="tel" id="memberPhone" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Direcci√≥n</label>
                                <input type="text" id="memberAddress" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Correo Electr√≥nico</label>
                                <input type="email" id="memberEmail" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contrase√±a *</label>
                            <input type="password" id="memberPassword" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <small style="color: #666;">La contrase√±a ser√° visible para los administradores</small>
                        </div>

                        <!-- Informaci√≥n de validaci√≥n autom√°tica -->
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>‚è∞ Validaci√≥n Autom√°tica de Socios</h5>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                ‚ö†Ô∏è <strong>Los socios deben ser confirmados por un administrador en un plazo de 7 d√≠as desde su registro.</strong>
                            </p>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                üóëÔ∏è Si no son confirmados en ese tiempo, ser√°n eliminados autom√°ticamente del sistema.
                            </p>
                            <p style="margin: 5px 0; font-size: 0.9em;">
                                üî¢ La numeraci√≥n de socio se asignar√° autom√°ticamente una vez confirmado.
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="saveMember()" style="margin-right: 10px;">üíæ Registrar Socio</button>
                            <button class="btn" onclick="cancelAddMember()">‚ùå Cancelar</button>
                        </div>
                    </div>
                </div>

                <!-- Estad√≠sticas de socios -->
                <div class="section">
                    <h3>üìä Estad√≠sticas de Socios</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="activeMembersCount">0</div>
                            <div style="color: #666;">Socios Activos</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="pendingMembersCount">0</div>
                            <div style="color: #666;">Pendientes de Validaci√≥n</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #dc2626;" id="expiredMembersCount">0</div>
                            <div style="color: #666;">Caducados (7 d√≠as)</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e9ecef;">
                            <div style="font-size: 2rem; font-weight: bold; color: #1e3a8a;" id="nextMemberNumber">1</div>
                            <div style="color: #666;">Pr√≥ximo N√∫mero de Socio</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 20px;">
                        <button class="btn" onclick="cleanExpiredMembers()" style="background: #dc2626;">üóëÔ∏è Limpiar Socios Caducados</button>
                        <button class="btn" onclick="validateAllPendingMembers()" style="background: #059669; margin-left: 10px;">‚úÖ Validar Todos los Pendientes</button>
                    </div>
                </div>

                <!-- Lista de socios -->
                <div class="section">
                    <h3>üìã Lista de Socios</h3>
                    <div id="membersList">
                        <!-- Los socios se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                </div>
            </div>

            <div id="multimedia" class="tab-content">
                <h2>üì∏ Multimedia</h2>
                <div class="section">
                    <p>üì∏ <strong>M√≥dulo de fotos y videos</strong></p>
                    <p>Gestiona la galer√≠a multimedia del club.</p>
                    <button class="btn" onclick="alert('‚ö†Ô∏è M√≥dulo en desarrollo. Pr√≥ximamente disponible.')">üì§ Subir Archivo</button>
                </div>
            </div>

            <!-- Secci√≥n de Tienda -->
            <div id="tienda" class="tab-content">
                <h2>üè™ Administraci√≥n de Tienda</h2>
                
                <div class="section">
                    <h3>üõí Gesti√≥n de Productos</h3>
                    <p><strong>Administra la tienda oficial de CDSANABRIACF</strong></p>
                    
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4>üè™ Tienda CDSANABRIACF</h4>
                        <p><strong>Funcionalidades disponibles:</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>‚ûï Agregar nuevos productos</li>
                            <li>üìù Editar productos existentes</li>
                            <li>üóëÔ∏è Eliminar productos</li>
                            <li>üìä Gestionar stock por tallas</li>
                            <li>üí∞ Configurar precios</li>
                            <li>üì∏ Subir fotos de productos</li>
                            <li>üìà Ver estad√≠sticas de ventas</li>
                        </ul>
                    </div>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <a href="admin-tienda-completa.html" style="
                            display: inline-block;
                            background: linear-gradient(135deg, #dc2626, #3b82f6);
                            color: white;
                            padding: 15px 30px;
                            border-radius: 25px;
                            text-decoration: none;
                            font-weight: 600;
                            font-size: 1.1rem;
                            transition: transform 0.3s, box-shadow 0.3s;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 15px rgba(220, 38, 38, 0.3)'" 
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.1)'">
                            üè™ Abrir Panel de Tienda
                        </a>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <h4>‚ÑπÔ∏è Informaci√≥n Importante:</h4>
                        <p><strong>‚Ä¢ Solo socios y amigos pueden comprar productos</strong></p>
                        <p><strong>‚Ä¢ Entrega en mano disponible</strong></p>
                        <p><strong>‚Ä¢ Stock controlado por tallas</strong></p>
                        <p><strong>‚Ä¢ Enlace a tienda oficial externa disponible</strong></p>
                    </div>
                </div>
            </div>

            <div id="configuracion" class="tab-content">
                <h2>‚öôÔ∏è Configuraci√≥n</h2>
                
                <!-- Gesti√≥n de Administradores -->
                <div class="section">
                    <h3>üë®‚Äçüíº Gesti√≥n de Administradores</h3>
                    <p><strong>Administradores del equipo CDSANABRIACF</strong></p>
                    
                    <button class="btn" onclick="showAddAdminForm()" style="background: #059669;">‚ûï A√±adir Administrador</button>
                    
                    <!-- Formulario para a√±adir administrador -->
                    <div id="addAdminForm" style="display: none; margin-top: 20px; background: white; padding: 20px; border-radius: 10px; border: 2px solid #059669;">
                        <h4>üìù Registrar Nuevo Administrador</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre *</label>
                                <input type="text" id="adminName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Email *</label>
                                <input type="email" id="adminEmail" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contrase√±a *</label>
                            <input type="password" id="adminPassword" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Rol</label>
                            <select id="adminRole" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="team_admin">Administrador de Equipo</option>
                                <option value="assistant_admin">Administrador Asistente</option>
                            </select>
                        </div>
                        
                        <button class="btn" onclick="saveNewAdmin()" style="background: #059669;">üíæ Guardar Administrador</button>
                        <button class="btn" onclick="cancelAddAdmin()">‚ùå Cancelar</button>
                    </div>
                    
                    <!-- Lista de administradores -->
                    <div id="adminsList" style="margin-top: 20px;">
                        <!-- Se carga din√°micamente -->
                    </div>
                </div>
                
                <!-- Logo del Club -->
                <div class="section">
                    <h3>üèÜ Logo del Club</h3>
                    <p><strong>Subir y gestionar el logo oficial del club</strong></p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">üìÅ Seleccionar Logo</label>
                            <input type="file" id="logoFile" accept="image/*" style="width: 100%; padding: 10px; border: 2px dashed #ddd; border-radius: 8px;">
                            <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">Formatos: JPG, PNG, GIF. Tama√±o m√°ximo: 2MB</p>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">üëÅÔ∏è Vista Previa</label>
                            <div id="logoPreview" style="width: 150px; height: 150px; border: 2px dashed #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                                <span style="color: #666;">Sin logo</span>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="uploadLogo()" style="background: #059669;">üíæ Guardar Logo</button>
                    <button class="btn" onclick="removeLogo()" style="background: #dc3545;">üóëÔ∏è Eliminar Logo</button>
                </div>

                <!-- Mensaje del Logo -->
                <div class="section">
                    <h3>üí¨ Mensaje del Logo</h3>
                    <p><strong>Personalizar el mensaje que aparece debajo del logo</strong></p>
                    
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 10px; font-weight: bold;">üìù Mensaje Personalizado</label>
                        <textarea id="logoMessage" rows="3" placeholder="Escribe aqu√≠ el mensaje que aparecer√° debajo del logo..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; resize: vertical;"></textarea>
                        <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">Este mensaje se mostrar√° debajo del logo en la p√°gina principal</p>
                    </div>
                    
                    <button class="btn" onclick="saveLogoMessage()" style="background: #059669;">üíæ Guardar Mensaje</button>
                    <button class="btn" onclick="resetLogoMessage()" style="background: #6c757d;">üîÑ Restablecer</button>
                </div>

                <!-- Colores y Tema -->
                <div class="section">
                    <h3>üé® Colores y Tema</h3>
                    <p><strong>Personalizar la apariencia del club</strong></p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">üé® Color Principal</label>
                            <input type="color" id="primaryColor" value="#dc2626" style="width: 100%; height: 40px; border: none; border-radius: 8px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">üé® Color Secundario</label>
                            <input type="color" id="secondaryColor" value="#3b82f6" style="width: 100%; height: 40px; border: none; border-radius: 8px;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">üìù Fuente</label>
                            <select id="fontFamily" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                                <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="'Times New Roman', serif">Times New Roman</option>
                                <option value="'Courier New', monospace">Courier New</option>
                                <option value="Georgia, serif">Georgia</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">üìè Tama√±o de Fuente</label>
                            <select id="fontSize" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                                <option value="14px">Peque√±o (14px)</option>
                                <option value="16px" selected>Mediano (16px)</option>
                                <option value="18px">Grande (18px)</option>
                                <option value="20px">Muy Grande (20px)</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="saveThemeSettings()" style="background: #059669;">üíæ Guardar Tema</button>
                    <button class="btn" onclick="resetThemeSettings()" style="background: #6c757d;">üîÑ Restablecer</button>
                </div>

                <!-- Datos de Contacto -->
                <div class="section">
                    <h3>üìû Datos de Contacto</h3>
                    <p><strong>Informaci√≥n de contacto del club</strong></p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">üìß Email del Club</label>
                            <input type="email" id="clubEmail" placeholder="club@cdsanabriacf.com" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">üì± Tel√©fono</label>
                            <input type="tel" id="clubPhone" placeholder="+34 600 000 000" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">üìç Direcci√≥n</label>
                        <input type="text" id="clubAddress" placeholder="Calle del Club, 123, Ciudad" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">üåê Sitio Web</label>
                            <input type="url" id="clubWebsite" placeholder="https://www.cdsanabriacf.com" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">üì± WhatsApp</label>
                            <input type="tel" id="clubWhatsApp" placeholder="+34 600 000 000" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">üìù Horarios de Atenci√≥n</label>
                        <textarea id="clubHours" placeholder="Lunes a Viernes: 9:00 - 18:00&#10;S√°bados: 9:00 - 14:00&#10;Domingos: Cerrado" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; height: 80px; resize: vertical;"></textarea>
                    </div>
                    
                    <button class="btn" onclick="saveContactInfo()" style="background: #059669;">üíæ Guardar Contacto</button>
                    <button class="btn" onclick="loadContactInfo()" style="background: #17a2b8;">üìã Cargar Datos</button>
                </div>
            </div>
                    </div>
        </div>

        <div class="section">
            <h2>üë• Administradores de Equipo</h2>
            <div class="admin-section">
                <h3>Gesti√≥n de Administradores</h3>
                <p style="margin-bottom: 20px; color: #666;">
                    Aqu√≠ puedes crear administradores para cada equipo. Cada administrador podr√° gestionar todo lo relacionado con su equipo asignado.
                </p>
                <div class="form-group">
                    <label for="adminEmail">Correo Electr√≥nico del Administrador:</label>
                    <input type="email" id="adminEmail" required placeholder="ejemplo@correo.com">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Contrase√±a:</label>
                    <input type="password" id="adminPassword" required placeholder="Contrase√±a para el administrador">
                </div>
                <div class="form-group">
                    <label for="adminTeam">Equipo a Administrar:</label>
                    <select id="adminTeam" required>
                        <option value="">Selecciona un equipo</option>
                        <option value="prebenjamin">Prebenjam√≠n</option>
                        <option value="benjamin">Benjam√≠n</option>
                        <option value="alevin">Alev√≠n</option>
                        <option value="infantil">Infantil</option>
                        <option value="aficionado">Aficionado</option>
                    </select>
                </div>
                <div class="form-buttons">
                    <button onclick="addTeamAdmin()" class="btn-primary">Crear Administrador de Equipo</button>
                </div>

                <div id="adminList" class="admin-list" style="margin-top: 20px;">
                    <h4>Administradores de Equipo Actuales</h4>
                    <div id="adminListContent">
                        <!-- La lista se llenar√° din√°micamente -->
                    </div>
                </div>
            </div>
        </div>

        <script>
        // Funciones para gesti√≥n de administradores de equipo
        function addTeamAdmin() {
            const email = document.getElementById('adminEmail').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            const team = document.getElementById('adminTeam').value;

            if (!email || !password || !team) {
                alert('Por favor, completa todos los campos');
                return;
            }

            // Verificar si ya existe un admin con ese email
            const admins = JSON.parse(localStorage.getItem('teamAdmins') || '[]');
            if (admins.some(admin => admin.email === email)) {
                alert('Ya existe un administrador con ese correo electr√≥nico');
                return;
            }

            // Crear nuevo administrador
            const newAdmin = {
                id: Date.now().toString(),
                email: email,
                password: password, // La contrase√±a se guarda para que puedas verla como admin principal
                team: team,
                createdAt: new Date().toISOString(),
                createdBy: JSON.parse(localStorage.getItem('currentAdmin')).email,
                status: 'active'
            };

            // Guardar en localStorage
            admins.push(newAdmin);
            localStorage.setItem('teamAdmins', JSON.stringify(admins));

            // Limpiar formulario
            document.getElementById('adminEmail').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminTeam').value = '';

            // Actualizar lista
            loadTeamAdmins();

            alert(`‚úÖ Administrador agregado exitosamente\n\nEmail: ${email}\nEquipo: ${team}`);
        }

        function loadTeamAdmins() {
            const admins = JSON.parse(localStorage.getItem('teamAdmins') || '[]');
            const container = document.getElementById('adminListContent');
            
            if (admins.length === 0) {
                container.innerHTML = '<p>No hay administradores registrados</p>';
                return;
            }

            let html = '<div class="admin-table">';
            html += `
                <div class="admin-row header">
                    <div>Email</div>
                    <div>Equipo</div>
                    <div>Contrase√±a</div>
                    <div>Estado</div>
                    <div>Acciones</div>
                </div>
            `;

            admins.forEach(admin => {
                const teamNames = {
                    'prebenjamin': 'Prebenjam√≠n',
                    'benjamin': 'Benjam√≠n',
                    'alevin': 'Alev√≠n',
                    'infantil': 'Infantil',
                    'aficionado': 'Aficionado'
                };

                html += `
                    <div class="admin-row">
                        <div>${admin.email}</div>
                        <div>${teamNames[admin.team] || admin.team}</div>
                        <div>
                            <span id="pwd_${admin.id}" style="-webkit-text-security: disc;">
                                ${admin.password}
                            </span>
                            <button onclick="togglePassword('${admin.id}')" class="btn-small">
                                üëÅÔ∏è
                            </button>
                        </div>
                        <div>
                            <span class="status-badge ${admin.status === 'active' ? 'active' : 'inactive'}">
                                ${admin.status === 'active' ? '‚úÖ Activo' : '‚ùå Inactivo'}
                            </span>
                        </div>
                        <div>
                            <button onclick="toggleAdminStatus('${admin.id}')" class="btn-small">
                                ${admin.status === 'active' ? 'üîí Desactivar' : 'üîì Activar'}
                            </button>
                            <button onclick="deleteAdmin('${admin.id}')" class="btn-small delete">
                                üóëÔ∏è Eliminar
                            </button>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function togglePassword(adminId) {
            const pwdSpan = document.getElementById(`pwd_${adminId}`);
            if (pwdSpan.style.webkitTextSecurity === 'disc') {
                pwdSpan.style.webkitTextSecurity = 'none';
            } else {
                pwdSpan.style.webkitTextSecurity = 'disc';
            }
        }

        function toggleAdminStatus(adminId) {
            const admins = JSON.parse(localStorage.getItem('teamAdmins') || '[]');
            const adminIndex = admins.findIndex(a => a.id === adminId);
            
            if (adminIndex !== -1) {
                admins[adminIndex].status = admins[adminIndex].status === 'active' ? 'inactive' : 'active';
                localStorage.setItem('teamAdmins', JSON.stringify(admins));
                loadTeamAdmins();
            }
        }

        function deleteAdmin(adminId) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este administrador?')) {
                return;
            }

            const admins = JSON.parse(localStorage.getItem('teamAdmins') || '[]');
            const updatedAdmins = admins.filter(a => a.id !== adminId);
            localStorage.setItem('teamAdmins', JSON.stringify(updatedAdmins));
            loadTeamAdmins();
        }

        // Verificar autenticaci√≥n al cargar la p√°gina
        // Funci√≥n para verificar permisos de administrador
        function checkAdminPermissions() {
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin'));
            if (!currentAdmin) {
                window.location.href = 'index.html';
                return;
            }

            // Si es administrador de equipo
            if (currentAdmin.role === 'team_admin') {
                // Ocultar la secci√≥n de gesti√≥n de administradores
                const adminSection = document.querySelector('.admin-section');
                if (adminSection) {
                    adminSection.parentElement.style.display = 'none';
                }

                // Mostrar mensaje de bienvenida espec√≠fico
                const welcomeMessage = document.createElement('div');
                welcomeMessage.style.cssText = 'background: #f0fdf4; color: #166534; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dcfce7;';
                welcomeMessage.innerHTML = `
                    <h3 style="margin: 0 0 10px 0;">üëã Bienvenido, Administrador de ${currentAdmin.teamId}</h3>
                    <p style="margin: 0;">Tienes acceso para gestionar todo lo relacionado con tu equipo.</p>
                `;
                document.querySelector('.admin-container').insertBefore(welcomeMessage, document.querySelector('.admin-container').firstChild);

                // Filtrar contenido para mostrar solo lo relacionado con su equipo
                filterContentForTeamAdmin(currentAdmin.teamId);
            }
        }

        function filterContentForTeamAdmin(teamId) {
            // Convertir el ID del equipo a nombre para mostrar
            const teamNames = {
                'prebenjamin': 'Prebenjam√≠n',
                'benjamin': 'Benjam√≠n',
                'alevin': 'Alev√≠n',
                'infantil': 'Infantil',
                'aficionado': 'Aficionado'
            };

            // Actualizar t√≠tulo de la p√°gina
            document.title = `Panel de ${teamNames[teamId]} - CDSANABRIACF`;

            // Filtrar jugadores
            const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
            const teamPlayers = players.filter(p => p.team === teamId);
            
            // Filtrar eventos
            const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
            const teamEvents = events.filter(e => e.team === teamId);
            
            // Actualizar contadores
            document.getElementById('playersCount').textContent = teamPlayers.length;
            document.getElementById('eventsCount').textContent = teamEvents.length;

            // Ocultar estad√≠sticas globales que no son relevantes para el equipo
            const globalStats = document.querySelectorAll('.stat-card[data-global="true"]');
            globalStats.forEach(stat => stat.style.display = 'none');
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç Cargando panel de administraci√≥n CDSANABRIACF...');
            checkAdminSession();
            checkAdminPermissions();
            loadTeamAdmins(); // Cargar lista de administradores
            checkExpiredMembers(); // Verificar socios expirados al cargar
        });

        // Funci√≥n para verificar sesi√≥n de administrador
        function checkAdminSession() {
            try {
                const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                
                if (!currentAdmin.email) {
                    // Crear sesi√≥n por defecto para el administrador principal
                    const defaultAdmin = {
                        id: 'ADMIN_CDSANABRIACF',
                        name: 'Administrador Principal CDSANABRIACF',
                        email: 'amco@gmx.es',
                        teamId: 'CDSANABRIACF',
                        role: 'super_admin',
                        loginTime: new Date().toISOString()
                    };
                    localStorage.setItem('currentAdmin', JSON.stringify(defaultAdmin));
                    currentAdmin = defaultAdmin;
                }
                
                console.log('‚úÖ Sesi√≥n de administrador verificada:', currentAdmin.email);
                
                // Actualizar informaci√≥n en pantalla con indicador de permisos (sin mostrar email)
                const adminInfo = document.getElementById('currentAdminInfo');
                if (adminInfo) {
                    const isPrincipal = currentAdmin.email === 'amco@gmx.es';
                    const roleText = isPrincipal ? 'üëë PRINCIPAL' : 'üë®‚Äçüíº SECUNDARIO';
                    const permissionText = isPrincipal ? '(Permisos completos)' : '(Sin gesti√≥n de admins)';
                    
                    adminInfo.innerHTML = `
                        üë§ ${currentAdmin.name}<br>
                        <small>${roleText} | Administrador Autorizado</small><br>
                        <small style="opacity: 0.8;">${permissionText}</small>
                    `;
                }
                
                return true;
            } catch (error) {
                console.error('‚ùå Error verificando sesi√≥n:', error);
                return false;
            }
        }

        // Funci√≥n para cambiar de pesta√±a
        function showTab(tabName) {
            try {
                console.log('üìÇ Cambiando a pesta√±a:', tabName);
                
                // Ocultar todos los contenidos de pesta√±as
                const tabContents = document.querySelectorAll('.tab-content');
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Remover clase active de todos los botones
                const navTabs = document.querySelectorAll('.nav-tab');
                navTabs.forEach(tab => tab.classList.remove('active'));
                
                // Mostrar el contenido de la pesta√±a seleccionada
                const targetTab = document.getElementById(tabName);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
                
                // Marcar el bot√≥n como activo
                const buttons = document.querySelectorAll('.nav-tab');
                buttons.forEach(button => {
                    if (button.textContent.includes(getTabDisplayName(tabName))) {
                        button.classList.add('active');
                    }
                });
                
                console.log('‚úÖ Pesta√±a cambiada exitosamente:', tabName);
            } catch (error) {
                console.error('‚ùå Error cambiando pesta√±a:', error);
            }
        }

        function getTabDisplayName(tabName) {
            const names = {
                'dashboard': 'Dashboard',
                'equipos': 'Equipos',
                'jugadores': 'Jugadores',
                'calendario': 'Calendario',
                'eventos': 'Eventos',
                'socios': 'Socios',
                'amigos': 'Amigos del Club',
                'entrenadores': 'Entrenadores',
                'mensajes': 'Mensajes Push',
                'exportar': 'Exportar Datos',
                'publicidad': 'Publicidad',
                'competiciones': 'Competiciones',
                'multimedia': 'Multimedia',
                'tienda': 'Tienda',
                'configuracion': 'Configuraci√≥n'
            };
            return names[tabName] || tabName;
        }

        // Funci√≥n para cerrar sesi√≥n
        function logout() {
            if (confirm('¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
                localStorage.removeItem('currentAdmin');
                console.log('üëã Sesi√≥n cerrada');
                alert('‚úÖ Sesi√≥n cerrada correctamente');
                window.location.href = '../admin-panel.html';
            }
        }

        // Funci√≥n para verificar permisos de administrador
        function checkAdminPermissions() {
            try {
                const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                const isPrincipalAdmin = currentAdmin.email === 'amco@gmx.es';
                
                console.log('üîç Verificando permisos. Es administrador principal:', isPrincipalAdmin);
                
                if (isPrincipalAdmin) {
                    // Mostrar secci√≥n de gesti√≥n de administradores
                    loadAdminsList();
                } else {
                    // Ocultar secci√≥n de gesti√≥n de administradores para administradores secundarios
                    const adminSection = document.querySelector('.section h3');
                    const sections = document.querySelectorAll('.section');
                    
                    sections.forEach(section => {
                        const h3 = section.querySelector('h3');
                        if (h3 && h3.textContent.includes('üë®‚Äçüíº Gesti√≥n de Administradores')) {
                            section.style.display = 'none';
                            console.log('üö´ Ocultando gesti√≥n de administradores para administrador secundario');
                        }
                    });
                }
            } catch (error) {
                console.error('‚ùå Error verificando permisos:', error);
            }
        }

        // Funci√≥n para generar contrase√±a autom√°tica
        function generatePassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let password = '';
            for (let i = 0; i < 8; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }

        // Funci√≥n para mostrar/ocultar contrase√±as
        function togglePassword(elementId, realPassword) {
            const element = document.getElementById(elementId);
            if (element.textContent === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
                element.textContent = realPassword;
            } else {
                element.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
            }
        }

        // Funciones para gesti√≥n de administradores (solo para administrador principal)
        function showAddAdminForm() {
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
            if (currentAdmin.email !== 'amco@gmx.es') {
                alert('‚ùå Solo el administrador principal puede gestionar otros administradores');
                return;
            }
            document.getElementById('addAdminForm').style.display = 'block';
            // Limpiar campo de contrase√±a para que el admin la ponga
            document.getElementById('adminPassword').value = '';
        }

        function cancelAddAdmin() {
            document.getElementById('addAdminForm').style.display = 'none';
            clearAdminForm();
        }

        function clearAdminForm() {
            document.getElementById('adminName').value = '';
            document.getElementById('adminEmail').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminRole').value = 'team_admin';
        }

        function saveNewAdmin() {
            // Verificar permisos
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
            if (currentAdmin.email !== 'amco@gmx.es') {
                alert('‚ùå Solo el administrador principal puede a√±adir otros administradores');
                return;
            }
            
            try {
                const adminData = {
                    id: 'ADMIN_' + Date.now(),
                    name: document.getElementById('adminName').value,
                    email: document.getElementById('adminEmail').value,
                    password: document.getElementById('adminPassword').value,
                    role: document.getElementById('adminRole').value,
                    teamId: 'CDSANABRIACF',
                    createdAt: new Date().toISOString(),
                    createdBy: 'amco@gmx.es',
                    status: 'active'
                };

                // Validar campos obligatorios
                if (!adminData.name || !adminData.email || !adminData.password) {
                    alert('‚ùå Por favor, completa todos los campos obligatorios marcados con *');
                    return;
                }

                // Validar que no sea el email principal
                if (adminData.email.toLowerCase() === 'amco@gmx.es') {
                    alert('‚ùå No puedes crear otro administrador con el email principal');
                    return;
                }

                // Validar email √∫nico
                const existingAdmins = JSON.parse(localStorage.getItem('cdsanabriacfTeamAdmins') || '[]');
                if (existingAdmins.find(admin => admin.email.toLowerCase() === adminData.email.toLowerCase())) {
                    alert('‚ùå Ya existe un administrador con este email');
                    return;
                }

                // Guardar en localStorage
                existingAdmins.push(adminData);
                localStorage.setItem('cdsanabriacfTeamAdmins', JSON.stringify(existingAdmins));

                alert('‚úÖ Administrador a√±adido exitosamente\n\nüìß Email: ' + adminData.email + '\n\nüí° El administrador puede acceder al panel con su email y contrase√±a.\n\n‚ö†Ô∏è Este administrador NO podr√° gestionar otros administradores.');
                
                cancelAddAdmin();
                loadAdminsList();

                console.log('üë®‚Äçüíº Nuevo administrador a√±adido:', adminData.name, adminData.email);
            } catch (error) {
                console.error('‚ùå Error a√±adiendo administrador:', error);
                alert('‚ùå Error al a√±adir el administrador. Int√©ntalo de nuevo.');
            }
        }

        function loadAdminsList() {
            try {
                const admins = JSON.parse(localStorage.getItem('cdsanabriacfTeamAdmins') || '[]');
                const adminsList = document.getElementById('adminsList');

                // A√±adir siempre el administrador principal
                const principalAdmin = {
                    id: 'ADMIN_PRINCIPAL',
                    name: 'Administrador Principal',
                    email: 'amco@gmx.es',
                    role: 'super_admin',
                    status: 'active'
                };

                let html = '<h4>üë• Lista de Administradores</h4>';
                html += '<div style="background: white; border-radius: 8px; padding: 15px; margin-top: 15px;">';
                
                // Mostrar administrador principal
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; background: #f0f9ff;">
                        <div>
                            <strong>üëë ${principalAdmin.name}</strong><br>
                            <small>üìß ${principalAdmin.email} | üéØ Super Administrador</small>
                        </div>
                        <div>
                            <span style="background: #059669; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">PRINCIPAL</span>
                        </div>
                    </div>
                `;

                // Mostrar administradores adicionales
                if (admins.length === 0) {
                    html += '<div style="padding: 15px; text-align: center; color: #666;">No hay administradores adicionales registrados</div>';
                } else {
                    admins.forEach(admin => {
                        const roleText = admin.role === 'team_admin' ? 'Administrador de Equipo' : 'Administrador Asistente';
                        const password = admin.password || 'No establecida';
                        html += `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee;">
                                <div>
                                    <strong>üë®‚Äçüíº ${admin.name}</strong><br>
                                    <small>üìß ${admin.email} | üéØ ${roleText}</small><br>
                                    <small style="color: #666;">Creado: ${new Date(admin.createdAt).toLocaleDateString()}</small><br>
                                    <small style="color: #059669; font-weight: bold;">
                                        üîê Contrase√±a: <span id="admin-password-${admin.id}">${password ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : 'No establecida'}</span>
                                        ${password ? `<button onclick="togglePassword('admin-password-${admin.id}', '${password}')" style="background: none; border: none; color: #059669; cursor: pointer; font-size: 0.8rem; margin-left: 5px;">üëÅÔ∏è</button>` : ''}
                                    </small>
                                </div>
                                <div>
                                    <button class="btn btn-small" onclick="editAdmin('${admin.id}')" style="padding: 5px 10px; font-size: 0.8rem; margin-right: 5px;">‚úèÔ∏è Editar</button>
                                    <button class="btn btn-small" onclick="deleteAdmin('${admin.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: #dc2626;">üóëÔ∏è Eliminar</button>
                                </div>
                            </div>
                        `;
                    });
                }

                html += '</div>';
                adminsList.innerHTML = html;

                console.log('üë• Lista de administradores cargada:', admins.length + 1, 'administradores');
            } catch (error) {
                console.error('‚ùå Error cargando lista de administradores:', error);
            }
        }

        function editAdmin(adminId) {
            // Verificar permisos
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
            if (currentAdmin.email !== 'amco@gmx.es') {
                alert('‚ùå Solo el administrador principal puede editar otros administradores');
                return;
            }
            alert('üîß Funci√≥n de edici√≥n en desarrollo. ID: ' + adminId);
        }

        function deleteAdmin(adminId) {
            // Verificar permisos
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
            if (currentAdmin.email !== 'amco@gmx.es') {
                alert('‚ùå Solo el administrador principal puede eliminar otros administradores');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de que quieres eliminar este administrador?\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer.')) {
                try {
                    const admins = JSON.parse(localStorage.getItem('cdsanabriacfTeamAdmins') || '[]');
                    const adminToDelete = admins.find(admin => admin.id === adminId);
                    
                    if (adminToDelete) {
                        const updatedAdmins = admins.filter(admin => admin.id !== adminId);
                        localStorage.setItem('cdsanabriacfTeamAdmins', JSON.stringify(updatedAdmins));

                        loadAdminsList();
                        alert('‚úÖ Administrador "' + adminToDelete.name + '" eliminado correctamente');
                        console.log('üóëÔ∏è Administrador eliminado:', adminToDelete.name, 'ID:', adminId);
                    }
                } catch (error) {
                    console.error('‚ùå Error eliminando administrador:', error);
                    alert('‚ùå Error al eliminar el administrador');
                }
            }
        }

        // === M√ìDULO DE JUGADORES ===
        
        // Funci√≥n para mostrar formulario de a√±adir jugador
        function showAddPlayerForm() {
            document.getElementById('addPlayerForm').style.display = 'block';
            document.getElementById('addPlayerForm').scrollIntoView({ behavior: 'smooth' });
        }

        // Funci√≥n para cancelar a√±adir jugador
        function cancelAddPlayer() {
            document.getElementById('addPlayerForm').style.display = 'none';
            clearPlayerForm();
        }

        // Funci√≥n para limpiar formulario de jugador
        function clearPlayerForm() {
            const form = document.getElementById('addPlayerForm');
            const inputs = form.querySelectorAll('input, select');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
            document.getElementById('guardianSection').style.display = 'none';
        }

        // Funci√≥n para calcular edad autom√°ticamente
        function calculateAge() {
            const birthDate = document.getElementById('playerBirthDate').value;
            if (!birthDate) return;

            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }

            document.getElementById('playerAge').value = age;

            // Mostrar secci√≥n de tutor para menores de 18
            const guardianSection = document.getElementById('guardianSection');
            if (age < 18) {
                guardianSection.style.display = 'block';
            } else {
                guardianSection.style.display = 'none';
            }

            // Sugerir categor√≠a autom√°ticamente
            let suggestedCategory = '';
            if (age >= 6 && age <= 8) suggestedCategory = 'prebenajmin';
            else if (age >= 8 && age <= 10) suggestedCategory = 'benjamin';
            else if (age >= 10 && age <= 12) suggestedCategory = 'alevin';
            else if (age >= 12 && age <= 14) suggestedCategory = 'infantil';
            else if (age >= 18) suggestedCategory = 'aficionado';

            if (suggestedCategory) {
                document.getElementById('playerCategory').value = suggestedCategory;
            }
        }

        // Funci√≥n para guardar jugador
        function savePlayer() {
            try {
                const playerData = {
                    id: 'PLAYER_' + Date.now(),
                    name: document.getElementById('playerName').value.trim(),
                    surname: document.getElementById('playerSurname').value.trim(),
                    dni: document.getElementById('playerDNI').value.trim(),
                    phone: document.getElementById('playerPhone').value.trim(),
                    address: document.getElementById('playerAddress').value.trim(),
                    birthDate: document.getElementById('playerBirthDate').value,
                    age: parseInt(document.getElementById('playerAge').value),
                    category: document.getElementById('playerCategory').value,
                    number: document.getElementById('playerNumber').value,
                    guardianName: document.getElementById('guardianName').value.trim(),
                    guardianDNI: document.getElementById('guardianDNI').value.trim(),
                    guardianPhone: document.getElementById('guardianPhone').value.trim(),
                    guardianEmail: document.getElementById('guardianEmail').value.trim(),
                    guardianAddress: document.getElementById('guardianAddress').value.trim(),
                    playerConsent: document.getElementById('playerConsent').checked,
                    photoConsent: document.getElementById('photoConsent').checked,
                    registrationDate: new Date().toISOString(),
                    status: 'pending_validation',
                    isMinor: playerData.age < 18
                };

                // Validar campos obligatorios
                if (!playerData.name || !playerData.surname || !playerData.dni || !playerData.phone || !playerData.birthDate) {
                    alert('‚ùå Por favor, completa todos los campos obligatorios marcados con *');
                    return;
                }

                // Validar consentimientos
                if (!playerData.playerConsent || !playerData.photoConsent) {
                    alert('‚ùå Los consentimientos son obligatorios para completar el registro');
                    return;
                }

                // Validar datos del tutor para menores
                if (playerData.age < 18) {
                    if (!playerData.guardianName || !playerData.guardianDNI || !playerData.guardianPhone || !playerData.guardianEmail) {
                        alert('‚ùå Para menores de edad es obligatorio completar todos los datos del tutor');
                        return;
                    }
                }

                // Validar DNI √∫nico
                const existingPlayers = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                if (existingPlayers.find(player => player.dni === playerData.dni)) {
                    alert('‚ùå Ya existe un jugador registrado con este DNI');
                    return;
                }

                // Validar dorsal √∫nico por categor√≠a
                if (playerData.number) {
                    const sameCategory = existingPlayers.filter(player => player.category === playerData.category);
                    if (sameCategory.find(player => player.number === playerData.number)) {
                        alert('‚ùå Ya existe un jugador con este dorsal en la categor√≠a ' + playerData.category);
                        return;
                    }
                }

                // Guardar en localStorage
                existingPlayers.push(playerData);
                localStorage.setItem('clubPlayers', JSON.stringify(existingPlayers));

                alert('‚úÖ Jugador registrado exitosamente\n\nüë§ ' + playerData.name + ' ' + playerData.surname + '\nüìß Categor√≠a: ' + playerData.category + '\nüéØ Estado: Pendiente de validaci√≥n\n\nüí° El jugador ser√° validado por un administrador.');
                
                cancelAddPlayer();
                loadPlayersList();
                updateDashboardCounts();

                console.log('üë§ Nuevo jugador registrado:', playerData.name, playerData.surname);
            } catch (error) {
                console.error('‚ùå Error guardando jugador:', error);
                alert('‚ùå Error al guardar el jugador. Int√©ntalo de nuevo.');
            }
        }

        // Funci√≥n para cargar lista de jugadores
        function loadPlayersList() {
            try {
                const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                const playersList = document.getElementById('playersList');
                
                if (players.length === 0) {
                    playersList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No hay jugadores registrados a√∫n.</p>';
                    return;
                }

                // Agrupar por categor√≠as
                const categories = {
                    'prebenajmin': 'Prebenjam√≠n (6-8 a√±os)',
                    'benjamin': 'Benjam√≠n (8-10 a√±os)',
                    'alevin': 'Alev√≠n (10-12 a√±os)',
                    'infantil': 'Infantil (12-14 a√±os)',
                    'aficionado': 'Aficionado (18+ a√±os)'
                };

                let html = '';
                
                Object.keys(categories).forEach(categoryKey => {
                    const categoryPlayers = players.filter(player => player.category === categoryKey);
                    
                    if (categoryPlayers.length > 0) {
                        html += `
                            <div class="category-section" data-category="${categoryKey}" style="margin-bottom: 30px; background: white; border-radius: 10px; padding: 20px; border: 2px solid #e9ecef;">
                                <h4 style="color: #1e3a8a; margin-bottom: 15px; display: flex; align-items: center;">
                                    ‚öΩ ${categories[categoryKey]} 
                                    <span style="background: #1e3a8a; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; margin-left: 10px;">
                                        ${categoryPlayers.length} jugador${categoryPlayers.length !== 1 ? 'es' : ''}
                                    </span>
                                </h4>
                        `;

                        categoryPlayers.forEach(player => {
                            const statusColor = player.status === 'active' ? '#059669' : player.status === 'pending_validation' ? '#f59e0b' : '#dc2626';
                            const statusText = player.status === 'active' ? 'Activo' : player.status === 'pending_validation' ? 'Pendiente' : 'Inactivo';
                            const isMinorIcon = player.age < 18 ? 'üë∂' : 'üë§';
                            
                            html += `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; background: #f8f9fa; margin-bottom: 10px; border-radius: 8px;">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                            <strong style="font-size: 1.1em;">${isMinorIcon} ${player.name} ${player.surname}</strong>
                                            <span style="background: ${statusColor}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; margin-left: 10px;">
                                                ${statusText}
                                            </span>
                                        </div>
                                        <div style="font-size: 0.9em; color: #666;">
                                            üìû ${player.phone} | üÜî ${player.dni} | üéÇ ${player.age} a√±os | üèÉ Dorsal: ${player.number || 'Sin asignar'}
                                        </div>
                                        ${player.age < 18 ? `<div style="font-size: 0.8em; color: #f59e0b; margin-top: 3px;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Tutor: ${player.guardianName} (${player.guardianPhone})</div>` : ''}
                                    </div>
                                    <div style="display: flex; gap: 5px;">
                                        <button onclick="viewPlayerDetails('${player.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">üëÅÔ∏è Ver</button>
                                        <button onclick="editPlayer('${player.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: #1e3a8a; color: white; border: none; border-radius: 4px; cursor: pointer;">‚úèÔ∏è Editar</button>
                                        ${player.status === 'pending_validation' ? `<button onclick="validatePlayer('${player.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer;">‚úÖ Validar</button>` : ''}
                                        <button onclick="deletePlayer('${player.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer;">üóëÔ∏è Eliminar</button>
                                    </div>
                                </div>
                            `;
                        });

                        html += `</div>`;
                    }
                });

                if (html === '') {
                    html = '<p style="text-align: center; color: #666; padding: 20px;">No hay jugadores en la categor√≠a seleccionada.</p>';
                }

                playersList.innerHTML = html;
                console.log('üë• Lista de jugadores cargada:', players.length, 'jugadores');
            } catch (error) {
                console.error('‚ùå Error cargando lista de jugadores:', error);
            }
        }

        // Funci√≥n para filtrar jugadores por categor√≠a
        function filterPlayersByCategory() {
            const selectedCategory = document.getElementById('categoryFilter').value;
            const categorySections = document.querySelectorAll('.category-section');
            
            categorySections.forEach(section => {
                if (selectedCategory === 'all' || section.dataset.category === selectedCategory) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        }

        // Funci√≥n para ver detalles del jugador
        function viewPlayerDetails(playerId) {
            const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
            const player = players.find(p => p.id === playerId);
            
            if (player) {
                const isMinor = player.age < 18;
                let details = `üë§ DETALLES DEL JUGADOR\n\n`;
                details += `Nombre: ${player.name} ${player.surname}\n`;
                details += `DNI: ${player.dni}\n`;
                details += `Tel√©fono: ${player.phone}\n`;
                details += `Edad: ${player.age} a√±os\n`;
                details += `Categor√≠a: ${player.category}\n`;
                details += `Dorsal: ${player.number || 'Sin asignar'}\n`;
                details += `Direcci√≥n: ${player.address || 'No especificada'}\n`;
                details += `Estado: ${player.status === 'active' ? 'Activo' : player.status === 'pending_validation' ? 'Pendiente de validaci√≥n' : 'Inactivo'}\n`;
                
                if (isMinor) {
                    details += `\nüë®‚Äçüë©‚Äçüëß‚Äçüë¶ DATOS DEL TUTOR:\n`;
                    details += `Nombre: ${player.guardianName}\n`;
                    details += `DNI: ${player.guardianDNI}\n`;
                    details += `Tel√©fono: ${player.guardianPhone}\n`;
                    details += `Email: ${player.guardianEmail}\n`;
                    details += `Direcci√≥n: ${player.guardianAddress || 'No especificada'}\n`;
                }
                
                details += `\n‚úÖ CONSENTIMIENTOS:\n`;
                details += `Jugador del equipo: ${player.playerConsent ? 'S√≠' : 'No'}\n`;
                details += `Fotos y videos: ${player.photoConsent ? 'S√≠' : 'No'}\n`;
                details += `\nFecha de registro: ${new Date(player.registrationDate).toLocaleDateString()}`;
                
                alert(details);
            }
        }

        // Funci√≥n para validar jugador
        function validatePlayer(playerId) {
            if (confirm('¬øValidar este jugador?\n\nEsto cambiar√° su estado a "Activo" y podr√° participar en todas las actividades del club.')) {
                try {
                    const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                    const playerIndex = players.findIndex(p => p.id === playerId);
                    
                    if (playerIndex !== -1) {
                        players[playerIndex].status = 'active';
                        players[playerIndex].validatedDate = new Date().toISOString();
                        localStorage.setItem('clubPlayers', JSON.stringify(players));
                        
                        loadPlayersList();
                        alert('‚úÖ Jugador validado correctamente');
                        console.log('‚úÖ Jugador validado:', players[playerIndex].name, players[playerIndex].surname);
                    }
                } catch (error) {
                    console.error('‚ùå Error validando jugador:', error);
                    alert('‚ùå Error al validar el jugador');
                }
            }
        }

        // Funci√≥n para editar jugador
        function editPlayer(playerId) {
            alert('üîß Funci√≥n de edici√≥n en desarrollo. ID: ' + playerId);
        }

        // Funci√≥n para eliminar jugador
        function deletePlayer(playerId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este jugador?\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer.')) {
                try {
                    const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                    const playerToDelete = players.find(p => p.id === playerId);
                    
                    if (playerToDelete) {
                        const updatedPlayers = players.filter(p => p.id !== playerId);
                        localStorage.setItem('clubPlayers', JSON.stringify(updatedPlayers));
                        
                        loadPlayersList();
                        updateDashboardCounts();
                        alert('‚úÖ Jugador "' + playerToDelete.name + ' ' + playerToDelete.surname + '" eliminado correctamente');
                        console.log('üóëÔ∏è Jugador eliminado:', playerToDelete.name, playerToDelete.surname);
                    }
                } catch (error) {
                    console.error('‚ùå Error eliminando jugador:', error);
                    alert('‚ùå Error al eliminar el jugador');
                }
            }
        }

        // Funci√≥n para actualizar contadores del dashboard
        function updateDashboardCounts() {
            try {
                const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                const playersCountElement = document.getElementById('playersCount');
                if (playersCountElement) {
                    playersCountElement.textContent = players.length;
                }
                
                const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
                const competitionsCountElement = document.getElementById('competitionsCount');
                if (competitionsCountElement) {
                    competitionsCountElement.textContent = competitions.length;
                }
            } catch (error) {
                console.error('‚ùå Error actualizando contadores:', error);
            }
        }

        // Cargar listas al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            loadPlayersList();
            loadMembersList();
            loadFriendsList();
            loadCoachesList();
            loadAdminMessagesHistory();
            loadExportHistory();
            loadAdvertisementsList();
            loadCompetitionsList();
            updateDashboardCounts();
            updateMemberCounts();
            updateFriendCounts();
            updateCoachCounts();
            updateMessageCounts();
            updateAdvertisementCounts();
            updateCategoryCounts();
        });

        // === M√ìDULO DE CALENDARIO ===
        let currentCalendarDate = new Date();
        
        function showAddCalendarEventForm() {
            document.getElementById('addCalendarEventForm').style.display = 'block';
            document.getElementById('addCalendarEventForm').scrollIntoView({ behavior: 'smooth' });
            const today = new Date();
            document.getElementById('calendarDate').value = today.toISOString().split('T')[0];
        }

        function cancelAddCalendarEvent() {
            document.getElementById('addCalendarEventForm').style.display = 'none';
            clearCalendarEventForm();
        }

        function clearCalendarEventForm() {
            const form = document.getElementById('addCalendarEventForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
            document.getElementById('matchFields').style.display = 'none';
            document.getElementById('recurringOptions').style.display = 'none';
        }

        function toggleRecurringOptions() {
            const isRecurring = document.getElementById('calendarRecurring').checked;
            const recurringOptions = document.getElementById('recurringOptions');
            
            if (isRecurring) {
                recurringOptions.style.display = 'block';
                const endDate = new Date();
                endDate.setMonth(endDate.getMonth() + 3);
                document.getElementById('recurringEndDate').value = endDate.toISOString().split('T')[0];
            } else {
                recurringOptions.style.display = 'none';
            }
        }

        function saveCalendarEvent() {
            try {
                const eventData = {
                    id: 'CALENDAR_' + Date.now(),
                    title: document.getElementById('calendarTitle').value.trim(),
                    type: document.getElementById('calendarType').value,
                    date: document.getElementById('calendarDate').value,
                    startTime: document.getElementById('calendarStartTime').value,
                    endTime: document.getElementById('calendarEndTime').value,
                    category: document.getElementById('calendarCategory').value,
                    location: document.getElementById('calendarLocation').value.trim(),
                    description: document.getElementById('calendarDescription').value.trim(),
                    rivalTeam: document.getElementById('rivalTeam').value.trim(),
                    homeAway: document.getElementById('homeAway').value,
                    isRecurring: document.getElementById('calendarRecurring').checked,
                    recurringEndDate: document.getElementById('recurringEndDate').value,
                    createdAt: new Date().toISOString(),
                    createdBy: JSON.parse(localStorage.getItem('currentAdmin') || '{}').email || 'admin'
                };

                if (!eventData.title || !eventData.type || !eventData.date || !eventData.startTime || !eventData.endTime || !eventData.category || !eventData.location) {
                    alert('‚ùå Por favor, completa todos los campos obligatorios marcados con *');
                    return;
                }

                if (eventData.startTime >= eventData.endTime) {
                    alert('‚ùå La hora de fin debe ser posterior a la hora de inicio');
                    return;
                }

                if (eventData.type === 'match' && !eventData.rivalTeam) {
                    alert('‚ùå Para partidos es obligatorio especificar el equipo rival');
                    return;
                }

                const calendarEvents = JSON.parse(localStorage.getItem('clubCalendarEvents') || '[]');
                calendarEvents.push(eventData);
                localStorage.setItem('clubCalendarEvents', JSON.stringify(calendarEvents));

                alert(`‚úÖ Actividad programada exitosamente\n\nüìÖ ${eventData.title}\nüìÜ ${eventData.date}\n‚è∞ ${eventData.startTime} - ${eventData.endTime}\nüìç ${eventData.location}`);
                
                cancelAddCalendarEvent();
                generateCalendarGrid();
                loadUpcomingActivities();

                console.log('üìÖ Nueva actividad programada:', eventData.title);
            } catch (error) {
                console.error('‚ùå Error guardando evento del calendario:', error);
                alert('‚ùå Error al programar la actividad. Int√©ntalo de nuevo.');
            }
        }

        function generateCalendarGrid() {
            try {
                const calendarGrid = document.getElementById('calendarGrid');
                const monthYear = document.getElementById('currentMonthYear');
                
                const year = currentCalendarDate.getFullYear();
                const month = currentCalendarDate.getMonth();
                
                const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                                  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                monthYear.textContent = `${monthNames[month]} ${year}`;

                const events = JSON.parse(localStorage.getItem('clubCalendarEvents') || '[]');
                const filteredEvents = events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.getFullYear() === year && eventDate.getMonth() === month;
                });

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startingDayOfWeek = firstDay.getDay();
                const daysInMonth = lastDay.getDate();

                let html = `
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #ddd; border-radius: 8px; overflow: hidden;">
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Dom</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Lun</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Mar</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Mi√©</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Jue</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">Vie</div>
                        <div style="background: #1e3a8a; color: white; padding: 10px; text-align: center; font-weight: bold;">S√°b</div>
                `;

                for (let i = 0; i < startingDayOfWeek; i++) {
                    html += `<div style="background: #f8f9fa; min-height: 80px; padding: 5px;"></div>`;
                }

                const today = new Date();
                for (let day = 1; day <= daysInMonth; day++) {
                    const currentDate = new Date(year, month, day);
                    const isToday = currentDate.toDateString() === today.toDateString();
                    const dateString = currentDate.toISOString().split('T')[0];
                    
                    const dayEvents = filteredEvents.filter(event => event.date === dateString);
                    
                    let dayClass = isToday ? 'background: #e3f2fd; border: 2px solid #1e3a8a;' : 'background: white;';
                    
                    html += `<div style="${dayClass} min-height: 80px; padding: 5px;"><div style="font-weight: ${isToday ? 'bold' : 'normal'};">${day}</div>`;
                    
                    dayEvents.slice(0, 2).forEach(event => {
                        const typeColors = { 'training': '#059669', 'match': '#dc2626', 'meeting': '#f59e0b', 'event': '#8b5cf6' };
                        html += `<div style="background: ${typeColors[event.type] || '#6c757d'}; color: white; font-size: 0.7rem; padding: 2px; border-radius: 3px; margin: 1px 0; overflow: hidden;">${event.title}</div>`;
                    });
                    
                    if (dayEvents.length > 2) {
                        html += `<div style="font-size: 0.6rem; color: #666;">+${dayEvents.length - 2} m√°s</div>`;
                    }
                    
                    html += `</div>`;
                }

                html += `</div>`;
                calendarGrid.innerHTML = html;
            } catch (error) {
                console.error('‚ùå Error generando calendario:', error);
            }
        }

        function changeCalendarMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            generateCalendarGrid();
        }

        function goToToday() {
            currentCalendarDate = new Date();
            generateCalendarGrid();
        }

        function loadUpcomingActivities() {
            try {
                const events = JSON.parse(localStorage.getItem('clubCalendarEvents') || '[]');
                const upcomingContainer = document.getElementById('upcomingActivities');
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const upcomingEvents = events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate >= today;
                }).sort((a, b) => new Date(a.date) - new Date(b.date)).slice(0, 5);

                if (upcomingEvents.length === 0) {
                    upcomingContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No hay actividades pr√≥ximas programadas.</p>';
                    return;
                }

                const typeIcons = { 'training': 'üèÉ', 'match': '‚öΩ', 'meeting': 'üí¨', 'event': 'üéâ' };

                let html = '<div style="background: white; border-radius: 10px; padding: 15px;">';
                
                upcomingEvents.forEach(event => {
                    const eventDate = new Date(event.date);
                    const isToday = eventDate.toDateString() === new Date().toDateString();
                    
                    html += `<div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; background: ${isToday ? '#fff3cd' : 'transparent'};">
                        <div>
                            <div><span style="margin-right: 8px;">${typeIcons[event.type] || 'üìÖ'}</span><strong>${event.title}</strong></div>
                            <div style="font-size: 0.9em; color: #666;">üìÖ ${eventDate.toLocaleDateString()} | ‚è∞ ${event.startTime} - ${event.endTime} | üìç ${event.location}</div>
                        </div>
                    </div>`;
                });

                html += '</div>';
                upcomingContainer.innerHTML = html;
            } catch (error) {
                console.error('‚ùå Error cargando pr√≥ximas actividades:', error);
            }
        }

        function filterCalendarEvents() {
            generateCalendarGrid();
            loadUpcomingActivities();
        }

        // === M√ìDULO DE EVENTOS ===
        
        function showAddEventForm() {
            document.getElementById('addEventForm').style.display = 'block';
            document.getElementById('addEventForm').scrollIntoView({ behavior: 'smooth' });
            const today = new Date();
            document.getElementById('eventDate').value = today.toISOString().split('T')[0];
        }

        function cancelAddEvent() {
            document.getElementById('addEventForm').style.display = 'none';
            clearEventForm();
        }

        function clearEventForm() {
            const form = document.getElementById('addEventForm');
            const inputs = form.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else if (input.type === 'file') {
                    input.value = '';
                } else {
                    input.value = '';
                }
            });
            document.getElementById('eventImagePreview').style.display = 'none';
        }

        function saveEvent() {
            try {
                const eventData = {
                    id: 'EVENT_' + Date.now(),
                    name: document.getElementById('eventName').value.trim(),
                    date: document.getElementById('eventDate').value,
                    startTime: document.getElementById('eventStartTime').value,
                    endTime: document.getElementById('eventEndTime').value,
                    location: document.getElementById('eventLocation').value.trim(),
                    description: document.getElementById('eventDescription').value.trim(),
                    price: parseFloat(document.getElementById('eventPrice').value) || 0,
                    minParticipants: parseInt(document.getElementById('eventMinParticipants').value),
                    maxParticipants: parseInt(document.getElementById('eventMaxParticipants').value),
                    registrationDeadline: document.getElementById('eventRegistrationDeadline').value,
                    photoConsent: document.getElementById('eventPhotoConsent').checked,
                    dataConsent: document.getElementById('eventDataConsent').checked,
                    image: null, // Se manejar√° por separado
                    participants: [],
                    status: 'upcoming',
                    createdAt: new Date().toISOString(),
                    createdBy: JSON.parse(localStorage.getItem('currentAdmin') || '{}').email || 'admin'
                };

                // Validaciones
                if (!eventData.name || !eventData.date || !eventData.startTime || !eventData.endTime || !eventData.location || !eventData.description) {
                    alert('‚ùå Por favor, completa todos los campos obligatorios marcados con *');
                    return;
                }

                if (eventData.startTime >= eventData.endTime) {
                    alert('‚ùå La hora de fin debe ser posterior a la hora de inicio');
                    return;
                }

                if (eventData.minParticipants > eventData.maxParticipants) {
                    alert('‚ùå El m√≠nimo de participantes no puede ser mayor que el m√°ximo');
                    return;
                }

                // Manejar imagen
                const imageFile = document.getElementById('eventImage').files[0];
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        eventData.image = e.target.result;
                        saveEventToStorage(eventData);
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    saveEventToStorage(eventData);
                }

            } catch (error) {
                console.error('‚ùå Error guardando evento:', error);
                alert('‚ùå Error al crear el evento. Int√©ntalo de nuevo.');
            }
        }

        function saveEventToStorage(eventData) {
            const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
            events.push(eventData);
            localStorage.setItem('clubEvents', JSON.stringify(events));

            const priceText = eventData.price === 0 ? 'Gratuito' : `${eventData.price}‚Ç¨`;
            alert(`‚úÖ Evento creado exitosamente\n\nüéâ ${eventData.name}\nüìÜ ${eventData.date}\nüí∞ ${priceText}\nüë• ${eventData.minParticipants}-${eventData.maxParticipants} participantes`);
            
            cancelAddEvent();
            loadEventsList();
            updateDashboardCounts();

            console.log('üéâ Nuevo evento creado:', eventData.name);
        }

        function loadEventsList() {
            try {
                const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
                const eventsList = document.getElementById('eventsList');
                
                if (events.length === 0) {
                    eventsList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No hay eventos creados a√∫n.</p>';
                    return;
                }

                // Actualizar estado de eventos
                const now = new Date();
                events.forEach(event => {
                    const eventDate = new Date(event.date);
                    const eventEndTime = new Date(`${event.date}T${event.endTime}`);
                    
                    if (eventEndTime < now) {
                        event.status = 'finished';
                    } else if (eventDate.toDateString() === now.toDateString()) {
                        event.status = 'ongoing';
                    } else {
                        event.status = 'upcoming';
                    }
                });

                // Filtrar eventos
                const statusFilter = document.getElementById('eventStatusFilter').value;
                const typeFilter = document.getElementById('eventTypeFilter').value;
                
                const filteredEvents = events.filter(event => {
                    const statusMatch = statusFilter === 'all' || event.status === statusFilter;
                    const typeMatch = typeFilter === 'all' || 
                                    (typeFilter === 'free' && event.price === 0) || 
                                    (typeFilter === 'paid' && event.price > 0);
                    return statusMatch && typeMatch;
                }).sort((a, b) => new Date(a.date) - new Date(b.date));

                let html = '<div style="background: white; border-radius: 10px; padding: 15px;">';

                filteredEvents.forEach(event => {
                    const statusColors = { 'upcoming': '#f59e0b', 'ongoing': '#059669', 'finished': '#6c757d' };
                    const statusTexts = { 'upcoming': 'Pr√≥ximo', 'ongoing': 'En Curso', 'finished': 'Finalizado' };
                    const priceText = event.price === 0 ? 'Gratuito' : `${event.price}‚Ç¨`;
                    const participantsCount = event.participants ? event.participants.length : 0;
                    const availableSpots = event.maxParticipants - participantsCount;
                    
                    html += `
                        <div style="border: 1px solid #e9ecef; border-radius: 10px; padding: 20px; margin-bottom: 15px; ${event.image ? 'display: flex; gap: 20px;' : ''}">
                            ${event.image ? `<div style="flex-shrink: 0;"><img src="${event.image}" style="width: 150px; height: 100px; object-fit: cover; border-radius: 8px;"></div>` : ''}
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                    <div>
                                        <h4 style="margin: 0 0 5px 0; color: #1e3a8a;">${event.name}</h4>
                                        <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">
                                            üìÖ ${new Date(event.date).toLocaleDateString()} | ‚è∞ ${event.startTime} - ${event.endTime} | üìç ${event.location}
                                        </div>
                                        <div style="font-size: 0.9em; color: #666;">
                                            üí∞ ${priceText} | üë• ${participantsCount}/${event.maxParticipants} inscritos | ‚úÖ ${availableSpots} plazas disponibles
                                        </div>
                                    </div>
                                    <span style="background: ${statusColors[event.status]}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                                        ${statusTexts[event.status]}
                                    </span>
                                </div>
                                <p style="margin: 10px 0; color: #555; font-size: 0.9em;">${event.description}</p>
                                <div style="display: flex; gap: 10px; margin-top: 15px;">
                                    <button onclick="viewEventDetails('${event.id}')" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">üëÅÔ∏è Ver Detalles</button>
                                    <button onclick="manageEventParticipants('${event.id}')" style="padding: 6px 12px; background: #1e3a8a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">üë• Participantes</button>
                                    <button onclick="editEvent('${event.id}')" style="padding: 6px 12px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">‚úèÔ∏è Editar</button>
                                    <button onclick="deleteEvent('${event.id}')" style="padding: 6px 12px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">üóëÔ∏è Eliminar</button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                eventsList.innerHTML = html;
                
                // Guardar eventos actualizados
                localStorage.setItem('clubEvents', JSON.stringify(events));
                
                console.log('üéâ Lista de eventos cargada:', filteredEvents.length, 'eventos');
            } catch (error) {
                console.error('‚ùå Error cargando lista de eventos:', error);
            }
        }

        function filterEvents() {
            loadEventsList();
        }

        function viewEventDetails(eventId) {
            const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
            const event = events.find(e => e.id === eventId);
            
            if (event) {
                const priceText = event.price === 0 ? 'Gratuito' : `${event.price}‚Ç¨`;
                const participantsCount = event.participants ? event.participants.length : 0;
                
                let details = `üéâ DETALLES DEL EVENTO\n\n`;
                details += `Nombre: ${event.name}\n`;
                details += `Fecha: ${new Date(event.date).toLocaleDateString()}\n`;
                details += `Hora: ${event.startTime} - ${event.endTime}\n`;
                details += `Ubicaci√≥n: ${event.location}\n`;
                details += `Precio: ${priceText}\n`;
                details += `Participantes: ${participantsCount}/${event.maxParticipants}\n`;
                details += `M√≠nimo requerido: ${event.minParticipants}\n`;
                
                if (event.registrationDeadline) {
                    details += `Fecha l√≠mite inscripci√≥n: ${new Date(event.registrationDeadline).toLocaleDateString()}\n`;
                }
                
                details += `\nDescripci√≥n: ${event.description}\n`;
                
                if (event.photoConsent || event.dataConsent) {
                    details += `\n‚úÖ CONSENTIMIENTOS REQUERIDOS:\n`;
                    if (event.photoConsent) details += `- Autorizaci√≥n para fotos y videos\n`;
                    if (event.dataConsent) details += `- Tratamiento de datos personales\n`;
                }
                
                details += `\nCreado: ${new Date(event.createdAt).toLocaleDateString()}\nPor: ${event.createdBy}`;
                
                alert(details);
            }
        }

        function manageEventParticipants(eventId) {
            alert('üîß Gesti√≥n de participantes en desarrollo. ID: ' + eventId);
        }

        function editEvent(eventId) {
            alert('üîß Funci√≥n de edici√≥n en desarrollo. ID: ' + eventId);
        }

        function deleteEvent(eventId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este evento?\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer y eliminar√° todas las inscripciones.')) {
                try {
                    const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
                    const eventToDelete = events.find(e => e.id === eventId);
                    
                    if (eventToDelete) {
                        const updatedEvents = events.filter(e => e.id !== eventId);
                        localStorage.setItem('clubEvents', JSON.stringify(updatedEvents));
                        
                        loadEventsList();
                        updateDashboardCounts();
                        alert('‚úÖ Evento "' + eventToDelete.name + '" eliminado correctamente');
                        console.log('üóëÔ∏è Evento eliminado:', eventToDelete.name);
                    }
                } catch (error) {
                    console.error('‚ùå Error eliminando evento:', error);
                    alert('‚ùå Error al eliminar el evento');
                }
            }
        }

        // Vista previa de imagen
        document.addEventListener('DOMContentLoaded', function() {
            const eventImage = document.getElementById('eventImage');
            if (eventImage) {
                eventImage.addEventListener('change', function() {
                    const file = this.files[0];
                    const preview = document.getElementById('eventImagePreview');
                    const previewImg = document.getElementById('eventImagePreviewImg');
                    
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewImg.src = e.target.result;
                            preview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        preview.style.display = 'none';
                    }
                });
            }
        });

        // Mostrar/ocultar campos de partido
        document.addEventListener('DOMContentLoaded', function() {
            const calendarType = document.getElementById('calendarType');
            if (calendarType) {
                calendarType.addEventListener('change', function() {
                    const matchFields = document.getElementById('matchFields');
                    if (this.value === 'match') {
                        matchFields.style.display = 'block';
                    } else {
                        matchFields.style.display = 'none';
                    }
                });
            }
        });

        // === M√ìDULO DE COMPETICIONES ===
        
        function showAddCompetitionForm() {
            document.getElementById('addCompetitionForm').style.display = 'block';
            document.getElementById('addCompetitionForm').scrollIntoView({ behavior: 'smooth' });
            const today = new Date();
            document.getElementById('competitionStartDate').value = today.toISOString().split('T')[0];
        }

        function cancelAddCompetition() {
            document.getElementById('addCompetitionForm').style.display = 'none';
            clearCompetitionForm();
        }

        function clearCompetitionForm() {
            const form = document.getElementById('addCompetitionForm');
            const inputs = form.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
            document.getElementById('maxTeams').value = '8';
        }

        function toggleCompetitionFields() {
            const competitionType = document.getElementById('competitionType').value;
            const maxTeamsField = document.getElementById('maxTeams');
            
            if (competitionType === 'torneo') {
                maxTeamsField.value = '8';
                maxTeamsField.max = '32';
            } else if (competitionType === 'liga') {
                maxTeamsField.value = '10';
                maxTeamsField.max = '20';
            } else {
                maxTeamsField.value = '4';
                maxTeamsField.max = '8';
            }
        }

        function saveCompetition() {
            try {
                const competitionData = {
                    id: 'COMP_' + Date.now(),
                    name: document.getElementById('competitionName').value.trim(),
                    category: document.getElementById('competitionCategory').value,
                    type: document.getElementById('competitionType').value,
                    startDate: document.getElementById('competitionStartDate').value,
                    endDate: document.getElementById('competitionEndDate').value,
                    description: document.getElementById('competitionDescription').value.trim(),
                    maxTeams: parseInt(document.getElementById('maxTeams').value),
                    rules: document.getElementById('competitionRules').value.trim(),
                    teams: [],
                    matches: [],
                    phases: [],
                    status: 'inscripcion',
                    createdAt: new Date().toISOString(),
                    createdBy: JSON.parse(localStorage.getItem('currentAdmin') || '{}').email || 'admin'
                };

                // Validaciones
                if (!competitionData.name || !competitionData.category || !competitionData.type || 
                    !competitionData.startDate || !competitionData.endDate) {
                    alert('‚ùå Por favor, completa todos los campos obligatorios marcados con *');
                    return;
                }

                if (new Date(competitionData.startDate) >= new Date(competitionData.endDate)) {
                    alert('‚ùå La fecha de fin debe ser posterior a la fecha de inicio');
                    return;
                }

                // Generar fases autom√°ticamente para torneos
                if (competitionData.type === 'torneo') {
                    competitionData.phases = generateTournamentPhases(competitionData.maxTeams);
                }

                // Guardar en localStorage
                const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
                competitions.push(competitionData);
                localStorage.setItem('clubCompetitions', JSON.stringify(competitions));

                alert(`‚úÖ Competici√≥n creada exitosamente\n\nüèÜ ${competitionData.name}\nüìÖ ${competitionData.startDate} - ${competitionData.endDate}\nüë• ${competitionData.maxTeams} equipos m√°ximo`);
                
                cancelAddCompetition();
                loadCompetitionsList();
                updateDashboardCounts();

                console.log('üèÜ Nueva competici√≥n creada:', competitionData.name);
            } catch (error) {
                console.error('‚ùå Error guardando competici√≥n:', error);
                alert('‚ùå Error al crear la competici√≥n. Int√©ntalo de nuevo.');
            }
        }

        function generateTournamentPhases(maxTeams) {
            const phases = [];
            let currentTeams = maxTeams;
            let phaseNumber = 1;
            
            while (currentTeams > 1) {
                let phaseName = '';
                if (currentTeams === 2) {
                    phaseName = 'Final';
                } else if (currentTeams === 4) {
                    phaseName = 'Semifinales';
                } else if (currentTeams === 8) {
                    phaseName = 'Cuartos de Final';
                } else if (currentTeams === 16) {
                    phaseName = 'Octavos de Final';
                } else {
                    phaseName = `Fase ${phaseNumber}`;
                }
                
                phases.push({
                    id: `phase_${phaseNumber}`,
                    name: phaseName,
                    teams: currentTeams,
                    matches: [],
                    status: 'pending'
                });
                
                currentTeams = Math.ceil(currentTeams / 2);
                phaseNumber++;
            }
            
            return phases;
        }

        function loadCompetitionsList() {
            try {
                const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
                const competitionsList = document.getElementById('competitionsList');
                
                if (competitions.length === 0) {
                    competitionsList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No hay competiciones creadas a√∫n.</p>';
                    return;
                }

                // Actualizar estado de competiciones
                const now = new Date();
                competitions.forEach(competition => {
                    const startDate = new Date(competition.startDate);
                    const endDate = new Date(competition.endDate);
                    
                    if (endDate < now) {
                        competition.status = 'finalizado';
                    } else if (startDate <= now && endDate >= now) {
                        competition.status = 'activo';
                    } else {
                        competition.status = 'inscripcion';
                    }
                });

                // Filtrar competiciones
                const categoryFilter = document.getElementById('competitionCategoryFilter').value;
                const statusFilter = document.getElementById('competitionStatusFilter').value;
                
                const filteredCompetitions = competitions.filter(competition => {
                    const categoryMatch = !categoryFilter || competition.category === categoryFilter;
                    const statusMatch = !statusFilter || competition.status === statusFilter;
                    return categoryMatch && statusMatch;
                }).sort((a, b) => new Date(a.startDate) - new Date(b.startDate));

                let html = '<div style="background: white; border-radius: 10px; padding: 15px;">';

                filteredCompetitions.forEach(competition => {
                    const statusColors = { 'inscripcion': '#f59e0b', 'activo': '#059669', 'finalizado': '#6c757d' };
                    const statusTexts = { 'inscripcion': 'En Inscripci√≥n', 'activo': 'Activo', 'finalizado': 'Finalizado' };
                    const typeTexts = { 'liga': 'Liga', 'torneo': 'Torneo', 'amistoso': 'Amistoso' };
                    const teamsCount = competition.teams ? competition.teams.length : 0;
                    const availableSpots = competition.maxTeams - teamsCount;
                    
                    html += `
                        <div style="border: 1px solid #e9ecef; border-radius: 10px; padding: 20px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <div>
                                    <h4 style="margin: 0 0 5px 0; color: #1e3a8a;">üèÜ ${competition.name}</h4>
                                    <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">
                                        üìÖ ${new Date(competition.startDate).toLocaleDateString()} - ${new Date(competition.endDate).toLocaleDateString()} | 
                                        üè∑Ô∏è ${competition.category} | 
                                        üéØ ${typeTexts[competition.type]}
                                    </div>
                                    <div style="font-size: 0.9em; color: #666;">
                                        üë• ${teamsCount}/${competition.maxTeams} equipos inscritos | ‚úÖ ${availableSpots} plazas disponibles
                                    </div>
                                </div>
                                <span style="background: ${statusColors[competition.status]}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                                    ${statusTexts[competition.status]}
                                </span>
                            </div>
                            ${competition.description ? `<p style="margin: 10px 0; color: #555; font-size: 0.9em;">${competition.description}</p>` : ''}
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button onclick="viewCompetitionDetails('${competition.id}')" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">üëÅÔ∏è Ver Detalles</button>
                                <button onclick="manageCompetitionTeams('${competition.id}')" style="padding: 6px 12px; background: #1e3a8a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">üë• Equipos</button>
                                <button onclick="manageCompetitionMatches('${competition.id}')" style="padding: 6px 12px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">‚öΩ Partidos</button>
                                <button onclick="editCompetition('${competition.id}')" style="padding: 6px 12px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">‚úèÔ∏è Editar</button>
                                <button onclick="deleteCompetition('${competition.id}')" style="padding: 6px 12px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">üóëÔ∏è Eliminar</button>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                competitionsList.innerHTML = html;
                
                // Guardar competiciones actualizadas
                localStorage.setItem('clubCompetitions', JSON.stringify(competitions));
                
                console.log('üèÜ Lista de competiciones cargada:', filteredCompetitions.length, 'competiciones');
            } catch (error) {
                console.error('‚ùå Error cargando lista de competiciones:', error);
            }
        }

        function filterCompetitions() {
            loadCompetitionsList();
        }

        function viewCompetitionDetails(competitionId) {
            const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
            const competition = competitions.find(c => c.id === competitionId);
            
            if (competition) {
                const typeTexts = { 'liga': 'Liga', 'torneo': 'Torneo', 'amistoso': 'Amistoso' };
                const teamsCount = competition.teams ? competition.teams.length : 0;
                
                let details = `üèÜ DETALLES DE LA COMPETICI√ìN\n\n`;
                details += `Nombre: ${competition.name}\n`;
                details += `Categor√≠a: ${competition.category}\n`;
                details += `Tipo: ${typeTexts[competition.type]}\n`;
                details += `Fecha: ${new Date(competition.startDate).toLocaleDateString()} - ${new Date(competition.endDate).toLocaleDateString()}\n`;
                details += `Equipos: ${teamsCount}/${competition.maxTeams}\n`;
                
                if (competition.description) {
                    details += `\nDescripci√≥n: ${competition.description}\n`;
                }
                
                if (competition.rules) {
                    details += `\nReglamento: ${competition.rules}\n`;
                }
                
                if (competition.type === 'torneo' && competition.phases) {
                    details += `\nüèÖ FASES DEL TORNEO:\n`;
                    competition.phases.forEach(phase => {
                        details += `- ${phase.name}: ${phase.teams} equipos\n`;
                    });
                }
                
                details += `\nCreado: ${new Date(competition.createdAt).toLocaleDateString()}\nPor: ${competition.createdBy}`;
                
                alert(details);
            }
        }

        function manageCompetitionTeams(competitionId) {
            alert('üîß Gesti√≥n de equipos participantes en desarrollo. ID: ' + competitionId);
        }

        function manageCompetitionMatches(competitionId) {
            alert('üîß Gesti√≥n de partidos y resultados en desarrollo. ID: ' + competitionId);
        }

        function editCompetition(competitionId) {
            alert('üîß Funci√≥n de edici√≥n en desarrollo. ID: ' + competitionId);
        }

        function deleteCompetition(competitionId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta competici√≥n?\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer y eliminar√° todos los datos asociados.')) {
                try {
                    const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
                    const competitionToDelete = competitions.find(c => c.id === competitionId);
                    
                    if (competitionToDelete) {
                        const updatedCompetitions = competitions.filter(c => c.id !== competitionId);
                        localStorage.setItem('clubCompetitions', JSON.stringify(updatedCompetitions));
                        
                        loadCompetitionsList();
                        updateDashboardCounts();
                        alert('‚úÖ Competici√≥n "' + competitionToDelete.name + '" eliminada correctamente');
                        console.log('üóëÔ∏è Competici√≥n eliminada:', competitionToDelete.name);
                    }
                } catch (error) {
                    console.error('‚ùå Error eliminando competici√≥n:', error);
                    alert('‚ùå Error al eliminar la competici√≥n');
                }
            }
        }

        // ===== FUNCIONES PARA GESTI√ìN DE CATEGOR√çAS DE EQUIPOS =====
        function manageCategoryPlayers(category) {
            // Cambiar a la pesta√±a de jugadores
            showTab('jugadores');
            
            // Establecer el filtro de categor√≠a
            const categoryFilter = document.getElementById('categoryFilter');
            if (categoryFilter) {
                categoryFilter.value = category;
                filterPlayersByCategory();
            }
            
            // Mostrar mensaje informativo
            setTimeout(() => {
                alert(`üë• Gesti√≥n de Jugadores - Categor√≠a: ${getCategoryDisplayName(category)}\n\nAhora puedes ver y gestionar todos los jugadores de esta categor√≠a.`);
            }, 100);
        }

        function getCategoryDisplayName(category) {
            const categories = {
                'prebenajmin': 'Prebenjam√≠n (6-8 a√±os)',
                'benjamin': 'Benjam√≠n (8-10 a√±os)',
                'alevin': 'Alev√≠n (10-12 a√±os)',
                'infantil': 'Infantil (12-14 a√±os)',
                'aficionado': 'Aficionado (18+ a√±os)'
            };
            return categories[category] || category;
        }

        // ===== FUNCIONES PARA GESTI√ìN DE SOCIOS =====
        function showAddMemberForm() {
            const form = document.getElementById('addMemberForm');
            if (form) {
                form.style.display = 'block';
                clearMemberForm();
            }
        }

        function cancelAddMember() {
            const form = document.getElementById('addMemberForm');
            if (form) {
                form.style.display = 'none';
                clearMemberForm();
            }
        }

        function clearMemberForm() {
            document.getElementById('memberName').value = '';
            document.getElementById('memberSurname').value = '';
            document.getElementById('memberDNI').value = '';
            document.getElementById('memberPhone').value = '';
            document.getElementById('memberAddress').value = '';
            document.getElementById('memberEmail').value = '';
            document.getElementById('memberPassword').value = '';
        }

        function saveMember() {
            try {
                const name = document.getElementById('memberName').value.trim();
                const surname = document.getElementById('memberSurname').value.trim();
                const dni = document.getElementById('memberDNI').value.trim();
                const phone = document.getElementById('memberPhone').value.trim();
                const address = document.getElementById('memberAddress').value.trim();
                const email = document.getElementById('memberEmail').value.trim();
                const password = document.getElementById('memberPassword').value.trim();

                // Validar campos obligatorios
                if (!name || !surname || !phone || !password) {
                    alert('‚ùå Error: Los campos Nombre, Apellidos, Tel√©fono y Contrase√±a son obligatorios.');
                    return;
                }

                // Obtener socios existentes
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                
                // Verificar DNI √∫nico si se proporciona
                if (dni) {
                    const existingMember = members.find(m => m.dni && m.dni.toLowerCase() === dni.toLowerCase());
                    if (existingMember) {
                        alert('‚ùå Error: Ya existe un socio con ese DNI.');
                        return;
                    }
                }

                // Crear nuevo socio
                const newMember = {
                    id: 'MEMBER_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name: name,
                    surname: surname,
                    dni: dni,
                    phone: phone,
                    address: address,
                    email: email,
                    password: password, // Contrase√±a del socio
                    status: 'pending_validation',
                    registrationDate: new Date().toISOString(),
                    validatedBy: null,
                    validatedDate: null,
                    memberNumber: null // Se asignar√° al validar
                };

                // Agregar a la lista
                members.push(newMember);
                localStorage.setItem('clubMembers', JSON.stringify(members));

                // Cerrar formulario y recargar lista
                cancelAddMember();
                loadMembersList();
                updateMemberCounts();
                updateDashboardCounts();

                alert('‚úÖ Socio registrado correctamente.\n\n‚ö†Ô∏è Recuerda: Debe ser validado por un administrador en 7 d√≠as.');
                console.log('üë§ Nuevo socio registrado:', newMember.name + ' ' + newMember.surname);

            } catch (error) {
                console.error('‚ùå Error guardando socio:', error);
                alert('‚ùå Error al guardar el socio. Int√©ntalo de nuevo.');
            }
        }

        function loadMembersList() {
            try {
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                const membersList = document.getElementById('membersList');
                const statusFilter = document.getElementById('memberStatusFilter').value;

                if (!membersList) return;

                // Filtrar socios seg√∫n el estado
                let filteredMembers = members;
                if (statusFilter !== 'all') {
                    filteredMembers = members.filter(member => {
                        if (statusFilter === 'pending') return member.status === 'pending_validation';
                        if (statusFilter === 'active') return member.status === 'active';
                        if (statusFilter === 'expired') return isMemberExpired(member);
                        return true;
                    });
                }

                if (filteredMembers.length === 0) {
                    membersList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No hay socios que mostrar con los filtros actuales.</div>';
                    return;
                }

                let html = '';
                filteredMembers.forEach(member => {
                    const isExpired = isMemberExpired(member);
                    const statusText = getMemberStatusText(member, isExpired);
                    const statusColor = getMemberStatusColor(member, isExpired);

                    html += `
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid ${statusColor};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <h4 style="margin: 0 0 5px 0; color: #1e3a8a;">${member.name} ${member.surname}</h4>
                                    <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">
                                        üìû ${member.phone} | üìß ${member.email || 'No especificado'} | üìç ${member.address || 'No especificada'}
                                    </div>
                                    <div style="font-size: 0.9em; color: #666;">
                                        üÜî DNI: ${member.dni || 'No especificado'} | üìÖ Registro: ${new Date(member.registrationDate).toLocaleDateString()}
                                        ${member.memberNumber ? `| üî¢ N¬∫ Socio: ${member.memberNumber}` : ''}
                                    </div>
                                    <div style="font-size: 0.9em; color: #059669; font-weight: bold; margin-top: 5px;">
                                        üîê Contrase√±a: 
                                        <span id="member-password-${member.id}">${member.password ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : 'No establecida'}</span>
                                        ${member.password ? `<button onclick="togglePassword('member-password-${member.id}', '${member.password}')" style="background: none; border: none; color: #059669; cursor: pointer; font-size: 0.8rem; margin-left: 5px;">üëÅÔ∏è</button>` : ''}
                                    </div>
                                </div>
                                <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                                    ${statusText}
                                </span>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button onclick="viewMemberDetails('${member.id}')" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">üëÅÔ∏è Ver Detalles</button>
                                ${member.status === 'pending_validation' ? `<button onclick="validateMember('${member.id}')" style="padding: 6px 12px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">‚úÖ Validar</button>` : ''}
                                <button onclick="editMember('${member.id}')" style="padding: 6px 12px; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">‚úèÔ∏è Editar</button>
                                <button onclick="deleteMember('${member.id}')" style="padding: 6px 12px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">üóëÔ∏è Eliminar</button>
                            </div>
                        </div>
                    `;
                });

                membersList.innerHTML = html;
                console.log('üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Lista de socios cargada:', filteredMembers.length, 'socios');

            } catch (error) {
                console.error('‚ùå Error cargando lista de socios:', error);
            }
        }

        function isMemberExpired(member) {
            if (member.status === 'active') return false;
            
            const registrationDate = new Date(member.registrationDate);
            const currentDate = new Date();
            const daysDiff = (currentDate - registrationDate) / (1000 * 60 * 60 * 24);
            
            return daysDiff > 7;
        }

        function getMemberStatusText(member, isExpired) {
            if (member.status === 'active') return 'Activo';
            if (isExpired) return 'Caducado';
            return 'Pendiente';
        }

        function getMemberStatusColor(member, isExpired) {
            if (member.status === 'active') return '#059669';
            if (isExpired) return '#dc2626';
            return '#f59e0b';
        }

        function filterMembers() {
            loadMembersList();
        }

        function viewMemberDetails(memberId) {
            const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
            const member = members.find(m => m.id === memberId);
            
            if (member) {
                const isExpired = isMemberExpired(member);
                let details = `üë§ DETALLES DEL SOCIO\n\n`;
                details += `Nombre: ${member.name} ${member.surname}\n`;
                details += `DNI: ${member.dni || 'No especificado'}\n`;
                details += `Tel√©fono: ${member.phone}\n`;
                details += `Direcci√≥n: ${member.address || 'No especificada'}\n`;
                details += `Email: ${member.email || 'No especificado'}\n`;
                details += `Estado: ${getMemberStatusText(member, isExpired)}\n`;
                details += `Fecha de Registro: ${new Date(member.registrationDate).toLocaleDateString()}\n`;
                
                if (member.memberNumber) {
                    details += `N√∫mero de Socio: ${member.memberNumber}\n`;
                }
                
                if (member.validatedBy) {
                    details += `Validado por: ${member.validatedBy}\n`;
                    details += `Fecha de Validaci√≥n: ${new Date(member.validatedDate).toLocaleDateString()}\n`;
                }
                
                details += `Contrase√±a: ${member.password ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢ (Haz clic en üëÅÔ∏è para ver)' : 'No establecida'}\n`;
                
                if (isExpired) {
                    details += `\n‚ö†Ô∏è Este socio ha superado el plazo de 7 d√≠as sin validaci√≥n.`;
                }
                
                alert(details);
            }
        }

        function validateMember(memberId) {
            try {
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                const memberIndex = members.findIndex(m => m.id === memberId);
                
                if (memberIndex !== -1) {
                    const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                    
                    // Verificar si el socio no ha expirado (7 d√≠as)
                    const registrationDate = new Date(members[memberIndex].registrationDate);
                    const currentDate = new Date();
                    const daysDiff = (currentDate - registrationDate) / (1000 * 60 * 60 * 24);
                    
                    if (daysDiff > 7) {
                        alert('‚ùå No se puede validar este socio. Ha superado el plazo de 7 d√≠as desde su registro.\n\nEl socio ser√° eliminado autom√°ticamente.');
                        deleteExpiredMembers();
                        return;
                    }
                    
                    // Asignar n√∫mero de socio
                    const activeMembers = members.filter(m => m.status === 'active');
                    const nextNumber = activeMembers.length + 1;
                    
                    members[memberIndex].status = 'active';
                    members[memberIndex].memberNumber = nextNumber;
                    members[memberIndex].validatedBy = currentAdmin.name || currentAdmin.email || 'Administrador';
                    members[memberIndex].validatedDate = new Date().toISOString();
                    
                    localStorage.setItem('clubMembers', JSON.stringify(members));
                    
                    loadMembersList();
                    updateMemberCounts();
                    updateDashboardCounts();
                    
                    alert(`‚úÖ Socio "${members[memberIndex].name} ${members[memberIndex].surname}" validado correctamente.\n\nüî¢ N√∫mero de socio asignado: ${nextNumber}`);
                    console.log('‚úÖ Socio validado:', members[memberIndex].name + ' ' + members[memberIndex].surname);
                }
            } catch (error) {
                console.error('‚ùå Error validando socio:', error);
                alert('‚ùå Error al validar el socio');
            }
        }

        // Funci√≥n para eliminar socios expirados (m√°s de 7 d√≠as sin validar)
        function deleteExpiredMembers() {
            try {
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                const currentDate = new Date();
                let deletedCount = 0;
                
                const updatedMembers = members.filter(member => {
                    if (member.status === 'pending_validation') {
                        const registrationDate = new Date(member.registrationDate);
                        const daysDiff = (currentDate - registrationDate) / (1000 * 60 * 60 * 24);
                        
                        if (daysDiff > 7) {
                            console.log('üóëÔ∏è Socio expirado eliminado:', member.name + ' ' + member.surname);
                            deletedCount++;
                            return false; // Eliminar de la lista
                        }
                    }
                    return true; // Mantener en la lista
                });
                
                if (deletedCount > 0) {
                    localStorage.setItem('clubMembers', JSON.stringify(updatedMembers));
                    loadMembersList();
                    updateMemberCounts();
                    updateDashboardCounts();
                    
                    alert(`üóëÔ∏è Se han eliminado ${deletedCount} socios que superaron el plazo de 7 d√≠as sin validaci√≥n.`);
                }
            } catch (error) {
                console.error('‚ùå Error eliminando socios expirados:', error);
            }
        }

        // Funci√≥n para verificar y eliminar socios expirados al cargar la p√°gina
        function checkExpiredMembers() {
            deleteExpiredMembers();
        }

        function editMember(memberId) {
            alert('üîß Funci√≥n de edici√≥n de socios en desarrollo. ID: ' + memberId);
        }

        function deleteMember(memberId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este socio?\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer.')) {
                try {
                    const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                    const memberToDelete = members.find(m => m.id === memberId);
                    
                    if (memberToDelete) {
                        const updatedMembers = members.filter(m => m.id !== memberId);
                        localStorage.setItem('clubMembers', JSON.stringify(updatedMembers));
                        
                        loadMembersList();
                        updateMemberCounts();
                        updateDashboardCounts();
                        
                        alert('‚úÖ Socio "' + memberToDelete.name + ' ' + memberToDelete.surname + '" eliminado correctamente');
                        console.log('üóëÔ∏è Socio eliminado:', memberToDelete.name + ' ' + memberToDelete.surname);
                    }
                } catch (error) {
                    console.error('‚ùå Error eliminando socio:', error);
                    alert('‚ùå Error al eliminar el socio');
                }
            }
        }

        function validateAllPendingMembers() {
            if (confirm('¬øEst√°s seguro de que quieres validar TODOS los socios pendientes?\n\n‚ö†Ô∏è Esta acci√≥n validar√° todos los socios que est√©n pendientes de validaci√≥n.')) {
                try {
                    const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                    const pendingMembers = members.filter(m => m.status === 'pending_validation');
                    const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                    
                    if (pendingMembers.length === 0) {
                        alert('‚ÑπÔ∏è No hay socios pendientes de validaci√≥n.');
                        return;
                    }
                    
                    let validatedCount = 0;
                    const activeMembers = members.filter(m => m.status === 'active');
                    let nextNumber = activeMembers.length + 1;
                    
                    members.forEach(member => {
                        if (member.status === 'pending_validation') {
                            member.status = 'active';
                            member.memberNumber = nextNumber++;
                            member.validatedBy = currentAdmin.name || currentAdmin.email || 'Administrador';
                            member.validatedDate = new Date().toISOString();
                            validatedCount++;
                        }
                    });
                    
                    localStorage.setItem('clubMembers', JSON.stringify(members));
                    
                    loadMembersList();
                    updateMemberCounts();
                    updateDashboardCounts();
                    
                    alert(`‚úÖ ${validatedCount} socios validados correctamente.`);
                    console.log('‚úÖ Socios validados en lote:', validatedCount);
                    
                } catch (error) {
                    console.error('‚ùå Error validando socios en lote:', error);
                    alert('‚ùå Error al validar los socios');
                }
            }
        }

        function cleanExpiredMembers() {
            if (confirm('¬øEst√°s seguro de que quieres eliminar TODOS los socios caducados?\n\n‚ö†Ô∏è Esta acci√≥n eliminar√° todos los socios que han superado el plazo de 7 d√≠as sin validaci√≥n.')) {
                try {
                    const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                    const expiredMembers = members.filter(m => isMemberExpired(m));
                    
                    if (expiredMembers.length === 0) {
                        alert('‚ÑπÔ∏è No hay socios caducados para eliminar.');
                        return;
                    }
                    
                    const updatedMembers = members.filter(m => !isMemberExpired(m));
                    localStorage.setItem('clubMembers', JSON.stringify(updatedMembers));
                    
                    loadMembersList();
                    updateMemberCounts();
                    updateDashboardCounts();
                    
                    alert(`üóëÔ∏è ${expiredMembers.length} socios caducados eliminados correctamente.`);
                    console.log('üóëÔ∏è Socios caducados eliminados:', expiredMembers.length);
                    
                } catch (error) {
                    console.error('‚ùå Error eliminando socios caducados:', error);
                    alert('‚ùå Error al eliminar los socios caducados');
                }
            }
        }

        function updateMemberCounts() {
            try {
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                
                const activeCount = members.filter(m => m.status === 'active').length;
                const pendingCount = members.filter(m => m.status === 'pending_validation').length;
                const expiredCount = members.filter(m => isMemberExpired(m)).length;
                
                // Actualizar contadores en la interfaz
                const activeElement = document.getElementById('activeMembersCount');
                const pendingElement = document.getElementById('pendingMembersCount');
                const expiredElement = document.getElementById('expiredMembersCount');
                
                if (activeElement) activeElement.textContent = activeCount;
                if (pendingElement) pendingElement.textContent = pendingCount;
                if (expiredElement) expiredElement.textContent = expiredCount;
                
                // Calcular pr√≥ximo n√∫mero de socio
                const nextNumber = activeCount + 1;
                const nextElement = document.getElementById('nextMemberNumber');
                if (nextElement) nextElement.textContent = nextNumber;
                
                console.log('üìä Contadores de socios actualizados:', { activeCount, pendingCount, expiredCount, nextNumber });
                
            } catch (error) {
                console.error('‚ùå Error actualizando contadores de socios:', error);
            }
        }

        // ===== ACTUALIZACI√ìN DE CONTADORES DE CATEGOR√çAS =====
        function updateCategoryCounts() {
            try {
                // PONER TODOS LOS CONTADORES DE CATEGOR√çAS A CERO
                const categories = ['prebenajmin', 'benjamin', 'alevin', 'infantil', 'aficionado'];
                categories.forEach(category => {
                    const element = document.getElementById(category + 'Count');
                    if (element) {
                        element.textContent = '0';
                    }
                });
                
                console.log('üìä Contadores de categor√≠as reseteados a cero');
                
            } catch (error) {
                console.error('‚ùå Error actualizando contadores de categor√≠as:', error);
            }
        }

        // ===== ACTUALIZACI√ìN DE FUNCI√ìN updateDashboardCounts =====
        function updateDashboardCounts() {
            try {
                // PONER TODOS LOS CONTADORES A CERO
                const activePlayers = 0;
                const activeMembers = 0;
                const activeFriends = 0;
                const eventsCount = 0;
                const competitionsCount = 0;
                
                // Actualizar elementos del dashboard
                const playersElement = document.getElementById('playersCount');
                const membersElement = document.getElementById('membersCount');
                const eventsElement = document.getElementById('eventsCount');
                const competitionsElement = document.getElementById('competitionsCount');
                
                if (playersElement) playersElement.textContent = activePlayers;
                if (membersElement) membersElement.textContent = activeMembers;
                if (eventsElement) eventsElement.textContent = eventsCount;
                if (competitionsElement) competitionsElement.textContent = competitionsCount;
                
                // Actualizar contadores de categor√≠as a cero
                updateCategoryCounts();
                
                console.log('üìä Dashboard reseteado a cero:', { activePlayers, activeMembers, activeFriends, eventsCount, competitionsCount });
                
            } catch (error) {
                console.error('‚ùå Error actualizando dashboard:', error);
            }
        }

        // ===== M√ìDULO DE AMIGOS DEL CLUB =====
        
        function showAddFriendForm() {
            const form = document.getElementById('addFriendForm');
            if (form) {
                form.style.display = 'block';
                clearFriendForm();
            }
        }

        function cancelAddFriend() {
            const form = document.getElementById('addFriendForm');
            if (form) {
                form.style.display = 'none';
                clearFriendForm();
            }
        }

        function clearFriendForm() {
            document.getElementById('friendName').value = '';
            document.getElementById('friendSurname').value = '';
            document.getElementById('friendDNI').value = '';
            document.getElementById('friendPhone').value = '';
            document.getElementById('friendEmail').value = '';
        }

        function saveFriend() {
            try {
                const name = document.getElementById('friendName').value.trim();
                const surname = document.getElementById('friendSurname').value.trim();
                const dni = document.getElementById('friendDNI').value.trim();
                const phone = document.getElementById('friendPhone').value.trim();
                const email = document.getElementById('friendEmail').value.trim();

                // Validar campos obligatorios
                if (!name || !surname || !dni || !phone || !email) {
                    alert('‚ùå Error: Todos los campos son obligatorios para registrar un amigo del club.');
                    return;
                }

                // Validar formato de email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    alert('‚ùå Error: El formato del correo electr√≥nico no es v√°lido.');
                    return;
                }

                // Obtener amigos existentes
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                
                // Verificar DNI √∫nico
                const existingFriendByDNI = friends.find(f => f.dni && f.dni.toLowerCase() === dni.toLowerCase());
                if (existingFriendByDNI) {
                    alert('‚ùå Error: Ya existe un amigo del club con ese DNI.');
                    return;
                }

                // Verificar email √∫nico
                const existingFriendByEmail = friends.find(f => f.email && f.email.toLowerCase() === email.toLowerCase());
                if (existingFriendByEmail) {
                    alert('‚ùå Error: Ya existe un amigo del club con ese correo electr√≥nico.');
                    return;
                }

                // Verificar tel√©fono √∫nico
                const existingFriendByPhone = friends.find(f => f.phone && f.phone === phone);
                if (existingFriendByPhone) {
                    alert('‚ùå Error: Ya existe un amigo del club con ese n√∫mero de tel√©fono.');
                    return;
                }

                // Crear nuevo amigo del club
                const newFriend = {
                    id: 'FRIEND_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name: name,
                    surname: surname,
                    dni: dni,
                    phone: phone,
                    email: email,
                    status: 'active',
                    registrationDate: new Date().toISOString(),
                    lastAccess: null,
                    accessCount: 0
                };

                // Agregar a la lista
                friends.push(newFriend);
                localStorage.setItem('clubFriends', JSON.stringify(friends));

                // Cerrar formulario y recargar lista
                cancelAddFriend();
                loadFriendsList();
                updateFriendCounts();
                updateDashboardCounts();

                alert('‚úÖ Amigo del club registrado correctamente.\n\nüîë Acceso: Puede acceder usando su correo electr√≥nico o tel√©fono.');
                console.log('ü§ù Nuevo amigo del club registrado:', newFriend.name + ' ' + newFriend.surname);

            } catch (error) {
                console.error('‚ùå Error guardando amigo del club:', error);
                alert('‚ùå Error al guardar el amigo del club. Int√©ntalo de nuevo.');
            }
        }

        function loadFriendsList() {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                const friendsList = document.getElementById('friendsList');
                const statusFilter = document.getElementById('friendStatusFilter').value;

                if (!friendsList) return;

                // Filtrar amigos seg√∫n el estado
                let filteredFriends = friends;
                if (statusFilter !== 'all') {
                    filteredFriends = friends.filter(friend => friend.status === statusFilter);
                }

                if (filteredFriends.length === 0) {
                    friendsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No hay amigos del club que mostrar con los filtros actuales.</div>';
                    return;
                }

                let html = '';
                filteredFriends.forEach(friend => {
                    const statusColor = friend.status === 'active' ? '#059669' : '#6c757d';
                    const statusText = friend.status === 'active' ? 'Activo' : 'Inactivo';
                    const lastAccessText = friend.lastAccess ? new Date(friend.lastAccess).toLocaleDateString('es-ES') : 'Nunca';

                    html += `
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid ${statusColor};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <h4 style="margin: 0 0 5px 0; color: #1e3a8a;">${friend.name} ${friend.surname}</h4>
                                    <p style="margin: 2px 0; color: #666;"><strong>DNI:</strong> ${friend.dni}</p>
                                    <p style="margin: 2px 0; color: #666;"><strong>Tel√©fono:</strong> ${friend.phone}</p>
                                    <p style="margin: 2px 0; color: #666;"><strong>Email:</strong> ${friend.email}</p>
                                    <p style="margin: 2px 0; color: #666;"><strong>Registro:</strong> ${new Date(friend.registrationDate).toLocaleDateString('es-ES')}</p>
                                    <p style="margin: 2px 0; color: #666;"><strong>√öltimo acceso:</strong> ${lastAccessText}</p>
                                    <p style="margin: 2px 0; color: #666;"><strong>Accesos:</strong> ${friend.accessCount}</p>
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                    <span style="background: ${statusColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">${statusText}</span>
                                    <button class="btn btn-sm" onclick="viewFriendDetails('${friend.id}')" style="font-size: 0.8rem;">üëÅÔ∏è Ver</button>
                                    <button class="btn btn-sm" onclick="toggleFriendStatus('${friend.id}')" style="font-size: 0.8rem;">${friend.status === 'active' ? '‚è∏Ô∏è Desactivar' : '‚ñ∂Ô∏è Activar'}</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteFriend('${friend.id}')" style="font-size: 0.8rem;">üóëÔ∏è Eliminar</button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                friendsList.innerHTML = html;
                console.log('ü§ù Lista de amigos del club cargada:', filteredFriends.length);

            } catch (error) {
                console.error('‚ùå Error cargando lista de amigos del club:', error);
                const friendsList = document.getElementById('friendsList');
                if (friendsList) {
                    friendsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #dc2626;">Error al cargar la lista de amigos del club.</div>';
                }
            }
        }

        function filterFriends() {
            loadFriendsList();
        }

        function viewFriendDetails(friendId) {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                const friend = friends.find(f => f.id === friendId);
                
                if (!friend) {
                    alert('‚ùå Amigo del club no encontrado.');
                    return;
                }

                const lastAccessText = friend.lastAccess ? new Date(friend.lastAccess).toLocaleString('es-ES') : 'Nunca ha accedido';
                const statusText = friend.status === 'active' ? 'Activo' : 'Inactivo';

                const details = `
ü§ù DETALLES DEL AMIGO DEL CLUB

üë§ DATOS PERSONALES:
‚Ä¢ Nombre: ${friend.name} ${friend.surname}
‚Ä¢ DNI: ${friend.dni}
‚Ä¢ Tel√©fono: ${friend.phone}
‚Ä¢ Correo Electr√≥nico: ${friend.email}

üìä INFORMACI√ìN DE ACCESO:
‚Ä¢ Estado: ${statusText}
‚Ä¢ Fecha de Registro: ${new Date(friend.registrationDate).toLocaleDateString('es-ES')}
‚Ä¢ √öltimo Acceso: ${lastAccessText}
‚Ä¢ N√∫mero de Accesos: ${friend.accessCount}

üîê PERMISOS:
‚Ä¢ Solo puede ver calendario y competiciones
‚Ä¢ Acceso sin contrase√±a (email/tel√©fono)
‚Ä¢ No puede modificar datos
                `;

                alert(details);

            } catch (error) {
                console.error('‚ùå Error mostrando detalles del amigo del club:', error);
                alert('‚ùå Error al mostrar los detalles del amigo del club.');
            }
        }

        function toggleFriendStatus(friendId) {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                const friendIndex = friends.findIndex(f => f.id === friendId);
                
                if (friendIndex === -1) {
                    alert('‚ùå Amigo del club no encontrado.');
                    return;
                }

                const friend = friends[friendIndex];
                const newStatus = friend.status === 'active' ? 'inactive' : 'active';
                const statusText = newStatus === 'active' ? 'activado' : 'desactivado';

                if (confirm(`¬øEst√°s seguro de que quieres ${statusText} a ${friend.name} ${friend.surname}?`)) {
                    friends[friendIndex].status = newStatus;
                    localStorage.setItem('clubFriends', JSON.stringify(friends));
                    
                    loadFriendsList();
                    updateFriendCounts();
                    updateDashboardCounts();
                    
                    alert(`‚úÖ Amigo del club ${statusText} correctamente.`);
                    console.log(`ü§ù Amigo del club ${statusText}:`, friend.name + ' ' + friend.surname);
                }

            } catch (error) {
                console.error('‚ùå Error cambiando estado del amigo del club:', error);
                alert('‚ùå Error al cambiar el estado del amigo del club.');
            }
        }

        function deleteFriend(friendId) {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                const friend = friends.find(f => f.id === friendId);
                
                if (!friend) {
                    alert('‚ùå Amigo del club no encontrado.');
                    return;
                }

                if (confirm(`¬øEst√°s seguro de que quieres eliminar a ${friend.name} ${friend.surname} de la lista de amigos del club?\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer.`)) {
                    const updatedFriends = friends.filter(f => f.id !== friendId);
                    localStorage.setItem('clubFriends', JSON.stringify(updatedFriends));
                    
                    loadFriendsList();
                    updateFriendCounts();
                    updateDashboardCounts();
                    
                    alert('‚úÖ Amigo del club eliminado correctamente.');
                    console.log('üóëÔ∏è Amigo del club eliminado:', friend.name + ' ' + friend.surname);
                }

            } catch (error) {
                console.error('‚ùå Error eliminando amigo del club:', error);
                alert('‚ùå Error al eliminar el amigo del club.');
            }
        }

        function updateFriendCounts() {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                
                const activeCount = friends.filter(f => f.status === 'active').length;
                const inactiveCount = friends.filter(f => f.status === 'inactive').length;
                const totalCount = friends.length;
                
                // Actualizar contadores en la interfaz
                const activeElement = document.getElementById('activeFriendsCount');
                const inactiveElement = document.getElementById('inactiveFriendsCount');
                const totalElement = document.getElementById('totalFriendsCount');
                
                if (activeElement) activeElement.textContent = activeCount;
                if (inactiveElement) inactiveElement.textContent = inactiveCount;
                if (totalElement) totalElement.textContent = totalCount;
                
                console.log('üìä Contadores de amigos del club actualizados:', { activeCount, inactiveCount, totalCount });
                
            } catch (error) {
                console.error('‚ùå Error actualizando contadores de amigos del club:', error);
            }
        }

        // ===== FUNCI√ìN DE ACCESO PARA AMIGOS DEL CLUB =====
        function authenticateFriend(identifier) {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                
                // Buscar por email o tel√©fono
                const friend = friends.find(f => 
                    (f.email && f.email.toLowerCase() === identifier.toLowerCase()) ||
                    (f.phone && f.phone === identifier)
                );
                
                if (!friend) {
                    return { success: false, message: 'No se encontr√≥ ning√∫n amigo del club con esos datos.' };
                }
                
                if (friend.status !== 'active') {
                    return { success: false, message: 'Tu cuenta est√° inactiva. Contacta con un administrador.' };
                }
                
                // Actualizar informaci√≥n de acceso
                friend.lastAccess = new Date().toISOString();
                friend.accessCount = (friend.accessCount || 0) + 1;
                
                // Guardar cambios
                const updatedFriends = friends.map(f => f.id === friend.id ? friend : f);
                localStorage.setItem('clubFriends', JSON.stringify(updatedFriends));
                
                return { 
                    success: true, 
                    friend: friend,
                    message: `Bienvenido ${friend.name} ${friend.surname}. Acceso concedido.`
                };
                
            } catch (error) {
                console.error('‚ùå Error en autenticaci√≥n de amigo del club:', error);
                return { success: false, message: 'Error en el sistema de autenticaci√≥n.' };
            }
        }

        // ===== M√ìDULO DE ENTRENADORES =====
        
        // Mostrar formulario para agregar entrenador
        function showAddCoachForm() {
            document.getElementById('addCoachForm').style.display = 'block';
            clearCoachForm();
        }

        // Cancelar agregar entrenador
        function cancelAddCoach() {
            document.getElementById('addCoachForm').style.display = 'none';
            clearCoachForm();
        }

        // Limpiar formulario de entrenador
        function clearCoachForm() {
            document.getElementById('coachName').value = '';
            document.getElementById('coachSurname').value = '';
            document.getElementById('coachDNI').value = '';
            document.getElementById('coachPhone').value = '';
            document.getElementById('coachEmail').value = '';
            document.getElementById('coachPassword').value = '';
            document.getElementById('coachTeam').value = '';
            document.getElementById('coachLicense').value = '';
            document.getElementById('coachExperience').value = '';
        }

        // Guardar entrenador
        function saveCoach() {
            try {
                const name = document.getElementById('coachName').value.trim();
                const surname = document.getElementById('coachSurname').value.trim();
                const dni = document.getElementById('coachDNI').value.trim();
                const phone = document.getElementById('coachPhone').value.trim();
                const email = document.getElementById('coachEmail').value.trim();
                const password = document.getElementById('coachPassword').value.trim();
                const team = document.getElementById('coachTeam').value;
                const license = document.getElementById('coachLicense').value.trim();
                const experience = document.getElementById('coachExperience').value.trim();

                // Validaciones
                if (!name || !surname || !dni || !phone || !email || !password || !team) {
                    alert('‚ùå Por favor, completa todos los campos obligatorios');
                    return;
                }

                // Verificar si ya existe un entrenador con ese email o DNI
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                const existingCoach = coaches.find(c => 
                    c.email === email || c.dni === dni
                );

                if (existingCoach) {
                    alert('‚ùå Ya existe un entrenador con ese email o DNI');
                    return;
                }

                // Verificar si ya hay un entrenador asignado a ese equipo
                const teamCoach = coaches.find(c => c.team === team && c.status === 'active');
                if (teamCoach) {
                    const confirmReplace = confirm(`‚ö†Ô∏è El equipo ${team} ya tiene un entrenador asignado (${teamCoach.name} ${teamCoach.surname}). ¬øDeseas reemplazarlo?`);
                    if (!confirmReplace) return;
                    
                    // Desactivar el entrenador anterior
                    teamCoach.status = 'inactive';
                    teamCoach.replacedBy = `${name} ${surname}`;
                    teamCoach.replacedDate = new Date().toISOString();
                }

                // Crear nuevo entrenador
                const newCoach = {
                    id: Date.now().toString(),
                    name: name,
                    surname: surname,
                    dni: dni,
                    phone: phone,
                    email: email,
                    password: password, // Contrase√±a del entrenador
                    team: team,
                    license: license,
                    experience: experience ? parseInt(experience) : 0,
                    status: 'pending', // Estado pendiente hasta validaci√≥n del administrador
                    registrationDate: new Date().toISOString(),
                    lastAccess: null,
                    accessCount: 0,
                    pushNotifications: {
                        enabled: true,
                        sentCount: 0,
                        lastSent: null
                    }
                };

                // Guardar en localStorage
                coaches.push(newCoach);
                localStorage.setItem('clubCoaches', JSON.stringify(coaches));

                // Cerrar formulario y mostrar confirmaci√≥n
                cancelAddCoach();
                alert(`‚úÖ Entrenador registrado exitosamente\n\nüë®‚Äçüè´ ${name} ${surname}\n‚öΩ Equipo: ${team}\nüìß Email: ${email}\nüì± Tel√©fono: ${phone}\n\n‚ö†Ô∏è El entrenador est√° pendiente de validaci√≥n. Debes activarlo para que pueda acceder.`);

                // Actualizar listas y contadores
                loadCoachesList();
                updateCoachCounts();

                console.log('üë®‚Äçüè´ Nuevo entrenador registrado:', newCoach);

            } catch (error) {
                console.error('‚ùå Error guardando entrenador:', error);
                alert('‚ùå Error al guardar el entrenador. Int√©ntalo de nuevo.');
            }
        }

        // Cargar lista de entrenadores
        function loadCoachesList() {
            try {
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                const filter = document.getElementById('coachStatusFilter').value;
                
                let filteredCoaches = coaches;
                if (filter !== 'all') {
                    filteredCoaches = coaches.filter(c => c.status === filter);
                }

                const coachesListElement = document.getElementById('coachesList');
                
                if (filteredCoaches.length === 0) {
                    coachesListElement.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay entrenadores registrados</p>';
                    return;
                }

                let html = '<div style="display: grid; gap: 15px;">';
                
                filteredCoaches.forEach(coach => {
                    const statusColor = coach.status === 'active' ? '#059669' : '#6c757d';
                    const statusText = coach.status === 'active' ? 'Activo' : 'Inactivo';
                    const teamNames = {
                        'prebenjamin': 'Prebenjam√≠n',
                        'benjamin': 'Benjam√≠n',
                        'alevin': 'Alev√≠n',
                        'infantil': 'Infantil',
                        'aficionado': 'Aficionado'
                    };

                    html += `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid ${statusColor};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                <div>
                                    <h4 style="margin: 0; color: #1e3a8a;">üë®‚Äçüè´ ${coach.name} ${coach.surname}</h4>
                                    <p style="margin: 5px 0; color: #666;">‚öΩ ${teamNames[coach.team] || coach.team}</p>
                                    <p style="margin: 5px 0; color: #666;">üìß ${coach.email}</p>
                                    <p style="margin: 5px 0; color: #666;">üì± ${coach.phone}</p>
                                </div>
                                <div style="text-align: right;">
                                    <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">${statusText}</span>
                                    <div style="margin-top: 10px;">
                                        <button class="btn btn-sm btn-primary" onclick="viewCoachDetails('${coach.id}')" style="margin-right: 5px;">üëÅÔ∏è Ver</button>
                                        <button class="btn btn-sm btn-warning" onclick="toggleCoachStatus('${coach.id}')" style="margin-right: 5px;">üîÑ ${coach.status === 'active' ? 'Desactivar' : 'Activar'}</button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteCoach('${coach.id}')">üóëÔ∏è Eliminar</button>
                                    </div>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 0.9rem;">
                                <div><strong>DNI:</strong> ${coach.dni}</div>
                                <div><strong>Licencia:</strong> ${coach.license || 'No especificada'}</div>
                                <div><strong>Experiencia:</strong> ${coach.experience || 0} a√±os</div>
                                <div><strong>Registro:</strong> ${new Date(coach.registrationDate).toLocaleDateString()}</div>
                                <div><strong>√öltimo acceso:</strong> ${coach.lastAccess ? new Date(coach.lastAccess).toLocaleDateString() : 'Nunca'}</div>
                                <div><strong>Mensajes enviados:</strong> ${coach.pushNotifications.sentCount || 0}</div>
                                <div style="grid-column: 1 / -1; background: #e8f5e8; padding: 8px; border-radius: 5px; margin-top: 10px;">
                                    <strong style="color: #059669;">üîê Contrase√±a:</strong> 
                                    <span id="coach-password-${coach.id}">${coach.password ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : 'No establecida'}</span>
                                    ${coach.password ? `<button onclick="togglePassword('coach-password-${coach.id}', '${coach.password}')" style="background: none; border: none; color: #059669; cursor: pointer; font-size: 0.8rem; margin-left: 5px;">üëÅÔ∏è</button>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                coachesListElement.innerHTML = html;

            } catch (error) {
                console.error('‚ùå Error cargando lista de entrenadores:', error);
                document.getElementById('coachesList').innerHTML = '<p style="text-align: center; color: #dc2626;">Error al cargar la lista de entrenadores</p>';
            }
        }

        // Filtrar entrenadores
        function filterCoaches() {
            loadCoachesList();
        }

        // Ver detalles del entrenador
        function viewCoachDetails(coachId) {
            try {
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                const coach = coaches.find(c => c.id === coachId);
                
                if (!coach) {
                    alert('‚ùå Entrenador no encontrado');
                    return;
                }

                const teamNames = {
                    'prebenjamin': 'Prebenjam√≠n',
                    'benjamin': 'Benjam√≠n',
                    'alevin': 'Alev√≠n',
                    'infantil': 'Infantil',
                    'aficionado': 'Aficionado'
                };

                const details = `
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 600px; margin: 20px auto;">
                        <h3 style="color: #1e3a8a; margin-bottom: 20px;">üë®‚Äçüè´ Detalles del Entrenador</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <h4>üìã Informaci√≥n Personal</h4>
                                <p><strong>Nombre:</strong> ${coach.name} ${coach.surname}</p>
                                <p><strong>DNI:</strong> ${coach.dni}</p>
                                <p><strong>Tel√©fono:</strong> ${coach.phone}</p>
                                <p><strong>Email:</strong> ${coach.email}</p>
                            </div>
                            <div>
                                <h4>‚öΩ Informaci√≥n Deportiva</h4>
                                <p><strong>Equipo:</strong> ${teamNames[coach.team] || coach.team}</p>
                                <p><strong>Licencia:</strong> ${coach.license || 'No especificada'}</p>
                                <p><strong>Experiencia:</strong> ${coach.experience || 0} a√±os</p>
                                <p><strong>Estado:</strong> <span style="color: ${coach.status === 'active' ? '#059669' : '#6c757d'};">${coach.status === 'active' ? 'Activo' : 'Inactivo'}</span></p>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4>üìä Estad√≠sticas de Actividad</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div>
                                    <strong>Fecha de registro:</strong><br>
                                    ${new Date(coach.registrationDate).toLocaleDateString()}
                                </div>
                                <div>
                                    <strong>√öltimo acceso:</strong><br>
                                    ${coach.lastAccess ? new Date(coach.lastAccess).toLocaleDateString() : 'Nunca'}
                                </div>
                                <div>
                                    <strong>Total de accesos:</strong><br>
                                    ${coach.accessCount || 0}
                                </div>
                                <div>
                                    <strong>Mensajes push enviados:</strong><br>
                                    ${coach.pushNotifications.sentCount || 0}
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-primary" onclick="closeModal()">Cerrar</button>
                        </div>
                    </div>
                `;

                showModal('Detalles del Entrenador', details);

            } catch (error) {
                console.error('‚ùå Error mostrando detalles del entrenador:', error);
                alert('‚ùå Error al mostrar los detalles del entrenador');
            }
        }

        // Cambiar estado del entrenador
        function toggleCoachStatus(coachId) {
            try {
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                const coachIndex = coaches.findIndex(c => c.id === coachId);
                
                if (coachIndex === -1) {
                    alert('‚ùå Entrenador no encontrado');
                    return;
                }

                const coach = coaches[coachIndex];
                const newStatus = coach.status === 'active' ? 'inactive' : 'active';
                
                coaches[coachIndex].status = newStatus;
                coaches[coachIndex].statusChangeDate = new Date().toISOString();
                
                localStorage.setItem('clubCoaches', JSON.stringify(coaches));
                
                alert(`‚úÖ Estado del entrenador ${coach.name} ${coach.surname} cambiado a ${newStatus === 'active' ? 'Activo' : 'Inactivo'}`);
                
                loadCoachesList();
                updateCoachCounts();

            } catch (error) {
                console.error('‚ùå Error cambiando estado del entrenador:', error);
                alert('‚ùå Error al cambiar el estado del entrenador');
            }
        }

        // Eliminar entrenador
        function deleteCoach(coachId) {
            try {
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                const coach = coaches.find(c => c.id === coachId);
                
                if (!coach) {
                    alert('‚ùå Entrenador no encontrado');
                    return;
                }

                const confirmDelete = confirm(`‚ö†Ô∏è ¬øEst√°s seguro de que quieres eliminar al entrenador ${coach.name} ${coach.surname}?\n\nEsta acci√≥n no se puede deshacer.`);
                
                if (!confirmDelete) return;

                const updatedCoaches = coaches.filter(c => c.id !== coachId);
                localStorage.setItem('clubCoaches', JSON.stringify(updatedCoaches));
                
                alert(`‚úÖ Entrenador ${coach.name} ${coach.surname} eliminado correctamente`);
                
                loadCoachesList();
                updateCoachCounts();

            } catch (error) {
                console.error('‚ùå Error eliminando entrenador:', error);
                alert('‚ùå Error al eliminar el entrenador');
            }
        }

        // Actualizar contadores de entrenadores
        function updateCoachCounts() {
            try {
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                
                const activeCount = coaches.filter(c => c.status === 'active').length;
                const inactiveCount = coaches.filter(c => c.status === 'inactive').length;
                const totalCount = coaches.length;
                
                // Actualizar contadores en la interfaz
                const activeElement = document.getElementById('activeCoachesCount');
                const inactiveElement = document.getElementById('inactiveCoachesCount');
                const totalElement = document.getElementById('totalCoachesCount');
                
                if (activeElement) activeElement.textContent = activeCount;
                if (inactiveElement) inactiveElement.textContent = inactiveCount;
                if (totalElement) totalElement.textContent = totalCount;
                
                console.log('üìä Contadores de entrenadores actualizados:', { activeCount, inactiveCount, totalCount });
                
            } catch (error) {
                console.error('‚ùå Error actualizando contadores de entrenadores:', error);
            }
        }

        // ===== M√ìDULO DE MENSAJES PUSH PARA ADMINISTRADORES =====
        
        // Mostrar formulario para agregar mensaje
        function showAddMessageForm() {
            document.getElementById('addMessageForm').style.display = 'block';
            clearMessageForm();
        }

        // Cancelar agregar mensaje
        function cancelAddMessage() {
            document.getElementById('addMessageForm').style.display = 'none';
            clearMessageForm();
        }

        // Limpiar formulario de mensaje
        function clearMessageForm() {
            document.getElementById('messageTitle').value = '';
            document.getElementById('messageContent').value = '';
            document.getElementById('messageType').value = 'general';
            document.getElementById('messageRecipients').value = 'all';
            document.getElementById('messageTeam').value = '';
        }

        // Enviar mensaje push desde administraci√≥n
        function sendAdminPushMessage() {
            try {
                const title = document.getElementById('messageTitle').value.trim();
                const content = document.getElementById('messageContent').value.trim();
                const type = document.getElementById('messageType').value;
                const recipients = document.getElementById('messageRecipients').value;
                const team = document.getElementById('messageTeam').value;
                
                if (!title || !content) {
                    alert('‚ùå Por favor, completa el t√≠tulo y contenido del mensaje');
                    return;
                }
                
                const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
                
                const message = {
                    id: 'MSG_ADMIN_' + Date.now(),
                    title: title,
                    content: content,
                    type: type,
                    recipients: recipients,
                    team: team || 'all',
                    senderId: currentAdmin.id || 'ADMIN_CDSANABRIACF',
                    senderName: currentAdmin.name || 'Administrador CDSANABRIACF',
                    senderType: 'admin',
                    sentAt: new Date().toISOString(),
                    status: 'sent'
                };
                
                // Guardar mensaje
                const messages = JSON.parse(localStorage.getItem('pushMessages') || '[]');
                messages.push(message);
                localStorage.setItem('pushMessages', JSON.stringify(messages));
                
                // Limpiar formulario
                clearMessageForm();
                cancelAddMessage();
                
                alert(`‚úÖ Mensaje enviado exitosamente\n\nüì± "${title}"\nüë• Destinatarios: ${recipients}\n‚è∞ ${new Date().toLocaleString()}`);
                
                // Actualizar historial y estad√≠sticas
                loadAdminMessagesHistory();
                updateMessageCounts();
                
            } catch (error) {
                console.error('‚ùå Error enviando mensaje:', error);
                alert('‚ùå Error al enviar el mensaje. Int√©ntalo de nuevo.');
            }
        }

        // Vista previa del mensaje
        function previewAdminMessage() {
            const title = document.getElementById('messageTitle').value.trim();
            const content = document.getElementById('messageContent').value.trim();
            const type = document.getElementById('messageType').value;
            const recipients = document.getElementById('messageRecipients').value;
            const team = document.getElementById('messageTeam').value;
            
            if (!title || !content) {
                alert('‚ùå Por favor, completa el t√≠tulo y contenido del mensaje');
                return;
            }
            
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || '{}');
            
            const preview = `
                üì± <strong>Vista Previa del Mensaje</strong><br><br>
                üìã <strong>T√≠tulo:</strong> ${title}<br>
                üí¨ <strong>Contenido:</strong> ${content}<br>
                üè∑Ô∏è <strong>Tipo:</strong> ${type}<br>
                üë• <strong>Destinatarios:</strong> ${recipients}<br>
                ‚öΩ <strong>Equipo:</strong> ${team || 'Todos los equipos'}<br>
                üë®‚Äçüíº <strong>Enviado por:</strong> ${currentAdmin.name || 'Administrador CDSANABRIACF'}
            `;
            
            alert(preview);
        }

        // Cargar historial de mensajes de administraci√≥n
        function loadAdminMessagesHistory() {
            try {
                const messages = JSON.parse(localStorage.getItem('pushMessages') || '[]');
                const adminMessages = messages.filter(m => m.senderType === 'admin');
                
                const historyElement = document.getElementById('adminMessagesHistory');
                
                if (adminMessages.length === 0) {
                    historyElement.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay mensajes enviados desde administraci√≥n</p>';
                    return;
                }

                let html = '<div style="display: grid; gap: 15px;">';
                
                adminMessages.sort((a, b) => new Date(b.sentAt) - new Date(a.sentAt)).forEach(message => {
                    const typeColors = {
                        'general': '#3b82f6',
                        'urgent': '#dc2626',
                        'reminder': '#f59e0b',
                        'announcement': '#059669'
                    };
                    
                    html += `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid ${typeColors[message.type] || '#3b82f6'};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: #1e3a8a;">${message.title}</h4>
                                <span style="background: ${typeColors[message.type] || '#3b82f6'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">${message.type}</span>
                            </div>
                            <p style="margin: 5px 0; color: #666;">${message.content}</p>
                            <div style="font-size: 0.8rem; color: #888; margin-top: 10px;">
                                üë• ${message.recipients} | ‚öΩ ${message.team || 'Todos'} | ‚è∞ ${new Date(message.sentAt).toLocaleString()}
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                historyElement.innerHTML = html;

            } catch (error) {
                console.error('‚ùå Error cargando historial de mensajes:', error);
                document.getElementById('adminMessagesHistory').innerHTML = '<p style="text-align: center; color: #dc2626;">Error al cargar el historial</p>';
            }
        }

        // Actualizar contadores de mensajes
        function updateMessageCounts() {
            try {
                const messages = JSON.parse(localStorage.getItem('pushMessages') || '[]');
                const today = new Date().toDateString();
                
                const totalCount = messages.length;
                const todayCount = messages.filter(m => new Date(m.sentAt).toDateString() === today).length;
                const urgentCount = messages.filter(m => m.type === 'urgent').length;
                
                // Actualizar contadores en la interfaz
                const totalElement = document.getElementById('totalMessagesCount');
                const todayElement = document.getElementById('todayMessagesCount');
                const urgentElement = document.getElementById('urgentMessagesCount');
                
                if (totalElement) totalElement.textContent = totalCount;
                if (todayElement) todayElement.textContent = todayCount;
                if (urgentElement) urgentElement.textContent = urgentCount;
                
                console.log('üìä Contadores de mensajes actualizados:', { totalCount, todayCount, urgentCount });
                
            } catch (error) {
                console.error('‚ùå Error actualizando contadores de mensajes:', error);
            }
        }

        // ===== M√ìDULO DE EXPORTACI√ìN A EXCEL =====
        
        // Funci√≥n para convertir datos a CSV
        function convertToCSV(data, headers) {
            try {
                // Crear encabezados
                const csvHeaders = headers.map(h => `"${h}"`).join(',');
                
                // Crear filas de datos
                const csvRows = data.map(row => {
                    return headers.map(header => {
                        const value = row[header] || '';
                        // Escapar comillas y envolver en comillas si contiene comas
                        return `"${String(value).replace(/"/g, '""')}"`;
                    }).join(',');
                });
                
                // Combinar encabezados y datos
                return [csvHeaders, ...csvRows].join('\n');
            } catch (error) {
                console.error('‚ùå Error convirtiendo a CSV:', error);
                return '';
            }
        }

        // Funci√≥n para descargar archivo CSV
        function downloadCSV(csvContent, filename) {
            try {
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', filename);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                
                // Registrar en historial
                addToExportHistory(filename);
                
                console.log('‚úÖ Archivo descargado:', filename);
            } catch (error) {
                console.error('‚ùå Error descargando archivo:', error);
                alert('‚ùå Error al descargar el archivo. Int√©ntalo de nuevo.');
            }
        }

        // Agregar al historial de exportaciones
        function addToExportHistory(filename) {
            try {
                const history = JSON.parse(localStorage.getItem('exportHistory') || '[]');
                const exportRecord = {
                    id: Date.now(),
                    filename: filename,
                    date: new Date().toISOString(),
                    admin: JSON.parse(localStorage.getItem('currentAdmin') || '{}').name || 'Administrador'
                };
                
                history.unshift(exportRecord);
                
                // Mantener solo los √∫ltimos 20 registros
                if (history.length > 20) {
                    history.splice(20);
                }
                
                localStorage.setItem('exportHistory', JSON.stringify(history));
                loadExportHistory();
                
            } catch (error) {
                console.error('‚ùå Error guardando historial:', error);
            }
        }

        // Cargar historial de exportaciones
        function loadExportHistory() {
            try {
                const history = JSON.parse(localStorage.getItem('exportHistory') || '[]');
                const historyElement = document.getElementById('exportHistory');
                
                if (history.length === 0) {
                    historyElement.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay exportaciones recientes</p>';
                    return;
                }

                let html = '<div style="display: grid; gap: 10px;">';
                
                history.forEach(record => {
                    html += `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #059669;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: #1e3a8a;">üìÑ ${record.filename}</strong>
                                    <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                                        üë§ ${record.admin} | ‚è∞ ${new Date(record.date).toLocaleString()}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                historyElement.innerHTML = html;

            } catch (error) {
                console.error('‚ùå Error cargando historial:', error);
                document.getElementById('exportHistory').innerHTML = '<p style="text-align: center; color: #dc2626;">Error al cargar el historial</p>';
            }
        }

        // Exportar jugadores
        function exportPlayers() {
            try {
                const category = document.getElementById('exportPlayerCategory').value;
                const players = JSON.parse(localStorage.getItem('clubPlayers') || '[]');
                
                let filteredPlayers = players;
                if (category !== 'all') {
                    filteredPlayers = players.filter(p => p.categoria === category);
                }
                
                if (filteredPlayers.length === 0) {
                    alert('‚ùå No hay jugadores para exportar con los filtros seleccionados');
                    return;
                }
                
                const headers = [
                    'ID', 'Nombre', 'Apellidos', 'DNI', 'Tel√©fono', 'Direcci√≥n', 
                    'Edad', 'Fecha de Nacimiento', 'Categor√≠a', 'Dorsal', 'Estado',
                    'Fecha de Registro', 'Padre/Madre 1', 'DNI Padre 1', 'Tel√©fono Padre 1',
                    'Padre/Madre 2', 'DNI Padre 2', 'Tel√©fono Padre 2', 'Consentimiento Fotos'
                ];
                
                const csvData = filteredPlayers.map(player => ({
                    'ID': player.id,
                    'Nombre': player.nombre,
                    'Apellidos': player.apellidos,
                    'DNI': player.dni,
                    'Tel√©fono': player.telefono,
                    'Direcci√≥n': player.direccion || '',
                    'Edad': player.edad,
                    'Fecha de Nacimiento': player.fechaNacimiento,
                    'Categor√≠a': player.categoria,
                    'Dorsal': player.dorsal || '',
                    'Estado': player.estado,
                    'Fecha de Registro': player.registrationDate ? new Date(player.registrationDate).toLocaleDateString() : '',
                    'Padre/Madre 1': player.padre1?.nombre || '',
                    'DNI Padre 1': player.padre1?.dni || '',
                    'Tel√©fono Padre 1': player.padre1?.telefono || '',
                    'Padre/Madre 2': player.padre2?.nombre || '',
                    'DNI Padre 2': player.padre2?.dni || '',
                    'Tel√©fono Padre 2': player.padre2?.telefono || '',
                    'Consentimiento Fotos': player.consentimientoFotos ? 'S√≠' : 'No'
                }));
                
                const csvContent = convertToCSV(csvData, headers);
                const filename = `jugadores_${category === 'all' ? 'todas_categorias' : category}_${new Date().toISOString().split('T')[0]}.csv`;
                
                downloadCSV(csvContent, filename);
                alert(`‚úÖ Exportaci√≥n completada\n\nüìä ${filteredPlayers.length} jugadores exportados\nüìÅ Archivo: ${filename}`);
                
            } catch (error) {
                console.error('‚ùå Error exportando jugadores:', error);
                alert('‚ùå Error al exportar jugadores. Int√©ntalo de nuevo.');
            }
        }

        // Exportar socios
        function exportMembers() {
            try {
                const status = document.getElementById('exportMemberStatus').value;
                const members = JSON.parse(localStorage.getItem('clubMembers') || '[]');
                
                let filteredMembers = members;
                if (status !== 'all') {
                    filteredMembers = members.filter(m => m.estado === status);
                }
                
                if (filteredMembers.length === 0) {
                    alert('‚ùå No hay socios para exportar con los filtros seleccionados');
                    return;
                }
                
                const headers = [
                    'N√∫mero de Socio', 'Nombre', 'Apellidos', 'DNI', 'Tel√©fono',
                    'Direcci√≥n', 'Email', 'Estado', 'Fecha de Registro', 'Fecha de Vencimiento',
                    'Pagado', '√öltimo Acceso', 'N√∫mero de Accesos'
                ];
                
                const csvData = filteredMembers.map(member => ({
                    'N√∫mero de Socio': member.numeroSocio,
                    'Nombre': member.nombre,
                    'Apellidos': member.apellidos,
                    'DNI': member.dni || '',
                    'Tel√©fono': member.telefono,
                    'Direcci√≥n': member.direccion || '',
                    'Email': member.email || '',
                    'Estado': member.estado,
                    'Fecha de Registro': member.registrationDate ? new Date(member.registrationDate).toLocaleDateString() : '',
                    'Fecha de Vencimiento': member.fechaVencimiento ? new Date(member.fechaVencimiento).toLocaleDateString() : '',
                    'Pagado': member.pagado ? 'S√≠' : 'No',
                    '√öltimo Acceso': member.lastAccess ? new Date(member.lastAccess).toLocaleDateString() : 'Nunca',
                    'N√∫mero de Accesos': member.accessCount || 0
                }));
                
                const csvContent = convertToCSV(csvData, headers);
                const filename = `socios_${status === 'all' ? 'todos_estados' : status}_${new Date().toISOString().split('T')[0]}.csv`;
                
                downloadCSV(csvContent, filename);
                alert(`‚úÖ Exportaci√≥n completada\n\nüìä ${filteredMembers.length} socios exportados\nüìÅ Archivo: ${filename}`);
                
            } catch (error) {
                console.error('‚ùå Error exportando socios:', error);
                alert('‚ùå Error al exportar socios. Int√©ntalo de nuevo.');
            }
        }

        // Exportar amigos
        function exportFriends() {
            try {
                const friends = JSON.parse(localStorage.getItem('clubFriends') || '[]');
                
                if (friends.length === 0) {
                    alert('‚ùå No hay amigos del club para exportar');
                    return;
                }
                
                const headers = [
                    'ID', 'Nombre', 'Apellidos', 'DNI', 'Tel√©fono', 'Email',
                    'Fecha de Registro', '√öltimo Acceso', 'N√∫mero de Accesos'
                ];
                
                const csvData = friends.map(friend => ({
                    'ID': friend.id,
                    'Nombre': friend.nombre,
                    'Apellidos': friend.apellidos,
                    'DNI': friend.dni || '',
                    'Tel√©fono': friend.phone,
                    'Email': friend.email,
                    'Fecha de Registro': friend.registrationDate ? new Date(friend.registrationDate).toLocaleDateString() : '',
                    '√öltimo Acceso': friend.lastAccess ? new Date(friend.lastAccess).toLocaleDateString() : 'Nunca',
                    'N√∫mero de Accesos': friend.accessCount || 0
                }));
                
                const csvContent = convertToCSV(csvData, headers);
                const filename = `amigos_del_club_${new Date().toISOString().split('T')[0]}.csv`;
                
                downloadCSV(csvContent, filename);
                alert(`‚úÖ Exportaci√≥n completada\n\nüìä ${friends.length} amigos exportados\nüìÅ Archivo: ${filename}`);
                
            } catch (error) {
                console.error('‚ùå Error exportando amigos:', error);
                alert('‚ùå Error al exportar amigos. Int√©ntalo de nuevo.');
            }
        }

        // Exportar entrenadores
        function exportCoaches() {
            try {
                const status = document.getElementById('exportCoachStatus').value;
                const coaches = JSON.parse(localStorage.getItem('clubCoaches') || '[]');
                
                let filteredCoaches = coaches;
                if (status !== 'all') {
                    filteredCoaches = coaches.filter(c => c.status === status);
                }
                
                if (filteredCoaches.length === 0) {
                    alert('‚ùå No hay entrenadores para exportar con los filtros seleccionados');
                    return;
                }
                
                const headers = [
                    'ID', 'Nombre', 'Apellidos', 'DNI', 'Tel√©fono', 'Email',
                    'Equipo Asignado', 'Licencia', 'Experiencia (a√±os)', 'Estado',
                    'Fecha de Registro', '√öltimo Acceso', 'N√∫mero de Accesos',
                    'Mensajes Enviados', '√öltimo Mensaje'
                ];
                
                const csvData = filteredCoaches.map(coach => ({
                    'ID': coach.id,
                    'Nombre': coach.name,
                    'Apellidos': coach.surname,
                    'DNI': coach.dni,
                    'Tel√©fono': coach.phone,
                    'Email': coach.email,
                    'Equipo Asignado': coach.team,
                    'Licencia': coach.license || '',
                    'Experiencia (a√±os)': coach.experience || 0,
                    'Estado': coach.status,
                    'Fecha de Registro': coach.registrationDate ? new Date(coach.registrationDate).toLocaleDateString() : '',
                    '√öltimo Acceso': coach.lastAccess ? new Date(coach.lastAccess).toLocaleDateString() : 'Nunca',
                    'N√∫mero de Accesos': coach.accessCount || 0,
                    'Mensajes Enviados': coach.pushNotifications?.sentCount || 0,
                    '√öltimo Mensaje': coach.pushNotifications?.lastSent ? new Date(coach.pushNotifications.lastSent).toLocaleDateString() : 'Nunca'
                }));
                
                const csvContent = convertToCSV(csvData, headers);
                const filename = `entrenadores_${status === 'all' ? 'todos_estados' : status}_${new Date().toISOString().split('T')[0]}.csv`;
                
                downloadCSV(csvContent, filename);
                alert(`‚úÖ Exportaci√≥n completada\n\nüìä ${filteredCoaches.length} entrenadores exportados\nüìÅ Archivo: ${filename}`);
                
            } catch (error) {
                console.error('‚ùå Error exportando entrenadores:', error);
                alert('‚ùå Error al exportar entrenadores. Int√©ntalo de nuevo.');
            }
        }

        // Exportar eventos
        function exportEvents() {
            try {
                const events = JSON.parse(localStorage.getItem('clubEvents') || '[]');
                
                if (events.length === 0) {
                    alert('‚ùå No hay eventos para exportar');
                    return;
                }
                
                const headers = [
                    'ID', 'T√≠tulo', 'Descripci√≥n', 'Fecha', 'Hora de Inicio', 'Hora de Fin',
                    'Ubicaci√≥n', 'Precio', 'M√≠nimo Participantes', 'M√°ximo Participantes',
                    'Participantes Actuales', 'Estado', 'Fecha de Creaci√≥n'
                ];
                
                const csvData = events.map(event => ({
                    'ID': event.id,
                    'T√≠tulo': event.title,
                    'Descripci√≥n': event.description || '',
                    'Fecha': event.date,
                    'Hora de Inicio': event.startTime,
                    'Hora de Fin': event.endTime,
                    'Ubicaci√≥n': event.location,
                    'Precio': event.price || 'Gratuito',
                    'M√≠nimo Participantes': event.minParticipants || 0,
                    'M√°ximo Participantes': event.maxParticipants || 0,
                    'Participantes Actuales': event.participants ? event.participants.length : 0,
                    'Estado': event.status || 'activo',
                    'Fecha de Creaci√≥n': event.createdAt ? new Date(event.createdAt).toLocaleDateString() : ''
                }));
                
                const csvContent = convertToCSV(csvData, headers);
                const filename = `eventos_del_club_${new Date().toISOString().split('T')[0]}.csv`;
                
                downloadCSV(csvContent, filename);
                alert(`‚úÖ Exportaci√≥n completada\n\nüìä ${events.length} eventos exportados\nüìÅ Archivo: ${filename}`);
                
            } catch (error) {
                console.error('‚ùå Error exportando eventos:', error);
                alert('‚ùå Error al exportar eventos. Int√©ntalo de nuevo.');
            }
        }

        // Exportar competiciones
        function exportCompetitions() {
            try {
                const competitions = JSON.parse(localStorage.getItem('clubCompetitions') || '[]');
                
                if (competitions.length === 0) {
                    alert('‚ùå No hay competiciones para exportar');
                    return;
                }
                
                const headers = [
                    'ID', 'Nombre', 'Categor√≠a', 'Fecha de Inicio', 'Fecha de Fin',
                    'Equipos Participantes', 'Fases', 'Estado', 'Fecha de Creaci√≥n'
                ];
                
                const csvData = competitions.map(comp => ({
                    'ID': comp.id,
                    'Nombre': comp.name,
                    'Categor√≠a': comp.category,
                    'Fecha de Inicio': comp.startDate,
                    'Fecha de Fin': comp.endDate,
                    'Equipos Participantes': comp.teams ? comp.teams.length : 0,
                    'Fases': comp.phases ? comp.phases.length : 0,
                    'Estado': comp.status || 'activa',
                    'Fecha de Creaci√≥n': comp.createdAt ? new Date(comp.createdAt).toLocaleDateString() : ''
                }));
                
                const csvContent = convertToCSV(csvData, headers);
                const filename = `competiciones_${new Date().toISOString().split('T')[0]}.csv`;
                
                downloadCSV(csvContent, filename);
                alert(`‚úÖ Exportaci√≥n completada\n\nüìä ${competitions.length} competiciones exportadas\nüìÅ Archivo: ${filename}`);
                
            } catch (error) {
                console.error('‚ùå Error exportando competiciones:', error);
                alert('‚ùå Error al exportar competiciones. Int√©ntalo de nuevo.');
            }
        }

        // Exportar todos los datos
        function exportAllData() {
            try {
                if (confirm('üìä ¬øEst√°s seguro de que quieres exportar todos los datos del club?\n\nEsto generar√° m√∫ltiples archivos CSV con toda la informaci√≥n.')) {
                    // Exportar cada categor√≠a
                    exportPlayers();
                    setTimeout(() => exportMembers(), 500);
                    setTimeout(() => exportFriends(), 1000);
                    setTimeout(() => exportCoaches(), 1500);
                    setTimeout(() => exportEvents(), 2000);
                    setTimeout(() => exportCompetitions(), 2500);
                    
                    alert('‚úÖ Exportaci√≥n masiva iniciada\n\nüìÅ Se descargar√°n 6 archivos CSV con todos los datos del club.');
                }
            } catch (error) {
                console.error('‚ùå Error en exportaci√≥n masiva:', error);
                alert('‚ùå Error en la exportaci√≥n masiva. Int√©ntalo de nuevo.');
            }
        }

        // ===== M√ìDULO DE PUBLICIDAD =====
        
        // Mostrar formulario para agregar anuncio
        function showAddAdvertisementForm() {
            document.getElementById('addAdvertisementForm').style.display = 'block';
            clearAdvertisementForm();
            setupImagePreview();
        }

        // Cancelar agregar anuncio
        function cancelAddAdvertisement() {
            document.getElementById('addAdvertisementForm').style.display = 'none';
            clearAdvertisementForm();
        }

        // Limpiar formulario de anuncio
        function clearAdvertisementForm() {
            document.getElementById('adTitle').value = '';
            document.getElementById('adCompany').value = '';
            document.getElementById('adDescription').value = '';
            document.getElementById('adUrl').value = '';
            document.getElementById('adCategory').value = 'general';
            document.getElementById('adImage').value = '';
            document.getElementById('adPosition').value = '1';
            document.getElementById('adStartDate').value = '';
            document.getElementById('adEndDate').value = '';
            document.getElementById('adStatus').value = 'active';
            document.getElementById('adType').value = 'carrusel';
            document.getElementById('adImagePreview').innerHTML = '';
        }

        // Configurar vista previa de imagen
        function setupImagePreview() {
            const imageInput = document.getElementById('adImage');
            const preview = document.getElementById('adImagePreview');
            
            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) { // 5MB
                        alert('‚ùå La imagen es demasiado grande. M√°ximo 5MB.');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; height: auto; border-radius: 8px; border: 2px solid #ddd;">`;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // Guardar anuncio
        function saveAdvertisement() {
            try {
                const title = document.getElementById('adTitle').value.trim();
                const company = document.getElementById('adCompany').value.trim();
                const description = document.getElementById('adDescription').value.trim();
                const url = document.getElementById('adUrl').value.trim();
                const category = document.getElementById('adCategory').value;
                const position = parseInt(document.getElementById('adPosition').value);
                const startDate = document.getElementById('adStartDate').value;
                const endDate = document.getElementById('adEndDate').value;
                const status = document.getElementById('adStatus').value;
                const type = document.getElementById('adType').value;
                
                if (!title || !company) {
                    alert('‚ùå Por favor, completa el t√≠tulo y la empresa colaboradora');
                    return;
                }
                
                // Procesar imagen
                const imageInput = document.getElementById('adImage');
                let imageData = null;
                
                if (imageInput.files[0]) {
                    const file = imageInput.files[0];
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imageData = e.target.result;
                            createAdvertisement(title, company, description, url, category, position, startDate, endDate, status, type, imageData);
                        };
                        reader.readAsDataURL(file);
                    });
                } else {
                    createAdvertisement(title, company, description, url, category, position, startDate, endDate, status, type, imageData);
                }
                
            } catch (error) {
                console.error('‚ùå Error guardando anuncio:', error);
                alert('‚ùå Error al guardar el anuncio. Int√©ntalo de nuevo.');
            }
        }

        // Crear anuncio
        function createAdvertisement(title, company, description, url, category, position, startDate, endDate, status, type, imageData) {
            try {
                const newAd = {
                    id: 'AD_' + Date.now(),
                    title: title,
                    company: company,
                    description: description,
                    url: url,
                    category: category,
                    position: position,
                    startDate: startDate,
                    endDate: endDate,
                    status: status,
                    type: type,
                    image: imageData,
                    createdAt: new Date().toISOString(),
                    views: 0,
                    clicks: 0
                };
                
                // Guardar anuncio
                const advertisements = JSON.parse(localStorage.getItem('clubAdvertisements') || '[]');
                advertisements.push(newAd);
                localStorage.setItem('clubAdvertisements', JSON.stringify(advertisements));
                
                // Cerrar formulario y mostrar confirmaci√≥n
                cancelAddAdvertisement();
                alert(`‚úÖ Anuncio guardado exitosamente\n\nüì¢ "${title}"\nüè¢ ${company}\nüìÖ ${status === 'active' ? 'Activo' : 'Inactivo'}`);
                
                // Actualizar listas y contadores
                loadAdvertisementsList();
                updateAdvertisementCounts();
                
            } catch (error) {
                console.error('‚ùå Error creando anuncio:', error);
                alert('‚ùå Error al crear el anuncio. Int√©ntalo de nuevo.');
            }
        }

        // Cargar lista de anuncios
        function loadAdvertisementsList() {
            try {
                const advertisements = JSON.parse(localStorage.getItem('clubAdvertisements') || '[]');
                const filter = document.getElementById('adFilter').value;
                
                let filteredAds = advertisements;
                if (filter === 'active') {
                    filteredAds = advertisements.filter(ad => ad.status === 'active');
                } else if (filter === 'carrusel') {
                    filteredAds = advertisements.filter(ad => ad.type === 'carrusel' && ad.status === 'active');
                } else if (filter === 'expired') {
                    const today = new Date().toISOString().split('T')[0];
                    filteredAds = advertisements.filter(ad => ad.endDate && ad.endDate < today);
                }
                
                const listElement = document.getElementById('advertisementsList');
                
                if (filteredAds.length === 0) {
                    listElement.innerHTML = '<p style="text-align: center; color: #6c757d;">No hay anuncios para mostrar</p>';
                    return;
                }

                let html = '<div style="display: grid; gap: 15px;">';
                
                filteredAds.sort((a, b) => a.position - b.position).forEach(ad => {
                    const statusColors = {
                        'active': '#059669',
                        'inactive': '#6c757d',
                        'pending': '#f59e0b'
                    };
                    
                    const typeColors = {
                        'banner': '#3b82f6',
                        'carrusel': '#8b5cf6',
                        'sidebar': '#10b981',
                        'popup': '#dc2626'
                    };
                    
                    const isExpired = ad.endDate && new Date(ad.endDate) < new Date();
                    
                    html += `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid ${statusColors[ad.status]};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <div style="flex: 1;">
                                    <h4 style="margin: 0; color: #1e3a8a;">üì¢ ${ad.title}</h4>
                                    <p style="margin: 5px 0; color: #666; font-weight: bold;">üè¢ ${ad.company}</p>
                                    ${ad.description ? `<p style="margin: 5px 0; color: #666;">${ad.description}</p>` : ''}
                                </div>
                                <div style="text-align: right; margin-left: 15px;">
                                    <span style="background: ${statusColors[ad.status]}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">${ad.status}</span>
                                    <br>
                                    <span style="background: ${typeColors[ad.type]}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; margin-top: 5px; display: inline-block;">${ad.type}</span>
                                </div>
                            </div>
                            
                            ${ad.image ? `<div style="margin: 10px 0;"><img src="${ad.image}" style="max-width: 200px; max-height: 100px; object-fit: cover; border-radius: 8px;"></div>` : ''}
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; font-size: 0.9rem;">
                                <div><strong>üìä Posici√≥n:</strong> ${ad.position}</div>
                                <div><strong>üè∑Ô∏è Categor√≠a:</strong> ${ad.category}</div>
                                <div><strong>üëÅÔ∏è Vistas:</strong> ${ad.views}</div>
                                <div><strong>üñ±Ô∏è Clicks:</strong> ${ad.clicks}</div>
                                ${ad.startDate ? `<div><strong>üìÖ Inicio:</strong> ${ad.startDate}</div>` : ''}
                                ${ad.endDate ? `<div><strong>üìÖ Fin:</strong> ${ad.endDate}</div>` : ''}
                            </div>
                            
                            ${isExpired ? '<div style="background: #dc2626; color: white; padding: 5px; border-radius: 5px; margin-top: 10px; text-align: center;">‚ö†Ô∏è ANUNCIO EXPIRADO</div>' : ''}
                            
                            <div style="margin-top: 15px;">
                                <button class="btn btn-sm" onclick="editAdvertisement('${ad.id}')" style="background: #3b82f6; color: white; margin-right: 5px;">‚úèÔ∏è Editar</button>
                                <button class="btn btn-sm" onclick="toggleAdvertisementStatus('${ad.id}')" style="background: ${ad.status === 'active' ? '#f59e0b' : '#059669'}; color: white; margin-right: 5px;">${ad.status === 'active' ? '‚è∏Ô∏è Pausar' : '‚ñ∂Ô∏è Activar'}</button>
                                <button class="btn btn-sm" onclick="deleteAdvertisement('${ad.id}')" style="background: #dc2626; color: white;">üóëÔ∏è Eliminar</button>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                listElement.innerHTML = html;

            } catch (error) {
                console.error('‚ùå Error cargando anuncios:', error);
                document.getElementById('advertisementsList').innerHTML = '<p style="text-align: center; color: #dc2626;">Error al cargar los anuncios</p>';
            }
        }

        // Filtrar anuncios
        function filterAdvertisements() {
            loadAdvertisementsList();
        }

        // Cambiar estado del anuncio
        function toggleAdvertisementStatus(adId) {
            try {
                const advertisements = JSON.parse(localStorage.getItem('clubAdvertisements') || '[]');
                const adIndex = advertisements.findIndex(ad => ad.id === adId);
                
                if (adIndex !== -1) {
                    const currentStatus = advertisements[adIndex].status;
                    advertisements[adIndex].status = currentStatus === 'active' ? 'inactive' : 'active';
                    
                    localStorage.setItem('clubAdvertisements', JSON.stringify(advertisements));
                    
                    alert(`‚úÖ Anuncio ${advertisements[adIndex].status === 'active' ? 'activado' : 'desactivado'} exitosamente`);
                    
                    loadAdvertisementsList();
                    updateAdvertisementCounts();
                }
            } catch (error) {
                console.error('‚ùå Error cambiando estado:', error);
                alert('‚ùå Error al cambiar el estado del anuncio');
            }
        }

        // Eliminar anuncio
        function deleteAdvertisement(adId) {
            try {
                if (confirm('‚ùå ¬øEst√°s seguro de que quieres eliminar este anuncio?\n\nEsta acci√≥n no se puede deshacer.')) {
                    const advertisements = JSON.parse(localStorage.getItem('clubAdvertisements') || '[]');
                    const filteredAds = advertisements.filter(ad => ad.id !== adId);
                    
                    localStorage.setItem('clubAdvertisements', JSON.stringify(filteredAds));
                    
                    alert('‚úÖ Anuncio eliminado exitosamente');
                    
                    loadAdvertisementsList();
                    updateAdvertisementCounts();
                }
            } catch (error) {
                console.error('‚ùå Error eliminando anuncio:', error);
                alert('‚ùå Error al eliminar el anuncio');
            }
        }

        // Editar anuncio (funci√≥n b√°sica)
        function editAdvertisement(adId) {
            alert('üîÑ Funci√≥n de edici√≥n en desarrollo. Por favor, elimina y crea un nuevo anuncio.');
        }

        // Actualizar contadores de anuncios
        function updateAdvertisementCounts() {
            try {
                const advertisements = JSON.parse(localStorage.getItem('clubAdvertisements') || '[]');
                const today = new Date().toISOString().split('T')[0];
                
                const activeCount = advertisements.filter(ad => ad.status === 'active').length;
                const totalCount = advertisements.length;
                const carouselCount = advertisements.filter(ad => ad.type === 'carrusel' && ad.status === 'active').length;
                const expiredCount = advertisements.filter(ad => ad.endDate && ad.endDate < today).length;
                
                // Actualizar contadores en la interfaz
                const activeElement = document.getElementById('activeAdsCount');
                const totalElement = document.getElementById('totalAdsCount');
                const carouselElement = document.getElementById('carouselAdsCount');
                const expiredElement = document.getElementById('expiredAdsCount');
                
                if (activeElement) activeElement.textContent = activeCount;
                if (totalElement) totalElement.textContent = totalCount;
                if (carouselElement) carouselElement.textContent = carouselCount;
                if (expiredElement) expiredElement.textContent = expiredCount;
                
                console.log('üìä Contadores de anuncios actualizados:', { activeCount, totalCount, carouselCount, expiredCount });
                
            } catch (error) {
                console.error('‚ùå Error actualizando contadores de anuncios:', error);
            }
        }

        // ===== M√ìDULO DE CONFIGURACI√ìN - LOGO DEL CLUB =====
        
        // Cargar logo al seleccionar archivo
        document.addEventListener('DOMContentLoaded', function() {
            const logoFile = document.getElementById('logoFile');
            if (logoFile) {
                logoFile.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        if (file.size > 2 * 1024 * 1024) { // 2MB
                            alert('‚ùå El archivo es demasiado grande. M√°ximo 2MB.');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const preview = document.getElementById('logoPreview');
                            preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // Cargar logo existente al cargar la p√°gina
            loadExistingLogo();
            loadLogoMessage();
            loadThemeSettings();
            loadContactInfo();
        });

        function uploadLogo() {
            try {
                const fileInput = document.getElementById('logoFile');
                const file = fileInput.files[0];
                
                if (!file) {
                    alert('‚ùå Por favor, selecciona un archivo de imagen.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const logoData = {
                        id: 'LOGO_CDSANABRIACF',
                        dataUrl: e.target.result,
                        fileName: file.name,
                        fileSize: file.size,
                        uploadDate: new Date().toISOString(),
                        teamId: 'CDSANABRIACF'
                    };
                    
                    localStorage.setItem('clubLogo', JSON.stringify(logoData));
                    
                    alert('‚úÖ Logo del club guardado correctamente.');
                    console.log('üèÜ Logo del club guardado:', file.name);
                };
                reader.readAsDataURL(file);
                
            } catch (error) {
                console.error('‚ùå Error guardando logo:', error);
                alert('‚ùå Error al guardar el logo del club.');
            }
        }

        function removeLogo() {
            try {
                if (confirm('¬øEst√°s seguro de que quieres eliminar el logo del club?')) {
                    localStorage.removeItem('clubLogo');
                    
                    const preview = document.getElementById('logoPreview');
                    preview.innerHTML = '<span style="color: #666;">Sin logo</span>';
                    
                    const fileInput = document.getElementById('logoFile');
                    fileInput.value = '';
                    
                    alert('‚úÖ Logo del club eliminado correctamente.');
                    console.log('üóëÔ∏è Logo del club eliminado');
                }
            } catch (error) {
                console.error('‚ùå Error eliminando logo:', error);
                alert('‚ùå Error al eliminar el logo del club.');
            }
        }

        function loadExistingLogo() {
            try {
                const logoData = JSON.parse(localStorage.getItem('clubLogo') || 'null');
                if (logoData && logoData.dataUrl) {
                    const preview = document.getElementById('logoPreview');
                    preview.innerHTML = `<img src="${logoData.dataUrl}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                }
            } catch (error) {
                console.error('‚ùå Error cargando logo existente:', error);
            }
        }

        // ===== M√ìDULO DE CONFIGURACI√ìN - MENSAJE DEL LOGO =====
        
        function saveLogoMessage() {
            try {
                const messageText = document.getElementById('logoMessage').value.trim();
                
                if (!messageText) {
                    alert('‚ùå Por favor, escribe un mensaje.');
                    return;
                }
                
                // Guardar en la configuraci√≥n del equipo
                const teamSettings = JSON.parse(localStorage.getItem('cdsanabriacfSettings') || '{}');
                teamSettings.logoMessage = messageText;
                localStorage.setItem('cdsanabriacfSettings', JSON.stringify(teamSettings));
                
                alert('‚úÖ Mensaje del logo guardado correctamente.\n\nüîÑ El mensaje se aplicar√° autom√°ticamente en la p√°gina principal.');
                console.log('üí¨ Mensaje del logo guardado:', messageText);
                
            } catch (error) {
                console.error('‚ùå Error guardando mensaje del logo:', error);
                alert('‚ùå Error al guardar el mensaje del logo.');
            }
        }

        function resetLogoMessage() {
            try {
                if (confirm('¬øEst√°s seguro de que quieres restablecer el mensaje del logo al valor por defecto?')) {
                    const defaultMessage = '¬°Bienvenidos al Club Deportivo Sanabriacf! ‚öΩ';
                    
                    document.getElementById('logoMessage').value = defaultMessage;
                    
                    // Guardar en la configuraci√≥n del equipo
                    const teamSettings = JSON.parse(localStorage.getItem('cdsanabriacfSettings') || '{}');
                    teamSettings.logoMessage = defaultMessage;
                    localStorage.setItem('cdsanabriacfSettings', JSON.stringify(teamSettings));
                    
                    console.log('üîÑ Mensaje del logo restablecido:', defaultMessage);
                }
            } catch (error) {
                console.error('‚ùå Error restableciendo mensaje del logo:', error);
                alert('‚ùå Error al restablecer el mensaje del logo.');
            }
        }

        function loadLogoMessage() {
            try {
                const teamSettings = JSON.parse(localStorage.getItem('cdsanabriacfSettings') || '{}');
                const messageText = teamSettings.logoMessage || '¬°Bienvenidos al Club Deportivo Sanabriacf! ‚öΩ';
                
                document.getElementById('logoMessage').value = messageText;
                console.log('üí¨ Mensaje del logo cargado:', messageText);
                
            } catch (error) {
                console.error('‚ùå Error cargando mensaje del logo:', error);
            }
        }

        // ===== M√ìDULO DE CONFIGURACI√ìN - COLORES Y TEMA =====
        
        function saveThemeSettings() {
            try {
                const themeSettings = {
                    primaryColor: document.getElementById('primaryColor').value,
                    secondaryColor: document.getElementById('secondaryColor').value,
                    fontFamily: document.getElementById('fontFamily').value,
                    fontSize: document.getElementById('fontSize').value,
                    teamId: 'CDSANABRIACF',
                    lastModified: new Date().toISOString()
                };
                
                localStorage.setItem('clubThemeSettings', JSON.stringify(themeSettings));
                
                // Aplicar cambios inmediatamente en el panel de administraci√≥n
                applyThemeSettings(themeSettings);
                
                // Notificar a la p√°gina principal si est√° abierta
                notifyMainPageOfThemeChange(themeSettings);
                
                alert('‚úÖ Configuraci√≥n de tema guardada y aplicada correctamente.\n\nüîÑ Los cambios se aplicar√°n autom√°ticamente a la p√°gina principal.');
                console.log('üé® Configuraci√≥n de tema guardada:', themeSettings);
                
            } catch (error) {
                console.error('‚ùå Error guardando configuraci√≥n de tema:', error);
                alert('‚ùå Error al guardar la configuraci√≥n de tema.');
            }
        }

        // Funci√≥n para notificar a la p√°gina principal del cambio de tema
        function notifyMainPageOfThemeChange(themeSettings) {
            try {
                // Buscar la ventana de la p√°gina principal
                const mainPageWindow = window.opener || window.parent;
                
                if (mainPageWindow && mainPageWindow !== window) {
                    // Enviar mensaje a la p√°gina principal
                    mainPageWindow.postMessage({
                        type: 'THEME_CHANGED',
                        themeSettings: themeSettings
                    }, '*');
                    
                    console.log('üì¢ Notificaci√≥n enviada a la p√°gina principal sobre cambio de tema');
                }
            } catch (error) {
                console.error('‚ùå Error notificando cambio de tema:', error);
            }
        }

        function resetThemeSettings() {
            try {
                if (confirm('¬øEst√°s seguro de que quieres restablecer la configuraci√≥n de tema a los valores por defecto?')) {
                    // Valores por defecto
                    document.getElementById('primaryColor').value = '#dc2626';
                    document.getElementById('secondaryColor').value = '#3b82f6';
                    document.getElementById('fontFamily').value = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
                    document.getElementById('fontSize').value = '16px';
                    
                    // Guardar y aplicar
                    saveThemeSettings();
                    
                    alert('‚úÖ Configuraci√≥n de tema restablecida a valores por defecto.');
                }
            } catch (error) {
                console.error('‚ùå Error restableciendo tema:', error);
                alert('‚ùå Error al restablecer la configuraci√≥n de tema.');
            }
        }

        function loadThemeSettings() {
            try {
                const themeSettings = JSON.parse(localStorage.getItem('clubThemeSettings') || 'null');
                if (themeSettings) {
                    document.getElementById('primaryColor').value = themeSettings.primaryColor || '#dc2626';
                    document.getElementById('secondaryColor').value = themeSettings.secondaryColor || '#3b82f6';
                    document.getElementById('fontFamily').value = themeSettings.fontFamily || "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
                    document.getElementById('fontSize').value = themeSettings.fontSize || '16px';
                    
                    // Aplicar configuraci√≥n
                    applyThemeSettings(themeSettings);
                } else {
                    // Valores por defecto si no hay configuraci√≥n
                    document.getElementById('primaryColor').value = '#dc2626';
                    document.getElementById('secondaryColor').value = '#3b82f6';
                    document.getElementById('fontFamily').value = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
                    document.getElementById('fontSize').value = '16px';
                    
                    console.log('‚ÑπÔ∏è No hay configuraci√≥n de tema guardada, usando valores por defecto');
                }
            } catch (error) {
                console.error('‚ùå Error cargando configuraci√≥n de tema:', error);
            }
        }

        function applyThemeSettings(settings) {
            try {
                // Aplicar colores al CSS
                const root = document.documentElement;
                root.style.setProperty('--primary-color', settings.primaryColor);
                root.style.setProperty('--secondary-color', settings.secondaryColor);
                
                // Aplicar fuente
                document.body.style.fontFamily = settings.fontFamily;
                document.body.style.fontSize = settings.fontSize;
                
                // Actualizar gradientes y elementos espec√≠ficos
                const adminHeader = document.querySelector('.admin-header');
                if (adminHeader) {
                    adminHeader.style.background = `linear-gradient(135deg, ${settings.primaryColor} 0%, ${settings.secondaryColor} 100%)`;
                }
                
                const navTabs = document.querySelectorAll('.nav-tab.active');
                navTabs.forEach(tab => {
                    tab.style.background = settings.primaryColor;
                });
                
            } catch (error) {
                console.error('‚ùå Error aplicando configuraci√≥n de tema:', error);
            }
        }

        // ===== M√ìDULO DE CONFIGURACI√ìN - DATOS DE CONTACTO =====
        
        function saveContactInfo() {
            try {
                const contactInfo = {
                    email: document.getElementById('clubEmail').value.trim(),
                    phone: document.getElementById('clubPhone').value.trim(),
                    address: document.getElementById('clubAddress').value.trim(),
                    website: document.getElementById('clubWebsite').value.trim(),
                    whatsapp: document.getElementById('clubWhatsApp').value.trim(),
                    hours: document.getElementById('clubHours').value.trim(),
                    teamId: 'CDSANABRIACF',
                    lastModified: new Date().toISOString()
                };
                
                localStorage.setItem('clubContactInfo', JSON.stringify(contactInfo));
                
                alert('‚úÖ Informaci√≥n de contacto guardada correctamente.');
                console.log('üìû Informaci√≥n de contacto guardada:', contactInfo);
                
            } catch (error) {
                console.error('‚ùå Error guardando informaci√≥n de contacto:', error);
                alert('‚ùå Error al guardar la informaci√≥n de contacto.');
            }
        }

        function loadContactInfo() {
            try {
                const contactInfo = JSON.parse(localStorage.getItem('clubContactInfo') || 'null');
                if (contactInfo) {
                    document.getElementById('clubEmail').value = contactInfo.email || '';
                    document.getElementById('clubPhone').value = contactInfo.phone || '';
                    document.getElementById('clubAddress').value = contactInfo.address || '';
                    document.getElementById('clubWebsite').value = contactInfo.website || '';
                    document.getElementById('clubWhatsApp').value = contactInfo.whatsapp || '';
                    document.getElementById('clubHours').value = contactInfo.hours || '';
                    
                    alert('‚úÖ Informaci√≥n de contacto cargada correctamente.');
                } else {
                    alert('‚ÑπÔ∏è No hay informaci√≥n de contacto guardada.');
                }
            } catch (error) {
                console.error('‚ùå Error cargando informaci√≥n de contacto:', error);
                alert('‚ùå Error al cargar la informaci√≥n de contacto.');
            }
        }

        console.log('üöÄ Panel de administraci√≥n CDSANABRIACF cargado correctamente');
    </script>
</body>
</html>
